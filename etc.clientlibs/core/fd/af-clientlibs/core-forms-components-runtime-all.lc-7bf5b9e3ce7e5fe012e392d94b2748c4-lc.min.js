(()=>{"use strict";var e={5848:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseNode=t.exclude=t.include=t.dependencyTracked=t.qualifiedName=t.target=t.staticFields=t.dynamicProps=t.editableProperties=void 0;const r=i(9333),a=i(3332),o=i(8744),l=i(3820),u=s(i(8224)),c=i(4476);t.editableProperties=["value","label","description","visible","enabled","valid","errorMessage","readOnly","enum","enumNames","required","properties","exclusiveMinimum","exclusiveMaximum","maximum","maxItems","minimum","minItems","checked"],t.dynamicProps=[...t.editableProperties,"index","activeChild"],t.staticFields=["plain-text","image"];class d{constructor(e,t){this._action=e,e.target?(this._currentTarget=t,this._target=e.target):(this._target=t,this._currentTarget=t)}get type(){return this._action.type}get payload(){return this._action.payload}get metadata(){return this._action.metadata}get target(){return this._target}get currentTarget(){return this._currentTarget}get isCustomEvent(){return this._action.isCustomEvent}get originalAction(){return this._action.originalAction}toString(){return this._action.toString()}}t.target=Symbol("target"),t.qualifiedName=Symbol("qualifiedName"),t.dependencyTracked=function(){return function(e,t,i){const n=i.get;null!=n&&(i.get=function(){return this.ruleEngine.trackDependency(this,t),n.call(this)})}};const h=e=>(...t)=>(i,n,s)=>{const r=s.get;null!=r&&(s.get=function(){if(t.indexOf(this.fieldType)>-1===e)return r.call(this)});const a=s.set;null!=a&&(s.set=function(i){this===this._ruleNode&&console.error(`Property '${n}' is being set through a proxy, which is not supported. Please use globals.functions.setProperty instead.`),t.indexOf(this.fieldType)>-1===e&&a.call(this,i)})};t.include=h(!0),t.exclude=h(!1);class p{constructor(e,i){var n,s;this._options=i,this._lang="",this._callbacks={},this._dependents=[],this._tokens=[],this._eventSource=r.EventSource.CODE,this._fragment="$form",this._idSet=this.createIdSet(),this[t.qualifiedName]=null,this._jsonModel=Object.assign(Object.assign({},e),{id:this.form.getUniqueId(null==e?void 0:e.id)}),(null===(n=this.parent)||void 0===n?void 0:n.isFragment)?this._fragment=this.parent.qualifiedName:(null===(s=this.parent)||void 0===s?void 0:s.fragment)&&(this._fragment=this.parent.fragment),this._propertiesManager=new o.PropertiesManager(this)}createIdSet(){return new Set}get isContainer(){return!1}get fragment(){return this._fragment}setupRuleNode(){const e=this;this._ruleNode=new Proxy(this.ruleNodeReference(),{get:(t,i)=>e.getFromRule(t,i)})}ruleNodeReference(){return this}getRuleNode(){return this._ruleNode}getFromRule(e,i){if(i===Symbol.toPrimitive||"valueOf"===i&&!e.hasOwnProperty("valueOf"))return this.valueOf;if(i===t.target)return this;if("string"==typeof i)if(i.startsWith("$")){if("function"!=typeof this[i=i.substr(1)]){const e=this[i];return e instanceof p?e.getRuleNode():e instanceof Array?e.map((e=>e instanceof p?e.getRuleNode():e)):e}}else{if(e.hasOwnProperty(i))return e[i];if("function"==typeof e[i])return e[i]}}get id(){return this._jsonModel.id}get index(){return this.parent?this.parent.indexOf(this):0}get parent(){return this._options.parent}get type(){return this._jsonModel.type}get repeatable(){var e;return null===(e=this.parent)||void 0===e?void 0:e.hasDynamicItems()}get fieldType(){return this._jsonModel.fieldType||"text-input"}get":type"(){return this._jsonModel[":type"]||this.fieldType}get name(){return this._jsonModel.name}get screenReaderText(){return this._jsonModel.screenReaderText}get description(){return this._jsonModel.description}set description(e){this._setProperty("description",e)}get dataRef(){return this._jsonModel.dataRef}get visible(){var e,t;return void 0!==(null===(e=this.parent)||void 0===e?void 0:e.visible)?!!(null===(t=this.parent)||void 0===t?void 0:t.visible)&&this._jsonModel.visible:this._jsonModel.visible}set visible(e){if(e!==this._jsonModel.visible){const t=(0,a.propertyChange)("visible",e,this._jsonModel.visible);this._jsonModel.visible=e,this.notifyDependents(t)}}get form(){return this._options.form}get ruleEngine(){return this.form.ruleEngine}get label(){return this._jsonModel.label}set label(e){if(!(null!==e&&null!==this._jsonModel.label&&"object"==typeof e&&"object"==typeof this._jsonModel.label?JSON.stringify(e)===JSON.stringify(this._jsonModel.label):e===this._jsonModel.label)){const t=(0,a.propertyChange)("label",e,this._jsonModel.label);this._jsonModel=Object.assign(Object.assign({},this._jsonModel),{label:e}),this.notifyDependents(t)}}get uniqueItems(){return this._jsonModel.uniqueItems}isTransparent(){var e,t;const i="array"===(null===(t=null===(e=this.parent)||void 0===e?void 0:e._jsonModel)||void 0===t?void 0:t.type);return!this._jsonModel.name&&!i}getDependents(){return this._dependents.map((e=>({id:e.node.id,propertyName:e.propertyName})))}getState(e=!1){return this.withDependencyTrackingControl(!0,(()=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},this._jsonModel),{properties:this.properties,index:this.index,parent:void 0,qualifiedName:this.qualifiedName}),!0===this.repeatable?{repeatable:!0,minOccur:this.parent.minItems,maxOccur:this.parent.maxItems}:{}),{":type":this[":type"]}),e?{_dependents:this._dependents.length?this.getDependents():void 0,allowedComponents:void 0,columnClassNames:void 0,columnCount:void 0,gridClassNames:void 0}:{})))}subscribe(e,t="change"){return this._callbacks[t]=this._callbacks[t]||[],this._callbacks[t].push(e),{unsubscribe:()=>{this._callbacks[t]=this._callbacks[t].filter((t=>t!==e))}}}_addDependent(e,i){if(void 0===this._dependents.find((({node:t,propertyName:n})=>{let s=t===e;return s&&i&&i.startsWith("properties.")&&(s=n===i),s}))){const n=this.subscribe((n=>{const s=n.payload.changes,r=[...t.dynamicProps,"items"];s.findIndex((e=>{const t=e.propertyName;return r.includes(t)||t.startsWith("properties.")&&i===t}))>-1&&("deps"===this.form.changeEventBehaviour?e.dispatch(n):e.dispatch(new a.ExecuteRule))}));this._dependents.push({node:e,propertyName:i,subscription:n})}}removeDependent(e){const t=this._dependents.findIndex((({node:t})=>t===e));t>-1&&(this._dependents[t].subscription.unsubscribe(),this._dependents.splice(t,1))}queueEvent(e){const t=new d(e,this);this.form.getEventQueue().queue(this,t,["valid","invalid"].indexOf(t.type)>-1)}dispatch(e){this.queueEvent(e),this.form.getEventQueue().runPendingQueue()}withDependencyTrackingControl(e,t){var i,n,s;const r=null===(i=this.form)||void 0===i?void 0:i.ruleEngine.getDependencyTracking();e&&(null===(n=this.form)||void 0===n||n.ruleEngine.setDependencyTracking(!1));try{return t()}finally{e&&(null===(s=this.form)||void 0===s||s.ruleEngine.setDependencyTracking(r))}}notifyDependents(e){const t=this._jsonModel._dependents;t&&(t.forEach((e=>{const t=this.form.getElement(e.id);t&&this._addDependent(t,e.propertyName)})),this._jsonModel._dependents=void 0),(this._callbacks[e.type]||[]).forEach((t=>{this.withDependencyTrackingControl(!0,(()=>{t(new d(e,this))}))}))}isEmpty(e=this._jsonModel.value){return null==e||""===e}_setProperty(e,t,i=!0,n=(e=>{})){const s=this._jsonModel[e];let r=!1;if(r=null!==t&&null!==s&&"object"==typeof t&&"object"==typeof s?JSON.stringify(t)===JSON.stringify(s):s===t,!r){this._jsonModel[e]=t;const r=(0,a.propertyChange)(e,t,s);return i&&this.notifyDependents(r),n.call(this,r),c.validationConstraintsList.includes(e)&&(void 0===this.hasValueBeenSet||this.hasValueBeenSet)&&this.validate(),r.payload.changes}return[]}bindToDataModel(e){if("form"===this.fieldType||"$form"===this.id)return void(this._data=e);const i=this._jsonModel.dataRef;let n,s=e,r="";if(null===i)n=u.default;else if(void 0===i||this.repeatable){if(e!==u.default&&-1===t.staticFields.indexOf(this.fieldType)){s=e;const t=this._jsonModel.name||"",i="array"===e.$type?this.index:t;if(r=i,""!==i){const s=this.defaultDataModel(i);void 0!==s&&("function"==typeof e.$getDataNode?(n=e.$getDataNode(i),void 0===n&&(n=s,e.$addDataNode(i,n))):(console.error(`$getDataNode method is undefined for "${t}" with dataModel type "${e.$type}"`),n=void 0))}else n=void 0}}else try{0===this._tokens.length&&(this._tokens=(0,l.tokenize)(i));let t=e;if(this._tokens[0].type===l.TOK_GLOBAL)t=this.form.getDataNode();else if(this._tokens[0].type===l.TOK_REPEATABLE){let e=this.parent;for(;!e.repeatable&&e!==this.form;)e=e.parent;t=e.getDataNode()}if(void 0!==t){const e=this._tokens[this._tokens.length-1].value,i=this.defaultDataModel(e);n=(0,l.resolveData)(t,this._tokens,i),s=(0,l.resolveData)(t,this._tokens.slice(0,-1)),r=e}}catch(e){console.error(`Error parsing dataRef "${i}" for field "${this.id}". The data of this field will not be exported.`)}return n&&(this.isContainer||s===u.default||n===u.default||(n=null==n?void 0:n.$convertToDataValue(),s.$addDataNode(r,n,!0)),null==n||n.$bindToField(this),this._data=n),this._data}getDataNode(){return this._data}get lang(){return this._jsonModel.lang&&(this._lang=this._jsonModel.lang),this._lang||(this.parent?this._lang=this.parent.lang:this._lang=Intl.DateTimeFormat().resolvedOptions().locale),this._lang}get properties(){return this._propertiesManager.properties}set properties(e){this._propertiesManager.properties=e}getPropertiesManager(){return this._propertiesManager}getNonTransparentParent(){let e=this.parent;for(;null!=e&&e.isTransparent();)e=e.parent;return e}_isAncestorRepeatable(){let e=this.parent;for(;e&&!e.repeatable;)e=e.parent;return Boolean(e)}_initialize(e){if(void 0===this._data){let e,t=this.parent;do{e=t.getDataNode(),t=t.parent}while(void 0===e);this.bindToDataModel(e)}}_applyUpdates(e,t){return e.reduce(((e,i)=>{const n=t[i],s=this._setProperty(i,n,!1);return s.length>0&&(e[i]=s[0]),e}),{})}get qualifiedName(){if(this.isTransparent())return null;if(null!==this[t.qualifiedName])return this[t.qualifiedName];const e=this.getNonTransparentParent();let i;return i=e&&"array"===e.type?`${e.qualifiedName}[${this.index}]`:`${e.qualifiedName}.${this.name}`,this.repeatable||this._isAncestorRepeatable()||(this[t.qualifiedName]=i),i}focus(){this.parent&&(this.parent.activeChild=this)}_getDefaults(){return{}}_applyDefaultsInModel(){Object.entries(this._getDefaults()).map((([e,t])=>{void 0===this._jsonModel[e]&&void 0!==t?this._jsonModel[e]=t:"object"!=typeof t||null===t||Array.isArray(t)||Object.keys(t).forEach((i=>{void 0===this._jsonModel[e][i]&&(this._jsonModel[e][i]=t[i])}))}))}}n([function(e,t,i){const n=i.get;null!=n&&(i.get=function(){return this.ruleEngine.trackDependency(this,t),n.call(this)})}],p.prototype,"index",null),n([function(e,t,i){const n=i.get;null!=n&&(i.get=function(){return this.ruleEngine.trackDependency(this,t),n.call(this)})}],p.prototype,"description",null),n([function(e,t,i){const n=i.get;null!=n&&(i.get=function(){return this.ruleEngine.trackDependency(this,t),n.call(this)})}],p.prototype,"visible",null),n([function(e,t,i){const n=i.get;null!=n&&(i.get=function(){return this.ruleEngine.trackDependency(this,t),n.call(this)})}],p.prototype,"label",null),t.BaseNode=p},3544:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(i(560)),r=i(3332);class a extends s.default{click(){var e;if(!(null===(e=this._events)||void 0===e?void 0:e.click)&&this._jsonModel.buttonType)return"submit"===this._jsonModel.buttonType?this.form.dispatch(new r.Submit({validate_form:!0})):"reset"===this._jsonModel.buttonType?this.form.dispatch(new r.Reset):void 0}}t.default=a},3968:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(i(560));class r extends s.default{constructor(e,t){super(e,t),this._captchaDisplayMode=e.captchaDisplayMode,this._captchaProvider=e.captchaProvider,this._captchaSiteKey=e.captchaSiteKey}getDataNode(){}custom_setProperty(e){this.applyUpdates(e.payload)}get captchaDisplayMode(){return this._captchaDisplayMode}get captchaProvider(){return this._captchaProvider}get captchaSiteKey(){return this._captchaSiteKey}}t.default=r},2716:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(i(560)),a=i(4476),o=i(5848);class l extends r.default{offValue(){const e=this.enum;return e.length>1?e[1]:null}_getConstraintObject(){const e=Object.assign({},super._getConstraintObject());var t;return e.required=(t=this.offValue(),(e,i)=>({valid:a.Constraints.required(e,i).valid&&(!e||i!=t),value:i})),e}_applyDefaults(){var e,t;"boolean"==typeof this._jsonModel.checked&&(this._jsonModel.checked?this._jsonModel.default=null===(e=this._jsonModel.enum)||void 0===e?void 0:e[0]:this._jsonModel.default=null===(t=this._jsonModel.enum)||void 0===t?void 0:t[1]),super._applyDefaults()}_getDefaults(){return Object.assign(Object.assign({},super._getDefaults()),{enforceEnum:!0})}get enum(){return this._jsonModel.enum||[]}updateDataNodeAndTypedValue(e){var t,i;const n=super.updateDataNodeAndTypedValue(e),s=n.find((e=>"value"===e.propertyName));if(s){const e=s.prevValue===(null===(t=this._jsonModel.enum)||void 0===t?void 0:t[0]),r=s.currentValue===(null===(i=this._jsonModel.enum)||void 0===i?void 0:i[0]);e!==r&&n.push({propertyName:"checked",prevValue:e,currentValue:r})}return n}set checked(e){var t,i;this.value=e?null===(t=this._jsonModel.enum)||void 0===t?void 0:t[0]:null===(i=this._jsonModel.enum)||void 0===i?void 0:i[1]}get checked(){var e;return this.value===(null===(e=this._jsonModel.enum)||void 0===e?void 0:e[0])}getState(e=!1,t=!1){return Object.assign(Object.assign({},super.getState(e,t)),{checked:this.checked})}}n([(0,o.dependencyTracked)()],l.prototype,"checked",null),t.default=l},7288:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(i(560));class r extends s.default{constructor(e,t){super(e,t)}_getFallbackType(){const e=super._getFallbackType();return"string"==typeof e?`${e}[]`:"string[]"}_getDefaults(){return Object.assign(Object.assign({},super._getDefaults()),{enforceEnum:!0,enum:[]})}}t.default=r},5504:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FIELD_TYPE=void 0,t.FIELD_TYPE={TEXT_INPUT:"text-input",EMAIL:"email",CAPTCHA:"captcha",MULTILINE_INPUT:"multiline-input",NUMBER_INPUT:"number-input",DATE_INPUT:"date-input",FILE_INPUT:"file-input",DROP_DOWN:"drop-down",RADIO_GROUP:"radio-group",PLAIN_TEXT:"plain-text",CHECKBOX:"checkbox",BUTTON:"button",PANEL:"panel",FORM:"form",CHECKBOX_GROUP:"checkbox-group",IMAGE:"image",TELEPHONE:"tel",PASSWORD:"password"}},5716:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(5088),a=s(i(5376)),o=i(3332),l=s(i(9576)),u=i(5848),c=["readOnly","enabled"];class d extends a.default{constructor(e,t){var i,n;super(e,{form:t.form,parent:t.parent,mode:t.mode}),this._children=[],this._itemTemplate=null,this._isFragment=!1,this._insideFragment=!1,this._activeChild=null,this._isFragment=!0===(null===(n=null===(i=this._jsonModel)||void 0===i?void 0:i.properties)||void 0===n?void 0:n["fd:fragment"]),this.fieldFactory=t.fieldFactory}_getDefaults(){return Object.assign(Object.assign({},super._getDefaults()),{enabled:!0,readOnly:!1})}ruleNodeReference(){return this._childrenReference}get items(){return this._children}get maxItems(){return this._jsonModel.maxItems}set maxItems(e){this._jsonModel.maxItems=e;const t=this._jsonModel.minItems||1,i=this._children.length,n=Math.min(i-e,i-t);if(n>0){for(let t=0;t<n;t++)this.getDataNode().$removeDataNode(e+t),this._childrenReference.pop();const t=this._children.splice(e,n);this.notifyDependents((0,o.propertyChange)("items",t,null))}}get minItems(){return this._jsonModel.minItems}set minItems(e){this._jsonModel.minItems=e;const t=this._children.length-e,i=Math.abs(t);if(t<0){const e=[];for(let t=0;t<i;t++)e.push(this._addChild(this._itemTemplate,null,!0));this.notifyDependents((0,o.propertyChange)("items",e,null))}}hasDynamicItems(){return null!=this._itemTemplate}get isContainer(){return!0}isSiteContainer(e){return(":items"in e||"cqItems"in e)&&!("fieldType"in e)}isAFormField(e){return"fieldType"in e||"id"in e||"name"in e||"dataRef"in e||"type"in e}_getFormAndSitesState(e=!1,t=!1){return this._jsonModel.items?this._jsonModel.items.map((i=>{if(this.isSiteContainer(i)){const e=Object.assign({},(null==i?void 0:i.id)?{id:this.form.getUniqueId()}:{});return Object.assign(Object.assign(Object.assign({},i),e),{":items":this.walkSiteContainerItems(i)})}return this.isAFormField(i)?Object.assign({},this.form.getElement(null==i?void 0:i.id).getState(e,t)):i})):[]}getItemsState(e=!1,t=!1){return"array"===this._jsonModel.type||(0,r.isRepeatable)(this._jsonModel)?this._children.map((e=>Object.assign({},e.getState(!0,t)))):this._getFormAndSitesState(e,t)}getState(e=!1,t=!1){return this.withDependencyTrackingControl(!0,(()=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},super.getState(t)),t?{":items":void 0,":itemsOrder":void 0}:{}),{items:this.getItemsState(e,t)}),("array"===this._jsonModel.type||(0,r.isRepeatable)(this._jsonModel))&&this._itemTemplate?{_itemTemplate:Object.assign({},this._itemTemplate)}:{}),{enabled:this.enabled,readOnly:this.readOnly})))}_createChild(e,t){return this.fieldFactory.createField(e,t)}walkSiteContainerItems(e){return Object.fromEntries(Object.entries(e[":items"]).map((([e,t])=>{if(this.isAFormField(t))return[e,this.form.getElement(null==t?void 0:t.id).getState()];if(this.isSiteContainer(t))return this.walkSiteContainerItems(t);if("object"==typeof t){const i=Object.assign({},(null==t?void 0:t.id)?{id:this.form.getUniqueId()}:{});return[e,Object.assign(Object.assign({},t),i)]}return[e,t]})))}_addChildToRuleNode(e,t){const i=this,{parent:n=this}=t,s="array"==n.type?n._children.length+"":e.name||"";s.length>0&&Object.defineProperty(n._childrenReference,s,{get:()=>(e.isContainer&&e.hasDynamicItems()&&i.ruleEngine.trackDependency(e,"items"),i.hasDynamicItems()?(i.ruleEngine.trackDependency(i,"items"),void 0!==this._children[s]?this._children[s].getRuleNode():void 0):e.getRuleNode()),configurable:!0,enumerable:!0})}_addChild(e,t,i=!1,n="create"){let s=this;for(;null!=s&&s.isTransparent();)s=s.parent;("number"!=typeof t||t>s._children.length)&&(t=this._children.length);const a=this.form,o=Object.assign({index:t},(0,r.deepClone)(e,i?()=>a.getUniqueId():void 0)),l=this._createChild(o,{parent:this,form:this.form,mode:n});return e.id=l.id,this.form.fieldAdded(l),this._addChildToRuleNode(l,{parent:s}),t===this._children.length?this._children.push(l):this._children.splice(t,0,l),l}indexOf(e){return this._children.indexOf(e)}defaultDataModel(e){const t=this._jsonModel.type||void 0;if(void 0!==t){const i="array"===t?[]:{};return new l.default(e,i,t)}}_canHaveRepeatingChildren(e="create"){const t=this._jsonModel.items;return"array"==this._jsonModel.type&&null!=this.getDataNode()&&(1===t.length||t.length>0&&1==t[0].repeatable&&"restore"===e)}get isFragment(){var e,t;return this._isFragment||(null===(t=null===(e=this._jsonModel)||void 0===e?void 0:e.properties)||void 0===t?void 0:t["fd:fragment"])}_initialize(e){super._initialize(e);const t=this._jsonModel.items||[];if(this._childrenReference="array"==this._jsonModel.type?[]:{},this._canHaveRepeatingChildren(e)){this._itemTemplate=this._jsonModel._itemTemplate||(0,r.deepClone)(t[0]),this._jsonModel._itemTemplate=void 0,"restore"===e&&(this._itemTemplate.repeatable=void 0),"number"!=typeof this._jsonModel.minItems&&(this._jsonModel.minItems=0),"number"!=typeof this._jsonModel.maxItems&&(this._jsonModel.maxItems=-1),"number"!=typeof this._jsonModel.initialItems&&(this._jsonModel.initialItems=Math.max(1,this._jsonModel.minItems));const i="restore"===e?this._jsonModel.items.length:this._jsonModel.initialItems;for(let n=0;n<i;n++){let i;if("restore"===e){let s=this._itemTemplate;n<this._jsonModel.items.length&&(s=(0,r.deepClone)(t[n]),s.repeatable=void 0),i=this._addChild(s,void 0,n>this._jsonModel.items.length-1,e)}else i=this._addChild(this._itemTemplate,void 0,n>this._jsonModel.items.length-1);"create"===e&&(t[0].id=i.id),i._initialize(e)}}else t.length>0?(t.forEach((t=>{this.isSiteContainer(t)?this._initializeSiteContainer(t):this.isAFormField(t)?this._addChild(t,void 0,!1,e)._initialize(e):this.form.logger.warn(`A container item was not initialized. ${t}`)})),this._jsonModel.minItems=this._children.length,this._jsonModel.maxItems=this._children.length,this._jsonModel.initialItems=this._children.length):this.form.logger.warn("A container exists with no items.");this.setupRuleNode()}_initializeSiteContainer(e){Object.entries(e[":items"]).forEach((([e,t])=>{if(this.isAFormField(t))this._addChild(t)._initialize();else if(this.isSiteContainer(t))return this._initializeSiteContainer(t)}))}addItem(e){if(("addItem"===e.type||"addInstance"==e.type)&&null!=this._itemTemplate&&(-1===this._jsonModel.maxItems||this._children.length<this._jsonModel.maxItems)){const t=this.getDataNode();let i=e.payload;const n=this._addChild(this._itemTemplate,e.payload,!0);("number"!=typeof i||i>this._children.length)&&(i=this._children.length);const s=n.defaultDataModel(i);s&&t.$addDataNode(i,s,!1,this),n._initialize("create"),this.notifyDependents((0,o.propertyChange)("items",n.getState(),null)),n.dispatch(new o.Initialize),n.dispatch(new o.ExecuteRule);for(let e=i+1;e<this._children.length;e++)this._children[e].dispatch(new o.ExecuteRule)}}removeItem(e){if(("removeItem"===e.type||"removeInstance"==e.type)&&null!=this._itemTemplate){if(0==this._children.length)return;let t=e.payload;"number"!=typeof t&&(t=this._children.length-1);const i=this._children[t].getState();if(this._children.length>this._jsonModel.minItems){this._childrenReference.pop(),this._children.splice(t,1),this.getDataNode().$removeDataNode(t,this);for(let e=t;e<this._children.length;e++)this._children[e].dispatch(new o.ExecuteRule);this.notifyDependents((0,o.propertyChange)("items",null,i))}}}queueEvent(e){var t;super.queueEvent(e),(null===(t=e.metadata)||void 0===t?void 0:t.dispatch)&&this.items.forEach((t=>{t.queueEvent(e)}))}reset(){if(("array"===this.type||(0,r.isRepeatable)(this._jsonModel))&&this.items.length>this._jsonModel.initialItems){const e=this.items.length-this._jsonModel.initialItems;for(let t=0;t<e;t++)this.dispatch(new o.RemoveItem)}this.items.forEach((e=>{e.reset()}))}validate(){return this.items.flatMap((e=>e.validate())).filter((e=>""!==e.fieldName))}dispatch(e){super.dispatch(e)}importData(e){var t;if(void 0!==this._data&&"array"===this.type&&Array.isArray(e)){const i=new l.default(this._data.$name,e,this._data.$type,this._data.parent);try{null===(t=this._data.parent)||void 0===t||t.$addDataNode(i.$name,i,!0)}catch(e){return void this.form.logger.error(`unable to setItems for ${this.qualifiedName} : ${e}`)}this._data=i;const n=this.syncDataAndFormModel(i),s=this.items.length;n.added.forEach((e=>{this.notifyDependents((0,o.propertyChange)("items",e.getState(),null)),e.dispatch(new o.Initialize)}));for(let e=0;e<s;e+=1)this._children[e].dispatch(new o.ExecuteRule);n.removed.forEach((e=>{this.notifyDependents((0,o.propertyChange)("items",null,e.getState()))}))}else void 0===this._data&&console.warn(`Data node is null, hence importData did not work for panel "${this.name}". Check if parent has a dataRef set to null.`)}syncDataAndFormModel(e){const t={added:[],removed:[]};if("array"===(null==e?void 0:e.$type)&&null!=this._itemTemplate){const i=null==e?void 0:e.$value.length,n=this._children.length,s=-1===this._jsonModel.maxItems?i:this._jsonModel.maxItems,r=this._jsonModel.minItems;let a=Math.min(i-n,s-n);const o=Math.min(n-i,n-r);for(;a>0;){a--;const e=this._addChild(this._itemTemplate,this.items.length,!0);e._initialize("create"),t.added.push(e)}if(o>0)for(let e=0;e<o;e++)this._childrenReference.pop(),t.removed.push(this._children.pop())}return this._children.forEach((t=>{let i=t.bindToDataModel(e);t.isContainer&&!i&&(i=e),t.syncDataAndFormModel(i)})),t}get activeChild(){return this._activeChild}set activeChild(e){var t;if(e!==this._activeChild){let i=this._activeChild;for(;i instanceof d;){const e=i.activeChild;i.activeChild=null,i=e}const n=(0,o.propertyChange)("activeChild",null==e?void 0:e.getState(),null===(t=this._activeChild)||void 0===t?void 0:t.getState());this._activeChild=e,this.parent&&null!==e&&(this.parent.activeChild=this),this._jsonModel.activeChild=null==e?void 0:e.id,this.notifyDependents(n)}}get enabled(){var e;const t=null===(e=this.parent)||void 0===e?void 0:e.enabled;return void 0!==t?!!t&&this._jsonModel.enabled:this._jsonModel.enabled}set enabled(e){this._setProperty("enabled",e,!0,this.notifyChildren)}get readOnly(){var e;return void 0!==(null===(e=this.parent)||void 0===e?void 0:e.readOnly)&&!!this.parent.readOnly||this._jsonModel.readOnly}set readOnly(e){this._setProperty("readOnly",e,!0,this.notifyChildren)}notifyChildren(e){if(void 0!==e.payload&&void 0!==e.payload.changes)for(const t of e.payload.changes)void 0!==t.propertyName&&c.includes(t.propertyName)&&this.items.forEach((i=>{t.currentValue!==i._jsonModel[t.propertyName]&&(i._jsonModel[t.propertyName]=t.currentValue,this.notifyDependents.call(i,(0,o.propertyChange)(t.propertyName,i.getState()[t.propertyName],null))),"panel"===i.fieldType&&this.notifyChildren.call(i,e)}))}}n([(0,u.dependencyTracked)()],d.prototype,"maxItems",null),n([(0,u.dependencyTracked)()],d.prototype,"minItems",null),n([(0,u.dependencyTracked)()],d.prototype,"activeChild",null),t.default=d},6884:function(e,t,i){var n,s,r=this&&this.__classPrivateFieldGet||function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=a(i(560)),l=i(6608);class u extends o.default{constructor(){super(...arguments),n.add(this),this._dataFormat="yyyy-MM-dd"}_applyDefaults(){super._applyDefaults(),this.locale=(new Intl.DateTimeFormat).resolvedOptions().locale,this._jsonModel.editFormat||(this._jsonModel.editFormat="short"),this._jsonModel.displayFormat||(this._jsonModel.displayFormat=this._jsonModel.editFormat),this._jsonModel.placeholder||(this._jsonModel.placeholder=(0,l.parseDateSkeleton)(this._jsonModel.editFormat,this.locale))}get value(){return super.value}set value(e){if("number"==typeof e){const t=r(this,n,"m",s).call(this,e);t&&(super.value=t)}else if("short"!==this._jsonModel.editFormat&&"date|short"!==this._jsonModel.editFormat){const t=(0,l.parseDate)(e,this.locale,this._jsonModel.editFormat)||(0,l.parseDate)(e,this.locale,"yyyy-MM-dd");t instanceof Date?super.value=(0,l.formatDate)(t,this.locale,this._dataFormat):super.value=e}else super.value=e}get minimum(){return super.minimum}set minimum(e){if("number"==typeof e){const t=r(this,n,"m",s).call(this,e);t&&(super.minimum=t)}else"string"==typeof e&&(super.minimum=e)}get maximum(){return super.maximum}set maximum(e){if("number"==typeof e){const t=r(this,n,"m",s).call(this,e);t&&(super.maximum=t)}else"string"==typeof e&&(super.maximum=e)}}n=new WeakSet,s=function(e){const t=(0,l.numberToDatetime)(e);return isNaN(t)?null:(0,l.formatDate)(t,this.locale,this._dataFormat)},t.default=u},3260:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(i(6884));class r extends s.default{constructor(){super(...arguments),this._dataFormat="yyyy-MM-ddTHH:mm"}_applyDefaults(){super._applyDefaults()}get value(){return super.value}set value(e){super.value=e}}t.default=r},6764:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(i(560));class r extends s.default{_getDefaults(){return Object.assign(Object.assign({},super._getDefaults()),{format:"email"})}}t.default=r},560:function(e,t,i){var n,s,r=this&&this.__decorate||function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},a=this&&this.__classPrivateFieldGet||function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=i(9333),u=i(4476),c=i(3332),d=o(i(5376)),h=i(9616),p=o(i(584)),f=i(5848),m=o(i(8224)),g=i(6608),_=i(1060),v=["string","number","integer","boolean","file","string[]","number[]","integer[]","boolean[]","file[]","array","object"];class y extends d.default{constructor(e,t){super(e,t),n.add(this),this._ruleNodeReference=[],this._hasValueBeenSet=!1,"restore"!==t.mode&&(this._applyDefaults(),this.queueEvent(new c.Initialize),"deps"===this.form.changeEventBehaviour?this.queueEvent(new c.Change({changes:[]})):this.queueEvent(new c.ExecuteRule))}get hasValueBeenSet(){return this._hasValueBeenSet}_initialize(){super._initialize(),this.setupRuleNode()}ruleNodeReference(){var e;return(null===(e=this.type)||void 0===e?void 0:e.endsWith("[]"))?this._ruleNodeReference=[]:this._ruleNodeReference=this,this._ruleNodeReference}_getDefaults(){return{readOnly:!1,enabled:!0,visible:!0,label:{visible:!0,richText:!1},required:!1,type:this._getFallbackType()}}_getFallbackType(){const e=this._jsonModel.type;let t=e;if("string"!=typeof e||-1===v.indexOf(e)){const e=this.enum;t=typeof(null==e?void 0:e[0]),"undefined"===t&&void 0!==this._jsonModel.default&&(t=this._jsonModel.default instanceof Array&&this._jsonModel.default.length>0?typeof this._jsonModel.default[0]+"[]":typeof this._jsonModel.default),0===t.indexOf("undefined")&&(t={"text-input":"string","multiline-input":"string","number-input":"number","date-input":"string","date-time":"string",email:"string","plain-text":"string",image:"string",checkbox:"boolean"}[this.fieldType])}return t}_applyDefaults(){var e,t,i;super._applyDefaultsInModel(),this.coerceParam("required","boolean"),this.coerceParam("readOnly","boolean"),this.coerceParam("enabled","boolean");const n=this._jsonModel.type;if("string"==typeof n&&-1!==v.indexOf(n)||(this._jsonModel.type=this._getFallbackType()),-1===["plain-text","image"].indexOf(this.fieldType)?this._jsonModel.value=void 0:"image"===this.fieldType?this._jsonModel.value=null!==(i=null===(t=null===(e=this._jsonModel)||void 0===e?void 0:e.properties)||void 0===t?void 0:t["fd:repoPath"])&&void 0!==i?i:this._jsonModel.value:this._jsonModel.default=this._jsonModel.default||this._jsonModel.value,void 0===this._jsonModel.value){const e=u.Constraints.type(this.getInternalType()||"string",this._jsonModel.default);this._jsonModel.value=e.value}if("string"!==this._jsonModel.type&&this.unset("emptyValue"),void 0===this._jsonModel.fieldType&&(this.form.logger.debug("fieldType property is mandatory. Please ensure all the fields have a fieldType"),this._jsonModel.viewType?(this._jsonModel.viewType.startsWith("custom:")?this.form.logger.error("viewType property has been removed. For custom types, use :type property"):this.form.logger.error("viewType property has been removed. Use fieldType property"),this._jsonModel.fieldType=this._jsonModel.viewType):this._jsonModel.fieldType=(0,h.defaultFieldTypes)(this._jsonModel)),void 0===this._jsonModel.enum)"boolean"===this._jsonModel.type&&(this._jsonModel.enum=[!0,!1]);else for(void 0===this._jsonModel.enumNames&&(this._jsonModel.enumNames=this._jsonModel.enum.map((e=>e.toString())));this._jsonModel.enumNames.length<this._jsonModel.enum.length;)this._jsonModel.enumNames.push(this._jsonModel.enum[this._jsonModel.enumNames.length].toString());const s=["minimum","maximum","exclusiveMinimum","exclusiveMaximum"];"string"!==this._jsonModel.type?"file-input"===this._jsonModel.fieldType?this.unset("pattern","minLength","maxLength"):this.unset("format","pattern","minLength","maxLength"):"date-input"===this._jsonModel.fieldType&&(this._jsonModel.format="date"),this.coerceParam("minLength","number"),this.coerceParam("maxLength","number"),"number"!==this._jsonModel.type&&"date"!==this._jsonModel.format&&"date-time"!==this._jsonModel.format&&"integer"!==this._jsonModel.type&&this.unset("step",...s),s.forEach((e=>{this.coerceParam(e,"integer"===this._jsonModel.type?"number":this._jsonModel.type)})),"number"!=typeof this._jsonModel.step&&this.coerceParam("step","number")}unset(...e){e.forEach((e=>this._jsonModel[e]=void 0))}coerceParam(e,t){const i=this._jsonModel[e];if(void 0!==i&&typeof i!==t){this.form.logger.info(`${e} is not of type ${t}. Trying to coerce.`);try{this._jsonModel[e]=(0,u.coerceType)(i,t)}catch(t){this.form.logger.warn(t),this.unset(e)}}}get editFormat(){return this.withCategory(this._jsonModel.editFormat)}get displayFormat(){return this.withCategory(this._jsonModel.displayFormat)}get displayValueExpression(){return this._jsonModel.displayValueExpression}get placeholder(){return this._jsonModel.placeholder}get readOnly(){return void 0!==this.parent.readOnly&&!0===this.parent.readOnly||this._jsonModel.readOnly}set readOnly(e){this._setProperty("readOnly",e)}get enabled(){var e;const t=null===(e=this.parent)||void 0===e?void 0:e.enabled;return void 0!==t?!!t&&this._jsonModel.enabled:this._jsonModel.enabled}set enabled(e){this._setProperty("enabled",e)}get valid(){var e,t;return null===(t=null===(e=this._jsonModel)||void 0===e?void 0:e.validity)||void 0===t?void 0:t.valid}set valid(e){const t=Object.assign({valid:e},e?{}:{customConstraint:!0});this._setProperty("valid",e),this._setProperty("validity",t)}get validity(){return this._jsonModel.validity}get emptyValue(){return"null"===this._jsonModel.emptyValue?null:""===this._jsonModel.emptyValue&&"string"===this.type?"":void 0}get enum(){return this._jsonModel.enum}set enum(e){this._setProperty("enum",e)}get enumNames(){return this._jsonModel.enumNames}set enumNames(e){this._setProperty("enumNames",e)}get required(){return this._jsonModel.required||!1}set required(e){this._setProperty("required",e)}get maximum(){if("number"===this.type||"date"===this.format||"date-time"===this.format||"integer"===this.type)return this._jsonModel.maximum}set maximum(e){"number"!==this.type&&"date"!==this.format&&"date-time"!==this.format&&"integer"!==this.type||this._setProperty("maximum",e)}get minimum(){if("number"===this.type||"date"===this.format||"date-time"===this.format||"integer"===this.type)return this._jsonModel.minimum}set minimum(e){"number"!==this.type&&"date"!==this.format&&"date-time"!==this.format&&"integer"!==this.type||this._setProperty("minimum",e)}withCategory(e){return e&&null===(null==e?void 0:e.match(/^(?:date|num)\|/))?("date"===this.format?e=`date|${e}`:"number"!==this.type&&"integer"!==this.type||(e=`num|${e}`),e):e}get editValue(){const e=this.editFormat;if(!e||!this.isNotEmpty(this.value)||!1===this.valid)return this.value;try{return(0,g.format)(this.value,this.lang,e)}catch(e){return this.value}}get displayValue(){var e,t;if(this.displayValueExpression&&"string"==typeof this.displayValueExpression&&0!==this.displayValueExpression.length)return this.executeExpression(this.displayValueExpression);const i=this.displayFormat;if(!i||!this.isNotEmpty(this.value)||!0===(null===(e=null==this?void 0:this.validity)||void 0===e?void 0:e.typeMismatch)||("date"===this.format||"date-time"===this.format)&&!0===(null===(t=null==this?void 0:this.validity)||void 0===t?void 0:t.formatMismatch))return this.value;try{return(0,g.format)(this.value,this.lang,i)}catch(e){return this.value}}getDataNodeValue(e){return this.isEmpty()?this.emptyValue:e}updateDataNodeAndTypedValue(e){const t=this.getDataNode();if(f.staticFields.indexOf(this.fieldType)>-1&&void 0!==t&&t!==m.default)return;const i=this._getConstraintObject().type(this.getInternalType()||"string",e),n=this._setProperty("value",i.value,!1);return n.length>0&&(this._hasValueBeenSet=!0,this._updateRuleNodeReference(i.value),void 0!==t&&t.setValue(this.getDataNodeValue(this._jsonModel.value),this._jsonModel.value,this)),n}get value(){return void 0===this._jsonModel.value?null:this._jsonModel.value}set value(e){const t=this.updateDataNodeAndTypedValue(e);let i={valid:!0},n="type";if((null==t?void 0:t.length)>0){let s={};const r=u.Constraints.type(this.getInternalType()||"string",e);if(this.parent.uniqueItems&&"array"===this.parent.type&&(i=u.Constraints.uniqueItems(this.parent.uniqueItems,this.parent.getDataNode().$value),n="uniqueItems"),r.valid&&i.valid)s=this.evaluateConstraints();else{const e=r.valid&&i.valid,t=Object.assign({valid:e,errorMessage:r.valid&&i.valid?"":this.getErrorMessage("type")},e?{}:{validationMessage:e?"":this.getErrorMessage(n),validity:{valid:e,[l.constraintKeys[n]]:!0}});s=this._applyUpdates(["valid","errorMessage","validationMessage","validity"],t)}s.valid&&this.triggerValidationEvent(s);const a=new c.Change({changes:t.concat(Object.values(s)),eventSource:this._eventSource});this.dispatch(a)}}uiChange(e){this._eventSource=l.EventSource.UI,"value"in e.payload?this.value=e.payload.value:"checked"in e.payload&&(this.checked=e.payload.checked),this._eventSource=l.EventSource.CODE}reset(){const e=this.updateDataNodeAndTypedValue(this.default);if(!e)return;const t=this._applyUpdates(["valid","errorMessage","validationMessage","validity"],{valid:void 0,errorMessage:"",validationMessage:"",validity:{valid:void 0}}),i=new c.Change({changes:e.concat(Object.values(t))});this.dispatch(i)}_updateRuleNodeReference(e){var t;if(null===(t=this.type)||void 0===t?void 0:t.endsWith("[]"))if(null!=e)for(e.forEach(((e,t)=>{this._ruleNodeReference[t]=e}));e.length!==this._ruleNodeReference.length;)this._ruleNodeReference.pop();else for(;0!==this._ruleNodeReference.length;)this._ruleNodeReference.pop()}getInternalType(){return this.type}valueOf(){const e=this[f.target],t=void 0===e?this:e;return t.ruleEngine.trackDependency(t,"value"),t._jsonModel.value||null}toString(){var e;const t=this[f.target];return(null===(e=(void 0===t?this:t)._jsonModel.value)||void 0===e?void 0:e.toString())||""}getErrorMessage(e){var t;const i=e,n=l.constraintKeys[i],s=(0,l.getConstraintTypeMessages)();return(null===(t=this._jsonModel.constraintMessages)||void 0===t?void 0:t["exclusiveMaximum"===i?"maximum":"exclusiveMinimum"===i?"minimum":i])||(0,_.replaceTemplatePlaceholders)(s[n],[this._jsonModel[i]])}get errorMessage(){return this._jsonModel.errorMessage}set errorMessage(e){this._setProperty("errorMessage",e),this._setProperty("validationMessage",e)}set constraintMessage(e){if(Array.isArray(e)){const t=Object.assign({},this._jsonModel.constraintMessages);e.forEach((({type:e,message:i})=>{t[e]=i})),this._setProperty("constraintMessages",t)}else{const t=Object.assign(Object.assign({},this._jsonModel.constraintMessages),{[e.type]:e.message});this._setProperty("constraintMessages",t)}}_getConstraintObject(){return u.Constraints}isArrayType(){return!!this.type&&this.type.indexOf("[]")>-1}checkEnum(e,t){if(!0===this._jsonModel.enforceEnum&&null!=e){const i=t.enum;return e instanceof Array&&this.isArrayType()?e.every((e=>i(this._jsonModel.enum||[],e).valid)):i(this._jsonModel.enum||[],e).valid}return!0}checkStep(){var e,t;const i=this._jsonModel.value,n=this._jsonModel.step;if("number"==typeof n){const s=(null===(t=null===(e=n.toString().split("."))||void 0===e?void 0:e[1])||void 0===t?void 0:t.length)||0,r=Math.pow(10,s),a=n*r,o=i*r,l=(this._jsonModel.minimum||this._jsonModel.default||0)*r,u=(o-l)/a,c=Math.abs(o-l)%a<.001;let d,h;return c||(d=(Math.ceil(u)*a+l)/r,h=(d-a)/r),{valid:c,next:d,prev:h}}return{valid:!0}}checkValidationExpression(){const e=this._jsonModel.validationExpression;return"string"!=typeof e||0===e.length||this.executeExpression(e)}getConstraints(){switch(this.type){case"string":switch(this.format){case"date":return u.ValidConstraints.date;case"date-time":return u.ValidConstraints.datetime;case"email":return u.ValidConstraints.email;case"binary":case"data-url":return u.ValidConstraints.file;default:return u.ValidConstraints.string}case"file":return u.ValidConstraints.file;case"number":case"integer":return u.ValidConstraints.number}return this.isArrayType()?u.ValidConstraints.array:[]}get format(){if(void 0===this._jsonModel.format&&"string"===this.type)switch(this.fieldType){case"date-input":this._jsonModel.format="date";break;case"date-time":this._jsonModel.format="date-time"}return this._jsonModel.format}get enforceEnum(){return this._jsonModel.enforceEnum}get tooltip(){return this._jsonModel.tooltip}get maxLength(){return this._jsonModel.maxLength}get minLength(){return this._jsonModel.minLength}get pattern(){return this._jsonModel.pattern}get step(){if("number"===this.type||"date"===this.format)return this._jsonModel.step}get exclusiveMinimum(){if("number"===this.type||"date"===this.format||"integer"===this.type)return this._jsonModel.exclusiveMinimum}set exclusiveMinimum(e){"number"!==this.type&&"date"!==this.format&&"integer"!==this.type||(this._jsonModel.exclusiveMinimum=e)}get exclusiveMaximum(){if("number"===this.type||"date"===this.format||"integer"===this.type)return this._jsonModel.exclusiveMaximum}set exclusiveMaximum(e){"number"!==this.type&&"date"!==this.format&&"integer"!==this.type||(this._jsonModel.exclusiveMaximum=e)}get default(){return this._jsonModel.default}isNotEmpty(e){return null!=e&&""!==e}evaluateConstraints(){let e="type";const t=this._jsonModel,i=this._jsonModel.value,n=this._getConstraintObject(),s=this.getConstraints();let r=!0;if(r&&(r=n.required(this.required,i).valid&&(!this.isArrayType()||!this.required||i.length>0),e="required"),r&&this.isNotEmpty(i)){const a=s.find((e=>{if(e in t&&void 0!==t[e]){const s=t[e],r=n[e];return i instanceof Array&&this.isArrayType()?-1!==u.ValidConstraints.array.indexOf(e)?!r(s,i).valid:i.some((e=>!r(s,e).valid)):"function"==typeof r&&!r(s,i).valid}return!1}));null!=a?(r=!1,e=a):(r=this.checkEnum(i,n),e="enum",r&&"number"===this.type&&(r=this.checkStep().valid,e="step"),r&&(r=this.checkValidationExpression(),e="validationExpression"))}r||this.form.logger.info(`${e} constraint evaluation failed ${this._jsonModel[e]}. Received ${this._jsonModel.value}`);const a=Object.assign({valid:r,errorMessage:r?"":this.getErrorMessage(e)},{validationMessage:r?"":this.getErrorMessage(e),validity:Object.assign({valid:r},r?{}:{[l.constraintKeys[e]]:!0})});return this._applyUpdates(["valid","errorMessage","validationMessage","validity"],a)}triggerValidationEvent(e){e.validity&&a(this,n,"m",s).call(this)}validate(){var e;if(!1===this.visible)return[];if(!1===this.valid&&this.errorMessage&&(null===(e=null==this?void 0:this.validity)||void 0===e?void 0:e.customConstraint))return[new l.ValidationError(this.id,[this._jsonModel.errorMessage])];const t=this.evaluateConstraints();return a(this,n,"m",s).call(this),t.validity&&this.notifyDependents(new c.Change({changes:Object.values(t)})),this.valid?[]:[new l.ValidationError(this.id,[this._jsonModel.errorMessage])]}syncDataAndFormModel(e){if(void 0!==e&&e!==m.default&&e.$value!==this._jsonModel.value){const t=(0,c.propertyChange)("value",e.$value,this._jsonModel.value);this._jsonModel.value=e.$value,this.queueEvent(t)}}defaultDataModel(e){const t=f.staticFields.indexOf(this.fieldType)>-1?void 0:this.getDataNodeValue(this._jsonModel.value);return new p.default(e,t,this.type||"string")}getState(e=!1,t=!1){return Object.assign(Object.assign({},super.getState(t)),{editFormat:this.editFormat,displayFormat:this.displayFormat,editValue:this.editValue,displayValue:this.displayValue,enabled:this.enabled,readOnly:this.readOnly})}markAsInvalid(e,t=null){const i={valid:!1,errorMessage:e,validationMessage:e,validity:Object.assign({valid:!1},null!=t?{[l.constraintKeys[t]]:!0}:{customConstraint:!0})},n=this._applyUpdates(["valid","errorMessage","validationMessage","validity"],i),s=new c.Change({changes:[].concat(Object.values(n))});0!==s.payload.changes.length&&(this.triggerValidationEvent(n),this.dispatch(s))}}n=new WeakSet,s=function(){this.validity.valid?this.dispatch(new c.Valid):this.dispatch(new c.Invalid)},r([(0,f.dependencyTracked)(),(0,f.exclude)("button","image","plain-text")],y.prototype,"readOnly",null),r([(0,f.dependencyTracked)(),(0,f.exclude)("image","plain-text")],y.prototype,"enabled",null),r([(0,f.dependencyTracked)()],y.prototype,"valid",null),r([(0,f.dependencyTracked)()],y.prototype,"validity",null),r([(0,f.dependencyTracked)()],y.prototype,"enum",null),r([(0,f.dependencyTracked)()],y.prototype,"enumNames",null),r([(0,f.dependencyTracked)()],y.prototype,"required",null),r([(0,f.include)("date-input","number-input")],y.prototype,"editValue",null),r([(0,f.dependencyTracked)()],y.prototype,"value",null),r([(0,f.dependencyTracked)()],y.prototype,"errorMessage",null),r([(0,f.include)("text-input","date-input","file-input","email","datetime-input")],y.prototype,"format",null),r([(0,f.include)("text-input")],y.prototype,"maxLength",null),r([(0,f.include)("text-input")],y.prototype,"minLength",null),r([(0,f.include)("text-input")],y.prototype,"pattern",null),r([(0,f.dependencyTracked)()],y.prototype,"exclusiveMinimum",null),r([(0,f.dependencyTracked)()],y.prototype,"exclusiveMaximum",null),t.default=y},2692:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Fieldset=void 0;const s=n(i(5716)),r=i(3332);class a extends s.default{constructor(e,t){super(e,t),"restore"!==t.mode&&(this._applyDefaults(),this.queueEvent(new r.Initialize),this.queueEvent(new r.ExecuteRule))}_getDefaults(){return Object.assign(Object.assign({},super._getDefaults()),{visible:!0,required:!1,label:{visible:!0,richText:!1}})}_applyDefaults(){super._applyDefaultsInModel(),this._jsonModel.dataRef&&void 0===this._jsonModel.type&&(this._jsonModel.type="object")}get type(){const e=super.type;if("array"===e||"object"===e)return e}get items(){return super.items?super.items:[]}get value(){var e;return null===(e=this.getDataNode())||void 0===e?void 0:e.$value}get fieldType(){return"panel"}}t.Fieldset=a},6440:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FileObject=void 0,t.FileObject=class{constructor(e){this.mediaType="application/octet-stream",this.name="unknown",this.size=0,Object.assign(this,e)}get type(){return this.mediaType}set type(e){this.mediaType=e}toJSON(){return{name:this.name,size:this.size,mediaType:this.mediaType,data:this.data.toString()}}equals(e){return this.data===e.data&&this.mediaType===e.mediaType&&this.name===e.name&&this.size===e.size}}},5432:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function o(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(3332),a=s(i(560)),o=i(1060),l=i(6440),u=i(4476),c=s(i(8224));function d(e,t){return e.replace(";base64",`;name=${encodeURIComponent(t)};base64`)}function h(e){return n(this,void 0,void 0,(function*(){const{name:t,size:i,type:n}=e;return yield new Promise(((s,r)=>{const a=new FileReader;a.onload=e=>{s(new l.FileObject({data:d(e.target.result,t),type:n,name:t,size:i}))},a.readAsDataURL(e.data)}))}))}class p extends a.default{_getDefaults(){return Object.assign(Object.assign({},super._getDefaults()),{accept:["audio/*","video/*","image/*","text/*","application/pdf"],maxFileSize:"2MB"})}_getFallbackType(){return"file"}get maxFileSize(){return(0,o.getFileSizeInBytes)(this._jsonModel.maxFileSize)}get accept(){return this._jsonModel.accept}_applyUpdates(e,t){return e.reduce(((e,i)=>{const n=this._jsonModel[i],s=t[i];return s!==n&&(e[i]={propertyName:i,currentValue:s,prevValue:n},n instanceof l.FileObject&&"object"==typeof s&&"value"===i?this._jsonModel[i]=new l.FileObject(Object.assign(Object.assign({},n),{data:s.data})):this._jsonModel[i]=s),e}),{})}getInternalType(){var e;return(null===(e=this.type)||void 0===e?void 0:e.endsWith("[]"))?"file[]":"file"}getDataNodeValue(e){var t;let i=e;return null!=i&&("string"===this.type?i=null===(t=i.data)||void 0===t?void 0:t.toString():"string[]"===this.type&&(i=i instanceof Array?i:[i],i=i.map((e=>{var t;return null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.toString()})))),i}serialize(){return n(this,void 0,void 0,(function*(){const e=this._jsonModel.value;return void 0===e?null:yield(t=e instanceof Array?e:[e],Promise.all([].map.call(t,h)));var t}))}syncDataAndFormModel(e){if(void 0!==e&&e!==c.default){const t=null==e?void 0:e.$value;if(null!=t){const e=u.Constraints.type(this.getInternalType(),t);e.valid||this.form.logger.debug(`unable to bind ${this.name} to data`),this.form.getEventQueue().queue(this,(0,r.propertyChange)("value",e.value,this._jsonModel.value)),this._jsonModel.value=e.value}else this._jsonModel.value=null}}}t.default=p},3416:function(e,t,i){var n,s,r,a,o,l,u,c=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function o(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((n=n.apply(e,t||[])).next())}))},d=this&&this.__classPrivateFieldGet||function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)},h=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.currentVersion=void 0;const p=h(i(5716)),f=h(i(1316)),m=h(i(5840)),g=h(i(9712)),_=i(3332),v=i(2267),y=h(i(9576)),b=i(7279),E=i(9333),T=i(1060),M=i(7888),O=i(7177);t.currentVersion=new O.Version("0.13");const I=new O.Version("0.13");class w extends p.default{constructor(e,t,i,s=new g.default,r="off",a="create"){super(e,{fieldFactory:t,mode:a}),this._ruleEngine=i,this._eventQueue=s,n.add(this),this.additionalSubmitMetadata={},this._fields={},this._invalidFields=[],this._exportDataAttachmentMap={},this.promises=[],this._captcha=null,this.dataRefRegex=/("[^"]+?"|[^.]+?)(?:\.|$)/g,this._logger=new v.Logger(r),this._applyDefaultsInModel(),"create"===a&&(this.queueEvent(new _.Initialize),"deps"===this.changeEventBehaviour?this.queueEvent(new _.Change({changes:[]})):this.queueEvent(new _.ExecuteRule)),this._ids=(0,T.IdGenerator)(),this.bindToDataModel(new y.default("$form",{})),this._initialize(a),"create"===a&&this.queueEvent(new _.FormLoad)}addPromises(e){this.promises.push(e)}waitForPromises(){return c(this,void 0,void 0,(function*(){let e=0;for(;this.promises.length>e;)e=this.promises.length,yield Promise.all(this.promises);this.promises=[]}))}_applyDefaultsInModel(){const e=this.specVersion;this._jsonModel.properties=this._jsonModel.properties||{},this._jsonModel.fieldType=this._jsonModel.fieldType||"form",(e.lessThan(I)||"string"!=typeof this._jsonModel.properties["fd:changeEventBehaviour"])&&(this._jsonModel.properties["fd:changeEventBehaviour"]="self")}get activeField(){return this._findActiveField(this)}_findActiveField(e){return(null==e?void 0:e.isContainer)?this._findActiveField(null==e?void 0:e.activeChild):e}get logger(){return this._logger}get changeEventBehaviour(){return"deps"===this.properties["fd:changeEventBehaviour"]?"deps":"self"}get metaData(){const e=this._jsonModel.metadata||{};return new f.default(e)}get action(){return this._jsonModel.action}get isFragment(){return!1}importData(e){this.bindToDataModel(new y.default("$form",e)),this.syncDataAndFormModel(this.getDataNode()),this._eventQueue.runPendingQueue()}exportData(e={}){var t;this._exportDataAttachmentMap=e;const i=null===(t=this.getDataNode())||void 0===t?void 0:t.$value;return this._exportDataAttachmentMap={},i}setAdditionalSubmitMetadata(e){this.additionalSubmitMetadata=Object.assign(Object.assign({},this.additionalSubmitMetadata),e)}get specVersion(){if("string"!=typeof this._jsonModel.adaptiveform)return t.currentVersion;try{return new O.Version(this._jsonModel.adaptiveform)}catch(e){return console.log(e),console.log("Falling back to default version"+t.currentVersion.toString()),t.currentVersion}}resolveQualifiedName(e){if(this.qualifiedName===e)return this;let t=null;return this.visit((i=>{i.qualifiedName===e&&(t=i)})),t}exportSubmitMetaData(){return this.withDependencyTrackingControl(!0,(()=>{const e={};this.visit((t=>{"captcha"===t.fieldType&&(e[t.qualifiedName]=t.value)}));const t={},i=this.properties["fd:draftId"]||"";i&&(t["fd:draftId"]=i);const n=this.properties["fd:dor"];if(n&&"none"!==n.dorType){const e=n["fd:excludeFromDoRIfHidden"];let i=[];i=Object.values(this._fields).filter((t=>!1===t.enabled||e&&!1===t.visible)).map((e=>(0,M.transformFieldName)(e.qualifiedName))),i&&i.length>0&&(t.excludeFromDoR=i)}Object.keys(t).length>0&&this.setAdditionalSubmitMetadata(t);const s=Object.assign({lang:this.lang,captchaInfo:e},this.additionalSubmitMetadata);return new m.default(s)}))}setFocus(e,t){const i=this._ruleEngine.getDependencyTracking();this._ruleEngine.setDependencyTracking(!1);try{if(!t)return d(this,n,"m",u).call(this,e),void d(this,n,"m",a).call(this,e);const i=(null==e?void 0:e.isContainer)?e:e.parent,r=d(this,n,"m",s).call(this,i.items);let c=i.activeChild,h=null!==c?r.indexOf(c):-1;if(null===i.activeChild)return d(this,n,"m",a).call(this,r[0]),void(h=0);t===E.FocusOption.NEXT_ITEM?c=d(this,n,"m",o).call(this,h,r):t===E.FocusOption.PREVIOUS_ITEM&&(c=d(this,n,"m",l).call(this,h,r)),null!==c&&d(this,n,"m",a).call(this,c)}finally{this._ruleEngine.setDependencyTracking(i)}}getState(e=!1){const t=this,i=super.getState(!1,e);return i.id="$form",Object.defineProperty(i,"data",{get:function(){return t.exportData()}}),Object.defineProperty(i,"attachments",{get:function(){return(0,T.getAttachments)(t)}}),i}get type(){return"object"}isTransparent(){return!1}get form(){return this}get ruleEngine(){return this._ruleEngine}getUniqueId(e){var t,i,n;if(e&&!(null===(t=this._idSet)||void 0===t?void 0:t.has(e)))return null===(i=this._idSet)||void 0===i||i.add(e),e;if(null==this._ids)return"";const s=this._ids.next().value;return null===(n=this._idSet)||void 0===n||n.add(s),s}clearIdRegistry(){var e;null===(e=this._idSet)||void 0===e||e.clear()}fieldAdded(e){"captcha"!==e.fieldType||this._captcha||(this._captcha=e),this._fields[e.id]=e,e.subscribe((e=>{-1===this._invalidFields.indexOf(e.target.id)&&this._invalidFields.push(e.target.id)}),"invalid"),e.subscribe((e=>{const t=this._invalidFields.indexOf(e.target.id);t>-1&&this._invalidFields.splice(t,1)}),"valid"),e.subscribe((e=>{const t=e.target.getState();if(e.payload.changes.length>0&&t){const i=e=>e&&"object"==typeof e?Array.isArray(e)?e.map(i):Object.assign({},e):e,n=e.payload.changes.map((({propertyName:e,currentValue:t,prevValue:n})=>({propertyName:e,currentValue:i(t),prevValue:i(n)}))),s=new _.FieldChanged(n,t,e.payload.eventSource);this.notifyDependents(s)}}))}visit(e){this.traverseChild(this,e)}traverseChild(e,t){e.items.forEach((e=>{e.isContainer&&this.traverseChild(e,t),t(e)}))}validate(){const e=super.validate();return this.dispatch(new _.ValidationComplete(e)),e}isValid(){return 0===this._invalidFields.length}dispatch(e){"submit"===e.type?(super.queueEvent(e),this._eventQueue.runPendingQueue()):super.dispatch(e)}submit(e,t){var i;if(!1===(null===(i=null==e?void 0:e.payload)||void 0===i?void 0:i.validate_form)||0===this.validate().length){const i=(null==e?void 0:e.payload)||{},n=(null==i?void 0:i.success)?null==i?void 0:i.success:"submitSuccess",s=(null==i?void 0:i.error)?null==i?void 0:i.error:"submitError",r=i.action||this.action,a=i.metadata||{submitMetadata:this.exportSubmitMetaData()},o=(null==i?void 0:i.save_as)||(null==i?void 0:i.submit_as);(0,b.submit)(t,n,s,o,null==i?void 0:i.data,r,a)}}save(e,t){const i=(null==e?void 0:e.payload)||{};i.save_as="multipart/form-data",i.metadata={draftMetadata:{lang:this.lang,"fd:draftId":this.properties["fd:draftId"]||""}},i.success="custom:saveSuccess",i.error="custom:saveError",this.submit(e,t),this.subscribe((e=>{this._saveSuccess(e)}),"saveSuccess")}_saveSuccess(e){var t,i;const n=(null===(i=null===(t=null==e?void 0:e.payload)||void 0===t?void 0:t.body)||void 0===i?void 0:i.draftId)||"",s=this.properties;n&&s&&(s["fd:draftId"]=n)}reset(){super.reset(),this._invalidFields=[]}getElement(e){return e==this.id?this:this._fields[e]}get qualifiedName(){return"$form"}getEventQueue(){return this._eventQueue}get name(){return"$form"}get value(){return null}get id(){return this._jsonModel.id||"$form"}get title(){return this._jsonModel.title||""}get captcha(){return this._captcha}}n=new WeakSet,s=function(e){return e.filter((e=>!0===e.visible))},r=function(e){const t=d(this,n,"m",s).call(this,e.items);return t&&t.length>0?t[0]:null},a=function e(t){if(!t.isContainer)return void(t.parent.activeChild=t);d(this,n,"m",u).call(this,t);const i=t.activeChild||d(this,n,"m",r).call(this,t);null!==i?d(this,n,"m",e).call(this,i):t.parent.activeChild=t},o=function(e,t){return e<t.length-1?t[e+1]:null},l=function(e,t){return e>0?t[e-1]:null},u=function(e){const t=e.parent;null!=t&&null!=t.activeChild&&(t.activeChild=null)},t.default=w},9916:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,s)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return s(t,e),t},a=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function o(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=t.fetchForm=t.validateFormData=t.validateFormInstance=t.restoreFormInstance=t.createFormInstanceSync=t.createFormInstance=void 0;const l=r(i(3416)),u=i(5088),c=i(372),d=o(i(6552)),h=o(i(9712)),p=i(2267),f=i(8608),m=i(7279),g=i(1060),_=o(i(9576)),v=(e,t,i)=>{let n=i;null==n&&(e=(0,g.sitesModelToFormModel)(e),n=new l.default(Object.assign({},e),f.FormFieldFactory,new d.default,new h.default(new p.Logger(t)),t));const s=null==e?void 0:e.data;return s&&n.importData(s),n};t.createFormInstance=(e,t,i="error",n=void 0)=>{try{const s=v(e,i,n);return"function"==typeof t&&t(s),s.getEventQueue().runPendingQueue(),s}catch(e){throw console.error(`Unable to create an instance of the Form ${e}`),new Error(e)}},t.createFormInstanceSync=(e,t,i="error",n=void 0)=>a(void 0,void 0,void 0,(function*(){try{const s=v(e,i,n);return"function"==typeof t&&t(s),s.getEventQueue().runPendingQueue(),yield s.waitForPromises(),s}catch(e){throw console.error(`Unable to create an instance of the Form ${e}`),new Error(e)}})),t.createFormInstance.currentVersion=l.currentVersion;const y={logLevel:"error"};t.restoreFormInstance=(e,t=null,{logLevel:i}=y)=>{try{const n=new l.default(Object.assign({},e),f.FormFieldFactory,new d.default,new h.default(new p.Logger(i)),i,"restore");return t&&(n.bindToDataModel(new _.default("$form",t)),n.syncDataAndFormModel(n.getDataNode())),n.getEventQueue().empty(),n}catch(e){throw console.error(`Unable to restore an instance of the Form ${e}`),new Error(e)}},t.validateFormInstance=(e,t)=>{try{const i=new l.default(Object.assign({},e),f.FormFieldFactory,new d.default);return t&&i.importData(t),0===i.validate().length}catch(e){throw new Error(e)}},t.validateFormData=(e,t)=>{try{const i=new l.default(Object.assign({},e),f.FormFieldFactory,new d.default);t&&i.importData(t);const n=i.validate();return{messages:n,valid:0===n.length}}catch(e){throw new Error(e)}},t.fetchForm=(e,t={})=>{const i=new Headers;return Object.entries(t).forEach((([e,t])=>{i.append(e,t)})),new Promise(((i,n)=>{(0,c.request)(`${e}.model.json`,null,{headers:t}).then((e=>{if(200!==e.status)n("Not Found");else{let t=e.body;if("model"in t){const{model:e}=t;t=e}i((0,u.jsonString)(t))}})).catch((e=>{n(`Network error: ${e.message||e}`)}))}))},t.registerFunctions=e=>{m.FunctionRuntime.registerFunctions(e)}},1316:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(i(140));class r extends s.default{get version(){return this.getP("version","")}get grammar(){return this.getP("grammar","")}}t.default=r},3336:function(e,t,i){var n=this&&this.__decorate||function(e,t,i,n){var s,r=arguments.length,a=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(a=(r<3?s(a):r>3?s(t,i,a):s(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.InstanceManager=void 0;const s=i(2692),r=i(5848);class a extends s.Fieldset{get maxOccur(){return this._jsonModel.maxItems}set maxOccur(e){this.maxItems=e}get minOccur(){return this.minItems}addInstance(e){return this.addItem(e)}removeInstance(e){return this.removeItem(e)}}n([(0,r.dependencyTracked)()],a.prototype,"maxOccur",null),n([(0,r.dependencyTracked)()],a.prototype,"minOccur",null),t.InstanceManager=a},140:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(5088);t.default=class{constructor(e){this._jsonModel=Object.assign({},e)}getP(e,t){return(0,n.getProperty)(this._jsonModel,e,t)}get isContainer(){return!1}}},8744:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PropertiesManager=void 0;const n=i(3332);t.PropertiesManager=class{constructor(e){this.host=e,this._definedProperties=new Set,this._propertiesWrapper={},this._initialized=!1}get properties(){return this._initialized||(this._setupInitialProperties(),this._initialized=!0),this._propertiesWrapper}set properties(e){const t=this.host._jsonModel.properties||{},i=Object.assign({},e);this.host._jsonModel.properties=i,Object.keys(i).forEach((e=>{this._ensurePropertyDescriptor(e)})),Object.keys(Object.assign(Object.assign({},t),i)).forEach((e=>{if(t[e]!==i[e]){const s=(0,n.propertyChange)(`properties.${e}`,i[e],t[e]);this.host.notifyDependents(s)}}))}ensurePropertyDescriptor(e){this._ensurePropertyDescriptor(e)}_setupInitialProperties(){const e=this.host._jsonModel.properties||{};Object.keys(e).forEach((e=>{this._ensurePropertyDescriptor(e)})),this.host._jsonModel.properties||(this.host._jsonModel.properties={})}_ensurePropertyDescriptor(e){this._definedProperties.has(e)||(Object.defineProperty(this._propertiesWrapper,e,{get:()=>(e.startsWith("fd:")||this.host.ruleEngine.trackDependency(this.host,`properties.${e}`),(this.host._jsonModel.properties||{})[e]),set:t=>{const i=this.host._jsonModel.properties||{},s=i[e];if(s!==t){const r=Object.assign(Object.assign({},i),{[e]:t});this.host._jsonModel.properties=r;const a=(0,n.propertyChange)(`properties.${e}`,t,s);this.host.notifyDependents(a)}},enumerable:!0,configurable:!0}),this._definedProperties.add(e))}updateNestedProperty(e,t){const i=e.split("."),s=i[0];this._ensurePropertyDescriptor(s);const r=this.host._jsonModel.properties||{},a=JSON.parse(JSON.stringify(r)),o=a[s]||{};a[s]=o;let l=o;for(let e=1;e<i.length-1;e++)l[i[e]]?"object"!=typeof l[i[e]]&&(l[i[e]]={}):l[i[e]]={},l=l[i[e]];const u=i[i.length-1],c=l[u];l[u]=t,this.host._jsonModel.properties=a;const d=(0,n.propertyChange)(`properties.${e}`,t,c);this.host.notifyDependents(d)}updateSimpleProperty(e,t){this._ensurePropertyDescriptor(e),this._propertiesWrapper[e]=t}}},5376:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(5848),s=i(1060);class r extends n.BaseNode{constructor(){super(...arguments),this._events={},this._rules={}}getRules(){return"object"!=typeof this._jsonModel.rules?{}:this._jsonModel.rules}getCompiledRule(e,t){if(!(e in this._rules)){const i=t||this.getRules()[e];if(!("string"==typeof i&&i.length>0))throw new Error(`only expression strings are supported. ${typeof i} types are not supported`);try{let t=i;if("$form"!==this.fragment){const e=(0,s.sanitizeName)(this.fragment);t=i.replaceAll("$form",e)}this._rules[e]=this.ruleEngine.compileRule(t,this.lang)}catch(t){this.form.logger.error(`Unable to compile rule \`"${e}" : "${i}"\` Exception : ${t}`)}}return this._rules[e]}getCompiledEvent(e){var t;if(!(e in this._events)){let i=null===(t=this._jsonModel.events)||void 0===t?void 0:t[e];"string"==typeof i&&i.length>0&&(i=[i]),void 0!==i&&i.length>0&&(this._events[e]=i.map((t=>{try{let e=t;if("$form"!==this.fragment){const i=(0,s.sanitizeName)(this.fragment);e=t.replaceAll("$form",i)}return this.ruleEngine.compileRule(e,this.lang)}catch(t){this.form.logger.error(`Unable to compile expression \`"${e}" : "${i}"\` Exception : ${t}`)}return null})).filter((e=>null!==e)))}return this._events[e]||[]}applyUpdates(e){"object"==typeof e?null!==e&&Object.entries(e).forEach((([e,t])=>{if(e in n.editableProperties||e in this&&"function"!=typeof this[e])try{this[e]=t}catch(e){console.error(e)}})):void 0!==e&&(this.value=e)}executeAllRules(e){const t=Object.entries(this.getRules());if(t.length>0){const i=this.getExpressionScope();t.forEach((([t,s])=>{const r=this.getCompiledRule(t,s);if(r){const a=this.ruleEngine.execute(r,i,e,!0,s);n.editableProperties.indexOf(t)>-1?this.isEmpty()&&this.isEmpty(a)&&"value"===t||(this[t]=a):this.form.logger.warn(`${t} is not a valid editable property.`)}}))}}getExpressionScope(){const e=this.getNonTransparentParent(),t={self:this.getRuleNode(),siblings:(null==e?void 0:e.ruleNodeReference())||{}},i=new Proxy(t,{get:(e,t)=>{if(t===Symbol.toStringTag)return"Object";if("string"==typeof t&&t.startsWith("$")){const i=e.self[t];return i instanceof n.BaseNode?i.getRuleNode():i instanceof Array?i.map((e=>e instanceof n.BaseNode?e.getRuleNode():e)):i}return t in e.siblings?e.siblings[t]:e.self[t]},has:(e,t)=>{const i=e.self[t],n=e.siblings[t];return void 0!==i||void 0!==n}});return i}executeEvent(e,t,i){let n;t&&(n=this.ruleEngine.execute(t,this.getExpressionScope(),e,!1,i),n instanceof Promise&&this.form.addPromises(n)),void 0!==n&&null!=n&&this.applyUpdates(n)}executeRule(e,t){void 0===e.payload.ruleName&&this.executeAllRules(t)}executeExpression(e){const t={form:this.form,$form:this.form.getRuleNode(),$field:this.getRuleNode(),field:this},i=this.ruleEngine.compileRule(e,this.lang);return this.ruleEngine.execute(i,this.getExpressionScope(),t,!1,e)}change(e,t){"deps"===this.form.changeEventBehaviour&&this.executeAllRules(t)}executeAction(e){var t;const i={form:this.form,$form:this.form.getRuleNode(),$field:this.getRuleNode(),field:this,$event:{type:e.type,payload:e.payload,target:this.getRuleNode()}};this.ruleEngine.setDependencyTracking(["change","executeRule"].includes(e.type));const n=e.isCustomEvent?`custom:${e.type}`:e.type,s=e.isCustomEvent?`custom_${e.type}`:e.type,r=this.getCompiledEvent(n),a=null===(t=this._jsonModel.events)||void 0===t?void 0:t[n];s in this&&"function"==typeof this[s]&&this[s](e,i),r.forEach(((e,t)=>{let n="";Array.isArray(a)?n=a[t]:"string"==typeof a&&(n=a),this.executeEvent(i,e,n)})),e.target===this&&this.notifyDependents(e)}}t.default=r},5840:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e={}){this.lang=e.lang||"en",this.captchaInfo=e.captchaInfo||{},Object.keys(e).forEach((t=>{"lang"!==t&&"captchaInfo"!==t&&(this[t]=e[t])}))}}},9712:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(2267);class s{constructor(e,t){this._node=e,this._event=t}get node(){return this._node}get event(){return this._event}isEqual(e){return null!=e&&this._node==e._node&&this._event.type==e._event.type}toString(){return this._node.id+"__"+this.event.type}valueOf(){return this.toString()}}class r{constructor(e=new n.Logger("off")){this.logger=e,this._isProcessing=!1,this._pendingEvents=[],this._runningEventCount={}}get length(){return this._pendingEvents.length}get isProcessing(){return this._isProcessing}isQueued(e,t){const i=new s(e,t);return void 0!==this._pendingEvents.find((e=>i.isEqual(e)))}queue(e,t,i=!1){e&&t&&(t instanceof Array||(t=[t]),t.forEach((t=>{var n;const a=new s(e,t),o=this._runningEventCount[a.valueOf()]||0;if(o<r.MAX_EVENT_CYCLE_COUNT){let s="";if("change"!==(null==t?void 0:t.type)||(null===(n=null==t?void 0:t.payload)||void 0===n?void 0:n.changes.map((e=>e.propertyName)).includes("activeChild"))?(null==t?void 0:t.type.includes("setProperty"))&&(s=JSON.stringify(t.payload,null,2)):s=JSON.stringify(t.payload.changes,null,2),this.logger.isLevelEnabled("info")&&e.withDependencyTrackingControl(!0,(()=>{this.logger.info(`Queued event : ${t.type} node: ${e.id} - ${e.qualifiedName} - ${s}`)})),i){const e=this._isProcessing?1:0;this._pendingEvents.splice(e,0,a)}else this._pendingEvents.push(a);this._runningEventCount[a.valueOf()]=o+1}else this.logger.info(`Skipped queueing event : ${t.type} node: ${e.id} - ${e.name} with count=${o}`)})))}empty(){this._pendingEvents=[]}runPendingQueue(){if(!this._isProcessing){for(this._isProcessing=!0;this._pendingEvents.length>0;){const e=this._pendingEvents[0];this.logger.info(`Dequeued event : ${e.event.type} node: ${e.node.id} - ${e.node.name}`),e.node.executeAction(e.event),this._pendingEvents.shift()}this._runningEventCount={},this._isProcessing=!1}}}r.MAX_EVENT_CYCLE_COUNT=10,t.default=r},3332:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.RequestFailure=t.RequestSuccess=t.RemoveInstance=t.AddInstance=t.RemoveItem=t.AddItem=t.CustomEvent=t.FieldChanged=t.Reset=t.SubmitError=t.SubmitFailure=t.SubmitSuccess=t.Save=t.Submit=t.Focus=t.ValidationComplete=t.Blur=t.Click=t.FormLoad=t.Initialize=t.propertyChange=t.ExecuteRule=t.Valid=t.Invalid=t.UIChange=t.Change=void 0,function(e){e.CODE="code",e.UI="ui"}(i||(i={}));class n{constructor(e,t,i){this._metadata=i,this._payload=e,this._type=t}get type(){return this._type}get payload(){return this._payload}get metadata(){return this._metadata}get target(){return this._target}get currentTarget(){return this._currentTarget}get isCustomEvent(){return!1}payloadToJson(){return this.payload}toJson(){return{payload:this.payloadToJson(),type:this.type,isCustomEvent:this.isCustomEvent}}toString(){return JSON.stringify(this.toJson())}}class s extends n{constructor(e,t=!1){super(e,"change",{dispatch:t})}withAdditionalChange(e){return new s(this.payload.changes.concat(e.payload.changes),this.metadata)}}t.Change=s,t.UIChange=class extends n{constructor(e,t=!1){super(e,"uiChange",{dispatch:t})}},t.Invalid=class extends n{constructor(e={}){super(e,"invalid",{})}},t.Valid=class extends n{constructor(e={}){super(e,"valid",{})}},t.ExecuteRule=class extends n{constructor(e={},t=!1){super(e,"executeRule",{dispatch:t})}},t.propertyChange=(e,t,i)=>new s({changes:[{propertyName:e,currentValue:t,prevValue:i}]}),t.Initialize=class extends n{constructor(e,t=!1){super(e,"initialize",{dispatch:t})}},t.FormLoad=class extends n{constructor(){super({},"load",{dispatch:!1})}},t.Click=class extends n{constructor(e,t=!1){super(e,"click",{dispatch:t})}},t.Blur=class extends n{constructor(e,t=!1){super(e,"blur",{dispatch:t})}},t.ValidationComplete=class extends n{constructor(e,t=!1){super(e,"validationComplete",{dispatch:t})}},t.Focus=class extends n{constructor(e,t=!1){super(e,"focus",{dispatch:t})}},t.Submit=class extends n{constructor(e,t=!1){super(e,"submit",{dispatch:t})}},t.Save=class extends n{constructor(e,t=!1){super(e,"save",{dispatch:t})}},t.SubmitSuccess=class extends n{constructor(e,t=!1){super(e,"submitSuccess",{dispatch:t})}},t.SubmitFailure=class extends n{constructor(e,t=!1){super(e,"submitFailure",{dispatch:t})}},t.SubmitError=class extends n{constructor(e,t=!1){super(e,"submitError",{dispatch:t})}},t.Reset=class extends n{constructor(e,t=!1){super(e,"reset",{dispatch:t})}},t.FieldChanged=class extends n{constructor(e,t,n=i.CODE){super({field:t,changes:e,eventSource:n},"fieldChanged")}},t.CustomEvent=class extends n{constructor(e,t={},i=!1){super(t,e,{dispatch:i})}get isCustomEvent(){return!0}},t.AddItem=class extends n{constructor(e){super(e,"addItem")}},t.RemoveItem=class extends n{constructor(e){super(e,"removeItem")}},t.AddInstance=class extends n{constructor(e){super(e,"addInstance")}},t.RemoveInstance=class extends n{constructor(e){super(e,"removeInstance")}},t.RequestSuccess=class extends n{constructor(e,t=!1){super(e,"requestSuccess",{dispatch:t})}},t.RequestFailure=class extends n{constructor(e,t=!1){super(e,"requestFailure",{dispatch:t})}}},2267:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;const i={off:0,debug:1,info:2,warn:3,error:4};t.Logger=class{constructor(e="off"){this.logLevel=i[e]}debug(e){this.log(e,"debug")}info(e){this.log(e,"info")}warn(e){this.log(e,"warn")}error(e){this.log(e,"error")}log(e,t){0!==this.logLevel&&this.logLevel<=i[t]&&console[t](e)}isLevelEnabled(e){return 0!==this.logLevel&&this.logLevel<=i[e]}}},9576:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(i(584)),r=n(i(8224));class a extends s.default{constructor(e,t,i=typeof t,n){super(e,t,i,n),this.$_items=t instanceof Array?t.map(((e,t)=>this.createEntry(t,e,this))):Object.fromEntries(Object.entries(t).map((([e,t])=>[e,this.createEntry(e,t,this)])))}createEntry(e,t,i){const n=Array.isArray(t)?"array":typeof t;return"object"==typeof t&&null!=t?new a(e,t,n,i):new s.default(e,t,n,i)}get $value(){return"array"===this.$type?Object.values(this.$_items).filter((e=>void 0!==e&&!e.disabled)).map((e=>e.$value)):Object.fromEntries(Object.values(this.$_items).filter((e=>void 0!==e&&!e.disabled)).map((e=>[e.$name,e.$value])))}get $length(){return Object.entries(this.$_items).length}$convertToDataValue(){return new s.default(this.$name,this.$value,this.$type,this.parent)}syncDataAndFormModel(e){this.$_fields.forEach((t=>{e&&e!==t&&t.syncDataAndFormModel(this)}))}$addDataNode(e,t,i=!1,n=null){if(t!==r.default){if("array"===this.$type){const s=e;i?this.$_items[e]=t:this.$_items.splice(s,0,t),this.syncDataAndFormModel(n)}else this.$_items[e]=t;t.parent=this}}$removeDataNode(e,t=null){"array"===this.$type?(this.$_items.splice(e,1),this.syncDataAndFormModel(t)):this.$_items[e]=void 0}$getDataNode(e){if(this.$_items.hasOwnProperty(e))return this.$_items[e]}$containsDataNode(e){return this.$_items.hasOwnProperty(e)&&void 0!==this.$_items[e]}get $isDataGroup(){return!0}}t.default=a},584:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(5088);t.default=class{constructor(e,t,i=typeof t,n){this.$_name=e,this.$_value=t,this.$_type=i,this.$_fields=[],this.parent=n}valueOf(){return this.$_value}get $name(){return this.$_name}get disabled(){return!this.$_fields.find((e=>!1!==e.enabled))&&this.$_fields.length}get $value(){const e=this.$_fields.find((e=>{if((0,n.isFile)(e))return e}));if(e&&this.$_fields.every((e=>["string","string[]"].includes(e.type)))){const t=e.form._exportDataAttachmentMap;if(t&&t[e.id]){const i=t[e.id];return Array.isArray(i)?i.map((e=>e.data)):i.data}}return this.$_value}setValue(e,t,i){this.$_value=e,this.$_fields.forEach((e=>{i!==e&&(e.value=t)}))}get $type(){return this.$_type}$bindToField(e){-1===this.$_fields.indexOf(e)&&(this.$_fields.push(e),this._checkForTypeConflicts(e))}_checkForTypeConflicts(e){if(this.$_fields.length<=1)return;const t=e.type,i=this.$_fields.filter((i=>i&&i!==e&&i.type!==t));if(i.length>0){const n=i.map((e=>`Field "${e.id}" (${e.type})`)).join(", ");console.error(`Type conflict detected: Multiple fields with same dataRef have different types. New field '${e.id}' (${t}) conflicts with: ${n}. DataRef: ${this.$name}`)}}$convertToDataValue(){return this}get $isDataGroup(){return!1}$addDataNode(e,t,i=!1){throw"add Data Node is called on a data value"}}},8224:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(i(584)),r=Symbol("NullValue");class a extends s.default{constructor(){super("",r,"null")}setValue(){}$bindToField(){}$length(){return 0}$convertToDataValue(){return this}$addDataNode(){}$removeDataNode(){}$getDataNode(){return this}$containsDataNode(){return!1}}const o=new a;t.default=o},5444:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,s)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.sanitizeName=t.Captcha=t.EmailInput=t.SubmitMetaData=t.isEmpty=t.request=t.FunctionRuntime=t.readAttachments=t.extractFileInfo=t.getFileSizeInBytes=t.Scriptable=t.Node=t.FormMetaData=t.FileUpload=t.FileObject=t.Fieldset=t.Field=t.Container=t.CheckboxGroup=t.Checkbox=t.BaseNode=t.Form=void 0,s(i(9916),t),s(i(9333),t),s(i(3332),t),s(i(712),t),s(i(5088),t),s(i(9616),t),s(i(5504),t);const a=i(1060);Object.defineProperty(t,"getFileSizeInBytes",{enumerable:!0,get:function(){return a.getFileSizeInBytes}}),Object.defineProperty(t,"extractFileInfo",{enumerable:!0,get:function(){return a.extractFileInfo}}),Object.defineProperty(t,"isEmpty",{enumerable:!0,get:function(){return a.isEmpty}}),Object.defineProperty(t,"readAttachments",{enumerable:!0,get:function(){return a.readAttachments}}),Object.defineProperty(t,"sanitizeName",{enumerable:!0,get:function(){return a.sanitizeName}});const o=i(5848);Object.defineProperty(t,"BaseNode",{enumerable:!0,get:function(){return o.BaseNode}});const l=r(i(2716));t.Checkbox=l.default;const u=r(i(7288));t.CheckboxGroup=u.default;const c=r(i(6764));t.EmailInput=c.default;const d=r(i(3968));t.Captcha=d.default;const h=r(i(5716));t.Container=h.default;const p=r(i(560));t.Field=p.default;const f=i(2692);Object.defineProperty(t,"Fieldset",{enumerable:!0,get:function(){return f.Fieldset}});const m=i(6440);Object.defineProperty(t,"FileObject",{enumerable:!0,get:function(){return m.FileObject}});const g=r(i(5432));t.FileUpload=g.default;const _=r(i(1316));t.FormMetaData=_.default;const v=r(i(5840));t.SubmitMetaData=v.default;const y=r(i(140));t.Node=y.default;const b=r(i(5376));t.Scriptable=b.default;const E=r(i(3416));t.Form=E.default;const T=i(7279);Object.defineProperty(t,"FunctionRuntime",{enumerable:!0,get:function(){return T.FunctionRuntime}}),Object.defineProperty(t,"request",{enumerable:!0,get:function(){return T.request}})},7279:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function o(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.FunctionRuntime=t.submit=t.request=void 0;const s=i(3332),r=i(372),a=i(6440),o=i(1060),l=i(5088),u=i(9333),c=e=>{const t=e;return t.length>0&&t.startsWith("custom:")?t.substring(7):t};t.request=(e,t,i,o,l,u,p)=>n(void 0,void 0,void 0,(function*(){var n;const f=t,m={method:i};let g,_={},v=null;try{o instanceof Promise&&(o=yield o)}catch(e){throw console.error("Error resolving payload Promise:",e),e}if(o.body&&o.headers&&(_=Object.assign({},o),p=Object.assign({},o.headers),v=(o=o.body).cryptoMetadata,g=o),o&&o instanceof a.FileObject&&o.data instanceof File){const e=new FormData;e.append(o.name,o.data),g=e}else if(o instanceof FormData)g=o;else if(o&&("string"==typeof o||"object"==typeof o&&Object.keys(o).length>0)){const e=Object.keys(p);e.length>0?m.headers=Object.assign(Object.assign({},p),-1===e.indexOf("Content-Type")?{"Content-Type":"application/json"}:{}):m.headers={"Content-Type":"application/json"};const t=(null===(n=null==m?void 0:m.headers)||void 0===n?void 0:n["Content-Type"])||"application/json";"object"==typeof o&&("application/json"===t?g=JSON.stringify(o):t.indexOf("multipart/form-data")>-1?g=h(o):t.indexOf("application/x-www-form-urlencoded")>-1&&(g=d(o))),"text/plain"===t&&(g=String(o))}const y=(t,i,n)=>{const r=c(i);"submitError"===i?(e.form.dispatch(new s.SubmitError(t,!0)),e.form.dispatch(new s.SubmitFailure(t,!0))):e.field?e.field.dispatch(new s.CustomEvent(r,t,!0)):e.form.dispatch(new s.CustomEvent(r,t,!0)),e.form.dispatch(new s.RequestFailure(n,!1))},b=e.$field||null,E={request:Object.assign({url:f,method:i},_),targetField:b,targetEvent:e.$event||null};try{const t=yield(0,r.request)(f,g,m);t.originalRequest=Object.assign(Object.assign({url:f,method:i},v&&{cryptoMetadata:v}),_),t.submitter=b;const n=Object.assign(Object.assign({},E),{response:t,request:t.originalRequest});if((null==t?void 0:t.status)>=200&&(null==t?void 0:t.status)<=299){const i=c(l);"submitSuccess"===l?e.form.dispatch(new s.SubmitSuccess(t,!0)):e.field?e.field.dispatch(new s.CustomEvent(i,t,!0)):e.form.dispatch(new s.CustomEvent(i,t,!0)),e.form.dispatch(new s.RequestSuccess(n,!1))}else e.form.logger.error("Error invoking a rest API"),y(t,u,n);return t}catch(t){e.form.logger.error("Network error while invoking a rest API:",t);const i={body:null,headers:{},error:t instanceof Error?t.message:String(t)},n=Object.assign(Object.assign({},E),{response:i});y(i,u,n),e.form.dispatch(new s.RequestFailure(n,!1))}}));const d=e=>{const t=new URLSearchParams;return Object.entries(e).forEach((([e,i])=>{null!=i&&"object"==typeof i?t.append(e,(0,l.jsonString)(i)):t.append(e,i)})),t};t.submit=(e,i,s,r="multipart/form-data",a=null,l="",u=null)=>n(void 0,void 0,void 0,(function*(){const n=l||e.form.action;let c=a;const d=yield(0,o.readAttachments)(e.form,!0);"object"==typeof c&&null!=c||(c=e.form.exportData(d));let p=r;const f=Object.assign({data:c},u);let m=f;(Object.keys(d).length>0||"multipart/form-data"===r)&&(m=h(f,d),p="multipart/form-data"),yield(0,t.request)(e,n,"POST",m,i,s,{"Content-Type":p})}));const h=(e,t)=>{const i=new FormData;Object.entries(e).forEach((([e,t])=>{null!=t&&"object"==typeof t?i.append(e,(0,l.jsonString)(t)):i.append(e,t)}));const n=(e,t)=>{if((null==e?void 0:e.data)instanceof File){let i=`${null==e?void 0:e.dataRef}/${null==e?void 0:e.name}`;i.startsWith("/")||(i=`/${i}`),t.append(i,e.data)}};return t&&Object.keys(t).reduce(((e,s)=>{const r=t[s];return r&&r instanceof Array?[...e,...r.map((e=>n(e,i)))]:[...e,n(r,i)]}),[]),i},p=(e,t={},i=!1)=>{switch(e){case"change":return new s.Change(t);case"submit":return new s.Submit(t);case"save":return new s.Save(t);case"click":return new s.Click(t);case"addItem":return new s.AddItem(t);case"removeItem":return new s.RemoveItem(t);case"reset":return new s.Reset(t);case"addInstance":return new s.AddInstance(t);case"removeInstance":return new s.RemoveInstance(t);case"invalid":return new s.Invalid(t);case"valid":return new s.Valid(t);case"initialize":return new s.Initialize(t);case"focus":return new s.Focus(t);default:console.error("invalid action")}};class f{constructor(){this.customFunctions={}}static getInstance(){return f.instance||(f.instance=new f),f.instance}registerFunctions(e){Object.entries(e).forEach((([e,t])=>{let i=t;"function"==typeof t&&(i={_func:(e,i,n)=>{const s={form:n.globals.$form,field:n.globals.$field,event:n.globals.$event,functions:{setProperty:(e,t)=>{const s=[e,"custom:setProperty",t];return f.getInstance().getFunctions().dispatchEvent._func.call(void 0,s,i,n)},reset:e=>{const t=[e=e||"reset","reset"];return n.globals.form.logger.warn("This usage of reset is deprecated. Please see the documentation and update."),f.getInstance().getFunctions().dispatchEvent._func.call(void 0,t,i,n)},validate:e=>{const t=[e];return f.getInstance().getFunctions().validate._func.call(void 0,t,i,n)},importData:(e,t)=>{const s=[e,t];return f.getInstance().getFunctions().importData._func.call(void 0,s,i,n)},exportData:()=>f.getInstance().getFunctions().exportData._func.call(void 0,e,i,n),submitForm:(e,t,s)=>{const r=[e,t,s||"multipart/form-data"];return f.getInstance().getFunctions().submitForm._func.call(void 0,r,i,n)},markFieldAsInvalid:(e,t,i)=>{var s,r;!i||i.useId?null===(s=n.globals.form.getElement(e))||void 0===s||s.markAsInvalid(t):i&&i.useDataRef?n.globals.form.visit((function(i){i.dataRef===e&&i.markAsInvalid(t)})):i&&i.useQualifiedName&&(null===(r=n.globals.form.resolveQualifiedName(e))||void 0===r||r.markAsInvalid(t))},setFocus:(e,t)=>{const s=[e,t];return f.getInstance().getFunctions().setFocus._func.call(void 0,s,i,n)},dispatchEvent:(e,t,s,r)=>{const a=[e,t,s,r];return f.getInstance().getFunctions().dispatchEvent._func.call(void 0,a,i,n)},getFiles:e=>{const t={};e||n.globals.form.visit((function(e){"file-input"===e.fieldType&&e.value&&(t[e.qualifiedName]=e.serialize())}));const i=n.globals.form.resolveQualifiedName(e);return"file-input"===(null==i?void 0:i.fieldType)&&(null==i?void 0:i.value)&&(t[e]=i.serialize()),t}}};return t(...e,s)},_signature:[]}),i.hasOwnProperty("_func")?f.getInstance().customFunctions[e]=i:console.warn(`Unable to register function with name ${e}.`)}))}unregisterFunctions(...e){e.forEach((e=>{e in f.getInstance().customFunctions&&(null==f||delete f.getInstance().customFunctions[e])}))}getFunctions(){function e(t){return null==t?t:null!==(i=t)&&"[object Array]"===Object.prototype.toString.call(i)?t.map((t=>e(t))):t.valueOf();var i}function i(e){return null==e?"":e.toString()}const r={validate:{_func:(e,t,i)=>{const n=e[0];let s;return s="string"==typeof n||void 0===n?i.globals.form.validate():i.globals.form.getElement(n.$id).validate(),Array.isArray(s)&&s.length&&i.globals.form.logger.warn("Form Validation Error"),s},_signature:[]},setFocus:{_func:(e,t,i)=>{const n=e[0],s=e[1];try{const e=i.globals.form.getElement(null==n?void 0:n.$id)||i.globals.field;i.globals.form.setFocus(e,s)}catch(e){i.globals.form.logger.error("An error has occurred within the setFocus API.")}},_signature:[]},getData:{_func:(e,t,i)=>(i.globals.form.logger.warn("The `getData` function is depricated. Use `exportData` instead."),i.globals.form.withDependencyTrackingControl(!0,(()=>i.globals.form.exportData()))),_signature:[]},exportData:{_func:(e,t,i)=>i.globals.form.withDependencyTrackingControl(!0,(()=>i.globals.form.exportData())),_signature:[]},importData:{_func:(e,t,i)=>i.globals.form.withDependencyTrackingControl(!0,(()=>{const t=e[0],n=e[1];if("object"!=typeof t||null===t||n){const e=i.globals.form.resolveQualifiedName(n);(null==e?void 0:e.isContainer)?e.importData(t,n):i.globals.form.logger.error("Invalid argument passed in importData. A container is expected")}else i.globals.form.importData(t);return{}})),_signature:[]},submitForm:{_func:(t,r,a)=>n(this,void 0,void 0,(function*(){var n,o,l,c,d;let h,p,f,m=null,g=null;t.length>0&&"object"==typeof e(t[0])?(h=t.length>0?e(t[0]):null,p=!(t.length>1)||e(t[1]),f=t.length>2?i(t[2]):"multipart/form-data"):(a.globals.form.logger.warn("This usage of submitForm is deprecated. Please see the documentation and update"),m=i(t[0]),g=i(t[1]),f=t.length>2?i(t[2]):"multipart/form-data",h=t.length>3?e(t[3]):null,p=!(t.length>4)||e(t[4]));const _=a.globals.form;if(_.captcha&&(_.captcha.captchaDisplayMode===u.CaptchaDisplayMode.INVISIBLE||"enterprise"===(null===(o=null===(n=_.captcha.properties["fd:captcha"])||void 0===n?void 0:n.config)||void 0===o?void 0:o.version)&&"score"===(null===(c=null===(l=_.captcha.properties["fd:captcha"])||void 0===l?void 0:l.config)||void 0===c?void 0:c.keyType))){if("function"!=typeof(null===(d=a.runtime.functionTable.fetchCaptchaToken)||void 0===d?void 0:d._func))return a.globals.form.logger.error("fetchCaptchaToken is not defined"),a.globals.form.dispatch(new s.SubmitError({type:"FetchCaptchaTokenNotDefined"})),{};try{const e=yield a.runtime.functionTable.fetchCaptchaToken._func([],r,a);_.captcha.value=e}catch(e){return a.globals.form.logger.error("Error while fetching captcha token"),a.globals.form.dispatch(new s.SubmitError({type:"FetchCaptchaTokenFailed"})),{}}}return a.globals.form.dispatch(new s.Submit({success:m,error:g,submit_as:f,validate_form:p,data:h})),{}})),_signature:[]},saveForm:{_func:(e,t,n)=>{const r=i(e[0]),a=e[2]||!1;return n.globals.form.dispatch(new s.Save({action:r,validate_form:a})),{}},_signature:[]},setVariable:{_func:(e,t,n)=>{const s=i(e[0]);let r=e[1];const a=e[2]||n.globals.form;return r&&"object"==typeof r&&r.$qualifiedName&&(r=n.globals.form.getElement(r.$id)._jsonModel.value),(a.$id?n.globals.form.getElement(a.$id):n.globals.form).getPropertiesManager().updateSimpleProperty(s,r),{}},_signature:[]},getVariable:{_func:(e,t,n)=>{const s=i(e[0]),r=e[1]||n.globals.form;if(!s)return;const a=(r.$id?n.globals.form.getElement(r.$id):n.globals.form).getPropertiesManager();if(s.includes(".")){const e=s.replace(/\[/g,".").replace(/\]/g,"").split(".").filter(Boolean);let t=a.properties;for(const i of e){if(null==t)return;t=t[i]}return t}return a.ensurePropertyDescriptor(s),a.properties[s]},_signature:[]},request:{_func:(n,s,r)=>{const a=i(n[0]),o=i(n[1]);let l,u,c,d={};if(n[2]&&"object"==typeof n[2]&&!n[2].then&&("data"in n[2]||"headers"in n[2])){const t=e(n[2]);l=t.data,d=t.headers||{},u=e(n[3]),c=e(n[4])}else l=e(n[2]),"string"==typeof n[3]?(r.globals.form.logger.warn("This usage of request is deprecated. Please see the documentation and update"),u=e(n[3]),c=e(n[4])):(d=e(n[3]),u=e(n[4]),c=e(n[5]));return(0,t.request)(r.globals,a,o,l,u,c,d)},_signature:[]},requestWithRetry:{_func:(s,r,a)=>{const o=i(s[0]),l=i(s[1]);let u,c,d=e(s[2]);return"string"==typeof s[3]&&5===s.length?(u=e(s[3]),c=e(s[4])):"string"==typeof s[4]&&6===s.length&&(u=e(s[4]),c=e(s[5])),e=>n(this,void 0,void 0,(function*(){try{d instanceof Promise&&(d=yield d)}catch(e){throw console.error("Error resolving payload Promise:",e),e}let i={},n={},r=null;5===s.length?(n=d.body||{},i=d.headers||{},r=d.cryptoMetadata):(n=d||{},i=s[3]||{}),e&&(e.body&&(n=Object.assign(Object.assign({},n),e.body)),e.headers&&(i=Object.assign(Object.assign({},i),e.headers)));const h=Object.assign({body:n,headers:i},r&&{cryptoMetadata:r});try{return yield(0,t.request)(a.globals,o,l,h,u,c,i)}catch(e){if(e&&"object"==typeof e&&"status"in e&&e.status>=400)throw e;throw new Error("Request failed")}}))},_signature:[]},retryHandler:{_func:(t,i,n)=>e(t[0])(),_signature:[]},awaitFn:{_func:(e,t,i)=>n(this,void 0,void 0,(function*(){const n=e[1],s=i.globals.$field;try{const a=yield e[0];r.dispatchEvent._func([s,n,a],t,i)}catch(n){const a=e[2];a&&r.dispatchEvent._func([s,a,n],t,i)}return{}})),_signature:[]},addInstance:{_func:(t,i,n)=>{const s=t[0],r=t.length>1?e(t[1]):void 0;try{const e=n.globals.form.getElement(s.$id),t=p("addInstance",r);e.addItem(t)}catch(e){n.globals.form.logger.error("Invalid argument passed in addInstance. An element is expected")}},_signature:[]},removeInstance:{_func:(t,i,n)=>{const s=t[0],r=t.length>1?e(t[1]):void 0;try{const e=n.globals.form.getElement(s.$id),t=p("removeInstance",r);e.removeItem(t)}catch(e){n.globals.form.logger.error("Invalid argument passed in removeInstance. An element is expected")}},_signature:[]},dispatchEvent:{_func:(t,i,n)=>{const r=t[0];if(null===r&&"string"!=typeof n)return n.debug.push("Invalid argument passed in dispatchEvent. An element is expected"),{};let a,o=e(t[1]),l=t.length>2?e(t[2]):void 0,u=t.length>3&&e(t[3]);if("string"==typeof r&&(l=o,o=r,u=!0),a=o.startsWith("custom:")?new s.CustomEvent(o.substring(7),l,u):p(o,l,u),null!=a)if("string"==typeof r)n.globals.form.dispatch(a);else{const e=(e,t,i)=>{i.globals.form.getElement(e.$id).dispatch(t)};Array.isArray(r)&&r.length>0&&void 0===r.$id?r.forEach((t=>{e(t,a,n)})):e(r,a,n)}return{}},_signature:[]},encrypt:{_func:(t,i,s)=>n(this,void 0,void 0,(function*(){return e(t[0])})),_signature:[]},decrypt:{_func:(t,i,s)=>n(this,void 0,void 0,(function*(){return e(t[0])})),_signature:[]},getQueryParameter:{_func:(e,t,n)=>{var s,r,a,o;const l=i(e[0]);if(!l)return n.globals.form.logger.error("Argument is missing in getQueryParameter. A parameter is expected"),"";const u=null===(r=null===(s=n.globals.form)||void 0===s?void 0:s.properties)||void 0===r?void 0:r.queryParams;if(u){if(void 0!==u[l])return u[l];const e=l.toLowerCase();for(const[t,i]of Object.entries(u))if(t.toLowerCase()===e)return i}try{const e=new URLSearchParams((null===(a=null===window||void 0===window?void 0:window.location)||void 0===a?void 0:a.search)||""),t=e.get(l)||(null===(o=Array.from(e.entries()).find((([e])=>e.toLowerCase()===l.toLowerCase())))||void 0===o?void 0:o[1]);if(null!=t)return t}catch(e){n.globals.form.logger.warn("Error reading URL parameters:",e)}return""},_signature:[]},getBrowserDetail:{_func:(e,t,n)=>{var s,r,a;const o=i(e[0]);return o?(null===(a=null===(r=null===(s=n.globals.form)||void 0===s?void 0:s.properties)||void 0===r?void 0:r.browserDetails)||void 0===a?void 0:a[o])?n.globals.form.properties.browserDetails[o]:"undefined"!=typeof navigator&&o in navigator?navigator[o]||"":(n.globals.form.logger.warn(`Invalid or unsupported browser detail requested: "${o}"`),""):(n.globals.form.logger.error("Argument is missing in getBrowserDetail. A parameter is expected"),"")},_signature:[]},getURLDetail:{_func:(e,t,n)=>{var s,r,a;const o=i(e[0]);return o?(null===(a=null===(r=null===(s=n.globals.form)||void 0===s?void 0:s.properties)||void 0===r?void 0:r.urlDetails)||void 0===a?void 0:a[o])?n.globals.form.properties.urlDetails[o]:"undefined"!=typeof window&&void 0!==window.location&&o in window.location?window.location[o]||"":(n.globals.form.logger.warn(`Invalid or unsupported url parameter requested: "${o}"`),""):(n.globals.form.logger.error("Argument is missing in getURLDetail. A parameter is expected"),"")},_signature:[]},getRelativeInstanceIndex:{_func:(t,i,n)=>{if(!Array.isArray(t[0])||0===t[0].length)return-1;const s=e(t[0])[0].$parent,r=n.globals.$field,a=s.$qualifiedName,o=r.$qualifiedName;if(o.startsWith(a+"[")){const e=a.length+1,t=o.indexOf("]",e);if(-1!==t){const i=Number(o.slice(e,t));if(!Number.isNaN(i))return i}}return s.length-1},_signature:[]},today:{_func:()=>{const e=new Date(Date.now());return new Date(e.getFullYear(),e.getMonth(),e.getDate())/864e5},_signature:[]},formatInput:{_func:e=>{const t=e[0],i=e[1];if(!t||!i)return t;const n=String(t).replace(/\D/g,"");switch(String(i).toLowerCase()){case"phonenumber":return n.length>=10?`(${n.substring(0,3)}) ${n.substring(3,6)}-${n.substring(6,10)}`:n.length>=7?`(${n.substring(0,3)}) ${n.substring(3,7)}`:n;case"socialsecuritynumber":return n.length>=9?`${n.substring(0,3)}-${n.substring(3,5)}-${n.substring(5,9)}`:n;case"email-alphanumeric":{const e=String(t).replace(/[^a-zA-Z0-9]/g,"");return e.length>0?`${e}@example.com`:t}case"zipcode":return n.length>=5?n.substring(0,5):n;default:return t}},_signature:[]}};return Object.assign(Object.assign({},r),f.getInstance().customFunctions)}}f.instance=null,t.FunctionRuntime=f.getInstance()},6552:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(i(3548)),r=i(7279),a=i(8416);t.default=class{constructor(){this._globalNames=["$form","$field","$event"],this.debugInfo=[],this.dependencyTracking=!0,this.customFunctions=r.FunctionRuntime.getFunctions()}compileRule(e,t){const i=new s.default(this.customFunctions,function(e){if(null==e){const t=(new Intl.DateTimeFormat).resolvedOptions();e=t.locale}return t=>(0,a.stringToNumber)(t,e)}(t),this.debugInfo);return{formula:i,ast:i.compile(e,this._globalNames)}}execute(e,t,i,n=!1,s){var r,a,o,l,u,c,d,h,p;const{formula:f,ast:m}=e,g=this._context;let _;this._context=i;try{_=f.run(m,t,"en-US",i)}catch(e){null===(o=null===(a=null===(r=this._context)||void 0===r?void 0:r.form)||void 0===a?void 0:a.logger)||void 0===o||o.error(e)}if(this.debugInfo.length)for(null===(c=null===(u=null===(l=this._context)||void 0===l?void 0:l.form)||void 0===u?void 0:u.logger)||void 0===c||c.warn(`Form rule expression string: ${s}`);this.debugInfo.length>0;)null===(p=null===(h=null===(d=this._context)||void 0===d?void 0:d.form)||void 0===h?void 0:h.logger)||void 0===p||p.warn(this.debugInfo.pop());let v=_;return n&&"object"==typeof _&&null!==_&&(v=Object.getPrototypeOf(_).valueOf.call(_)),this._context=g,v}trackDependency(e,t){this.dependencyTracking&&this._context&&void 0!==this._context.field&&this._context.field!==e&&e._addDependent(this._context.field,t)}setDependencyTracking(e){this.dependencyTracking=e}getDependencyTracking(){return this.dependencyTracking}}},9136:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getConstraintTypeMessages=t.setCustomDefaultConstraintTypeMessages=t.constraintKeys=t.ConstraintType=t.constraintProps=t.translationProps=void 0,t.translationProps=["description","placeholder","enum","enumNames","label.value","constraintMessages.accept","constraintMessages.enum","constraintMessages.exclusiveMinimum","constraintMessages.exclusiveMaximum","constraintMessages.format","constraintMessages.maxFileSize","constraintMessages.maxLength","constraintMessages.maximum","constraintMessages.maxItems","constraintMessages.minLength","constraintMessages.minimum","constraintMessages.minItems","constraintMessages.pattern","constraintMessages.required","constraintMessages.step","constraintMessages.type","constraintMessages.validationExpression"],t.constraintProps=["accept","enum","exclusiveMinimum","exclusiveMaximum","format","maxFileSize","maxLength","maximum","maxItems","minLength","minimum","minItems","pattern","required","step","validationExpression","enumNames"],t.ConstraintType=Object.freeze({PATTERN_MISMATCH:"patternMismatch",TOO_SHORT:"tooShort",TOO_LONG:"tooLong",RANGE_OVERFLOW:"rangeOverflow",RANGE_UNDERFLOW:"rangeUnderflow",TYPE_MISMATCH:"typeMismatch",VALUE_MISSING:"valueMissing",STEP_MISMATCH:"stepMismatch",FORMAT_MISMATCH:"formatMismatch",ACCEPT_MISMATCH:"acceptMismatch",FILE_SIZE_MISMATCH:"fileSizeMismatch",UNIQUE_ITEMS_MISMATCH:"uniqueItemsMismatch",MIN_ITEMS_MISMATCH:"minItemsMismatch",MAX_ITEMS_MISMATCH:"maxItemsMismatch",EXPRESSION_MISMATCH:"expressionMismatch",EXCLUSIVE_MAXIMUM_MISMATCH:"exclusiveMaximumMismatch",EXCLUSIVE_MINIMUM_MISMATCH:"exclusiveMinimumMismatch",ENUM_MISMATCH:"enumMismatch"}),t.constraintKeys=Object.freeze({pattern:t.ConstraintType.PATTERN_MISMATCH,minLength:t.ConstraintType.TOO_SHORT,maxLength:t.ConstraintType.TOO_LONG,maximum:t.ConstraintType.RANGE_OVERFLOW,minimum:t.ConstraintType.RANGE_UNDERFLOW,type:t.ConstraintType.TYPE_MISMATCH,required:t.ConstraintType.VALUE_MISSING,step:t.ConstraintType.STEP_MISMATCH,format:t.ConstraintType.FORMAT_MISMATCH,accept:t.ConstraintType.ACCEPT_MISMATCH,maxFileSize:t.ConstraintType.FILE_SIZE_MISMATCH,uniqueItems:t.ConstraintType.UNIQUE_ITEMS_MISMATCH,minItems:t.ConstraintType.MIN_ITEMS_MISMATCH,maxItems:t.ConstraintType.MAX_ITEMS_MISMATCH,validationExpression:t.ConstraintType.EXPRESSION_MISMATCH,exclusiveMinimum:t.ConstraintType.EXCLUSIVE_MINIMUM_MISMATCH,exclusiveMaximum:t.ConstraintType.EXCLUSIVE_MAXIMUM_MISMATCH,enum:t.ConstraintType.ENUM_MISMATCH});const i=Object.freeze({[t.ConstraintType.PATTERN_MISMATCH]:"Please match the format requested.",[t.ConstraintType.TOO_SHORT]:"Please lengthen this text to ${0} characters or more.",[t.ConstraintType.TOO_LONG]:"Please shorten this text to ${0} characters or less.",[t.ConstraintType.RANGE_OVERFLOW]:"Value must be less than or equal to ${0}.",[t.ConstraintType.RANGE_UNDERFLOW]:"Value must be greater than or equal to ${0}.",[t.ConstraintType.TYPE_MISMATCH]:"Please enter a valid value.",[t.ConstraintType.VALUE_MISSING]:"Please fill in this field.",[t.ConstraintType.STEP_MISMATCH]:"Please enter a valid value.",[t.ConstraintType.FORMAT_MISMATCH]:"Specify the value in allowed format : ${0}.",[t.ConstraintType.ACCEPT_MISMATCH]:"The specified file type not supported.",[t.ConstraintType.FILE_SIZE_MISMATCH]:"File too large. Reduce size and try again.",[t.ConstraintType.UNIQUE_ITEMS_MISMATCH]:"All the items must be unique.",[t.ConstraintType.MIN_ITEMS_MISMATCH]:"Specify a number of items equal to or greater than ${0}.",[t.ConstraintType.MAX_ITEMS_MISMATCH]:"Specify a number of items equal to or less than ${0}.",[t.ConstraintType.EXPRESSION_MISMATCH]:"Please enter a valid value.",[t.ConstraintType.EXCLUSIVE_MINIMUM_MISMATCH]:"Value must be greater than ${0}.",[t.ConstraintType.EXCLUSIVE_MAXIMUM_MISMATCH]:"Value must be less than ${0}.",[t.ConstraintType.ENUM_MISMATCH]:"Please select a value from the allowed options."}),n=(e,t)=>"object"!=typeof e||null===e?e:Array.isArray(e)?e.map((e=>n(e,t))):Object.keys(e).reduce(((i,s)=>{const r=t(s),a=e[s];return i[r]=n(a,t),i}),{});let s={};t.setCustomDefaultConstraintTypeMessages=e=>{const i=Object.entries(e).reduce(((e,[i,n])=>(void 0!==t.constraintKeys[i]&&(e[i]=n),e)),{});s=n(i,(e=>t.constraintKeys[e]))},t.getConstraintTypeMessages=()=>Object.assign(Object.assign({},i),s)},9048:(e,t)=>{var i,n,s;Object.defineProperty(t,"__esModule",{value:!0}),t.CaptchaDisplayMode=t.FocusOption=t.ValidationError=t.EventSource=void 0,(i=t.EventSource||(t.EventSource={})).CODE="code",i.UI="ui",t.ValidationError=class{constructor(e="",t=[]){this.errorMessages=t,this.fieldName=e}},(s=t.FocusOption||(t.FocusOption={})).NEXT_ITEM="nextItem",s.PREVIOUS_ITEM="previousItem",(n=t.CaptchaDisplayMode||(t.CaptchaDisplayMode={})).INVISIBLE="invisible",n.VISIBLE="visible"},9333:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,s)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),s(i(9136),t),s(i(9048),t)},8416:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stringToNumber=void 0;const n=i(6608);t.stringToNumber=function(e,t){if(null===e)return 0;const i=+e;if(!isNaN(i))return i;if(t){const i=(0,n.parseDefaultDate)(e,t,!0);if(i!==e)return(0,n.datetimeToNumber)(i)}return 0}},3820:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.resolveData=t.tokenize=t.repeatable=t.global$=t.bracket=t.identifier=t.TOK_REPEATABLE=t.TOK_GLOBAL=void 0;const s=n(i(9576)),r="Identifier";t.TOK_GLOBAL="Global",t.TOK_REPEATABLE="Repeatable";const a="bracket";t.identifier=(e,t)=>({type:r,value:e,start:t}),t.bracket=(e,t)=>({type:a,value:e,start:t}),t.global$=()=>({type:t.TOK_GLOBAL,start:0,value:"$"}),t.repeatable=()=>({type:t.TOK_REPEATABLE,start:0,value:"#"});const o=function(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||"_"===e},l=(e,t,i)=>null===e&&"$"===t[i],u=(e,t,i)=>null===e&&"#"===t[i],c=(e,t)=>{const i=e[t];return"$"===i?e.length>t&&o(e[t+1]):i>="a"&&i<="z"||i>="A"&&i<="Z"||"_"===i},d=e=>e>="0"&&e<="9";class h{constructor(e){this.stream=e,this._tokens=[],this._result_tokens=[],this._current=0}_consumeGlobal(){return this._current+=1,(0,t.global$)()}_consumeRepeatable(){return this._current+=1,(0,t.repeatable)()}_consumeUnquotedIdentifier(e){const i=this._current;for(this._current+=1;this._current<e.length&&o(e[this._current]);)this._current+=1;return(0,t.identifier)(e.slice(i,this._current),i)}_consumeQuotedIdentifier(e){const i=this._current;this._current+=1;const n=e.length;for(;'"'!==e[this._current]&&this._current<n;){let t=this._current;"\\"!==e[t]||"\\"!==e[t+1]&&'"'!==e[t+1]?t+=1:t+=2,this._current=t}return this._current+=1,(0,t.identifier)(JSON.parse(e.slice(i,this._current)),i)}_consumeNumber(e){const t=this._current;this._current+=1;const i=e.length;for(;d(e[this._current])&&this._current<i;)this._current+=1;const n=e.slice(t,this._current);return{type:"Number",value:parseInt(n,10),start:t}}_consumeBracket(e){const i=this._current;let n;if(this._current+=1,!d(e[this._current]))throw new Error(`unexpected exception at position ${this._current}. Must be a character`);if(n=this._consumeNumber(e).value,this._current<this.stream.length&&"]"!==e[this._current])throw new Error(`unexpected exception at position ${this._current}. Must be a character`);return this._current++,(0,t.bracket)(n,i)}tokenize(){const e=this.stream;for(;this._current<e.length;){const t=this._tokens.length?this._tokens.slice(-1)[0]:null;if(l(t,e,this._current)){const e=this._consumeGlobal();this._tokens.push(e),this._result_tokens.push(e)}else if(u(t,e,this._current)){const e=this._consumeRepeatable();this._tokens.push(e),this._result_tokens.push(e)}else if(c(e,this._current)){const t=this._consumeUnquotedIdentifier(e);this._tokens.push(t),this._result_tokens.push(t)}else if("."===e[this._current]&&null!=t&&"DOT"!==t.type)this._tokens.push({type:"DOT",value:".",start:this._current}),this._current+=1;else if("["===e[this._current]){const t=this._consumeBracket(e);this._tokens.push(t),this._result_tokens.push(t)}else{if('"'!==e[this._current]){const e=Math.max(0,this._current-2),t=Math.min(this.stream.length,this._current+2);throw new Error(`Exception at parsing stream ${this.stream.slice(e,t)}`)}{const t=this._consumeQuotedIdentifier(e);this._tokens.push(t),this._result_tokens.push(t)}}}return this._result_tokens}}t.tokenize=e=>new h(e).tokenize(),t.resolveData=(e,i,n)=>{let o;o="string"==typeof i?(0,t.tokenize)(i):i;let l=e,u=0;const c=(e,t,i)=>null===t?i:t.type===a?new s.default(e.value,[],"array"):new s.default(e.value,{});for(;u<o.length&&null!=l;){const i=o[u];if(i.type===t.TOK_GLOBAL)l=e;else if(i.type===r){if(!(l instanceof s.default&&"object"===l.$type))throw new Error(`Looking for ${i.value} in ${l.$value}`);if(l.$containsDataNode(i.value)&&null!==l.$getDataNode(i.value).$value)l=l.$getDataNode(i.value);else if(n){const e=c(i,u<o.length-1?o[u+1]:null,n);l.$addDataNode(i.value,e),l=e}else l=void 0}else if(i.type===a){if(!(l instanceof s.default&&"array"===l.$type))throw new Error(`Looking for index ${i.value} in non array${l.$value}`);{const e=i.value;if(e<l.$length)l=l.$getDataNode(e);else if(n){const t=c(i,u<o.length-1?o[u+1]:null,n);l.$addDataNode(e,t),l=t}else l=void 0}}u+=1}return l}},7888:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.transformFieldName=void 0,t.transformFieldName=e=>e.split(".").slice(1).map((e=>e.match(/\[\d+\]$/)?e:""!==e?`${e}[0]`:e)).join(".")},372:function(e,t){var i=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function o(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.convertQueryString=t.request=void 0,t.request=(e,s=null,r={})=>{const a=Object.assign(Object.assign({},n),r),o="GET"===a.method&&s?(0,t.convertQueryString)(e,s):e;return"GET"!==a.method&&(a.body=s),fetch(o,Object.assign({},a)).then((t=>i(void 0,void 0,void 0,(function*(){var i,n,s;let r;t.ok||console.error(`Error while fetching response from ${e} : ${t.statusText}`),r=(null===(n=null===(i=null==t?void 0:t.headers)||void 0===i?void 0:i.get("Content-Type"))||void 0===n?void 0:n.includes("application/json"))?yield t.json():yield t.text();const a={};return null===(s=null==t?void 0:t.headers)||void 0===s||s.forEach(((e,t)=>{a[t]=e})),{status:t.status,body:r,headers:a}})))).catch((t=>{throw console.error(`Network error while fetching from ${e}:`,t),t}))};const n={method:"GET"};t.convertQueryString=(e,t)=>{if(!t)return e;let i={};try{i=JSON.parse(t)}catch(e){console.log("Query params invalid")}const n=[];return Object.keys(i).forEach((e=>{Array.isArray(i[e])?n.push(`${encodeURIComponent(e)}=${encodeURIComponent(JSON.stringify(i[e]))}`):n.push(`${encodeURIComponent(e)}=${encodeURIComponent(i[e])}`)})),n.length?e.includes("?")?`${e}&${n.join("&")}`:`${e}?${n.join("&")}`:e}},8608:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FormFieldFactory=void 0;const s=i(3336),r=i(2692),a=i(5088),o=n(i(5432)),l=n(i(2716)),u=n(i(7288)),c=n(i(6884)),d=n(i(3260)),h=n(i(560)),p=n(i(6764)),f=n(i(3968)),m=n(i(3544)),g={text:"text-input",number:"number-input",email:"email",file:"file-input",range:"range",textarea:"multiline-input"};t.FormFieldFactory=new class{createField(e,t){let i;const n=Object.assign(Object.assign({},t),{fieldFactory:this});if(e.fieldType=e.fieldType?e.fieldType in g?g[e.fieldType]:e.fieldType:"text-input",(0,a.isRepeatable)(e)){const t=Object.assign(Object.assign(Object.assign({},e),"items"in e&&{type:"object"}),{minOccur:void 0,maxOccur:void 0,repeatable:void 0,name:void 0}),r=Object.assign({minItems:e.minOccur||0,maxItems:e.maxOccur||-1,fieldType:e.fieldType,type:"array",name:e.name,dataRef:e.dataRef,events:{"custom:setProperty":"$event.payload"}},{items:[t]});i=new s.InstanceManager(r,n)}else i="items"in e||"panel"===e.fieldType?new r.Fieldset(e,n):(0,a.isFile)(e)||"file-input"===e.fieldType?new o.default(e,n):(0,a.isCheckbox)(e)?new l.default(e,n):(0,a.isCheckboxGroup)(e)?new u.default(e,n):(0,a.isEmailInput)(e)?new p.default(e,n):(0,a.isDateField)(e)?new c.default(e,n):(0,a.isDateTimeField)(e)?new d.default(e,n):(0,a.isCaptcha)(e)?new f.default(e,n):(0,a.isButton)(e)?new m.default(e,n):new h.default(e,n);return i}}},1060:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(s,r){function a(e){try{l(n.next(e))}catch(e){r(e)}}function o(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,o)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.sanitizeName=t.replaceTemplatePlaceholders=t.sitesModelToFormModel=t.dataURItoBlob=t.extractFileInfo=t.isDataUrl=t.IdGenerator=t.getFileSizeInBytes=t.getAttachments=t.readAttachments=t.isEmpty=t.randomWord=void 0;const s=i(5088),r=i(6440),a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_".split(""),o=/^(\d*\.?\d+)(\\?(?=[KMGT])([KMGT])(?:i?B)?|B?)$/i;t.randomWord=e=>{const t=[];for(let i=0;i<=e;i++){let e;e=0===i?Math.floor(Math.random()*(a.length-11)):Math.floor(Math.random()*a.length),t.push(a[e])}return t.join("")},t.isEmpty=e=>""===e||null==e;const l=(e,i,n)=>{if(i&&null===e.dataRef)return n?Promise.resolve(null):null;let r=null;if(e.isContainer)return n?(0,t.readAttachments)(e,i).then((e=>e)):(0,t.getAttachments)(e,i);if((0,s.isFile)(e.getState())){r={};const t=e.name||"",i=null!=e.dataRef?e.dataRef:t.length>0?e.name:void 0;if(e.value instanceof Array)if("string[]"===e.type&&"data-url"===(null==e?void 0:e.format)){if(n)return e.serialize().then((t=>(r[e.id]=t.map((e=>Object.assign(Object.assign({},e),{dataRef:i}))),r)));r[e.id]=e.value.map((e=>Object.assign(Object.assign({},e),{dataRef:i})))}else r[e.id]=e.value.map((e=>Object.assign(Object.assign({},e),{dataRef:i})));else if(null!=e.value)if("string"===e.type&&"data-url"===(null==e?void 0:e.format)){if(n)return e.serialize().then((t=>(r[e.id]=Object.assign(Object.assign({},t[0]),{dataRef:i}),r)));r[e.id]=Object.assign(Object.assign({},e.value),{dataRef:i})}else r[e.id]=Object.assign(Object.assign({},e.value),{dataRef:i})}return n?Promise.resolve(r):r};t.readAttachments=(e,t=!1)=>n(void 0,void 0,void 0,(function*(){return(e.items||[]).reduce(((e,i)=>n(void 0,void 0,void 0,(function*(){const n=yield e,s=yield l(i,t,!0);return Object.assign(n,s)}))),Promise.resolve({}))})),t.getAttachments=(e,t=!1)=>(e.items||[]).reduce(((e,i)=>{const n=l(i,t,!1);return Object.assign(e,n)}),{}),t.getFileSizeInBytes=e=>{let t=0;if("string"==typeof e){const i=o.exec(e.trim());null!=i&&(t=u(parseFloat(i[1]),(i[2]||"kb").toUpperCase()))}return t};const u=(e,t)=>{const i=Math.pow(1024,{KB:1,MB:2,GB:3,TB:4}[t]);return Math.round(e*i)};t.IdGenerator=function*(e=50){const i=function(){const i=[];for(let n=0;n<e;n++)i.push((0,t.randomWord)(10));return i},n={};let s=i();do{let e=s.pop();for(;e in n;)0===s.length&&(s=i()),e=s.pop();n[e]=!0,yield s.pop(),0===s.length&&(s=i())}while(s.length>0)},t.isDataUrl=e=>null!=/^data:([a-z]+\/[a-z0-9-+.]+)?;(?:name=(.*);)?base64,(.*)$/.exec(e.trim()),t.extractFileInfo=e=>{if(null!==e){let i=null;if(e instanceof r.FileObject)i=e;else if("undefined"!=typeof File&&e instanceof File)i={name:e.name,mediaType:e.type,size:e.size,data:e};else if("string"==typeof e&&(0,t.isDataUrl)(e)){const n=(0,t.dataURItoBlob)(e);if(null!==n){const{blob:e,name:t}=n;i={name:t,mediaType:e.type,size:e.size,data:e}}}else{let n=e;try{n=JSON.parse(e),i=n,i.mediaType||(i.mediaType=i.type)}catch(e){}if("string"==typeof(null==n?void 0:n.data)&&(0,t.isDataUrl)(null==n?void 0:n.data)){const e=(0,t.dataURItoBlob)(null==n?void 0:n.data);if(null!==e){const t=e.blob;i={name:null==n?void 0:n.name,mediaType:(null==n?void 0:n.type)||(null==n?void 0:n.mediaType),size:t.size,data:t}}}else"string"==typeof n?i={name:n.split("/").pop(),mediaType:"application/octet-stream",size:0,data:n}:"object"==typeof n&&(i={name:null==n?void 0:n.name,mediaType:(null==n?void 0:n.type)||(null==n?void 0:n.mediaType),size:null==n?void 0:n.size,data:null==n?void 0:n.data})}return null!==i&&null!=i.data?new r.FileObject(i):null}return null},t.dataURItoBlob=e=>{const t=/^data:([a-z]+\/[a-z0-9-+.]+)?(?:;name=([^;]+))?(;base64)?,(.+)$/.exec(e);if(null!==t){const e=t[1]||"",i=t[2]||"unknown";if("string"==typeof t[3]){const n=atob(t[4]),s=[];for(let e=0;e<n.length;e++)s.push(n.charCodeAt(e));return{name:i,blob:new window.Blob([new Uint8Array(s)],{type:e})}}return{name:i,blob:new window.Blob([t[4]],{type:e})}}return null},t.sitesModelToFormModel=e=>{if(!e||!Object.keys(e).length)return e;if((":items"in(i=e)||"cqItems"in i)&&(":itemsOrder"in i||"cqItemsOrder"in i)){const i=[],n=e[":itemsOrder"]||e.cqItemsOrder,s=e[":items"]||e.cqItems;n.forEach((e=>{i.push((0,t.sitesModelToFormModel)(s[e]))})),e.items=i}var i;return e},t.replaceTemplatePlaceholders=(e,t=[])=>null==e?void 0:e.replace(/\${(\d+)}/g,((e,i)=>{const n=t[i];return void 0!==n?n:e})),t.sanitizeName=e=>{const t=/^[A-Za-z0-9_$][A-Za-z0-9_.[\]]*$/;return e.includes(".")?e.split(".").map((e=>{if(e.includes("[")){const i=e.indexOf("["),n=e.substring(0,i),s=e.substring(i);return t.test(n)?e:`"${n}"${s}`}return t.test(e)?e:`"${e}"`})).join("."):t.test(e)?e:`"${e}"`}},5088:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isRepeatable=t.jsonString=t.checkIfKeyAdded=t.deepClone=t.isButton=t.isCaptcha=t.isDateField=t.isDateTimeField=t.isEmailInput=t.isCheckboxGroup=t.isCheckbox=t.checkIfConstraintsArePresent=t.isFile=t.getProperty=void 0;const n=i(9333),s=i(9616);t.getProperty=(e,t,i)=>{if(t in e)return e[t];if(!t.startsWith(":")){const i=`:${t}`;if(i in e)return e[i]}return i},t.isFile=function(e){return"file"===(null==e?void 0:e.type)||"file[]"===(null==e?void 0:e.type)||("string"===(null==e?void 0:e.type)||"string[]"===(null==e?void 0:e.type))&&("binary"===(null==e?void 0:e.format)||"data-url"===(null==e?void 0:e.format))||"file-input"===(null==e?void 0:e.fieldType)},t.checkIfConstraintsArePresent=function(e){return n.constraintProps.some((t=>void 0!==e[t]))},t.isCheckbox=function(e){return"checkbox"===((null==e?void 0:e.fieldType)||(0,s.defaultFieldTypes)(e))},t.isCheckboxGroup=function(e){return"checkbox-group"===((null==e?void 0:e.fieldType)||(0,s.defaultFieldTypes)(e))},t.isEmailInput=function(e){const t=(null==e?void 0:e.fieldType)||(0,s.defaultFieldTypes)(e);return"text-input"===t&&"email"===(null==e?void 0:e.format)||"email"===t},t.isDateTimeField=function(e){const t=(null==e?void 0:e.fieldType)||(0,s.defaultFieldTypes)(e);return"text-input"===t&&"date-time"===(null==e?void 0:e.format)||"datetime-input"===t},t.isDateField=function(e){const t=(null==e?void 0:e.fieldType)||(0,s.defaultFieldTypes)(e);return"text-input"===t&&"date"===(null==e?void 0:e.format)||"date-input"===t},t.isCaptcha=function(e){return"captcha"===((null==e?void 0:e.fieldType)||(0,s.defaultFieldTypes)(e))},t.isButton=function(e){return"button"===(null==e?void 0:e.fieldType)},t.deepClone=function e(t,i){if(null===t||"object"!=typeof t)return t;let n;if(Array.isArray(t)){n=new Array(t.length);for(let s=0;s<t.length;s++)n[s]=e(t[s],i)}else{n={};for(const s of Object.keys(t))n[s]=e(t[s],i)}return i&&n&&n.id&&(n.id=i()),n},t.checkIfKeyAdded=function(e,i,n){if(null!=e&&null!=i){const s=Object.assign({},i);return s[n]=e[n],""===(0,t.jsonString)(e).replace((0,t.jsonString)(s),"")}return!1},t.jsonString=e=>JSON.stringify(e,null,2),t.isRepeatable=e=>e.repeatable&&(void 0===e.minOccur&&void 0===e.maxOccur||void 0!==e.minOccur&&void 0!==e.maxOccur&&0!==e.maxOccur||void 0!==e.minOccur&&void 0!==e.maxOccur&&0!==e.minOccur&&0!==e.maxOccur||void 0!==e.minOccur&&e.minOccur>=0||void 0!==e.maxOccur&&0!==e.maxOccur)||!1},9616:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.exportDataSchema=t.defaultFieldTypes=void 0;const i=e=>new Map(Object.entries(e)),n=i({date:"date-input","data-url":"file-input",binary:"file-input"}),s=i({number:"number-input",boolean:"checkbox",object:"panel",array:"panel",file:"file-input","file[]":"file-input"}),r=["string[]","boolean[]","number[]","array"];t.defaultFieldTypes=e=>{const t=e.type||"string";return"enum"in e?e.enum.length>2||r.indexOf(t)>-1?"drop-down":"checkbox":"string"===t||"string[]"===t?n.get(e.format)||"text-input":s.get(t)||"text-input"};const a=e=>{var t;if("items"in e){const t=e,i=t.items;if("array"===t.type)return{type:"array",items:a(i[0]),minItems:null==t?void 0:t.minItems,maxItems:null==t?void 0:t.maxItems};{const e=i.filter((e=>null!=e.name));return{type:"object",properties:Object.fromEntries(e.map((e=>[e.name,a(e)]))),required:e.filter((e=>e.required)).map((e=>e.name))}}}{const i=e,n=["type","maxLength","minLength","minimum","maximum","format","pattern","step","enum"].reduce(((e,t)=>{const n=t;return t in i&&null!=i[n]&&(e[t]=i[n]),e}),{});if("none"===i.dataRef||0==Object.keys(n).length)return;return Object.assign({title:null===(t=i.label)||void 0===t?void 0:t.value,description:i.description},n)}};t.exportDataSchema=e=>a(e)},712:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createTranslationObject=t.createTranslationObj=t.getOrElse=t.addTranslationId=t.invalidateTranslation=t.CUSTOM_PROPS_KEY=t.TRANSLATION_ID=t.TRANSLATION_TOKEN=void 0;const n=i(9333);t.TRANSLATION_TOKEN="##",t.TRANSLATION_ID="afs:translationIds",t.CUSTOM_PROPS_KEY="properties";const s=["de-DE","en-US","es-ES","fr-FR","it-IT","ja-JP","ko-KR","pt-BR","zh-CN","zh-TW"];t.invalidateTranslation=(e,i)=>{n.translationProps.forEach((n=>{var s,r,a,o;n in i&&(null===(r=null===(s=null==e?void 0:e[t.CUSTOM_PROPS_KEY])||void 0===s?void 0:s[t.TRANSLATION_ID])||void 0===r?void 0:r[n])&&(null===(o=null===(a=null==e?void 0:e[t.CUSTOM_PROPS_KEY])||void 0===a?void 0:a[t.TRANSLATION_ID])||void 0===o||delete o[n])}))},t.addTranslationId=(e,t=[])=>{const i=e,s=[...n.translationProps,...t];return r(i,"",s),i};const r=(e,i,n)=>{Object.entries(e).forEach((([s,a])=>{if("object"==typeof a)e instanceof Array?a&&"name"in a&&r(a,`${""===i?i:i+t.TRANSLATION_TOKEN}${a.name}`,n):r(a,"items"===s?i:`${""===i?i:i+t.TRANSLATION_TOKEN}${s}`,n);else if(":type"in e||"type"in e||"fieldType"in e)for(const s of n)null!=(0,t.getOrElse)(e,s)&&(t.CUSTOM_PROPS_KEY in e||(e[t.CUSTOM_PROPS_KEY]={}),t.TRANSLATION_ID in e[t.CUSTOM_PROPS_KEY]||(e[t.CUSTOM_PROPS_KEY][t.TRANSLATION_ID]={}),s in e[t.CUSTOM_PROPS_KEY][t.TRANSLATION_ID]||(e[t.CUSTOM_PROPS_KEY][t.TRANSLATION_ID][s]=`${i}${t.TRANSLATION_TOKEN}${s}${t.TRANSLATION_TOKEN}${Math.floor(1e4*Math.random())+1}`))}))},a=(e,i,n)=>{Object.values(e).forEach((s=>{var r,o;if("object"==typeof s)a(s,i,n);else for(const s of n){const n=(0,t.getOrElse)(e,s);n&&(null===(o=null===(r=null==e?void 0:e[t.CUSTOM_PROPS_KEY])||void 0===r?void 0:r[t.TRANSLATION_ID])||void 0===o?void 0:o[s])&&(n instanceof Array?n.forEach(((n,r)=>{"string"==typeof n&&(i[`${e[t.CUSTOM_PROPS_KEY][t.TRANSLATION_ID][s]}${t.TRANSLATION_TOKEN}${r}`]=n)})):i[`${e[t.CUSTOM_PROPS_KEY][t.TRANSLATION_ID][s]}`]=n)}}))};t.getOrElse=(e,t,i=null)=>{if(!t)return i;const n=Array.isArray(t)?t:t.split(".");let s=e,r=0;for(;r<n.length&&s.hasOwnProperty(n[r]);)s=s[n[r]],r++;return r==n.length?s:i},t.createTranslationObj=(e,t=[])=>{const i={},s=[...n.translationProps,...t];return a(e,i,s),i},t.createTranslationObject=(e,i=[],r=[])=>{const a=[...n.translationProps,...i],o=JSON.parse(JSON.stringify(e)),l=(0,t.createTranslationObj)((0,t.addTranslationId)(o,i),a),u=[...s,...r],c={};for(const e of u)c[e]=JSON.parse(JSON.stringify(l));return[o,c]}},4476:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Constraints=t.validationConstraintsList=t.ValidConstraints=t.coerceType=void 0;const n=i(1060),s=i(6440),r=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,a=/^[a-zA-Z0-9.!#$%&*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/,o=[31,28,31,30,31,30,31,31,30,31,30,31];t.coerceType=(e,t)=>{let i;switch(t){case"string":return e+"";case"number":if(i=+e,!isNaN(i))return i;break;case"boolean":if("string"==typeof e)return"true"===e;if("number"==typeof e)return 0!==e}throw`${e} has invalid type. Expected : ${t}, Actual ${typeof e}`};const l=e=>{if(""===e||null==e)return{value:"",valid:!0};let t=parseFloat(e);const i=!isNaN(t);return i||(t=e),{value:t,valid:i}},u=e=>{if(""===e||null==e)return{value:"",valid:!0};let t=parseFloat(e);const i=!isNaN(t)&&Math.round(t)===t;return i||(t=e),{value:t,valid:i}},c=e=>null==e||e instanceof Array?e:[e],d=e=>{const t="boolean"==typeof e||"true"===e||"false"===e;return{valid:t,value:"boolean"==typeof e?e:t?"true"===e:e}},h=e=>{const t=(0,n.extractFileInfo)(e),i=null!==t;return{value:i?t:e,valid:i}},p=(e,t)=>{const i=c(e);return null==i?[[],[i]]:i.reduce(((e,i)=>{if(0==e[1].length){const n=t(i);e[n.valid?0:1].push(n.value)}return e}),[[],[]])};t.ValidConstraints={date:["minimum","maximum","exclusiveMinimum","exclusiveMaximum","format"],string:["minLength","maxLength","pattern"],number:["minimum","maximum","exclusiveMinimum","exclusiveMaximum"],array:["minItems","maxItems","uniqueItems"],file:["accept","maxFileSize"],email:["minLength","maxLength","format","pattern"],datetime:["minimum","maximum"]},t.validationConstraintsList=["type","format","minimum","maximum","exclusiveMinimum","exclusiveMaximum","minItems","maxItems","uniqueItems","minLength","maxLength","pattern","required","enum","accept","maxFileSize"],t.Constraints={type:(e,t)=>{let i=t;if(null==t)return{valid:!0,value:t};let n,s=!0;switch(e){case"string":s=!0,i=t.toString();break;case"string[]":i=c(t);break;case"number":n=l(t),i=n.value,s=n.valid;break;case"boolean":n=d(t),s=n.valid,i=n.value;break;case"integer":n=u(t),s=n.valid,i=n.value;break;case"integer[]":n=p(t,u),s=0===n[1].length,i=s?n[0]:t;break;case"file":n=h(t instanceof Array?t[0]:t),s=n.valid,i=n.value;break;case"file[]":n=p(t,h),s=0===n[1].length,i=s?n[0]:t;break;case"number[]":n=p(t,l),s=0===n[1].length,i=s?n[0]:t;break;case"boolean[]":n=p(t,d),s=0===n[1].length,i=s?n[0]:t}return{valid:s,value:i}},format:(e,t)=>{let i=!0;const n=t;if(null===t)return{value:n,valid:i};let s;switch(e){case"date":if(s=r.exec((t||"").trim()),null!=s){const[e,t,n,r]=s,[a,l]=[+n,+r],u=(e=>e%400==0||e%4==0&&e%100!=0)(+t);i=a>=1&&a<=12&&l>=1&&l<=((e,t)=>e&&2==t?29:o[t-1])(u,a)}else i=!1;break;case"email":i=new RegExp(a).test((t||"").trim());break;case"data-url":i=!0}return{valid:i,value:n}},minimum:(e,t)=>({valid:t>=e,value:t}),maximum:(e,t)=>({valid:t<=e,value:t}),exclusiveMinimum:(e,t)=>({valid:t>e,value:t}),exclusiveMaximum:(e,t)=>({valid:t<e,value:t}),minItems:(e,t)=>({valid:t instanceof Array&&t.length>=e,value:t}),maxItems:(e,t)=>({valid:t instanceof Array&&t.length<=e,value:t}),uniqueItems:(e,t)=>({valid:!e||t instanceof Array&&t.length===new Set(t).size,value:t}),minLength:(e,i)=>Object.assign(Object.assign({},t.Constraints.minimum(e,"string"==typeof i?i.length:0)),{value:i}),maxLength:(e,i)=>Object.assign(Object.assign({},t.Constraints.maximum(e,"string"==typeof i?i.length:0)),{value:i}),pattern:(e,t)=>{let i;return i="string"==typeof e?new RegExp(e):e,{valid:i.test(t),value:t}},required:(e,t)=>({valid:!e||null!=t&&""!==t,value:t}),enum:(e,t)=>({valid:e.indexOf(t)>-1,value:t}),accept:(e,t)=>e&&0!==e.length&&null!=t?{valid:!(t instanceof Array?t:[t]).some((t=>{return!(""!==(i=t.type)&&(!i||e.some((e=>{const t=e.trim(),n=t.split("/")[0],s=t.split(".")[1];return t.includes("*")&&i.startsWith(n)||t.includes(".")&&i.endsWith(s)||t===i}))));var i})),value:t}:{valid:!0,value:t},maxFileSize:(e,t)=>{const i="string"==typeof e?(0,n.getFileSizeInBytes)(e):e;return{valid:!(t instanceof s.FileObject)||t.size<=i,value:t}}}},7177:function(e,t){var i,n,s,r,a=this&&this.__classPrivateFieldSet||function(e,t,i,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,i):s?s.value=i:t.set(e,i),i},o=this&&this.__classPrivateFieldGet||function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.Version=void 0,t.Version=class{constructor(e){i.set(this,void 0),n.set(this,void 0),s.set(this,void 0),r.set(this,!0);const t=e.match(/([^.]+)\.([^.]+)(?:\.(.+))?/);if(!t)throw new Error("Invalid version string "+e);if(a(this,n,+t[1],"f"),a(this,i,+t[2],"f"),a(this,s,t[3]?+t[3]:0,"f"),isNaN(o(this,n,"f"))||isNaN(o(this,i,"f"))||isNaN(o(this,s,"f")))throw new Error("Invalid version string "+e)}get major(){return o(this,n,"f")}get minor(){return o(this,i,"f")}get subversion(){return o(this,s,"f")}completeMatch(e){return this.major===e.major&&this.minor===e.minor&&o(this,s,"f")===e.subversion}lessThan(e){return this.major<e.major||this.major===e.major&&this.minor<e.minor||this.major===e.major&&this.minor===e.minor&&o(this,s,"f")<e.subversion}toString(){return`${this.major}.${this.minor}.${this.subversion}`}valueOf(){return this.toString()}},i=new WeakMap,n=new WeakMap,s=new WeakMap,r=new WeakMap},2435:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.adjustTimeZone=o,t.datetimeToNumber=function(e){return null===e?0:e.getTime()/864e5},t.formatDate=function(e,t,i,s){if(i.startsWith("date|")&&(i=i.split("|")[1]),n.ShorthandStyles.find((e=>i.includes(e)))){const r={timeZone:s},a=i.split(/\s/).filter((e=>e.length));return n.ShorthandStyles.indexOf(a[0])>-1&&(r.dateStyle=a[0]),a.length>1&&n.ShorthandStyles.indexOf(a[1])>-1&&(r.timeStyle=a[1]),new Intl.DateTimeFormat(t,r).format(e)}return function(e,t,i,s){const r=(0,n.parseDateTimeSkeleton)(i,t);r.push(["timeZone",s]);const a=r.filter((e=>!e[0].startsWith("x-"))),o=r.filter((e=>e[0].startsWith("x-"))),l=Object.fromEntries(a);delete l.literal;const u=new Intl.DateTimeFormat(t,l).formatToParts(e);return function(e,t){["hour","minute","second"].forEach((i=>{const n=e.find((e=>e.type===i));if(!n)return;const s=t.find((e=>e[0]===i))[1];"2-digit"===s&&1===n.value.length&&(n.value=`0${n.value}`),"numeric"===s&&2===n.value.length&&"0"===n.value.charAt(0)&&(n.value=n.value.slice(1))}))}(u,r),function(e,t){const i=e.find((e=>"year"===e.type));if(!i)return;const n=t.find((e=>"year"===e[0]))[2];for(;i.value.length<n;)i.value=`0${i.value}`}(u,a),a.reduce(((e,t)=>{if("literal"===t[0])e.push(t);else{const i=u.find((e=>{return e.type===({hour12:"dayPeriod",fractionalSecondDigits:"fractionalSecond"}[i=t[0]]||i);var i}));if(i&&"timeZoneName"===i.type){const e=o.find((e=>"x-timeZoneName"===e[0]))[1],t=e[0];"Z"===t&&(e.length<4?(i.value=i.value.replace(/(GMT|:)/g,""),""===i.value&&(i.value="+0000")):5===e.length&&("GMT"===i.value?i.value="Z":i.value=i.value.replace(/GMT/,""))),"X"===t||"x"===t?(1===e.length&&(i.value=i.value.replace(/(GMT|:(00)?)/g,"")),2===e.length&&(i.value=i.value.replace(/(GMT|:)/g,"")),3===e.length&&(i.value=i.value.replace(/GMT/g,"")),"X"===t&&""===i.value&&(i.value="Z")):"O"===e&&(i.value=i.value.replace(/GMT/g,"").replace(/0(\d+):/,"$1:").replace(/:00/,""),""===i.value&&(i.value="+0"))}i&&e.push([i.type,i.value])}return e}),[])}(e,t,i,s).map((e=>e[1])).join("")},t.numberToDatetime=function(e){return new Date(Math.round(1e3*e*60*60*24))},t.offsetMS=r,t.offsetMSFallback=a,t.parseDate=l,t.parseDefaultDate=function(e,t,i){return l(e,t,"yyyy-MM-dd",null,i)};var n=i(8880);const s=[0,1,2,3,4,5,6,7,8,9,10,11].map((e=>new Date(2e3,e,1)));function r(e,t){let i;try{i=new Intl.DateTimeFormat("en-US",{timeZone:t,timeZoneName:"longOffset"}).format(e)}catch(e){return a(0,t)}const n=/GMT([+\-])?(\d{1,2}):?(\d{0,2})?/.exec(i);if(!n)return 0;const[s,r,o]=n.slice(1),l=60*(60*(isNaN(parseInt(r))?0:parseInt(r))+(isNaN(parseInt(o))?0:parseInt(o)))*1e3;return"-"===s?-l:l}function a(e,t){return 60*function(e){var t=new Date;function i(e){var t=e.replace(":"," ").split(" ");return{day:parseInt(t[0]),hour:parseInt(t[1]),minute:parseInt(t[2])}}var n=t.toLocaleString("en-US",{timeZone:e,day:"numeric",hour:"numeric",minute:"numeric",hourCycle:"h23"}),s=i(n),r=i(n=t.toLocaleString("en-US",{day:"numeric",hour:"numeric",minute:"numeric",hourCycle:"h23"}));return 24*s.day*60+60*s.hour+s.minute-(24*r.day*60+60*r.hour+r.minute)-t.getTimezoneOffset()}(t)*1e3}function o(e,t){if(null===e)return null;let i=e.getTime()-60*e.getTimezoneOffset()*1e3;const n=r(e,t);return a(0,t),i+=-n,new Date(i)}function l(e,t,i,r){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];i.startsWith("date|")&&(i=i.split("|")[1]);const l=[],u=[],c=(d=t,""===(null===(h=new Intl.DateTimeFormat(d,{era:"short"}).formatToParts(new Date).find((e=>"era"===e.type)))||void 0===h?void 0:h.value)?"islamic":"gregory");var d,h;const p=function(e){return new Intl.NumberFormat(e,{style:"decimal",useGrouping:!1}).format(9876543210).split("").reverse()}(t),f=`([${p[0]}-${p[9]}]{1,2})`,m=`([${p[0]}-${p[9]}]{1,3})`,g=`([${p[0]}-${p[9]}]{1,4})`;let _="h12",v=a,y=!1;const b=e=>E(e)-1,E=e=>e.split("").reduce(((e,t)=>10*e+p.indexOf(t)),0),T=(0,n.parseDateTimeSkeleton)(i,t),M=function(e,t){return s.map((i=>{const n=new Intl.DateTimeFormat(e,t).formatToParts(i).find((e=>"month"===e.type));return n&&n.value}))}(t,Object.fromEntries(T));T.forEach((e=>{let[i,n,s]=e;if("literal"===i)u.push(n);else if("month"===i&&["numeric","2-digit"].includes(n))u.push(f),l.push(["month",b]);else if("month"===i&&["formatted","long","short","narrow"].includes(n))u.push(`(${M.join("|")})`),l.push(["month",(a=M,e=>a.indexOf(e))]);else if(["day","minute","second"].includes(i))"minute"!==i&&"second"!==i||(v=!1),u.push(f),l.push([i,E]);else if("fractionalSecondDigits"===i)v=!1,u.push(m),l.push([i,(e,t)=>t.fractionalSecondDigits+E(e)]);else if("hour"===i)v=!1,u.push(f),l.push([i,(e,t)=>t.hour+E(e)]);else if("year"===i)u.push("numeric"===n?g:f),l.push(["year",(r=s,e=>{let t=E(e);return t=t<100&&2===r?t+2e3:t,"islamic"===c&&(t=Math.ceil(.97*t+622)),r>2&&t<100&&(y=!0),t})]);else if("dayPeriod"===i){v=!1;const e=function(e){const t=new Date(2e3,1,1,1,1,1),i=new Date(2e3,1,1,16,1,1),n=new Intl.DateTimeFormat(e,{dateStyle:"full",timeStyle:"full"}),s=n.formatToParts(t).find((e=>"dayPeriod"===e.type)),r=n.formatToParts(i).find((e=>"dayPeriod"===e.type));return s&&r?{regex:`(${s.value}|${r.value})`,fn:(e,t)=>t.hour+=e===r.value?12:0}:null}(t);e&&(u.push(e.regex),l.push(["hour",e.fn]))}else"hourCycle"===i?(v=!1,_=n):"x-timeZoneName"===i?(v=!1,u.push("(?:GMT|UTC|Z)?([+\\-0-9]{0,3}:?[0-9]{0,2})"),l.push([i,(e,t)=>{if(v=!0,!e)return;const i=e.replace(//,"-").match(/([+\-\d]{2,3}):?(\d{0,2})/),n=1*i[1];t.hour-=n;const s=i.length>2?1*i[2]:0;t.minute-=n<0?-s:s}])):"timeZoneName"!==i&&(v=!1,u.push(".+?"));var r,a;return u}),[]);const O=new RegExp(`^${u.join("")}$`),I=e.match(O);if(null===I)return null;const w={year:1972,month:0,day:1,hour:0,minute:0,second:0,fractionalSecondDigits:0};if(I.slice(1).forEach(((e,t)=>{const[i,n]=l[t];w[i]=n(e,w)})),"h24"===_&&24===w.hour&&(w.hour=0),"h12"===_&&12===w.hour&&(w.hour=0),v){const e=new Date(Date.UTC(w.year,w.month,w.day,w.hour,w.minute,w.second,w.fractionalSecondDigits));return y&&e.setUTCFullYear(w.year),e}const A=new Date(w.year,w.month,w.day,w.hour,w.minute,w.second,w.fractionalSecondDigits);return y&&A.setFullYear(w.year),null==r?A:o(A,r)}},8880:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ShorthandStyles=void 0,t.getSkeleton=function(e,t){if(n.find((t=>e.includes(t)))){const i=s(e,t),n=[],r={month:"M",year:"Y",day:"d"};return i.forEach((e=>{let[t,i,s]=e;t in r?n.push(Array(s).fill(r[t]).join("")):"literal"===t&&n.push(i)})),n.join("")}return e},t.parseDateTimeSkeleton=function(e,t){if(n.find((t=>e.includes(t))))return s(e,t);const r=[];return e.replace(i,(e=>{const t=e.length;switch(e[0]){case"G":r.push(["era",4===t?"long":5===t?"narrow":"short",t]);break;case"y":r.push(["year",2===t?"2-digit":"numeric",t]);break;case"Y":case"u":case"U":case"r":throw new RangeError("`Y/u/U/r` (year) patterns are not supported, use `y` instead");case"q":case"Q":throw new RangeError("`q/Q` (quarter) patterns are not supported");case"M":case"L":r.push(["month",["numeric","2-digit","short","long","narrow"][t-1],t]);break;case"w":case"W":throw new RangeError("`w/W` (week) patterns are not supported");case"d":r.push(["day",["numeric","2-digit"][t-1],t]);break;case"D":case"F":case"g":throw new RangeError("`D/F/g` (day) patterns are not supported, use `d` instead");case"E":r.push(["weekday",["short","short","short","long","narrow","narrow"][t-1],t]);break;case"e":if(t<4)throw new RangeError("`e..eee` (weekday) patterns are not supported");r.push(["weekday",["short","long","narrow","short"][t-4],t]);break;case"c":if(t<3||t>5)throw new RangeError("`c, cc, cccccc` (weekday) patterns are not supported");r.push(["weekday",["short","long","narrow","short"][t-3],t]);break;case"a":r.push(["hour12",!0,1]);break;case"b":case"B":throw new RangeError("`b/B` (period) patterns are not supported, use `a` instead");case"h":r.push(["hourCycle","h12"]),r.push(["hour",["numeric","2-digit"][t-1],t]);break;case"H":r.push(["hourCycle","h23",1]),r.push(["hour",["numeric","2-digit"][t-1],t]);break;case"K":r.push(["hourCycle","h11",1]),r.push(["hour",["numeric","2-digit"][t-1],t]);break;case"k":r.push(["hourCycle","h24",1]),r.push(["hour",["numeric","2-digit"][t-1],t]);break;case"j":case"J":case"C":throw new RangeError("`j/J/C` (hour) patterns are not supported, use `h/H/K/k` instead");case"m":r.push(["minute",["numeric","2-digit"][t-1],t]);break;case"s":r.push(["second",["numeric","2-digit"][t-1],t]);break;case"S":r.push(["fractionalSecondDigits",t,t]);break;case"A":throw new RangeError("`S/A` (millisecond) patterns are not supported, use `s` instead");case"O":r.push(["timeZoneName",t<4?"shortOffset":"longOffset",t]),r.push(["x-timeZoneName",t<4?"O":"OOOO",t]);break;case"X":case"x":case"Z":r.push(["timeZoneName","longOffset",1]),r.push(["x-timeZoneName",e,1]);break;case"z":case"v":case"V":throw new RangeError("z/v/V` (timeZone) patterns are not supported, use `X/x/Z/O` instead");case"'":r.push(["literal",e.slice(1,-1).replace(/''/g,"'"),-1]);break;default:r.push(["literal",e,-1])}return""})),r};const i=/(?:[Eec]{1,6}|G{1,5}|[Qq]{1,5}|(?:[yYur]+|U{1,5})|[ML]{1,5}|d{1,2}|D{1,3}|F{1}|[abB]{1,5}|[hkHK]{1,2}|w{1,2}|W{1}|m{1,2}|s{1,2}|[zZOvV]{1,5}|[zZOvVxX]{1,3}|S{1,3}|'(?:[^']|'')*')|[^a-zA-Z']+/g,n=["full","long","medium","short"];function s(e,t){const i={},n=e.split(/\s/).filter((e=>e.length));i.dateStyle=n[0],n.length>1&&(i.timeStyle=n[1]);const s=new Date(2e3,2,1,2,3,4),r=new Intl.DateTimeFormat(t,i).formatToParts(s),a=r.find((e=>"month"===e.type)).value,o=new Intl.DateTimeFormat(t,{month:"long"}).formatToParts(s)[0].value,l=new Intl.DateTimeFormat(t,{month:"short"}).formatToParts(s)[0].value,u=[];return r.forEach((t=>{let i,{type:n,value:s}=t;"month"===n&&(i={[a]:"medium"===e?"short":"long",[o]:"long",[l]:"short","03":"2-digit",3:"numeric"}[s]),"year"===n&&(i={2e3:"numeric","00":"2-digit"}[s]),["day","hour","minute","second"].includes(n)&&(i=2===s.length?"2-digit":"numeric"),"literal"===n&&(i=s),"dayPeriod"===n&&(i="short"),u.push([n,i,s.length])})),u}t.ShorthandStyles=n,new Date(2e3,2,1,2,3,4)},9704:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"datetimeToNumber",{enumerable:!0,get:function(){return n.datetimeToNumber}}),Object.defineProperty(t,"formatDate",{enumerable:!0,get:function(){return n.formatDate}}),Object.defineProperty(t,"getSkeleton",{enumerable:!0,get:function(){return s.getSkeleton}}),Object.defineProperty(t,"numberToDatetime",{enumerable:!0,get:function(){return n.numberToDatetime}}),Object.defineProperty(t,"parseDate",{enumerable:!0,get:function(){return n.parseDate}}),Object.defineProperty(t,"parseDefaultDate",{enumerable:!0,get:function(){return n.parseDefaultDate}});var n=i(2435),s=i(8880)},6608:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"datetimeToNumber",{enumerable:!0,get:function(){return n.datetimeToNumber}}),t.format=void 0,Object.defineProperty(t,"formatDate",{enumerable:!0,get:function(){return n.formatDate}}),Object.defineProperty(t,"formatNumber",{enumerable:!0,get:function(){return s.formatNumber}}),Object.defineProperty(t,"numberToDatetime",{enumerable:!0,get:function(){return n.numberToDatetime}}),t.parse=void 0,Object.defineProperty(t,"parseDate",{enumerable:!0,get:function(){return n.parseDate}}),Object.defineProperty(t,"parseDateSkeleton",{enumerable:!0,get:function(){return n.getSkeleton}}),Object.defineProperty(t,"parseDefaultDate",{enumerable:!0,get:function(){return n.parseDefaultDate}}),Object.defineProperty(t,"parseNumber",{enumerable:!0,get:function(){return s.parseNumber}});var n=i(9704),s=i(1960);const r=function(e){const t=null==e?void 0:e.match(/^(?:(num|date)\|)?(.+)/);return[null==t?void 0:t[1],null==t?void 0:t[2]]};t.format=function(e,t,i,a){const[o,l]=r(i);switch(o){case"date":return e instanceof Date||(e=new Date(e.replace(/-/g,"/").replace(/T.+/,""))),(0,n.formatDate)(e,t,l,a);case"num":return(0,s.formatNumber)(e,t,l);default:throw"unable to deduce the format. The skeleton should be date|<format> for date formats and num|<format> for numbers"}},t.parse=function(e,t,i,a){const[o,l]=r(i);switch(o){case"date":return(0,n.parseDate)(e,t,l,a);case"number":return(0,s.parseNumber)(e,t,l);default:throw"unable to deduce the format. The skeleton should be date|<format> for date formats and num|<format> for numbers"}}},1960:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.formatNumber=function(e,t,i){if(i.startsWith("num|")&&(i=i.split("|")[1]),!i)return e;t=t||"en";const{options:s,order:r}=(0,n.parseNumberSkeleton)(i,t);return new Intl.NumberFormat(t,s).format(e)},t.parseDefaultNumber=function(e,t){return s(e,t,`currency/${currencies[t]||"USD"}`)},t.parseNumber=s;var n=i(1764);function s(e,t,i){try{i.startsWith("num|")&&(i=i.split("|")[1]);let s=1,r=e;const a=function(e,t){const i={};let s=new Intl.NumberFormat(e,{style:"decimal",useGrouping:!1}).formatToParts(9876543210.1);i.digits=s.find((e=>"integer"===e.type)).value.split("").reverse(),i.decimal=s.find((e=>"decimal"===e.type)).value;const r=e=>{const t=s.find((t=>t.type===e));t&&(i[e]=t.value)},a=(0,n.parseNumberSkeleton)(t),o=new Intl.NumberFormat(e,a);return s=o.formatToParts(-987654321),r("group"),r("minusSign"),r("percentSign"),i.currency=s.filter((e=>"currency"===e.type)).map((e=>e.value)),i.literal=s.filter((e=>"literal"===e.type)).map((e=>e.value)),s=o.formatToParts(987654321),r("plusSign"),r("exponentSeparator"),r("unit"),i}(t,i);if(a.group&&(r=r.replaceAll(a.group,"")),r=r.replace(a.decimal,"."),a.unit&&(r=r.replaceAll(a.unit,"")),a.minusSign&&r.includes(a.minusSign)&&(r=r.replace(a.minusSign,""),s*=-1),a.percentSign&&r.includes(a.percentSign)&&(s/=100,r=r.replace(a.percentSign,"")),a.currency.forEach((e=>r=r.replace(e,""))),a.literal.forEach((e=>{r.includes(e)&&("("===e&&(s*=-1),r=r.replace(e,""))})),a.plusSign&&(r=r.replace(a.plusSign,"")),a.exponentSeparator){let e;[r,e]=r.split(a.exponentSeparator),s*=Math.pow(10,e)}const o=s*r;return isNaN(o)?e:o}catch(t){return console.dir(t),e}}},1764:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ShorthandStyles=void 0,t.parseNumberSkeleton=function(e,t){const i={},r=[];let o,l;for(l=0;l<a.length&&null==o;l++)o=a[l].exec(e);if(o){switch(l){case 1:i.style="currency",i.currencyDisplay="narrowSymbol",o[1]?i.currency=o[1]:i.currency=(0,n.getCurrency)(t);break;case 2:new Intl.NumberFormat(t,{}).resolvedOptions(),i.minimumFractionDigits=i.minimumFractionDigits||2;break;case 3:i.minimumFractionDigits=0,i.maximumFractionDigits=0;break;case 4:i.style="percent",i.maximumFractionDigits=2;break;case 5:i.style="unit",i.unitDisplay="long",i.unit=o[1]}return{options:i,order:r}}return i.useGrouping=!1,i.minimumIntegerDigits=1,i.maximumFractionDigits=0,i.minimumFractionDigits=0,e.replace(s,((s,a,o,l)=>{const u=s.length;switch(s[0]){case"#":r.push(["digit",u]),!0===(null==i?void 0:i.decimal)&&(i.maximumFractionDigits=i.minimumFractionDigits+u);break;case"@":if(null!=i&&i.minimumSignificantDigits)throw"@ symbol should occur together";const c=a||"";r.push(["@",u-c.length]),i.minimumSignificantDigits=u-c.length,i.maximumSignificantDigits=u,r.push(["digit",c.length]);break;case",":if(!0===(null==i?void 0:i.decimal))throw"grouping character not supporting for fractions";r.push(["group",1]),i.useGrouping="auto";break;case".":null!=i&&i.decimal?console.error("only one decimal symbol is allowed"):(r.push(["decimal",1]),i.decimal=!0);break;case"0":if(r.push("0",u),i.minimumSignificantDigits||i.maximumSignificantDigits)throw"0 is not supported with @";!0===(null==i?void 0:i.decimal)?(i.minimumFractionDigits=u,i.maximumFractionDigits||(i.maximumFractionDigits=u)):i.minimumIntegerDigits=u;break;case"-":0!==l&&console.error("sign display is always in the beginning"),i.signDisplay="negative",r.push(["signDisplay",1,"-"]);break;case"+":0!==l&&"E"===r[r.length-1][0]&&console.error("sign display is always in the beginning"),0===l&&(i.signDisplay="always"),r.push(["signDisplay",1,"+"]);break;case"":0!==l&&l!==e.length-1?console.error("currency display should be either in the beginning or at the end"):(i.style="currency",i.currencyDisplay=["symbol","code","name","narrowSymbol"][u-1],i.currency=o||(0,n.getCurrency)(t),r.push(["currency",u]));break;case"%":0!==l&&l!==e.length-1?console.error("percent display should be either in the beginning or at the end"):(r.push(["%",1]),i.style="percent");break;case"E":r.push(["E",u]),i.style=["scientific","engineering"](u-1);break;default:console.error("unknown chars"+s)}})),{options:i,order:r}};var n=i(8763);const s=/(?:[#]+|[@]+(#+)?|[0]+|[,]|[.]|[-]|[+]|[%]|[]{1,4}(?:\/([a-zA-Z]{3}))?|[;]|[K]{1,2}|E{1,2}[+]?|'(?:[^']|'')*')|[^a-zA-Z']+/g,r=["acre","bit","byte","celsius","centimeter","day","degree","fahrenheit","fluid-ounce","foot","gallon","gigabit","gigabyte","gram","hectare","hour","inch","kilobit","kilobyte","kilogram","kilometer","liter","megabit","megabyte","meter","mile","mile-scandinavian","milliliter","millimeter","millisecond","minute","month","ounce","percent","petabyte","pound","second","stone","terabit","terabyte","week","yard","year"].join("|"),a=[/^currency(?:\/([a-zA-Z]{3}))?$/,/^decimal$/,/^integer$/,/^percent$/,new RegExp(`^unit/(${r})$`)];t.ShorthandStyles=a},8763:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrency=void 0;const i={"da-DK":"DKK","de-DE":"EUR","en-US":"USD","en-GB":"GBP","es-ES":"EUR","fi-FI":"EUR","fr-FR":"EUR","it-IT":"EUR","ja-JP":"JPY","nb-NO":"NOK","nl-NL":"EUR","pt-BR":"BRL","sv-SE":"SEK","zh-CN":"CNY","zh-TW":"TWD","ko-KR":"KRW","cs-CZ":"CZK","pl-PL":"PLN","ru-RU":"RUB","tr-TR":"TRY"},n=Object.keys(i);t.getCurrency=function(e){if(n.indexOf(e)>-1)return i[e];{const t=n.find((t=>t.startsWith(e)));if(t)return i[t]}return""}},3548:(e,t,i)=>{i.r(t),i.d(t,{default:()=>At,jsonFormula:()=>Ct});const n={TYPE_NUMBER:0,TYPE_ANY:1,TYPE_STRING:2,TYPE_ARRAY:3,TYPE_OBJECT:4,TYPE_BOOLEAN:5,TYPE_EXPREF:6,TYPE_NULL:7,TYPE_ARRAY_NUMBER:8,TYPE_ARRAY_STRING:9,TYPE_CLASS:10,TYPE_ARRAY_ARRAY:11},s={TOK_EOF:"EOF",TOK_UNQUOTEDIDENTIFIER:"UnquotedIdentifier",TOK_QUOTEDIDENTIFIER:"QuotedIdentifier",TOK_RBRACKET:"Rbracket",TOK_RPAREN:"Rparen",TOK_COMMA:"Comma",TOK_COLON:"Colon",TOK_CONCATENATE:"Concatenate",TOK_RBRACE:"Rbrace",TOK_NUMBER:"Number",TOK_CURRENT:"Current",TOK_GLOBAL:"Global",TOK_FIELD:"Field",TOK_EXPREF:"Expref",TOK_PIPE:"Pipe",TOK_OR:"Or",TOK_AND:"And",TOK_ADD:"Add",TOK_SUBTRACT:"Subtract",TOK_UNARY_MINUS:"UnaryMinus",TOK_MULTIPLY:"Multiply",TOK_POWER:"Power",TOK_UNION:"Union",TOK_DIVIDE:"Divide",TOK_EQ:"EQ",TOK_GT:"GT",TOK_LT:"LT",TOK_GTE:"GTE",TOK_LTE:"LTE",TOK_NE:"NE",TOK_FLATTEN:"Flatten",TOK_STAR:"Star",TOK_FILTER:"Filter",TOK_DOT:"Dot",TOK_NOT:"Not",TOK_LBRACE:"Lbrace",TOK_LBRACKET:"Lbracket",TOK_LPAREN:"Lparen",TOK_LITERAL:"Literal"},{TYPE_NUMBER:r,TYPE_ANY:a,TYPE_STRING:o,TYPE_ARRAY:l,TYPE_OBJECT:u,TYPE_BOOLEAN:c,TYPE_EXPREF:d,TYPE_NULL:h,TYPE_ARRAY_NUMBER:p,TYPE_ARRAY_STRING:f,TYPE_CLASS:m,TYPE_ARRAY_ARRAY:g}=n,{TOK_EXPREF:_}=s,v={[r]:"number",[a]:"any",[o]:"string",[l]:"array",[u]:"object",[c]:"boolean",[d]:"expression",[h]:"null",[p]:"Array<number>",[f]:"Array<string>",[m]:"class",[g]:"Array<array>"};function y(e,t=!0){if(null===e)return h;let i=e;if(t){if("function"!=typeof e.valueOf)return u;i=e.valueOf.call(e)}switch(Object.prototype.toString.call(i)){case"[object String]":return o;case"[object Number]":return r;case"[object Array]":return l;case"[object Boolean]":return c;case"[object Null]":return h;case"[object Object]":return i.jmespathType===_?d:u;default:return u}}function b(e){return[y(e),y(e,!1)]}function E(e,t,i,n,s,d){const _=e[0];if(-1!==t.findIndex((e=>e===a||_===e)))return i;let y=!1;if((_===u||1===t.length&&t[0]===m)&&(y=!0),_===l&&1===t.length&&t[0]===u&&(y=!0),t.includes(g)){if(_===l&&(i.forEach((e=>{e instanceof Array||(y=!0)})),!y))return i;y=!0}if(y)throw new Error(`TypeError: ${n} expected argument to be type ${v[t[0]]} but received type ${v[_]} instead.`);let T=-1;if(_===l&&t.includes(f)&&t.includes(p)&&(T=i.length>0&&"string"==typeof i[0]?f:p),-1===T&&[f,p,l].includes(_)&&(T=t.find((e=>[f,p,l].includes(e)))),-1===T&&([T]=t),T===a)return i;if(T===f||T===p||T===l){if(T===l)return _===p||_===f?i:null===i?[]:[i];const t=T===p?r:o;if(_===l){const e=i.slice();for(let i=0;i<e.length;i+=1){const r=b(e[i]);e[i]=E(r,[t],e[i],n,s,d)}return e}if([r,o,h,c].includes(t))return[E(e,[t],i,n,s,d)]}else{if(T===r)return[o,c,h].includes(_)?s(i):0;if(T===o)return _===h||_===u?"":d(i);if(T===c)return!!i;if(T===u&&e[1]===u)return i}throw new Error(`TypeError: ${n} expected argument to be type ${v[t[0]]} but received type ${v[_]} instead.`)}function T(e){return null!==e&&"[object Array]"===Object.prototype.toString.call(e)}function M(e){return null!==e&&"[object Object]"===Object.prototype.toString.call(e)}function O(e){return null==e?e:T(e)?e.map((e=>O(e))):"function"!=typeof e.valueOf?e:e.valueOf()}function I(e,t){const i=O(e),n=O(t);if(i===n)return!0;if(Object.prototype.toString.call(i)!==Object.prototype.toString.call(n))return!1;if(!0===T(i)){if(i.length!==n.length)return!1;for(let e=0;e<i.length;e+=1)if(!1===I(i[e],n[e]))return!1;return!0}if(!0===M(i)){const e={};for(const t in i)if(hasOwnProperty.call(i,t)){if(!1===I(i[t],n[t]))return!1;e[t]=!0}for(const t in n)if(hasOwnProperty.call(n,t)&&!0!==e[t])return!1;return!0}return!1}const{TOK_CURRENT:w,TOK_GLOBAL:A,TOK_EXPREF:C,TOK_PIPE:N,TOK_EQ:j,TOK_GT:S,TOK_LT:x,TOK_GTE:R,TOK_LTE:D,TOK_NE:P,TOK_FLATTEN:F}=s,{TYPE_STRING:L,TYPE_ARRAY_STRING:k,TYPE_ARRAY:$}=n;function U(e){if(null===e)return!0;const t=O(e);if(""===t||!1===t||null===t)return!0;if(T(t)&&0===t.length)return!0;if(M(t)){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}return!t}class V{constructor(e,t,i,n,s,r){this.runtime=e,this.globals=t,this.toNumber=i,this.toString=n,this.debug=s,this.language=r}search(e,t){return this.visit(e,t)}visit(e,t){const i=e&&{Field:(e,t)=>{if(null!==t&&(M(t)||T(t))){let i=t[e.name];if("function"==typeof i&&(i=void 0),void 0===i){try{this.debug.push(`Failed to find: '${e.name}'`);const i=Object.keys(t).map((e=>`'${e}'`)).toString();i.length&&this.debug.push(`Available fields: ${i}`)}catch(e){}return null}return i}return null},Subexpression:(e,t)=>{let i=this.visit(e.children[0],t);for(let t=1;t<e.children.length;t+=1)if(i=this.visit(e.children[1],i),null===i)return null;return i},IndexExpression:(e,t)=>{const i=this.visit(e.children[0],t);return this.visit(e.children[1],i)},Index:(e,t)=>{if(T(t)){let i=this.toNumber(this.visit(e.value,t));i<0&&(i=t.length+i);const n=t[i];return void 0===n?(this.debug.push(`Index ${i} out of range`),null):n}if(M(t)){const i=this.toString(this.visit(e.value,t)),n=t[i];return void 0===n?(this.debug.push(`Key ${i} does not exist`),null):n}return this.debug.push(`left side of index expression ${t} is not an array or object.`),null},Slice:(e,t)=>{if(!T(t))return null;const i=e.children.slice(0).map((e=>null!=e?this.toNumber(this.visit(e,t)):null)),n=this.computeSliceParams(t.length,i),[s,r,a]=n,o=[];if(a>0)for(let e=s;e<r;e+=a)o.push(t[e]);else for(let e=s;e>r;e+=a)o.push(t[e]);return o},Projection:(e,t)=>{const i=this.visit(e.children[0],t);if(!T(i))return null;const n=[];return i.forEach((t=>{const i=this.visit(e.children[1],t);null!==i&&n.push(i)})),n},ValueProjection:(e,t)=>{const i=this.visit(e.children[0],t);if(!M(O(i)))return null;const n=[];var s;return(s=i,Object.values(s)).forEach((t=>{const i=this.visit(e.children[1],t);null!==i&&n.push(i)})),n},FilterProjection:(e,t)=>{const i=this.visit(e.children[0],t);if(!T(i))return null;const n=i.filter((t=>!U(this.visit(e.children[2],t)))),s=[];return n.forEach((t=>{const i=this.visit(e.children[1],t);null!==i&&s.push(i)})),s},Comparator:(e,t)=>{const i=this.visit(e.children[0],t),n=this.visit(e.children[1],t);if(e.name===j)return I(i,n);if(e.name===P)return!I(i,n);if(e.name===S)return i>n;if(e.name===R)return i>=n;if(e.name===x)return i<n;if(e.name===D)return i<=n;throw new Error(`Unknown comparator: ${e.name}`)},[F]:(e,t)=>{const i=this.visit(e.children[0],t);if(!T(i))return null;const n=[];return i.forEach((e=>{T(e)?n.push(...e):n.push(e)})),n},Identity:(e,t)=>t,MultiSelectList:(e,t)=>null===t?null:e.children.map((e=>this.visit(e,t))),MultiSelectHash:(e,t)=>{if(null===t)return null;const i={};return e.children.forEach((e=>{i[e.name]=this.visit(e.value,t)})),i},OrExpression:(e,t)=>{let i=this.visit(e.children[0],t);return U(i)&&(i=this.visit(e.children[1],t)),i},AndExpression:(e,t)=>{const i=this.visit(e.children[0],t);return!0===U(i)?i:this.visit(e.children[1],t)},AddExpression:(e,t)=>{const i=this.visit(e.children[0],t),n=this.visit(e.children[1],t);return this.applyOperator(i,n,"+")},ConcatenateExpression:(e,t)=>{let i=this.visit(e.children[0],t),n=this.visit(e.children[1],t);return i=E(b(i),[L,k],i,"concatenate",this.toNumber,this.toString),n=E(b(n),[L,k],n,"concatenate",this.toNumber,this.toString),this.applyOperator(i,n,"&")},UnionExpression:(e,t)=>{let i=this.visit(e.children[0],t),n=this.visit(e.children[1],t);return i=E(b(i),[$],i,"union",this.toNumber,this.toString),n=E(b(n),[$],n,"union",this.toNumber,this.toString),i.concat(n)},SubtractExpression:(e,t)=>{const i=this.visit(e.children[0],t),n=this.visit(e.children[1],t);return this.applyOperator(i,n,"-")},MultiplyExpression:(e,t)=>{const i=this.visit(e.children[0],t),n=this.visit(e.children[1],t);return this.applyOperator(i,n,"*")},DivideExpression:(e,t)=>{const i=this.visit(e.children[0],t),n=this.visit(e.children[1],t);return this.applyOperator(i,n,"/")},PowerExpression:(e,t)=>{const i=this.visit(e.children[0],t),n=this.visit(e.children[1],t);return this.applyOperator(i,n,"^")},NotExpression:(e,t)=>U(this.visit(e.children[0],t)),UnaryMinusExpression:(e,t)=>-1*this.visit(e.children[0],t),Literal:e=>e.value,Number:e=>e.value,[N]:(e,t)=>{const i=this.visit(e.children[0],t);return this.visit(e.children[1],i)},[w]:(e,t)=>t,[A]:e=>{const t=this.globals[e.name];return void 0===t?null:t},Function:(e,t)=>{if("if"===e.name)return this.runtime.callFunction(e.name,e.children,t,this,!1);const i=e.children.map((e=>this.visit(e,t)));return this.runtime.callFunction(e.name,i,t,this)},ExpressionReference:e=>{const[t]=e.children;return t.jmespathType=C,t}}[e.type];if(!i)throw new Error(`Unknown/missing node type ${e&&e.type||""}`);return i(e,t)}computeSliceParams(e,t){function i(e,t,i){let n=t;return n<0?(n+=e,n<0&&(n=i<0?-1:0)):n>=e&&(n=i<0?e-1:e),n}let[n,s,r]=t;if(null===r)r=1;else if(0===r){const e=new Error("Invalid slice, step cannot be 0");throw e.name="RuntimeError",e}const a=r<0;return n=null===n?a?e-1:0:i(e,n,r),s=null===s?a?-1:e:i(e,s,r),[n,s,r]}applyOperator(e,t,i){if(T(e)&&T(t)){const n=e.length<t.length?e:t,s=Math.abs(e.length-t.length);n.length+=s,n.fill(null,n.length-s);const r=[];for(let n=0;n<e.length;n+=1)r.push(this.applyOperator(e[n],t[n],i));return r}if(T(e))return e.map((e=>this.applyOperator(e,t,i)));if(T(t))return t.map((t=>this.applyOperator(e,t,i)));if("*"===i)return this.toNumber(e)*this.toNumber(t);if("&"===i)return e+t;if("+"===i)return this.toNumber(e)+this.toNumber(t);if("-"===i)return this.toNumber(e)-this.toNumber(t);if("/"===i){const i=e/t;return Number.isFinite(i)?i:null}if("^"===i)return e**t;throw new Error(`Unknown operator: ${i}`)}}const{TOK_UNQUOTEDIDENTIFIER:B,TOK_QUOTEDIDENTIFIER:Y,TOK_RBRACKET:K,TOK_RPAREN:H,TOK_COMMA:q,TOK_COLON:G,TOK_CONCATENATE:z,TOK_RBRACE:W,TOK_NUMBER:J,TOK_CURRENT:Q,TOK_GLOBAL:X,TOK_EXPREF:Z,TOK_PIPE:ee,TOK_OR:te,TOK_AND:ie,TOK_ADD:ne,TOK_SUBTRACT:se,TOK_UNARY_MINUS:re,TOK_MULTIPLY:ae,TOK_POWER:oe,TOK_DIVIDE:le,TOK_UNION:ue,TOK_EQ:ce,TOK_GT:de,TOK_LT:he,TOK_GTE:pe,TOK_LTE:fe,TOK_NE:me,TOK_FLATTEN:ge,TOK_STAR:_e,TOK_FILTER:ve,TOK_DOT:ye,TOK_NOT:be,TOK_LBRACE:Ee,TOK_LBRACKET:Te,TOK_LPAREN:Me,TOK_LITERAL:Oe}=s,Ie={".":ye,",":q,":":G,"{":Ee,"}":W,"]":K,"(":Me,")":H,"@":Q},we={"<":!0,">":!0,"=":!0,"!":!0},Ae={" ":!0,"\t":!0,"\n":!0};function Ce(e){return e>="0"&&e<="9"||"."===e}function Ne(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||"_"===e}function je(e,t){const i=e[t];return"$"===i?e.length>t&&Ne(e[t+1]):i>="a"&&i<="z"||i>="A"&&i<="Z"||"_"===i}class Se{constructor(e=[],t=[]){this._allowedGlobalNames=e,this.debug=t}tokenize(e){const t=[];let i,n,s;for(this._current=0;this._current<e.length;){const r=t.length?t.slice(-1)[0].type:null;if(this._isGlobal(r,e,this._current))t.push(this._consumeGlobal(e));else if(je(e,this._current))i=this._current,n=this._consumeUnquotedIdentifier(e),t.push({type:B,value:n,start:i});else if(void 0!==Ie[e[this._current]])t.push({type:Ie[e[this._current]],value:e[this._current],start:this._current}),this._current+=1;else if("-"!==e[this._current]||[X,Q,J,H,B,Y,K].includes(r))if(Ce(e[this._current]))s=this._consumeNumber(e),t.push(s);else if("["===e[this._current])s=this._consumeLBracket(e),t.push(s);else if('"'===e[this._current])i=this._current,n=this._consumeQuotedIdentifier(e),t.push({type:Y,value:n,start:i});else if("'"===e[this._current])i=this._current,n=this._consumeRawStringLiteral(e),t.push({type:Oe,value:n,start:i});else if("`"===e[this._current]){i=this._current;const n=this._consumeLiteral(e);t.push({type:Oe,value:n,start:i})}else if(void 0!==we[e[this._current]])t.push(this._consumeOperator(e));else if(void 0!==Ae[e[this._current]])this._current+=1;else if("&"===e[this._current])i=this._current,this._current+=1,"&"===e[this._current]?(this._current+=1,t.push({type:ie,value:"&&",start:i})):r===q||r===Me?t.push({type:Z,value:"&",start:i}):t.push({type:z,value:"&",start:i});else if("~"===e[this._current])i=this._current,this._current+=1,t.push({type:ue,value:"~",start:i});else if("+"===e[this._current])i=this._current,this._current+=1,t.push({type:ne,value:"+",start:i});else if("-"===e[this._current])i=this._current,this._current+=1,t.push({type:se,value:"-",start:i});else if("*"===e[this._current]){i=this._current,this._current+=1;const e=t.length&&t.slice(-1)[0].type;0===t.length||[Te,ye,ee,ie,te,q,G].includes(e)?t.push({type:_e,value:"*",start:i}):t.push({type:ae,value:"*",start:i})}else if("/"===e[this._current])i=this._current,this._current+=1,t.push({type:le,value:"/",start:i});else if("^"===e[this._current])i=this._current,this._current+=1,t.push({type:oe,value:"^",start:i});else{if("|"!==e[this._current]){const t=new Error(`Unknown character:${e[this._current]}`);throw t.name="LexerError",t}i=this._current,this._current+=1,"|"===e[this._current]?(this._current+=1,t.push({type:te,value:"||",start:i})):t.push({type:ee,value:"|",start:i})}else s=this._consumeUnaryMinus(e),t.push(s)}return t}_consumeUnquotedIdentifier(e){const t=this._current;for(this._current+=1;this._current<e.length&&Ne(e[this._current]);)this._current+=1;return e.slice(t,this._current)}_consumeQuotedIdentifier(e){const t=this._current;this._current+=1;const i=e.length;let n=!je(e,t+1);for(;'"'!==e[this._current]&&this._current<i;){let t=this._current;Ne(e[t])||(n=!0),"\\"!==e[t]||"\\"!==e[t+1]&&'"'!==e[t+1]?t+=1:t+=2,this._current=t}this._current+=1;const s=e.slice(t,this._current);try{n&&!s.includes(" ")||(this.debug.push(`Suspicious quotes: ${s}`),this.debug.push(`Did you intend a literal? '${s.replace(/"/g,"")}'?`))}catch(e){}return JSON.parse(s)}_consumeRawStringLiteral(e){const t=this._current;this._current+=1;const i=e.length;for(;"'"!==e[this._current]&&this._current<i;){let t=this._current;"\\"!==e[t]||"\\"!==e[t+1]&&"'"!==e[t+1]?t+=1:t+=2,this._current=t}return this._current+=1,e.slice(t+1,this._current-1).replaceAll("\\'","'")}_consumeNumber(e){const t=this._current;this._current+=1;const i=e.length;for(;Ce(e[this._current])&&this._current<i;)this._current+=1;const n=e.slice(t,this._current);let s;return s=n.includes(".")?parseFloat(n):parseInt(n,10),{type:J,value:s,start:t}}_consumeUnaryMinus(){const e=this._current;return this._current+=1,{type:re,value:"-",start:e}}_consumeLBracket(e){const t=this._current;return this._current+=1,"?"===e[this._current]?(this._current+=1,{type:ve,value:"[?",start:t}):"]"===e[this._current]?(this._current+=1,{type:ge,value:"[]",start:t}):{type:Te,value:"[",start:t}}_isGlobal(e,t,i){if(null!==e&&e===ye)return!1;if("$"!==t[i])return!1;let n=i+1;for(;n<t.length&&Ne(t[n]);)n+=1;const s=t.slice(i,n);return this._allowedGlobalNames.includes(s)}_consumeGlobal(e){const t=this._current;for(this._current+=1;this._current<e.length&&Ne(e[this._current]);)this._current+=1;const i=e.slice(t,this._current);return{type:X,name:i,start:t}}_consumeOperator(e){const t=this._current,i=e[t];return this._current+=1,"!"===i?"="===e[this._current]?(this._current+=1,{type:me,value:"!=",start:t}):{type:be,value:"!",start:t}:"<"===i?"="===e[this._current]?(this._current+=1,{type:fe,value:"<=",start:t}):{type:he,value:"<",start:t}:">"===i?"="===e[this._current]?(this._current+=1,{type:pe,value:">=",start:t}):{type:de,value:">",start:t}:"="===e[this._current]?(this._current+=1,{type:ce,value:"==",start:t}):{type:ce,value:"=",start:t}}_consumeLiteral(e){this._current+=1;const t=this._current,i=e.length;let n,s=!1;for(;(s||"`"!==e[this._current])&&this._current<i;){let t=this._current;s&&"\\"===e[t]&&'"'===e[t+1]?t+=2:('"'===e[t]&&(s=!s),s&&"`"===e[t+1]?t+=2:"\\"!==e[t]||"\\"!==e[t+1]&&"`"!==e[t+1]?t+=1:t+=2),this._current=t}let r=e.slice(t,this._current).trimStart();return r=r.replaceAll("\\`","`"),n=function(e){if(""===e)return!1;if('[{"'.includes(e[0]))return!0;if(["true","false","null"].includes(e))return!0;if(!"-0123456789".includes(e[0]))return!1;try{return JSON.parse(e),!0}catch(e){return!1}}(r)?JSON.parse(r):JSON.parse(`"${r}"`),this._current+=1,n}}const{TOK_LITERAL:xe,TOK_COLON:Re,TOK_EOF:De,TOK_UNQUOTEDIDENTIFIER:Pe,TOK_QUOTEDIDENTIFIER:Fe,TOK_RBRACKET:Le,TOK_RPAREN:ke,TOK_COMMA:$e,TOK_CONCATENATE:Ue,TOK_RBRACE:Ve,TOK_NUMBER:Be,TOK_CURRENT:Ye,TOK_GLOBAL:Ke,TOK_FIELD:He,TOK_EXPREF:qe,TOK_PIPE:Ge,TOK_OR:ze,TOK_AND:We,TOK_ADD:Je,TOK_SUBTRACT:Qe,TOK_UNARY_MINUS:Xe,TOK_MULTIPLY:Ze,TOK_POWER:et,TOK_DIVIDE:tt,TOK_UNION:it,TOK_EQ:nt,TOK_GT:st,TOK_LT:rt,TOK_GTE:at,TOK_LTE:ot,TOK_NE:lt,TOK_FLATTEN:ut,TOK_STAR:ct,TOK_FILTER:dt,TOK_DOT:ht,TOK_NOT:pt,TOK_LBRACE:ft,TOK_LBRACKET:mt,TOK_LPAREN:gt}=s,_t={[De]:0,[Pe]:0,[Fe]:0,[Le]:0,[ke]:0,[$e]:0,[Ve]:0,[Be]:0,[Ye]:0,[Ke]:0,[He]:0,[qe]:0,[Ge]:1,[ze]:2,[We]:3,[Ue]:5,[Je]:6,[Qe]:6,[Ze]:7,[tt]:7,[et]:7,[it]:7,[nt]:5,[st]:5,[rt]:5,[at]:5,[ot]:5,[lt]:5,[ut]:9,[ct]:20,[dt]:21,[ht]:40,[pt]:30,[Xe]:30,[ft]:50,[mt]:55,[gt]:60};class vt{constructor(e=[]){this._allowedGlobalNames=e}parse(e,t){this._loadTokens(e,t),this.index=0;const i=this.expression(0);if(this._lookahead(0)!==De){const e=this._lookaheadToken(0),t=new Error(`Unexpected token type: ${e.type}, value: ${e.value}`);throw t.name="ParserError",t}return i}_loadTokens(e,t){const i=new Se(this._allowedGlobalNames,t).tokenize(e);i.push({type:De,value:"",start:e.length}),this.tokens=i}expression(e){const t=this._lookaheadToken(0);this._advance();let i=this.nud(t),n=this._lookahead(0);for(;e<_t[n];)this._advance(),i=this.led(n,i),n=this._lookahead(0);return i}_lookahead(e){return this.tokens[this.index+e].type}_lookaheadToken(e){return this.tokens[this.index+e]}_advance(){this.index+=1}_getIndex(){return this.index}_setIndex(e){this.index=e}nud(e){let t,i,n,s,r;switch(e.type){case xe:return{type:"Literal",value:e.value};case Be:return{type:"Number",value:e.value};case Pe:return{type:"Field",name:e.value};case Fe:if(s={type:"Field",name:e.value},this._lookahead(0)===gt)throw new Error("Quoted identifier not allowed for function names.");return s;case pt:return i=this.expression(_t.Not),{type:"NotExpression",children:[i]};case Xe:return i=this.expression(_t.UnaryMinus),{type:"UnaryMinusExpression",children:[i]};case ct:return t={type:"Identity"},i=this._lookahead(0)===Le?{type:"Identity"}:this._parseProjectionRHS(_t.Star),{type:"ValueProjection",children:[t,i]};case dt:return this.led(e.type,{type:"Identity"});case ft:return this._parseMultiselectHash();case ut:return t={type:ut,children:[{type:"Identity"}]},i=this._parseProjectionRHS(_t.Flatten),{type:"Projection",children:[t,i]};case mt:return this._lookahead(0)===ct&&this._lookahead(1)===Le?(this._advance(),this._advance(),i=this._parseProjectionRHS(_t.Star),{type:"Projection",children:[{type:"Identity"},i]}):this._parseUnchainedIndexExpression();case Ye:return{type:Ye};case Ke:return{type:Ke,name:e.name};case He:return{type:He};case qe:return n=this.expression(_t.Expref),{type:"ExpressionReference",children:[n]};case gt:for(r=[];this._lookahead(0)!==ke;)n=this.expression(0),r.push(n);return this._match(ke),r[0];default:this._errorToken(e)}}led(e,t){let i,n,s,r,a,o,l,u,c;switch(e){case Ue:return n=this.expression(_t.Concatenate),{type:"ConcatenateExpression",children:[t,n]};case ht:return l=_t.Dot,this._lookahead(0)!==ct?(n=this._parseDotRHS(l),{type:"Subexpression",children:[t,n]}):(this._advance(),n=this._parseProjectionRHS(l),{type:"ValueProjection",children:[t,n]});case Ge:return n=this.expression(_t.Pipe),{type:Ge,children:[t,n]};case ze:return n=this.expression(_t.Or),{type:"OrExpression",children:[t,n]};case We:return n=this.expression(_t.And),{type:"AndExpression",children:[t,n]};case Je:return n=this.expression(_t.Add),{type:"AddExpression",children:[t,n]};case Qe:return n=this.expression(_t.Subtract),{type:"SubtractExpression",children:[t,n]};case Ze:return n=this.expression(_t.Multiply),{type:"MultiplyExpression",children:[t,n]};case tt:return n=this.expression(_t.Divide),{type:"DivideExpression",children:[t,n]};case et:return n=this.expression(_t.Power),{type:"PowerExpression",children:[t,n]};case it:return n=this.expression(_t.Power),{type:"UnionExpression",children:[t,n]};case gt:for(s=t.name,r=[];this._lookahead(0)!==ke;)a=this.expression(0),this._lookahead(0)===$e&&this._match($e),r.push(a);return this._match(ke),o={type:"Function",name:s,children:r},o;case dt:return i=this.expression(0),this._match(Le),n=this._lookahead(0)===ut?{type:"Identity"}:this._parseProjectionRHS(_t.Filter),{type:"FilterProjection",children:[t,n,i]};case ut:return u={type:ut,children:[t]},c=this._parseProjectionRHS(_t.Flatten),{type:"Projection",children:[u,c]};case nt:case lt:case st:case at:case rt:case ot:return this._parseComparator(t,e);case mt:return this._lookahead(0)===ct&&this._lookahead(1)===Le?(this._advance(),this._advance(),n=this._parseProjectionRHS(_t.Star),{type:"Projection",children:[t,n]}):(n=this._parseChainedIndexExpression(),this._projectIfSlice(t,n));default:this._errorToken(this._lookaheadToken(0))}}_match(e){if(this._lookahead(0)!==e){const t=this._lookaheadToken(0),i=new Error(`Expected ${e}, got: ${t.type}`);throw i.name="ParserError",i}this._advance()}_errorToken(e){const t=new Error(`Invalid token (${e.type}): "${e.value}"`);throw t.name="ParserError",t}_parseChainedIndexExpression(){const e=this._getIndex();if(this._lookahead(0)===Re)return this._parseSliceExpression();const t=this.expression(0);return this._lookahead(0)===Re?(this._setIndex(e),this._parseSliceExpression()):(this._match(Le),{type:"Index",value:t})}_parseUnchainedIndexExpression(){const e=this._getIndex(),t=this._lookahead(0);if(t===Re){const e=this._parseSliceExpression();return this._projectIfSlice({type:"Identity"},e)}const i=this.expression(0),n=this._lookahead(0);if(n===$e)return this._setIndex(e),this._parseMultiselectList();if(n===Re){this._setIndex(e);const t=this._parseSliceExpression();return this._projectIfSlice({type:"Identity"},t)}return t===Be||t===Xe?(this._match(Le),{type:"Index",value:i}):(this._setIndex(e),this._parseMultiselectList())}_projectIfSlice(e,t){const i={type:"IndexExpression",children:[e,t]};return"Slice"===t.type?{type:"Projection",children:[i,this._parseProjectionRHS(_t.Star)]}:i}_parseSliceExpression(){const e=[null,null,null];let t=0,i=this._lookahead(0);for(;i!==Le&&t<3;){if(i===Re&&t<2)t+=1,this._advance();else{e[t]=this.expression(0);const i=this._lookahead(0);if(i!==Re&&i!==Le){const e=new Error(`Syntax error, unexpected token: ${i.value}(${i.type})`);throw e.name="Parsererror",e}}i=this._lookahead(0)}return this._match(Le),{type:"Slice",children:e}}_parseComparator(e,t){return{type:"Comparator",name:t,children:[e,this.expression(_t[t])]}}_parseDotRHS(e){const t=this._lookahead(0);return[Pe,Fe,ct].indexOf(t)>=0?this.expression(e):t===mt?(this._match(mt),this._parseMultiselectList()):t===ft?(this._match(ft),this._parseMultiselectHash()):void 0}_parseProjectionRHS(e){let t;if(_t[this._lookahead(0)]<10)t={type:"Identity"};else if(this._lookahead(0)===mt)t=this.expression(e);else if(this._lookahead(0)===dt)t=this.expression(e);else{if(this._lookahead(0)!==ht){const e=this._lookaheadToken(0),t=new Error(`Sytanx error, unexpected token: ${e.value}(${e.type})`);throw t.name="ParserError",t}this._match(ht),t=this._parseDotRHS(e)}return t}_parseMultiselectList(){const e=[];for(;this._lookahead(0)!==Le;){const t=this.expression(0);if(e.push(t),this._lookahead(0)===$e&&(this._match($e),this._lookahead(0)===Le))throw new Error("Unexpected token Rbracket")}return this._match(Le),{type:"MultiSelectList",children:e}}_parseMultiselectHash(){const e=[],t=[Pe,Fe];let i,n,s,r;if(this._lookahead(0)===Ve)return this._advance(),{type:"MultiSelectHash",children:[]};for(;;){if(i=this._lookaheadToken(0),t.indexOf(i.type)<0)throw new Error(`Expecting an identifier token, got: ${i.type}`);if(n=i.value,this._advance(),this._match(Re),s=this.expression(0),r={type:"KeyValuePair",name:n,value:s},e.push(r),this._lookahead(0)===$e)this._match($e);else if(this._lookahead(0)===Ve){this._match(Ve);break}}return{type:"MultiSelectHash",children:e}}}function yt(e,t){const i=10**t;return Math.round(e*i)/i}const bt=864e5;const{TYPE_CLASS:Et,TYPE_ANY:Tt}=n;function Mt(e){return null==e?"":e.toString()}const Ot=e=>{const t=+e;return Number.isNaN(t)?0:t};class It{constructor(e,t,i={}){this.strictDeepEqual=I,this.toNumber=t,this.functionTable=function(e,t,i,s,r,a,o,l){const{TYPE_NUMBER:u,TYPE_ANY:c,TYPE_STRING:d,TYPE_ARRAY:h,TYPE_OBJECT:p,TYPE_BOOLEAN:f,TYPE_EXPREF:m,TYPE_NULL:g,TYPE_ARRAY_NUMBER:_,TYPE_ARRAY_STRING:v}=n;function y(t,i){return n=>{const s=e.interpreter.visit(t,n);if(i.indexOf(r(s))<0){const e=`TypeError: expected one of ${i}, received ${r(s)}`;throw new Error(e)}return s}}const b={abs:{_func:e=>Math.abs(e[0]),_signature:[{types:[u]}]},avg:{_func:e=>{let t=0;const i=e[0];return i.forEach((e=>{t+=e})),t/i.length},_signature:[{types:[_]}]},ceil:{_func:e=>Math.ceil(e[0]),_signature:[{types:[u]}]},contains:{_func:e=>a(e[0]).indexOf(a(e[1]))>=0,_signature:[{types:[d,h]},{types:[c]}]},endsWith:{_func:e=>{const t=a(e[0]),i=a(e[1]);return-1!==t.indexOf(i,t.length-i.length)},_signature:[{types:[d]},{types:[d]}]},floor:{_func:e=>Math.floor(e[0]),_signature:[{types:[u]}]},join:{_func:e=>{const t=e[0];return e[1].join(t)},_signature:[{types:[d]},{types:[v]}]},keys:{_func:e=>null===e[0]?[]:Object.keys(e[0]),_signature:[{types:[c]}]},length:{_func:e=>{const n=a(e[0]);return t(n)?Object.keys(n).length:i(n)?n.length:o(n).length},_signature:[{types:[d,h,p]}]},map:{_func:t=>{const i=t[0];return t[1].map((t=>e.interpreter.visit(i,t)))},_signature:[{types:[m]},{types:[h]}]},max:{_func:e=>{const t=e.reduce(((e,t)=>(Array.isArray(t)?e.push(...t):e.push(t),e)),[]),i=t.find((e=>null!==e));if(0===t.length||void 0===i)return null;const n=r(i,!0)===u,a=n?(e,t)=>{const i=s(t);return e<=i?i:e}:(e,t)=>{const i=o(t);return 1===e.localeCompare(i)?e:i};return t.reduce(a,n?s(i):o(i))},_signature:[{types:[h,_,v],variadic:!0}]},maxBy:{_func:e=>{const t=e[1],i=e[0],n=y(t,[u,d]);let s,r,a=-1/0;return i.forEach((e=>{r=n(e),r>a&&(a=r,s=e)})),s},_signature:[{types:[h]},{types:[m]}]},merge:{_func:e=>{const t={};return e.forEach((e=>{Object.entries(e||{}).forEach((([e,i])=>{t[e]=i}))})),t},_signature:[{types:[p],variadic:!0}]},min:{_func:e=>{const t=e.reduce(((e,t)=>(Array.isArray(t)?e.push(...t):e.push(t),e)),[]),i=t.find((e=>null!==e));if(0===t.length||void 0===i)return null;const n=r(i,!0)===u,a=n?(e,t)=>{const i=s(t);return e<=i?e:i}:(e,t)=>{const i=o(t);return 1===e.localeCompare(i)?i:e};return t.reduce(a,n?s(i):o(i))},_signature:[{types:[h,_,v],variadic:!0}]},minBy:{_func:e=>{const t=e[1],i=e[0],n=y(t,[u,d]);let s,r,a=1/0;return i.forEach((e=>{r=n(e),r<a&&(a=r,s=e)})),s},_signature:[{types:[h]},{types:[m]}]},notNull:{_func:e=>e.find((e=>r(e)!==g))||null,_signature:[{types:[c],variadic:!0}]},reduce:{_func:t=>{const i=t[0];return t[1].reduce(((t,n,s,r)=>e.interpreter.visit(i,{accumulated:t,current:n,index:s,array:r})),3===t.length?t[2]:null)},_signature:[{types:[m]},{types:[h]},{types:[c],optional:!0}]},register:{_func:t=>{const i=t[0],n=t[1];return b[i]?(l.push(`Cannot re-register '${i}'`),{}):(b[i]={_func:t=>e.interpreter.visit(n,...t),_signature:[{types:[c],optional:!0}]},{})},_signature:[{types:[d]},{types:[m]}]},reverse:{_func:e=>{const t=a(e[0]);if(r(t)===d){let e="";for(let i=t.length-1;i>=0;i-=1)e+=t[i];return e}const i=e[0].slice(0);return i.reverse(),i},_signature:[{types:[d,h]}]},sort:{_func:e=>{const t=e[0].slice(0);if(t.length>0){const i=r(e[0][0])===u?s:o;t.sort(((e,t)=>{const n=i(e),s=i(t);return n<s?-1:n>s?1:0}))}return t},_signature:[{types:[h,v,_]}]},sortBy:{_func:t=>{const i=t[0].slice(0);if(0===i.length)return i;const n=t[1],s=r(e.interpreter.visit(n,i[0]));if([u,d].indexOf(s)<0)throw new Error("TypeError");const a=[];for(let e=0;e<i.length;e+=1)a.push([e,i[e]]);a.sort(((t,i)=>{const a=e.interpreter.visit(n,t[1]),o=e.interpreter.visit(n,i[1]);if(r(a)!==s)throw new Error(`TypeError: expected ${s}, received ${r(a)}`);if(r(o)!==s)throw new Error(`TypeError: expected ${s}, received ${r(o)}`);return a>o?1:a<o?-1:t[0]-i[0]}));for(let e=0;e<a.length;e+=1)[,i[e]]=a[e];return i},_signature:[{types:[h]},{types:[m]}]},startsWith:{_func:e=>a(e[0]).startsWith(a(e[1])),_signature:[{types:[d]},{types:[d]}]},sum:{_func:e=>{let t=0;return e[0].forEach((e=>{t+=1*e})),t},_signature:[{types:[_]}]},toArray:{_func:e=>r(e[0])===h?e[0]:[e[0]],_signature:[{types:[c]}]},toNumber:{_func:e=>{const t=r(e[0]);return t===u?e[0]:t===d?s(e[0]):null},_signature:[{types:[c]}]},toString:{_func:e=>r(e[0])===d?e[0]:JSON.stringify(e[0]),_signature:[{types:[c]}]},type:{_func:e=>({[u]:"number",[d]:"string",[h]:"array",[p]:"object",[f]:"boolean",[m]:"expref",[g]:"null"}[r(e[0])]),_signature:[{types:[c]}]},values:{_func:e=>{const t=a(e[0]);return null===t?[]:Object.values(t)},_signature:[{types:[c]}]},zip:{_func:e=>{const t=e.reduce(((e,t)=>Math.min(e,t.length)),e[0].length),i=new Array(t);for(let n=0;n<t;n+=1)i[n]=[],e.forEach((e=>{i[n].push(e[n])}));return i},_signature:[{types:[h],variadic:!0}]}};return b}(this,M,T,t,y,O,Mt,e),Object.entries(function(e,t,i,s=[]){return{and:{_func:t=>{let i=!!e(t[0]);return t.slice(1).forEach((t=>{i=i&&!!e(t)})),i},_signature:[{types:[n.TYPE_ANY],variadic:!0}]},casefold:{_func:(e,i,n)=>t(e[0]).toLocaleUpperCase(n.language).toLocaleLowerCase(n.language),_signature:[{types:[n.TYPE_STRING]}]},datedif:{_func:e=>{const n=i(e[0]),s=i(e[1]),r=t(e[2]).toLowerCase();if(s===n)return 0;if(s<n)return null;if("d"===r)return Math.floor(s-n);const a=new Date(n*bt),o=new Date(s*bt),l=o.getFullYear()-a.getFullYear();let u=o.getMonth()-a.getMonth();const c=o.getDate()-a.getDate();if("y"===r){let e=l;return u<0&&(e-=1),0===u&&c<0&&(e-=1),e}if("m"===r)return 12*l+u+(c<0?-1:0);if("ym"===r)return c<0&&(u-=1),u<=0&&l>0?12+u:u;if("yd"===r)return c<0&&(u-=1),u<0?o.setFullYear(a.getFullYear()+1):o.setFullYear(a.getFullYear()),Math.floor((o.getTime()-a.getTime())/bt);throw new TypeError(`Unrecognized unit parameter "${r}" for datedif()`)},_signature:[{types:[n.TYPE_NUMBER]},{types:[n.TYPE_NUMBER]},{types:[n.TYPE_STRING]}]},datetime:{_func:e=>{const n=i(e[0]),s=i(e[1]),r=i(e[2]),a=e.length>3?i(e[3]):0,o=e.length>4?i(e[4]):0,l=e.length>5?i(e[5]):0,u=e.length>6?i(e[6]):0,c=e.length>7?t(e[7]):null;let d=new Date(n,s-1,r,a,o,l,u);return c&&(d=function(e,t){if(null===e)return null;let i=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds());return i+=function(e,t){const i=new Intl.DateTimeFormat("en-US",{timeZone:t,timeZoneName:"longOffset"}).format(e),n=/GMT([+\-])?(\d{1,2}):?(\d{0,2})?/.exec(i);if(!n)return 0;const[s,r,a]=n.slice(1),o=60*(60*(r||0)+1*(a||0))*1e3;return"-"===s?-1*o:o}(e,t),new Date(i)}(d,c)),d.getTime()/bt},_signature:[{types:[n.TYPE_NUMBER]},{types:[n.TYPE_NUMBER]},{types:[n.TYPE_NUMBER]},{types:[n.TYPE_NUMBER],optional:!0},{types:[n.TYPE_NUMBER],optional:!0},{types:[n.TYPE_NUMBER],optional:!0},{types:[n.TYPE_NUMBER],optional:!0},{types:[n.TYPE_STRING],optional:!0}]},day:{_func:e=>{const t=i(e[0]);return new Date(t*bt).getDate()},_signature:[{types:[n.TYPE_NUMBER]}]},deepScan:{_func:e=>{const[t,i]=e,n=i.toString(),s=[];return null===t||function e(t){Object.entries(t).forEach((([t,i])=>{t===n&&s.push(i),"object"==typeof i&&e(i)}))}(t),s},_signature:[{types:[n.TYPE_OBJECT,n.TYPE_ARRAY,n.TYPE_NULL]},{types:[n.TYPE_STRING,n.TYPE_NUMBER]}]},entries:{_func:t=>{const i=e(t[0]);return Object.entries(i)},_signature:[{types:[n.TYPE_NUMBER,n.TYPE_STRING,n.TYPE_ARRAY,n.TYPE_OBJECT,n.TYPE_BOOLEAN]}]},eomonth:{_func:e=>{const t=i(e[0]),n=i(e[1]),s=new Date(t*bt);return new Date(s.getFullYear(),s.getMonth()+n+1,0).getTime()/bt},_signature:[{types:[n.TYPE_NUMBER]},{types:[n.TYPE_NUMBER]}]},exp:{_func:e=>{const t=i(e[0]);return Math.exp(t)},_signature:[{types:[n.TYPE_NUMBER]}]},false:{_func:()=>!1,_signature:[]},find:{_func:e=>{const n=t(e[0]),s=t(e[1]),r=e.length>2?i(e[2]):0,a=s.indexOf(n,r);return-1===a?null:a},_signature:[{types:[n.TYPE_STRING]},{types:[n.TYPE_STRING]},{types:[n.TYPE_NUMBER],optional:!0}]},fromEntries:{_func:e=>{const t=e[0];return Object.fromEntries(t)},_signature:[{types:[n.TYPE_ARRAY_ARRAY]}]},hour:{_func:e=>{const t=i(e[0])%1;if(t<0)return null;const n=yt(24*t,14);return Math.floor(n%24)},_signature:[{types:[n.TYPE_NUMBER]}]},if:{_func:(t,i,n)=>{const s=t[0],r=t[1],a=t[2],o=n.visit(s,i);return e(o)?n.visit(r,i):n.visit(a,i)},_signature:[{types:[n.TYPE_ANY]},{types:[n.TYPE_ANY]},{types:[n.TYPE_ANY]}]},left:{_func:e=>{const n=e.length>1?i(e[1]):1;return n<0?null:e[0]instanceof Array?e[0].slice(0,n):t(e[0]).substr(0,n)},_signature:[{types:[n.TYPE_STRING,n.TYPE_ARRAY]},{types:[n.TYPE_NUMBER],optional:!0}]},lower:{_func:e=>t(e[0]).toLowerCase(),_signature:[{types:[n.TYPE_STRING]}]},mid:{_func:e=>{const n=i(e[1]),s=i(e[2]);return n<0?null:e[0]instanceof Array?e[0].slice(n,n+s):t(e[0]).substr(n,s)},_signature:[{types:[n.TYPE_STRING,n.TYPE_ARRAY]},{types:[n.TYPE_NUMBER]},{types:[n.TYPE_NUMBER]}]},minute:{_func:e=>{const t=i(e[0])%1;if(t<0)return null;const n=Math.round(1440*t,10);return Math.floor(n%60)},_signature:[{types:[n.TYPE_NUMBER]}]},mod:{_func:e=>i(e[0])%i(e[1]),_signature:[{types:[n.TYPE_NUMBER]},{types:[n.TYPE_NUMBER]}]},month:{_func:e=>{const t=i(e[0]);return new Date(t*bt).getMonth()+1},_signature:[{types:[n.TYPE_NUMBER]}]},not:{_func:t=>!e(t[0]),_signature:[{types:[n.TYPE_ANY]}]},now:{_func:()=>Date.now()/bt,_signature:[]},null:{_func:()=>null,_signature:[]},or:{_func:t=>{let i=!!e(t[0]);return t.slice(1).forEach((t=>{i=i||!!e(t)})),i},_signature:[{types:[n.TYPE_ANY],variadic:!0}]},power:{_func:e=>i(e[0])**i(e[1]),_signature:[{types:[n.TYPE_NUMBER]},{types:[n.TYPE_NUMBER]}]},proper:{_func:e=>t(e[0]).split(" ").map((e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase())).join(" "),_signature:[{types:[n.TYPE_STRING]}]},replace:{_func:e=>{const n=t(e[0]),s=i(e[1]),r=i(e[2]),a=t(e[3]);return s<0?null:n.substr(0,s)+a+n.substr(s+r)},_signature:[{types:[n.TYPE_STRING]},{types:[n.TYPE_NUMBER]},{types:[n.TYPE_NUMBER]},{types:[n.TYPE_STRING]}]},rept:{_func:e=>{const n=t(e[0]),s=i(e[1]);return s<0?null:n.repeat(s)},_signature:[{types:[n.TYPE_STRING]},{types:[n.TYPE_NUMBER]}]},right:{_func:e=>{const n=e.length>1?i(e[1]):1;if(n<0)return null;if(e[0]instanceof Array)return 0===n?[]:e[0].slice(-1*n);const s=t(e[0]),r=s.length-n;return s.substr(r,n)},_signature:[{types:[n.TYPE_STRING,n.TYPE_ARRAY]},{types:[n.TYPE_NUMBER],optional:!0}]},round:{_func:e=>yt(i(e[0]),i(e[1])),_signature:[{types:[n.TYPE_NUMBER]},{types:[n.TYPE_NUMBER]}]},search:{_func:e=>{const n=t(e[0]),s=t(e[1]),r=i(e[2]);if(null===n||null===s||0===s.length)return[];const a=n.replace(/([[.\\^$()+{])/g,"\\$1").replace(/~?\?/g,(e=>"~?"===e?"\\?":".")).replace(/~?\*/g,(e=>"~*"===e?"\\*":".*?")).replace(/~~/g,"~"),o=new RegExp(a),l=s.substring(r).match(o);return null===l?[]:[l.index+r,l[0]]},_signature:[{types:[n.TYPE_STRING]},{types:[n.TYPE_STRING]},{types:[n.TYPE_NUMBER],optional:!0}]},second:{_func:e=>{const t=i(e[0])%1;if(t<0)return null;const n=yt(86400*t,10);return Math.floor(n%60)},_signature:[{types:[n.TYPE_NUMBER]}]},split:{_func:e=>{const i=t(e[0]),n=t(e[1]);return i.split(n)},_signature:[{types:[n.TYPE_STRING]},{types:[n.TYPE_STRING]}]},sqrt:{_func:e=>{const t=Math.sqrt(i(e[0]));return Number.isNaN(t)?null:t},_signature:[{types:[n.TYPE_NUMBER]}]},stdev:{_func:e=>{const t=e[0]||[];if(t.length<=1)return null;const n=t.map((e=>i(e))),s=n.reduce(((e,t)=>e+t),0)/t.length,r=n.reduce(((e,t)=>e+t*t),0),a=Math.sqrt((r-t.length*s*s)/(t.length-1));return Number.isNaN(a)?null:a},_signature:[{types:[n.TYPE_ARRAY_NUMBER]}]},stdevp:{_func:e=>{const t=e[0]||[];if(0===t.length)return null;const n=t.map((e=>i(e))),s=n.reduce(((e,t)=>e+t),0)/t.length,r=n.reduce(((e,t)=>e+t*t),0)/t.length,a=Math.sqrt(r-s*s);return Number.isNaN(a)?null:a},_signature:[{types:[n.TYPE_ARRAY_NUMBER]}]},substitute:{_func:e=>{const n=t(e[0]),s=t(e[1]),r=t(e[2]);if(e.length<=3)return n.replaceAll(s,r);const a=i(e[3]);if(a<1)return n;let o=-1;for(let e=0;e<a;e+=1){o+=1;const e=n.slice(o).indexOf(s);if(-1===e)return n;o+=e}return n.slice(0,o)+n.slice(o).replace(s,r)},_signature:[{types:[n.TYPE_STRING]},{types:[n.TYPE_STRING]},{types:[n.TYPE_STRING]},{types:[n.TYPE_NUMBER],optional:!0}]},time:{_func:e=>{const t=(3600*i(e[0])+60*i(e[1])+i(e[2]))/86400;return t<0?null:t-Math.floor(t)},_signature:[{types:[n.TYPE_NUMBER]},{types:[n.TYPE_NUMBER]},{types:[n.TYPE_NUMBER]}]},today:{_func:()=>Math.floor(Date.now()/bt),_signature:[]},trim:{_func:e=>t(e[0]).split(" ").filter((e=>e)).join(" "),_signature:[{types:[n.TYPE_STRING]}]},true:{_func:()=>!0,_signature:[]},trunc:{_func:e=>{const t=i(e[0]),n=e.length>1?i(e[1]):0;return(t>=0?Math.floor:Math.ceil)(t*10**n)/10**n},_signature:[{types:[n.TYPE_NUMBER]},{types:[n.TYPE_NUMBER],optional:!0}]},unique:{_func:t=>{const i=t[0].map((t=>e(t)));return t[0].filter(((t,n)=>i.indexOf(e(t))===n))},_signature:[{types:[n.TYPE_ARRAY]}]},upper:{_func:e=>t(e[0]).toUpperCase(),_signature:[{types:[n.TYPE_STRING]}]},value:{_func:e=>{const t=e[0]||{},i=e[1],n=t[i];if(void 0===n){s.push(`Failed to find: '${i}'`);const e=Object.keys(t).map((e=>`'${e}'`)).toString();return e.length&&s.push(`Available fields: ${e}`),null}return n},_signature:[{types:[n.TYPE_OBJECT,n.TYPE_ARRAY,n.TYPE_NULL]},{types:[n.TYPE_STRING,n.TYPE_NUMBER]}]},weekday:{_func:e=>{const t=i(e[0]),n=e.length>1?i(e[1]):1,s=new Date(t*bt).getDay();switch(n){case 1:return s+1;case 2:return(s+6)%7+1;case 3:return(s+6)%7;default:return null}},_signature:[{types:[n.TYPE_NUMBER]},{types:[n.TYPE_NUMBER],optional:!0}]},year:{_func:e=>{const t=i(e[0]);return new Date(t*bt).getFullYear()},_signature:[{types:[n.TYPE_NUMBER]}]},charCode:{_func:e=>{const t=i(e[0]);return Number.isInteger(t)?String.fromCharCode(t):null},_signature:[{types:[n.TYPE_NUMBER]}]},codePoint:{_func:e=>{const i=t(e[0]);return 0===i.length?null:i.codePointAt(0)},_signature:[{types:[n.TYPE_STRING]}]},encodeUrlComponent:{_func:e=>encodeURIComponent(e[0]),_signature:[{types:[n.TYPE_STRING]}]},encodeUrl:{_func:e=>encodeURI(e[0]),_signature:[{types:[n.TYPE_STRING]}]},decodeUrlComponent:{_func:e=>decodeURIComponent(e[0]),_signature:[{types:[n.TYPE_STRING]}]},decodeUrl:{_func:e=>decodeURI(e[0]),_signature:[{types:[n.TYPE_STRING]}]}}}(O,Mt,t,e)).forEach((([e,t])=>{this.functionTable[e]=t})),Object.entries(i).forEach((([e,t])=>{this.functionTable[e]=t}))}_validateArgs(e,t,i,n){if(0===i.length)return;let s;const r=i.filter((e=>!e.optional)).length;if(i[i.length-1].variadic){if(t.length<i.length)throw s=1===i.length?" argument":" arguments",new Error(`ArgumentError: ${e}() takes at least${i.length}${s} but received ${t.length}`)}else if(t.length<r||t.length>i.length)throw s=1===i.length?" argument":" arguments",new Error(`ArgumentError: ${e}() takes ${i.length}${s} but received ${t.length}`);if(!n)return;let a,o;const l=Math.min(i.length,t.length);for(let n=0;n<l;n+=1)a=i[n].types,u=t[n],c=void 0,a.includes(Et)&&null!==(c=u)&&!Array.isArray(c)&&"Object"!==c.constructor.name||a.includes(Tt)||(o=b(t[n]),t[n]=E(o,a,t[n],e,this.toNumber,Mt));var u,c}callFunction(e,t,i,n,s=!0){if(!Object.prototype.hasOwnProperty.call(this.functionTable,e))throw new Error(`Unknown function: ${e}()`);const r=this.functionTable[e];return this._validateArgs(e,t,r._signature,s),r._func.call(this,t,i,n)}}class wt{constructor(e,t,i){this.debug=e,this.toNumber=function(e,t=[]){return i=>{const n=O(i);if(null===n)return null;if(n instanceof Array)return t.push("Converted array to zero"),0;const s=typeof n;return"number"===s?n:"string"===s?e(n,t):"boolean"===s?n?1:0:(t.push("Converted object to zero"),0)}}(i||Ot,e),this.runtime=new It(e,this.toNumber,t)}compile(e,t=[]){let i;try{i=new vt(t).parse(e,this.debug)}catch(e){throw this.debug.push(e.toString()),e}return i}search(e,t,i={},n="en-US"){this.runtime.interpreter=new V(this.runtime,i,this.toNumber,Mt,this.debug,n);try{return this.runtime.interpreter.search(e,t)}catch(e){throw this.debug.push(e.message||e.toString()),e}}}class At{constructor(e={},t=null,i=[]){this.customFunctions={...e},this.stringToNumber=t,this.debug=i,this.formula=new wt(i,e,t)}search(e,t,i={},n="en-US"){const s=this.compile(e,Object.keys(i));return this.run(s,t,n,i)}run(e,t,i,n){return this.formula.search(e,t,n,i)}compile(e,t=[]){return this.debug.length=0,this.formula.compile(e,t)}}function Ct(e,t,i,n={},s=null,r=[],a="en-US"){return new At(n,s,r).search(i,e,t,a)}}},t={};function i(n){var s=t[n];if(void 0!==s)return s.exports;var r=t[n]={exports:{}};return e[n].call(r.exports,r,r.exports,i),r.exports}i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{i.r(n),i.d(n,{Actions:()=>C,Constants:()=>t,FileAttachmentUtils:()=>j,FormCheckBox:()=>b,FormContainer:()=>p,FormField:()=>f,FormFieldBase:()=>m,FormFileInput:()=>E,FormFileInputWidget:()=>O,FormFileInputWidgetBase:()=>T,FormOptionFieldBase:()=>M,FormPanel:()=>_,FormTabs:()=>y,Formatters:()=>N,FunctionRuntime:()=>e.FunctionRuntime,HTTPAPILayer:()=>s,LanguageUtils:()=>h,Utils:()=>d,createFormInstance:()=>e.createFormInstance,customFunctions:()=>o});var e=i(5444);const t={NS:"cmp",FORM_CONTAINER_INITIALISED:"AF_FormContainerInitialised",PANEL_INSTANCE_ADDED:"AF_PanelInstanceAdded",PANEL_INSTANCE_REMOVED:"AF_PanelInstanceRemoved",FORM_LANGUAGE_INITIALIZED:"AF_LanguageInitialised",ELEMENT_FOCUS_CHANGED:"elementFocusChanged",ELEMENT_HELP_SHOWN:"elementHelpShown",ELEMENT_ERROR_SHOWN:"elementErrorShown",ELEMENT_VALUE_CHANGED:"elementValueChanged",FORM_CONTAINER_DATA_ATTRIBUTE:"adaptiveformcontainerPath",DATA_HOOK_ADD_INSTANCE:"data-cmp-hook-add-instance",DATA_HOOK_REMOVE_INSTANCE:"data-cmp-hook-remove-instance",DATA_ATTRIBUTE_VALID:"data-cmp-valid",DATA_ATTRIBUTE_ENABLED:"data-cmp-enabled",DATA_ATTRIBUTE_VISIBLE:"data-cmp-visible",DATA_ATTRIBUTE_REQUIRED:"data-cmp-required",DATA_ATTRIBUTE_READONLY:"data-cmp-readonly",DATA_ATTRIBUTE_ACTIVE:"data-cmp-active",ARIA_DISABLED:"aria-disabled",ARIA_HIDDEN:"aria-hidden",ARIA_INVALID:"aria-invalid",ARIA_CHECKED:"aria-checked",ARIA_SELECTED:"aria-selected",GUIDE_BRIDGE_INITIALIZE_START:"bridgeInitializeStart",HTML_ATTRS:{DISABLED:"disabled",CHECKED:"checked"},TABINDEX:"tabindex",ARIA_CURRENT:"aria-current",API_PATH_PREFIX:"/adobe/forms/af",FIELD_TYPE:e.FIELD_TYPE},s=class{static REQ_PARAMETER_DATA_REF="dataRef";static async getForm(e){const t=e.indexOf("/jcr:content/guideContainer");let i=e;-1!==t&&(i=e.substring(0,t));const n=await this.#e();if(n)return await this.#t(i,n);console.debug("Error in fetching form")}static async getFormDefinition(e,t){const i=new URLSearchParams(window.location.search),n=Object.fromEntries(i.entries());let s=null;if("afAcceptLang"in n)s=`${n.afAcceptLang}`;else{const e=window.location.pathname.split(".");e?.length>=3&&(s=`${e[e.length-2]}`)}return null===s&&null!=t&&(s=t),await this.getJson(`${e}.model.${null!==s?`${s}.`:""}json${this.REQ_PARAMETER_DATA_REF in n?`?${this.REQ_PARAMETER_DATA_REF}=${n[this.REQ_PARAMETER_DATA_REF]}`:""}`)}static async#t(e,t){const i=t.items.find((t=>t.path===e));if(i)return i;if(t.cursor){const i=await this.#e(t.cursor);return await this.#t(e,i)}console.debug("Form at "+e+" Not Found")}static async#e(e=""){return await this.getJson(`${t.API_PATH_PREFIX}/listforms?cursor=${e}`)}static async getPrefillData(e,i){return await this.getJson(t.API_PATH_PREFIX+"/data/"+e+"?"+Object.keys(i).map((e=>e+"="+i[e])).join("&"))}static async getJson(e){let t=`${d.getContextPath()}${e}`;return new Promise((e=>{let i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="json",i.onload=function(){let t=i.status;e(200===t?i.response:null)},i.send()}))}static async getCustomFunctionConfig(e){return await this.getJson(t.API_PATH_PREFIX+"/customfunctions/"+e)}};function r(e){try{const t=new URL(e,window.location.href);return"http:"===t.protocol||"https:"===t.protocol}catch(e){return!1}}function a(e){return window?.Granite?.HTTP&&"function"==typeof window.Granite.HTTP.externalize?window.Granite.HTTP.externalize(e):e}const o={toObject:function(e){if("string"==typeof e)try{return JSON.parse(e)}catch(e){return{}}return e},externalize:a,validateURL:r,navigateTo:(e,t)=>function(e,t){let i=null,n=window,s=null;"_newwindow"===t&&(i="_blank",s="width=1000,height=800"),i||(i=t||"_blank"),r(e)&&n.open(e,i,s)}(o.externalize(e),t),defaultErrorHandler:function(e,t,i){e&&e.validationErrors&&e.validationErrors?.forEach((function(e){e.details&&(e.fieldName?i.functions.markFieldAsInvalid(e.fieldName,e.details.join("\n"),{useQualifiedName:!0}):e.dataRef&&i.functions.markFieldAsInvalid(e.dataRef,e.details.join("\n"),{useDataRef:!0}))}))},defaultSubmitSuccessHandler:function(e){const t=e.event,i=t?.payload?.body,n=e.form;if(i)if(i.redirectUrl)window.location.href=encodeURI(i.redirectUrl);else if(i.thankYouMessage){let e=document.getElementById(`${n.$id}`),t=document.createElement("div");t.setAttribute("class","tyMessage"),t.setAttribute("tabindex","-1"),t.setAttribute("role","alertdialog"),t.innerHTML=i.thankYouMessage,e.replaceWith(t),t.focus()}},defaultSubmitErrorHandler:function(e,t){window.alert(e)},fetchCaptchaToken:async function(e){return new Promise(((t,i)=>{const n=function(e){t(e)},s=function(e){i(e)};try{const r=e.form.$captcha;if("turnstile"===r.$captchaProvider){const e=document.getElementsByClassName("cmp-adaptiveform-turnstile__widget")[0],t={sitekey:r.$captchaSiteKey,callback:n,"error-callback":s};if(null!=turnstile){const n=turnstile.render(e,t);n?turnstile.execute(n):i({error:"Failed to render turnstile captcha"})}else i({error:"Turnstile captcha not loaded"})}else{const e=r?.$properties["fd:captcha"]?.config?.siteKey,n=r.$name.replaceAll("-","_");let s=r?.$properties["fd:path"];const a=s.indexOf("/jcr:content");let o="";a>0&&(s=s.substring(0,a),o=s.substring(s.lastIndexOf("/")+1).replaceAll("-","_"));let l=`submit_${o}_${n}`;grecaptcha.enterprise.ready((()=>{grecaptcha.enterprise.execute(e,{action:l}).then((e=>t(e))).catch((e=>i(e)))}))}}catch(e){i(e)}}))},dateToDaysSinceEpoch:function(e){let t;if("string"==typeof e)t=new Date(e);else{if("number"==typeof e)return Math.floor(e);if(!(e instanceof Date))throw new Error("Invalid date input");t=e}if(isNaN(t.getTime()))throw new Error("Invalid date input");return Math.floor(t.getTime()/864e5)},downloadDoR:function(e,t){const i=t.form.$lang,n=new URLSearchParams({locale:i}).toString();let s=a("/adobe/forms/af/dor/"+t.form.$id+"?"+n);const r=new FormData;var o=JSON.stringify(t.functions.exportData());r.append("data",o),t.form.$id;var l=new XMLHttpRequest;l.open("POST",s,!0),l.responseType="arraybuffer",l.onreadystatechange=function(){if(4===l.readyState)if(200===l.status){const t=new Blob([l.response],{type:"application/pdf"}),i=URL.createObjectURL(t),n=document.createElement("a");n.href=i,n.download=e||"Downloaded_DoR.pdf",document.body.appendChild(n),n.click(),URL.revokeObjectURL(i),document.body.removeChild(n)}else console.error("Error while generating pdf")},l.send(r)},exportFormData:function(e,t,i){null==e&&(e=!0);const n=i.functions.exportData();if(!n)return;if(null==t)return e&&"object"==typeof n?JSON.stringify(n):n;const s=t.replace(/\[/g,".").replace(/\]/g,"").split(".").filter(Boolean);let r=n;for(const e of s){if(null==r)return;r=r[e]}return r&&"object"==typeof r&&e?JSON.stringify(r):r}};function l(e,t){if(window.xfalib){formBridge.registerConfig("disabledServerScripts",["initialize","$formready","$layoutready"]);const i=JSON.parse(JSON.parse(JSON.stringify(e)));return xfalib.runtime.renderContext=JSON.parse(JSON.parse(JSON.stringify(t))),xfalib.script.XfaModelRegistry.prototype.createModel(i),new xfalib.acrobat.Acrobat,function(e){e._syncXfaProps(),xfalib.runtime.xfa.form._initialize(!0),$(window).trigger("XfaInitialized")}}}const u=class{static async registerCustomFunctions(t){const i=await s.getCustomFunctionConfig(t);if(console.debug("Fetched custom functions: "+JSON.stringify(i)),i&&i.customFunction){const t=i.customFunction.reduce(((e,t)=>(window[t.id]&&(e[t.id]=window[t.id]),e)),{});e.FunctionRuntime.registerFunctions(t)}}static async registerCustomFunctionsV2(t){let i,n=[];const r=t.properties["fd:customFunctionsUrl"];i=r?await s.getJson(r):await s.getCustomFunctionConfig(t.id),console.debug("Fetched custom functions: "+JSON.stringify(i)),i&&i.clientSideParsingEnabled?n=this.extractFunctionNames(t):i&&i.customFunction&&(n=i.customFunction);const a=n.reduce(((e,t)=>(Object.prototype.hasOwnProperty.call(window,t.id)&&"function"==typeof window[t.id]&&(e[t.id]=window[t.id]),e)),{});console.debug("Registering custom functions:",a),e.FunctionRuntime.registerFunctions(a)}static extractFunctionNames=e=>{const t=new Set,i=e=>{const i=/(\w+)\s*\(/g;let n;for(;null!==(n=i.exec(e));)t.add(n[1])};e.events&&Object.values(e.events).forEach((e=>{e.forEach((e=>{i(e)}))})),e.rules&&Object.values(e.rules).forEach((e=>{i(e)}));const n=e=>{e&&Object.values(e).forEach((e=>{e.validationExpression&&i(e.validationExpression),e.displayValueExpression&&i(e.displayValueExpression),e.events&&Object.values(e.events).forEach((e=>{e.forEach((e=>{i(e)}))})),e.rules&&Object.values(e.rules).forEach((e=>{i(e)})),e[":items"]&&n(e[":items"])}))};return e[":items"]&&n(e[":items"]),console.debug("Extracted function names from form JSON:",t),Array.from(t).map((e=>({id:e})))};static async registerCustomFunctionsByUrl(t){try{if(null!=t&&t.trim().length>0){const i=await import(t),n=Object.keys(i),s=[];for(const e of n){const t=i[e];"function"==typeof t&&(s[e]=t)}e.FunctionRuntime.registerFunctions(s)}}catch(e){window.console&&console.error("error in loading custom functions from url "+t+" with message "+e.message)}}};class c{static#i="";static#n={};static#s=[];static readData(e,i){const n=e.dataset;let s={};const r=["is"];if(i){const e=i.charAt(0).toUpperCase()+i.substring(1);r.push("hook"+e)}for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e)){let i=n[e];0===e.indexOf(t.NS)&&(e=e.slice(t.NS.length),e=e.charAt(0).toLowerCase()+e.substring(1),-1===r.indexOf(e)&&(s[e]=i))}return s}static registerMutationObserver(e,t,i,n){let s=new(window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver)((function(n){n.forEach((function(n){var s=[].slice.call(n.addedNodes);s.length>0&&s.forEach((function(n){if(n.querySelectorAll){var s=[].slice.call(n.querySelectorAll(i));c.#r(s,t,e)}}))}))}));const r='[data-cmp-path="'+e.getPath()+'"]',a=document.querySelector(r);s.observe(a,{subtree:!0,childList:!0,characterData:!0})}static#r(e,t,i){for(let n=0;n<e.length;n++){const s=e[n].id,r=e[n].getAttribute("data-cmp-adaptiveformcontainer-path"),a=i.getFormElement().getAttribute("data-cmp-path");if(null==i.getField(s)&&r==a){let s=t({element:e[n],formContainer:i});i.addField(s)}}}static createFieldsForAddedElement(e,t){Object.values(c.#s).forEach((function(i){let n=c.#n[i];const s=e.querySelectorAll(n.fieldSelector);c.#r(s,n.fieldCreator,t)}))}static setupField(e,t,i){t in c.#n||c.#s.push(t),c.#n[t]={fieldCreator:e,fieldSelector:t,fieldClass:i}}static initializeAllFields(e){console.debug("Initializing field views ",e),Object.values(c.#s).forEach((function(t){const{fieldSelector:i,fieldCreator:n,fieldClass:s}=c.#n[t];console.debug("Initializing all fields of field selector ",i);let r=document.querySelectorAll(i);c.#r(r,n,e),c.registerMutationObserver(e,n,i,s)}))}static#a(e,t){e&&e.getAllFields()&&delete e.getAllFields()[t]}static#o(e,t){let i=e.children;if(i)for(let e=0;e<i.length;e++)c.#o(i[e]);e.getInstanceManager&&e.getInstanceManager()&&c.#a(t,e.getInstanceManager().id),c.#a(t,e.id)}static removeFieldReferences(e,t){let i=e.children;if(i)for(let e=0;e<i.length;e++)c.#o(i[e]);c.#a(t,e.id)}static updateId(e,t,i){let n=e.querySelectorAll("#"+t)[0];n&&(n.id=i)}static setContextPath(e){null!=c.#i&&0!==c.#i.length||(c.#i=e)}static getContextPath(){return c.#i}static registerClickHandler(e,t,i){const n="["+t+"]";e.querySelectorAll(n).forEach((e=>e.addEventListener("click",i)))}static async setupFormContainer(i,n,r){e.FunctionRuntime.registerFunctions(o);let a=document.querySelectorAll(n);for(let e=0;e<a.length;e++){const n=c.readData(a[e],r),o=n.customFunctionsModuleUrl,d=n.path,h=n.pageLang;if("contextPath"in n&&c.setContextPath(n.contextPath),null==d)console.error(`data-${t.NS}-${r}-path attribute is not present in the HTML element. Form cannot be initialized`);else{let n,r;const p=a[e].parentElement?.querySelector("[data-cmp-adaptiveform-container-loader]"),f=a[e].getAttribute("data-cmp-schema-type");if(p&&f&&("XDP"===f||"FORM_TEMPLATES"===f)){const e=p.getAttribute("data-cmp-adaptiveform-container-loader"),t=await fetch(`/adobe/forms/af/${e}`);n=(await t.json()).afModelDefinition,n.id=e,r=l(n.formdom,n.xfaRenderContext)}else n=await s.getFormDefinition(d,h);console.debug("fetched model json",n),await u.registerCustomFunctionsV2(n),await u.registerCustomFunctionsByUrl(o);const m=new URLSearchParams(window.location.search),g=Object.fromEntries(m.entries());let _={};!0===n?.properties?.["fd:formDataEnabled"]&&(_=await s.getJson(n.properties["fd:dataUrl"]+"?"+Object.keys(g).map((e=>e+"="+g[e])).join("&")),_=_||{},_=c.stripIfWrapped(_),window.formBridge&&window.formBridge.restoreFormState({formState:{xfaDom:_.data.xfaDom,xfaRenderContext:_.data.xfaRenderContext},context:this,error:function(){},success:function(){}}));const v=await i({_formJson:n,_prefillData:_,_path:d,_element:a[e]});"function"==typeof r&&r(v.getModel()),c.initializeAllFields(v);const y=new CustomEvent(t.FORM_CONTAINER_INITIALISED,{detail:v});document.dispatchEvent(y)}}}static stripIfWrapped(e){if(e&&e.hasOwnProperty("data")){const t=e.data;if(t&&t.hasOwnProperty("afData")){const e=t.afData;if(e&&e.hasOwnProperty("afBoundData"))return e.afBoundData}}return e}static isUserAgent(e){if(navigator.userAgent)return new RegExp("^((?!chrome|android).)*"+e,"i").test(navigator.userAgent)}}const d=c,h=class{static#l={};static async loadLang(i,n,r=!1){const a=await s.getJson(n);if(a&&(console.debug("fetched language data",a),this.#l[i]=a,(0,e.setCustomDefaultConstraintTypeMessages)(a)),r){await this.#u(i);const e=new CustomEvent(t.FORM_LANGUAGE_INITIALIZED,{detail:i});document.dispatchEvent(e)}}static async#u(e){let t=guideBridge.getConfigsForKey(guideBridge.ConfigKeys.LOCALE_CONFIG)||[];t=t.map((e=>e.fn)).filter((e=>"function"==typeof e));for(const i of t)await i(e)}static getTranslatedString(e,t,i){let n="";return e in this.#l&&(n=this.#l[e][t],i&&(n=n.replace(/\${(\d+)}/g,(function(e,t){return void 0!==i[t]?i[t]:e})))),n}},p=class{constructor(t){let i=t._prefillData.data&&0===Object.keys(t._prefillData.data).length?null:t._prefillData.data;this._model=(0,e.createFormInstance)({...t._formJson,data:i}),this._path=t._path,this._fields={},this._deferredParents={},this._element=t._element,this.#c()}#c(){this._element&&this._element.addEventListener("keydown",(e=>{if("Enter"!==e.key)return;const t=e.target;"INPUT"===t.tagName&&["text","password","email","url","search","tel","number"].includes(t.type)&&e.preventDefault()}))}addInstanceManager(e){this._fields[e.id]=e}getField(e){return this._fields.hasOwnProperty(e)?this._fields[e]:null}getModel(e){return e?this._model.getElement(e):this._model}getLang(){return this._model.lang||"en"}getParentFormElementId(e){const t=e.fieldType&&e.repeatable?e.parent.parent:e.parent;return"form"===t.fieldType?"$form":t.id}addField(e){if(e.getFormContainerPath()===this._path){let t=e.getId();this._fields[t]=e;let i=this.getModel(t);e.setModel(i),e.syncMarkupWithModel();const n=this.getParentFormElementId(i);if("$form"!=n){let t=this._fields[n];t?e.setParent(t):(this._deferredParents[n]||(this._deferredParents[n]=[]),this._deferredParents[n].push(e))}else e.setParent(this);if(this._deferredParents[t]){let i=this._deferredParents[t];for(let t=0;t<i.length;t++)i[t].setParent(e);delete this._deferredParents[t]}e.subscribe()}}setFocus(e){if(e){let t=this._fields[e];t&&t.setFocus?t.setFocus():console.log("View on which focus is to be set, not initialized.")}}getFormId(){return this._model._jsonModel.id}getFormTitle(){return this._model._jsonModel.title}getPath(){return this._path}getFormElement(){return this._element}getAllFields(){return this._fields}updateActiveChild(e){this.setFocus(e?._activeChild?.id||e?.id)}#d(e){const t=e[0].fieldName;this.setFocus(t)}subscribe(){this._model.subscribe((e=>{let t=e.target.getState();e.payload.changes.forEach((e=>{const i=`update${(n=e.propertyName)[0].toUpperCase()+n.slice(1)}`;var n;"function"==typeof this[i]?this[i](e.currentValue,t):console.warn(`changes to ${e.propertyName} are not supported at form. Please raise an issue`)}))})),this._model.subscribe((e=>{e.payload.length>0&&this.#d(e.payload)}),"validationComplete")}},f=class{constructor(e){this.formContainer=e.formContainer,this.element=e.element,this.options=d.readData(this.element,this.getClass()),this.setId(this.element.id),this.active=!1}setId(e){this.id=e}setParent(e){this.parentView=e,this.parentView.addChild&&this.parentView.addChild(this),this.getInstanceManager()&&!this.getInstanceManager().getRepeatableParentView()&&this.getInstanceManager().setRepeatableParentView(e)}setInstanceManager(e){this.instanceManager=e}setActive(){this.isActive()||(this.element.setAttribute(t.DATA_ATTRIBUTE_ACTIVE,!0),this.parentView&&this.parentView?._model?.activeChild!==this._model&&(this.parentView._model.activeChild=this._model),this.active=!0)}setInactive(){this.isActive()&&this.element.setAttribute(t.DATA_ATTRIBUTE_ACTIVE,!1)}isActive(){return"true"===this.element.getAttribute(t.DATA_ATTRIBUTE_ACTIVE)}triggerExit(){this._model.dispatch(new FormView.Actions.CustomEvent("xfaexit"))}triggerEnter(){this._model.dispatch(new FormView.Actions.CustomEvent("xfaenter"))}getFormContainerPath(){return this.options.adaptiveformcontainerPath}getId(){return this.id}setModel(e){if(void 0!==this._model&&null!==this._model)throw"Re-initializing model is not permitted";this._model=e}setModelValue(e){this._model.dispatch(new FormView.Actions.UIChange({value:e}))}syncMarkupWithModel(){throw"method not implemented"}toggle(e,t,i){this.toggleAttribute(this.element,e,t,i)}toggleAttribute(e,t,i,n){e&&(!1===t?e.setAttribute(i,n):e.removeAttribute(i))}getLayoutProperties(){let e={};const t=this.getModel().getState();return t&&t.properties&&t.properties["afs:layout"]&&(e=t.properties["afs:layout"]),e}getModel(){return this._model}subscribe(){throw"the field does not subscribe to the model"}initializeHelpContent(e){throw"method not implemented"}getInstanceManager(){return this.instanceManager}},m=class extends f{constructor(e){super(e),this.widget=this.getWidget(),this.description=this.getDescription(),this.label=this.getLabel(),this.errorDiv=this.getErrorDiv(),this.qm=this.getQuestionMarkDiv(),this.tooltip=this.getTooltipDiv(),this.updateEmptyStatus()}ELEMENT_FOCUS_CHANGED=t.ELEMENT_FOCUS_CHANGED;ELEMENT_HELP_SHOWN=t.ELEMENT_HELP_SHOWN;ELEMENT_ERROR_SHOWN=t.ELEMENT_ERROR_SHOWN;ELEMENT_VALUE_CHANGED=t.ELEMENT_VALUE_CHANGED;getWidget(){throw"method not implemented"}getDescription(){throw"method not implemented"}getLabel(){throw"method not implemented"}getErrorDiv(){throw"method not implemented"}getTooltipDiv(){throw"method not implemented"}getQuestionMarkDiv(){throw"method not implemented"}getClass(){return this.constructor.IS}setModel(e){super.setModel(e);const t=this._model.getState();this.applyState(t),this.#h()}getWidgetId(){return this.getId()+"-widget"}#p(){let e="function"==typeof this.getWidget?this.getWidget():null;e=("function"==typeof this.getWidgets?this.getWidgets():null)||e,e&&e.setAttribute("id",this.getWidgetId())}#f(){let e="function"==typeof this.getLabel?this.getLabel():null;e&&e.setAttribute("for",this.getWidgetId())}#m(){let e="function"==typeof this.getErrorDiv?this.getErrorDiv():null;e&&e.setAttribute("id",`${this.getId()}__errormessage`)}#g(){let e="function"==typeof this.getTooltipDiv?this.getTooltipDiv():null;e&&e.setAttribute("id",`${this.getId()}__shortdescription`)}#_(){let e="function"==typeof this.getDescription?this.getDescription():null;e&&e.setAttribute("id",`${this.getId()}__longdescription`)}#v(){let e="",t="function"==typeof this.getWidget?this.getWidget():null;function i(t,i){e?e+=` ${i}__${t}`:e=`${i}__${t}`}if(t=("function"==typeof this.getWidgets?this.getWidgets():null)||t,t){if(this.getDescription()){const e=this.getDescription();""!==e.innerHTML.trim()&&0!==e.children.length&&i("longdescription",this.getId())}this.getTooltipDiv()&&i("shortdescription",this.getId()),this.getErrorDiv()&&this.getErrorDiv().innerHTML&&i("errormessage",this.getId()),t.setAttribute("aria-describedby",e)}}#y(){let e="function"==typeof this.getWidget?this.getWidget():null;e=("function"==typeof this.getWidgets?this.getWidgets():null)||e;const t=this.getModel?.();if(e&&t?.screenReaderText){const i=window.DOMPurify?window.DOMPurify.sanitize(t.screenReaderText,{ALLOWED_TAGS:[]}):t.screenReaderText;e.setAttribute("aria-label",i)}}syncMarkupWithModel(){this.#f(),this.#p(),this.#g(),this.#_(),this.#v(),this.#m(),this.#y()}setFocus(e){const t=this.parentView?.getModel()?.fieldType;"form"!==t&&this.parentView?.setFocus&&this.parentView.setFocus(this.getId()),this.isActive()||(this.widget=this.getWidget(),this.widget instanceof NodeList?this.widget[0].focus():"adaptiveFormFileInput"===this.getClass()?this.getAttachButtonLabel().focus():this.widget.focus())}applyState(e){e.value&&this.updateValue(e.value),this.updateVisible(e.visible,e),this.updateReadOnly(e.readOnly),this.updateEnabled(e.enabled,e),this.initializeHelpContent(e),this.updateLabel(e.label),this.updateRequired(e.required,e),this.updateDescription(e.description)}initializeHelpContent(e){this.#b(!1),this.getDescription()&&this.#E(e)}#h(){this.#T(),this.#M()}#M(){const e=this.qm;e&&e.addEventListener("click",(()=>{this.#O(this.ELEMENT_HELP_SHOWN)}))}#T(){const e=this.getWidget();if(e)if(e.length&&e.length>1)for(let t of e)t.onfocus=()=>{this.#O(this.ELEMENT_FOCUS_CHANGED)};else e.onfocus=()=>{this.#O(this.ELEMENT_FOCUS_CHANGED)}}#O(e,t){const i=this.formContainer.getFormId(),n=this.formContainer.getFormTitle(),s=this.#I(),r={formId:i,formTitle:n,fieldName:this._model.name,fieldId:this._model.id,panelName:s,fieldQualifiedName:this._model.qualifiedName,...void 0!==t?.prevValue?{prevText:t?.prevValue}:{},...void 0!==t?.currentValue?{newText:t?.currentValue}:{},..."object"==typeof t&&null!==t?t:{}},a=this.formContainer.getPath();window.guideBridge.trigger(e,r,a)}#I(){return this.parentView?.getModel()?.name}setWidgetValueToDisplayValue(){this._model.displayValueExpression&&this._model.displayValue&&(this.widget.value=this._model.displayValue)}setWidgetValueToModelValue(){this._model.displayValueExpression&&this._model.displayValue&&(this.widget.value=this._model.value)}#w(e){this.tooltip&&this.toggleAttribute(this.getTooltipDiv(),e,t.DATA_ATTRIBUTE_VISIBLE,!1)}#b(e){this.getDescription()&&this.toggleAttribute(this.getDescription(),e,t.DATA_ATTRIBUTE_VISIBLE,!1)}#A(){return!!this.getLayoutProperties().tooltipVisible}updateVisible(e,i){this.toggle(e,t.ARIA_HIDDEN,!0),this.element.setAttribute(t.DATA_ATTRIBUTE_VISIBLE,e),null!=this.parentView&&"panel"===this.parentView.getModel().fieldType&&this.parentView.updateChildVisibility(e,i)}updateEnabled(e,i){this.widget&&(this.element.setAttribute(t.DATA_ATTRIBUTE_ENABLED,e),!1===e?this.widget.setAttribute("disabled","disabled"):this.widget.removeAttribute("disabled"))}updateReadOnly(e){this.widget&&(this.element.setAttribute(t.DATA_ATTRIBUTE_READONLY,e),!0===e?this.widget.setAttribute("readonly","readonly"):this.widget.removeAttribute("readonly"))}updateRequired(e,i){this.widget&&(this.element.toggleAttribute("required",e),this.element.setAttribute(t.DATA_ATTRIBUTE_REQUIRED,e),!0===e?this.widget.setAttribute("required","required"):this.widget.removeAttribute("required"))}updateValid(e,t){}updateValidity(e,i){const n=e.valid;this.errorDiv&&(this.element.setAttribute(t.DATA_ATTRIBUTE_VALID,n),this.widget.setAttribute(t.ARIA_INVALID,!n),this.updateValidationMessage(i.validationMessage,i))}updateErrorMessage(e,t){}updateValidationMessage(e,t){if(this.errorDiv&&this.errorDiv.innerHTML!==t.validationMessage){if(this.errorDiv.innerHTML=t.validationMessage,!1===t.validity.valid){const e=Object.keys(t.validity).find((e=>"valid"!==e&&!0===t.validity[e]));this.#O(this.ELEMENT_ERROR_SHOWN,{validationMessage:t.validationMessage,validationType:e}),t.validationMessage||(this.errorDiv.innerHTML=h.getTranslatedString(this.formContainer.getModel().lang,"defaultError"))}this.#v()}}updateValue(e){let t=void 0===e?null:e;this.widget&&(this.widget.value=t,this.updateEmptyStatus())}updateEmptyStatus(){if(!this.getWidget())return;let e="";const t=["radio","checkbox"];e=this.widget instanceof NodeList?Array.from(this.widget).map((e=>t.includes(e.type)?e.checked:e.value)).find((e=>e)):t.includes(this.widget.type)?this.widget.checked:this.widget.value;const i=Array.from(this.element.classList).filter((e=>!e.includes("--")))[0],n=`${i}--filled`,s=`${i}--empty`;this.element.classList.add(e?n:s),this.element.classList.remove(e?s:n)}updateLabel(e){this.label&&(e.hasOwnProperty("value")&&(this.label.innerHTML=e.value),e.hasOwnProperty("visible")&&(this.toggleAttribute(this.label,e.visible,t.ARIA_HIDDEN,!0),this.label.setAttribute(t.DATA_ATTRIBUTE_VISIBLE,e.visible)))}updateActiveChild(e){this.formContainer.setFocus(e?._activeChild?.id||e?.id)}updateDescription(e){if(void 0!==e){const t=window.DOMPurify?window.DOMPurify.sanitize(e,{ALLOWED_TAGS:[]}).trim():e;let i=this.getDescription();if(i){if(i.innerText.trim()===t)return;let e=i.querySelectorAll("p");e||(e=document.createElement("p"),i.innerHTML="",i.appendChild(pElement)),1===e.length&&(e[0].innerHTML=t)}else this.#C(t)}}#C(e){const t=Array.from(this.element.classList).filter((e=>!e.includes("--")))[0],i=this.element.querySelector(`.${t}__label-container`);if(!i)return void console.error("label container not found");{const e=document.createElement("button");e.className=`${t}__questionmark`,e.title="Help text",i.appendChild(e)}const n=document.createElement("div");n.className=`${t}__longdescription`,n.id=`${this.getId()}__longdescription`,n.setAttribute("aria-live","polite"),n.setAttribute("data-cmp-visible",!1);const s=document.createElement("p");s.textContent=e,n.appendChild(s);var r=this.getErrorDiv();r?(this.element.insertBefore(n,r),this.#E()):console.log("error div not found")}#E(e){const i=this.getQuestionMarkDiv(),n=this.getDescription(),s=this.#A(),r=this;i&&n&&i.addEventListener("click",(e=>{e.preventDefault(),"false"===n.getAttribute(t.DATA_ATTRIBUTE_VISIBLE)?(r.#b(!0),s&&r.#w(!1)):(r.#b(!1),s&&r.#w(!0))}))}subscribe(){this._model.subscribe((e=>{let t=e.target.getState();e.payload.changes.forEach((e=>{const i=`update${(n=e.propertyName)[0].toUpperCase()+n.slice(1)}`;var n;"value"===e.propertyName&&this.#O(this.ELEMENT_VALUE_CHANGED,e),"function"==typeof this[i]?this[i](e.currentValue,t):console.warn(`changes to ${e.propertyName} are not supported. Please raise an issue`)}))}))}},g=class{constructor(e){this.formContainer=e.formContainer,this._model=e.model,this.parentElement=e.parentElement,this.id=this._model.id,this.children=[],this.subscribe()}#N(e,t,i){let n=null;return null==e?(n=this.#j(t,i),d.createFieldsForAddedElement(n,this.formContainer)):null==t?this.#S(e.getModel()):e.getId()!=t.id&&(n=this.#j(t,i),d.createFieldsForAddedElement(n,this.formContainer),this.#S(e.getModel())),n}#x(){const e=this.children,t=this._model.items,i=e.length,n=t.length,s=i>n?i:n;let r=null;for(let a=0;a<s;a++){const s=a<i?e[a]:null,o=a<n?t[a]:null;r=this.#N(s,o,r)}}#R(e,t,i){if("array"!=t.type&&d.updateId(e,t.id,i),"panel"==t.fieldType&&t.items)for(let n=0;n<t.items.length;n++)this.#R(e,t.items[n],i+"_"+n)}updateCloneIds(e,t,i){if("array"!=i.type&&d.updateId(e,t,i.id),"panel"==i.fieldType&&i.items)for(let n=0;n<i.items.length;n++)this.updateCloneIds(e,t+"_"+n,i.items[n])}updateTemplate(e){const t=e.element.parentElement;this._templateHTML=t.cloneNode(!0);let i=e.getModel();i||(i=this.formContainer.getModel(e.getId())),this.#R(this._templateHTML,i,"temp_0")}#D(e,t,i){const n=new CustomEvent(t);i&&(n.payload=i),this.getModel().dispatch(n)}#j(e,t){if(this._templateHTML)return this.handleAddition(e,t);console.error("Panel needs to have templateHTML to support repeatability.")}#S(e){const i=e.index;let n=this.children[i];-1==i&&(n=this.formContainer.getField(e.id)),d.removeFieldReferences(n,this.formContainer),this.handleRemoval(n),this.children.splice(i,1);const s=new CustomEvent(t.PANEL_INSTANCE_REMOVED,{detail:n});this.formContainer.getFormElement().dispatchEvent(s)}addInstance(e,t){this.#D(e,"addInstance",t)}removeInstance(e,t){this.#D(e,"removeInstance",t)}#P(e,t,i,n){const s=this.formContainer.getModel(e),r=new CustomEvent(t);r.payload=s.index+i,s.parent.dispatch(r),n.stopPropagation()}#F(e){if("function"==typeof this?.repeatableParentView?.getRepeatableRootElement){const i=this.repeatableParentView.getRepeatableRootElement(e);d.registerClickHandler(i,t.DATA_HOOK_ADD_INSTANCE,(e=>{const i=e.currentTarget.getAttribute(t.DATA_HOOK_ADD_INSTANCE);i?this.#P(i,"addInstance",1,e):this.addInstance(e)})),d.registerClickHandler(i,t.DATA_HOOK_REMOVE_INSTANCE,(e=>{const i=e.currentTarget.getAttribute(t.DATA_HOOK_REMOVE_INSTANCE);i?this.#P(i,"removeInstance",0,e):this.removeInstance(e)}))}}handleAddition(e,t){const i=e.index;let n=this._templateHTML.cloneNode(!0),s=this.formContainer.getModel(e.id);if(this.updateCloneIds(n,"temp_0",s),this.repeatableParentView&&"function"==typeof this.repeatableParentView.addRepeatableMarkup)n=this.repeatableParentView.addRepeatableMarkup(this,s,n);else if(0==this.children.length)this.parentElement.append(n);else if(0==s.index){let e=this.children[0].element.parentElement;this.parentElement.insertBefore(n,e)}else this.getElementAt(i-1).after(n);return n}getElementAt(e){let t=this._model.items.find((t=>t.index===e)),i=this.parentElement.querySelector(`#${t.id}`);if(i)for(;i.parentElement!==this.parentElement;)i=i.parentElement;return i}handleRemoval(e){this.repeatableParentView&&"function"==typeof this.repeatableParentView.handleChildRemoval&&this.repeatableParentView.handleChildRemoval(e),e.element.parentElement.remove()}addChild(e){this._templateHTML||this.updateTemplate(e),this.children.splice(e.getModel().index,0,e),this.#F(e);const i=new CustomEvent(t.PANEL_INSTANCE_ADDED,{detail:e});this.repeatableParentView&&"function"==typeof this.repeatableParentView.handleChildAddition&&this.repeatableParentView.handleChildAddition(e),this.formContainer.getFormElement().dispatchEvent(i)}updateItems(e,t,i){e?this.#S(e):t&&this.#j(t)}subscribe(){this.getModel().subscribe((e=>{let t=e.target.getState();e.payload.changes.forEach((e=>{"items"===e.propertyName?this.updateItems(e.prevValue,e.currentValue,t):console.warn(`changes to ${e.propertyName} are not supported. Please raise an issue`)}))}))}getId(){return this.id}getModel(){return this._model}setRepeatableParentView(e){this.repeatableParentView=e,this.#x(),this.children.length>0&&this.#F(this.children[0])}getRepeatableParentView(){return this.repeatableParentView}},_=class extends m{constructor(e){super(e),this.children=[]}instantiateInstanceManager(){return new g({formContainer:this.formContainer,model:this._model.parent,parentElement:this.element.parentElement.parentElement})}setModel(e){if(super.setModel(e),e.repeatable){let t=this.formContainer.getField(e.parent.id);null==t&&(t=this.instantiateInstanceManager(),this.formContainer.addInstanceManager(t)),this.setInstanceManager(t),t.addChild(this)}}setFocus(e){const t=this.parentView?.getModel()?.fieldType;"form"!==t&&this.parentView?.setFocus&&this.parentView.setFocus(this.getId())}getActiveRepeatableNonRepeatableTabId(e,t){for(const i of e){if(i.id===t)return t;if("panel"===i.fieldType&&"array"===i.type){const e=this.formContainer.getModel().getElement(i.id).getState(),n=this.getActiveRepeatableNonRepeatableTabId(e.items,t);if(n)return n}}return null}focusToFirstVisibleField(e){const t=this.formContainer.getModel(),i=this.getActiveRepeatableNonRepeatableTabId(this.getModel().getState().items,e),n=t.getElement(i);if(!n)return;const s=e=>{if(!e.visible||!e.enabled)return null;if(e.fieldType&&"panel"!==e.fieldType)return e;for(const t of e.items){const e=s(t);if(e)return e}return null},r=s(n);r&&setTimeout((()=>{this.formContainer.setFocus(r.id)}),0)}addChild(e){this.children.push(e)}getCountOfAllChildrenInModel(){var e=0;for(let i in this.getModel()._children){var t=this.getModel()._children[i];null!=t.minOccur&&null!=t.maxOccur&&null!=t._children?e+=0==t._children.length?1:t._children.length:e+=1}return e}getChild(e){for(let t in this.children)if(this.children[t].id===e)return this.children[t]}handleChildAddition(e){}handleChildRemoval(e){}applyState(e){this.updateVisible(e.visible),this.updateEnabled(e.enabled),this.initializeHelpContent(e),this.updateLabel(e.label)}updateEnabled(e){this.toggle(e,t.ARIA_DISABLED,!0),this.element.setAttribute(t.DATA_ATTRIBUTE_ENABLED,e)}updateValid(e,t){}updateValidity(e,i){const n=e.valid;this.toggle(n,t.ARIA_INVALID,!0),this.element.setAttribute(t.DATA_ATTRIBUTE_VALID,n)}getChildViewByIndex(e){}#L(e){var t={closestRepeatableFieldInstanceManagerIds:[]};for(let n=e-1;n>=0;n--){var i=this.getChildViewByIndex(n);if(null==i.getInstanceManager()){t.closestNonRepeatableFieldId=i.getId();break}if(t.closestRepeatableFieldInstanceManagerIds.push(i.getInstanceManager().getId()),0!=i.getInstanceManager().getModel().minOccur)break}return t}cacheClosestFieldsInView(){for(let n=0;n<this.children.length;n++){var e=this.getChildViewByIndex(n);if(null!=e.getInstanceManager()&&0==e.getInstanceManager().getModel().minOccur){var t=e.getInstanceManager().getId();if(null==this._templateHTML[t]&&(this._templateHTML[t]={}),null==this._templateHTML[t].closestNonRepeatableFieldId&&null==this._templateHTML[t].closestRepeatableFieldInstanceManagerIds){var i=this.#L(n);this._templateHTML[t].closestNonRepeatableFieldId=i.closestNonRepeatableFieldId,this._templateHTML[t].closestRepeatableFieldInstanceManagerIds=i.closestRepeatableFieldInstanceManagerIds}}}}getIndexToInsert(e,t){var i=-1;for(let s=this.children.length-1;s>=0;s--){var n=this.getChildViewByIndex(s);if(e===n.getId()){i=s;break}if(null!=n.getInstanceManager()&&t.includes(n.getInstanceManager().getId())){i=s;break}}return i+1}getRepeatableRootElement(e){return e.element.parentElement}updateChildVisibility(e,t){}handleHiddenChildrenVisibility(){for(let e=0;e<this.children.length;e++)"false"===this.children[e].element.getAttribute(t.DATA_ATTRIBUTE_VISIBLE)&&this.updateChildVisibility(!1,this.children[e].getModel().getState())}findFirstVisibleChild(e){for(let i=0;i<e.length;i++)if("false"!=e[i].getAttribute(t.DATA_ATTRIBUTE_VISIBLE))return e[i]}updateVisibilityOfNavigationElement(e,i){e&&(!1===i?e.setAttribute(t.ARIA_HIDDEN,!0):e.removeAttribute(t.ARIA_HIDDEN),e.setAttribute(t.DATA_ATTRIBUTE_VISIBLE,i))}updateEmptyStatus(){}};class v extends _{static keyCodes={END:35,HOME:36,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40};#k;#$;#U;#V;#B="__tab";#Y="__tabpanel";_templateHTML={};constructor(e,t,i,n){super(e),this.#U=t,this.#$=i,this.#V=n;const{element:s}=e;this.#K(s),this.#k=this.getActiveTabId(this.#H()),this.#q(),this.#G()}#q(){var e=this.#z(),i=this.#H();if(e)for(var n=0;n<e.length;n++)i[n]&&(i[n].id===this.#k?(e[n].classList.add(this.#V.active.tabpanel),e[n].removeAttribute(t.ARIA_HIDDEN),i[n].classList.add(this.#V.active.tab),i[n].setAttribute(t.ARIA_SELECTED,!0),i[n].setAttribute(t.TABINDEX,"0"),i[n].setAttribute(t.ARIA_CURRENT,"true"),i[n].setAttribute("state","selected")):(e[n].classList.remove(this.#V.active.tabpanel),e[n].setAttribute(t.ARIA_HIDDEN,!0),i[n].classList.remove(this.#V.active.tab),i[n].setAttribute(t.ARIA_SELECTED,!1),i[n].setAttribute(t.TABINDEX,"-1"),i[n].setAttribute(t.ARIA_CURRENT,"false"),i[n].removeAttribute("state")))}#G(){var e=this.#H();if(e)for(var t=0;t<e.length;t++){var i=this;!function(t){e[t].addEventListener("click",(function(n){n?.target?.id===e[t].id&&i.navigateAndFocusTab(e[t].id)}))}(t),e[t].addEventListener("keydown",(function(e){i.#W(e)}))}}#K(e){this._elements={},this._elements.self=e;for(var t=this._elements.self.querySelectorAll("[data-"+this.#U+"-hook-"+this.#$+"]"),i=0;i<t.length;i++){var n=t[i];if(n.closest("[data-cmp-is="+this.#$+"]")===this._elements.self){var s=this.#$.toLowerCase(),r=s.charAt(0).toUpperCase()+s.slice(1),a=n.dataset[this.#U+"Hook"+r];if(this._elements[a]){if(!Array.isArray(this._elements[a])){var o=this._elements[a];this._elements[a]=[o]}this._elements[a].push(n)}else this._elements[a]=[n]}}}#W(e){var t=this.#J(this.#k),i=this.#H(),n=i.length-1;switch(e.keyCode){case v.keyCodes.ARROW_LEFT:case v.keyCodes.ARROW_UP:e.preventDefault(),t>0&&this.navigateAndFocusTab(i[t-1].id);break;case v.keyCodes.ARROW_RIGHT:case v.keyCodes.ARROW_DOWN:e.preventDefault(),t<n&&this.navigateAndFocusTab(i[t+1].id);break;case v.keyCodes.HOME:e.preventDefault(),this.navigateAndFocusTab(i[0].id);break;case v.keyCodes.END:e.preventDefault(),this.navigateAndFocusTab(i[n].id);break;default:return}}#J(e){var t=this.#H();if(t)for(var i=0;i<t.length;i++)if(t[i].id===e)return i;return-1}navigateAndFocusTab(e){if(this.setActive(),this.#k!==e){this.navigate(e),this.focusWithoutScroll(this.#Q(e));const t=this.getActiveTabId(this.#H()).replace(this.#B,"");this.focusToFirstVisibleField(t)}}#Q(e){var t=this.#H();if(t)for(var i=0;i<t.length;i++)if(t[i].id===e)return t[i]}focusWithoutScroll(e){if(e){var t=window.scrollX||window.pageXOffset,i=window.scrollY||window.pageYOffset;e.focus(),window.scrollTo(t,i)}}navigate(e){this.#k=e,this.addSteppedClass(e),this.#q()}addSteppedClass(e){var t=this.#H(),i=this.#z();const n=this.getActiveTabId(t),s=this.#Q(n);if(s.classList.contains(this.#V.active.tab)){s.classList.add(this.#V.stepped.tab);const e=Array.from(i).find((e=>e.getAttribute("aria-labelledby")===s.id));e&&e.classList.add(this.#V.stepped.tabpanel)}}getActiveTabId(e){if(e){for(var t=e[0].id,i=0;i<e.length;i++)if(e[i].classList.contains(this.#V.active.tab)){t=e[i].id;break}return t}}#X(){var e=this.#H(),t=this.#z();if(t)for(var i=0;i<t.length;i++){var n=t[i].querySelectorAll("[data-cmp-is]")[0].id;e[i].id=n+this.#B,e[i].setAttribute("aria-controls",n+this.#Y)}}#Z(){var e=this.#z();if(e)for(var t=0;t<e.length;t++){var i=e[t].querySelectorAll("[data-cmp-is]")[0].id;e[t].id=i+this.#Y,e[t].setAttribute("aria-labelledby",i+this.#B)}}syncMarkupWithModel(){super.syncMarkupWithModel(),this.#X(),this.#Z()}handleChildAddition(e){if(null!=e.getInstanceManager()&&null!=this._templateHTML[e.getInstanceManager().getId()]){var t=this._templateHTML[e.getInstanceManager().getId()].navigationTab.cloneNode(!0);t.id=e.id+this.#B,t.setAttribute("aria-controls",e.id+this.#Y);var i=e.getModel().index,n=e.getInstanceManager().getId();if(0==i){var s=this._templateHTML[n].closestNonRepeatableFieldId,r=this._templateHTML[n].closestRepeatableFieldInstanceManagerIds,a=this.getIndexToInsert(s,r);if(0==a){var o=this.#ee();o.insertBefore(t,o.firstChild)}else this.#H()[a-1].after(t)}else{var l=e.getInstanceManager().children[i-1].element.id+this.#B;this.#Q(l).after(t)}this.#K(this._elements.self);var u=this.#te(e.id+this.#Y);u.setAttribute("aria-labelledby",e.id+this.#B);const c=Array.from(t.classList).find((e=>e.includes("--stepped")));c&&t.classList.remove(c);const d=Array.from(u.classList).find((e=>e.includes("--stepped")));d&&u.classList.remove(d),this.#ie(t.id),this.#q(),null!=e.getInstanceManager().getModel().minOccur&&e.getInstanceManager().children.length>e.getInstanceManager().getModel().minOccur?this.navigateAndFocusTab(t.id):this.navigateAndFocusTab(this.findFirstVisibleChild(this.#H()).id)}}handleChildRemoval(e){var t=e.element.id+this.#Y,i=e.element.id+this.#B,n=this.#te(t),s=this.#Q(i);const r=this.#H(),a=Array.from(r).findIndex((e=>e.id===i));let o=null;if(0===a)o=r[1];else for(let e=a-1;e>=0;e--){o=r[e];break}s.remove(),n.remove(),this.children.splice(this.children.indexOf(e),1),this.#K(this._elements.self),this.#q(),o&&this.navigateAndFocusTab(o.id)}addChild(e){super.addChild(e),this.#ne(e),this.getCountOfAllChildrenInModel()===this.children.length&&(this.cacheClosestFieldsInView(),this.handleHiddenChildrenVisibility())}#ne(e){if(null!=e.getInstanceManager()&&(null==this._templateHTML||null==this._templateHTML[e.getInstanceManager().getId()])){var t=e.element.id+this.#B,i=e.element.id+this.#Y,n=e.getInstanceManager().getId(),s=this.#Q(t),r=this.#te(i);this._templateHTML[n]={},this._templateHTML[n].navigationTab=s,this._templateHTML[n].targetTabPanel=r}}#te(e){var t=this.#z();if(t)for(var i=0;i<t.length;i++)if(t[i].id===e)return t[i]}#ie(e){var t=this,i=this.#H(),n=this.#J(e);i[n].addEventListener("click",(function(i){i?.target?.id===e&&t.navigateAndFocusTab(e)})),i[n].addEventListener("keydown",(function(e){t.#W(e)}))}#ee(){return this.element.querySelector(this.#V.olTabList)}#z(){return this._elements.tabpanel}#H(){return this._elements.tab}addRepeatableMarkup(e,t,i){let n=this._templateHTML[e.getId()].targetTabPanel.cloneNode(!1);return n.id=t.id+this.#Y,this.#se(e,t.index).beforeViewElement.after(n),n.append(i),n}#se(e,t){var i={},n=e.getId();if(0==t){var s=this._templateHTML[n].closestNonRepeatableFieldId,r=this._templateHTML[n].closestRepeatableFieldInstanceManagerIds,a=this.getIndexToInsert(s,r);i.beforeViewElement=a>0?this.#z()[a-1]:this.#ee()}else{let n=this.#re(e,t-1);i.beforeViewElement=n}return i}#re(e,t){let i=e._model.items.find((e=>e.index===t))?.id;return this.element.querySelector(`#${i}${this.#Y}`)}getChildViewByIndex(e){var t=this.#z(),i=t[e].id.substring(0,t[e].id.lastIndexOf("__"));return this.getChild(i)}updateChildVisibility(e,t){this.updateVisibilityOfNavigationElement(this.#Q(t.id+this.#B),e);var i=this.getActiveTabId(this._elements.tab);if(!e&&i===t.id+this.#B){let e=this.findFirstVisibleChild(this.#H());e&&this.navigateAndFocusTab(e.id)}}}const y=v,b=class extends m{constructor(e){super(e)}updateValue(e){e===this._model._jsonModel.enum[0]?(this.widget.checked=!0,this.widget.setAttribute(FormView.Constants.HTML_ATTRS.CHECKED,FormView.Constants.HTML_ATTRS.CHECKED)):(this.widget.checked=!1,this.widget.removeAttribute(FormView.Constants.HTML_ATTRS.CHECKED)),this.widget.value=e,super.updateEmptyStatus()}setModel(e){super.setModel(e),this._onValue=this._model._jsonModel.enum[0],this._offValue=this._model._jsonModel.enum[1],this.widget.addEventListener("change",(e=>{const t=this.widget.checked?this._onValue:this._offValue;this._model.dispatch(new FormView.Actions.UIChange({value:t}))})),this.widget.addEventListener("focus",(e=>{this.setActive(),this.triggerEnter()})),this.widget.addEventListener("blur",(e=>{this.setInactive(),this.triggerExit()}))}},E=class extends m{constructor(e){super(e)}setModel(e){super.setModel(e),null==this.widgetObject&&(this.widgetObject=new FileInputWidget(this.widgetFields))}updateValue(e){null==this.widgetObject&&(this.widgetObject=new FileInputWidget(this.widgetFields)),this.widgetObject.setValue(e),super.updateEmptyStatus()}syncWidget(){let e=this.getWidget?this.getWidget():null;e&&(e.id=this.getId()+"__widget",this.getAttachButtonLabel().setAttribute("for",this.getId()+"__widget"))}syncLabel(){let e="function"==typeof this.getLabel?this.getLabel():null;e&&e.setAttribute("for",this.getId())}syncMarkupWithModel(){super.syncMarkupWithModel(),this.syncWidget(),this.syncLabel()}},T=class{fileItemSelector=".cmp-adaptiveform-fileinput__fileitem";widget=null;fileArr=[];fileList=null;lang="en";model=null;isFileUpdate=!1;options=null;regexMimeTypeList=[];values=[];invalidFeature={SIZE:1,NAME:2,MIMETYPE:3};extensionToMimeTypeMap={bat:"application/x-msdownload",com:"application/x-msdownload",dll:"application/x-msdownload",exe:"application/x-msdownload",msi:"application/x-msdownload",msg:"application/vnd.ms-outlook",dwg:"image/vnd.dwg",jxr:"image/vnd.ms-photo",psd:"image/vnd.adobe.photoshop",ico:"image/vnd.microsoft.icon",cab:"application/vnd.ms-cab-compressed",deb:"application/vnd.debian.binary-package",sqlite:"application/vnd.sqlite3",inf2:"image/vnd.cns.inf2",djv:"image/vnd.djvu",djvu:"image/vnd.djvu",dxf:"image/vnd.dxf",fbs:"image/vnd.fastbidsheet",fpx:"image/vnd.fpx",fst:"image/vnd.fst",mmr:"image/vnd.fujixerox.edmics-mmr",rlc:"image/vnd.fujixerox.edmics-rlc",pgb:"image/vnd.globalgraphics.pgb",mix:"image/vnd.mix",mdi:"image/vnd.ms-modi",npx:"image/vnd.net-fpx",radiance:"image/vnd.radiance","sealed.png":"image/vnd.sealed.png","softseal.gif":"image/vnd.sealedmedia.softseal.gif","softseal.jpg":"image/vnd.sealedmedia.softseal.jpg",svf:"image/vnd.svf"};initialFileValueFileNameMap;constructor(e){this.widget=e.widget,this.model=e.model(),this.fileList=e.fileListDiv,this.lang=this.model.lang,this.options=Object.assign({},{contextPath:""},this.model._jsonModel),this.attachEventHandlers(e?.widget,e?.dragArea),this.regexMimeTypeList=this.options.accept.map((function(e,t){try{return new RegExp(e.trim())}catch(e){window.console&&console.log(e)}}))}attachEventHandlers(e,t){e.addEventListener("change",(e=>{this.handleChange(e?.target?.files)}))}static isValid(e){return/^[^\\/:\*\;\$\%\?"<>\|]+$/.test(e)&&!/^\./.test(e)&&!/^(nul|prn|con|lpt[0-9]|com[0-9])(\.|$)/i.test(e)}getIndexOfText(e,t){let i=-1,n=this,s=!1;return this.values.find((function(r,a){let o=r,l="object"==typeof n.initialFileValueFileNameMap&&void 0!==typeof n.initialFileValueFileNameMap[r]?n._initialFileValueFileNameMap[r]:null;if(o.match(/\//g)&&o.match(/\//g).length>1&&(o=r.substring(r.lastIndexOf("/")+1)),o===e||l===e){if(i=a,s=-1!==n.values.indexOf(r,i+1),t&&s){let e=t.parentNode.parentNode;i=Array.prototype.indexOf.call(e.children,t.parentElement)}return r}})),i}static displaySVG(e){const t=e,i=document.createElement("img");i.src=t;const n=window.open("","_blank","scrollbars=no,menubar=no,height=600,width=800,resizable=yes,toolbar=no,status=no");n?.document?.body.appendChild(i)}static previewFileUsingObjectUrl(e){if(e){if(!window.navigator||!window.navigator.msSaveOrOpenBlob){let t=window.URL.createObjectURL(e);return"image/svg+xml"===e.type?this.displaySVG(t):window.open(t,"","scrollbars=no,menubar=no,height=600,width=800,resizable=yes,toolbar=no,status=no"),t}window.navigator.msSaveOrOpenBlob(e,e.name)}}static previewFile(e){let t=arguments[1].fileUrl,i=t.lastIndexOf("/");i>=0&&-1===t.indexOf("?")&&(t=t.substr(0,i)+"/"+encodeURIComponent(t.substr(i+1))),window.open(t,"","scrollbars=no,menubar=no,height=600,width=800,resizable=yes,toolbar=no,status=no")}handleFilePreview(e){let t=e.target,i=t.textContent,n=this.getIndexOfText(i,t),s=null;if(-1!==n)if(void 0!==t.dataset.key&&(s=t.dataset.key),s&&"[object Blob]"!==s)0!==s.lastIndexOf(this.options.contextPath,0)&&(s=this.options.contextPath+s),FileInputWidget.previewFile.apply(this,[null,{fileUrl:s}]);else{let e=this.fileArr[n]?.data,i=FileInputWidget.previewFileUsingObjectUrl(e);i&&(t.dataset.objectUrl=i)}}handleClick(e){let t=e.target,i=t.previousSibling.textContent,n=this.getIndexOfText(i,t),s=t.previousSibling.dataset.key,r=t.previousSibling.dataset.objectUrl;if(-1!==n){this.values.splice(n,1),this.fileArr.splice(n,1),this.model.value=this.fileArr;let e=Array.from(this.widget.files).findIndex((function(e){return e.name===i}));this.deleteFilesFromInputDom([e]),null!=s&&delete t.previousSibling.dataset.key,r&&window.URL.revokeObjectURL(r)}t.parentElement.remove(),this.widget.focus()}fileItem(e,t,i){let n=this,s=document.createElement("li");s.setAttribute("class","cmp-adaptiveform-fileinput__fileitem");let r=document.createElement("span");r.setAttribute("tabindex","0"),r.setAttribute("class","cmp-adaptiveform-fileinput__filename"),r.setAttribute("aria-label",e),r.textContent=e,r.addEventListener("keypress",(function(e){13!==e.keyCode&&32!==e.charCode||e.target.click()})),r.addEventListener("click",(function(e){n.handleFilePreview(e)})),s.appendChild(r),null!=i&&(r.dataset.key=i);let a=document.createElement("span");return a.setAttribute("tabindex","0"),a.setAttribute("class","cmp-adaptiveform-fileinput__filedelete"),a.setAttribute("aria-label",FormView.LanguageUtils.getTranslatedString(this.lang,"FileCloseAccessText")+e),a.setAttribute("role","button"),a.textContent="x",a.addEventListener("keypress",(function(e){13!==e.keyCode&&32!==e.charCode||e.target.click()})),a.addEventListener("click",(function(e){n.handleClick(e)})),s.appendChild(a),s}isMultiSelect(){return"file[]"===this.options.type||"string[]"===this.options.type}showFileList(e,t,i){if(!this.isMultiSelect()||null==e)for(;this.fileList.lastElementChild;)this.fileList.removeChild(this.fileList.lastElementChild);null!=e&&this.fileList.append(this.fileItem(e,t,i))}showInvalidMessage(e,t){let i=this,n=null!==navigator.userAgent.match(/iPad/i),s=null!==navigator.userAgent.match(/iPhone/i);n||s?setTimeout((function(){i.invalidMessage(i,e,t)}),0):this.invalidMessage(e,t)}invalidMessage(e,t){const i=this.options.constraintMessages||{},n={[this.invalidFeature.SIZE]:i.maxFileSize||FormView.LanguageUtils.getTranslatedString(this.lang,"FileSizeGreater",[e,this.options.maxFileSize]),[this.invalidFeature.NAME]:i.invalidFileName||FormView.LanguageUtils.getTranslatedString(this.lang,"FileNameInvalid",[e]),[this.invalidFeature.MIMETYPE]:i.invalidMimeType||FormView.LanguageUtils.getTranslatedString(this.lang,"FileMimeTypeInvalid",[e])};alert(n[t])}getFileListItem(e){try{let t=new DataTransfer||new ClipboardEvent("").clipboardData;return e.forEach((function(e){t.items.add(e)})),t.files}catch(e){throw console.error(e),e}}updateFilesInDom(e){this.isFileUpdate=!0,this.widget.files=this.getFileListItem(e),this.isFileUpdate=!1}deleteFilesFromInputDom(e){let t=[];Array.from(this.widget.files).forEach((function(i,n){e.includes(n)||t.push(i)}));try{this.updateFilesInDom(t)}catch(e){console.error("Deleting files is not supported in your browser")}}setValue(e){let t=!1;if(null!=e&&(e=Array.isArray(e)?e:[e]),null!=this.fileArr&&null!=e&&(t=JSON.stringify(FormView.FileAttachmentUtils.extractFileInfo(this.fileArr))===JSON.stringify(e)),!t){let t={};for(this.fileList.querySelectorAll(".cmp-adaptiveform-fileinput__filename").forEach((function(e){let i=e.dataset.key;if(void 0!==i){let e=i.substring(i.lastIndexOf("/")+1);t[e]=i}}));this.fileList.lastElementChild;)this.fileList.removeChild(this.fileList.lastElementChild);if(null!=e){let i=this;this.values=e.map((function(e,n){let s=!!window.File&&e.data instanceof window.File,r="string"==typeof e?e:e.name,a="string"==typeof e?e:s?"":e.data;return t[r]&&(a=t[r]),i.showFileList(r,null,a),r})),this.fileArr=[...e]}}}handleChange(e){if(!this.isFileUpdate){let t="",i="",n="",s="",r=this,a=e,o=!1,l=!1,u=!1;if(void 0!==a){let e=[];Array.from(a).forEach((function(a,c){let d=!1,h=!1,p=!1;if(t=a.name.split("\\").pop(),a.size/1024/1024>parseFloat(this.options.maxFileSize))o=d=!0,i=t+","+i;else if(FileInputWidget.isValid(t)){let e=!1,i=t.split(".").pop(),n=a.type?a.type:r.extensionToMimeTypeMap[i];null!=n&&n.trim().length>0&&(e=this.regexMimeTypeList.some((function(e){return e.test(n)}))),e||(u=p=!0,s=t+","+s)}else l=h=!0,n=t+","+n;d||h||p?e.push(c):this.isMultiSelect()?(this.values.push(t),this.fileArr.push(a)):(this.values=[t],this.fileArr=[a])}),this),e.length>0&&null!==this.widget&&this.deleteFilesFromInputDom(e)}this.model.value=this.fileArr,o?this.showInvalidMessage(i.substring(0,i.lastIndexOf(",")),this.invalidFeature.SIZE):l?this.showInvalidMessage(n.substring(0,n.lastIndexOf(",")),this.invalidFeature.NAME):u&&this.showInvalidMessage(s.substring(0,s.lastIndexOf(",")),this.invalidFeature.MIMETYPE)}this.widget.value=null}},M=class extends m{constructor(e){super(e)}updateEnum(e){}updateEnumNames(e){}applyState(e){super.applyState(e),e?.enum&&this.updateEnum(e.enum),e?.enumNames&&this.updateEnumNames(e.enumNames)}updateEnumForRadioButtonAndCheckbox(e,t){let i=this.getWidget().length;0===i?e.forEach((e=>{this.getWidgets().appendChild(t.call(this,e,e))})):i===e.length?this.widget.forEach(((t,i)=>{t.value=e[i]})):i<e.length?(this.widget.forEach(((t,i)=>{t.value=e[i]})),e.forEach(((e,n)=>{n>i-1&&this.getWidgets().appendChild(t.call(this,e,e))}))):this.widget.forEach(((t,i)=>{if(i<e.length)t.value=e[i];else{let e=t.parentElement.parentElement;this.getWidgets().removeChild(e)}}))}updateEnumNamesForRadioButtonAndCheckbox(e,t){let i=this.getWidget().length;0===i?e.forEach((e=>{this.getWidgets().appendChild(t.call(this,e,e))})):i>e.length?[...this.getOptions()].forEach(((t,i)=>{let n=t.querySelector("span"),s=t.querySelector("input"),r=i<e.length?e[i]:s.value,a=window.DOMPurify?window.DOMPurify.sanitize(r):r;n.innerHTML=a;let o=`${this._model.label.value}:  ${a}`,l=window.DOMPurify?window.DOMPurify.sanitize(o,{ALLOWED_TAGS:[]}):o;s.setAttribute("aria-label",l)})):[...this.getOptions()].forEach(((t,i)=>{let n=t.querySelector("span"),s=t.querySelector("input"),r=window.DOMPurify?window.DOMPurify.sanitize(e[i]):e[i];if(n&&(n.innerHTML=r),s){let e=`${this._model.label.value}:  ${r}`,t=window.DOMPurify?window.DOMPurify.sanitize(e,{ALLOWED_TAGS:[]}):e;s.setAttribute("aria-label",t)}}))}},O=class extends T{attachEventHandlers(e,t,i){super.attachEventHandlers(e,i),t?.addEventListener("dragover",(e=>{e.preventDefault(),t.classList.add("cmp-adaptiveform-fileinput__dragarea--active")})),t?.addEventListener("dragleave",(e=>{t.classList.remove("cmp-adaptiveform-fileinput__dragarea--active")})),t?.addEventListener("drop",(e=>{e.preventDefault(),t.classList.remove("cmp-adaptiveform-fileinput__dragarea--active"),this.handleChange(e?.dataTransfer?.files)})),t?.addEventListener("paste",(e=>{e.preventDefault(),this.handleChange(e?.clipboardData?.files)}))}handleClick(e){let t=e.target,i=t.parentElement.previousSibling.textContent,n=this.getIndexOfText(i,t),s=t.parentElement.previousSibling.dataset.key,r=t.parentElement.previousSibling.dataset.objectUrl;if(-1!==n){this.values.splice(n,1),this.fileArr.splice(n,1),this.model.value=this.fileArr;let e=Array.from(this.widget.files).findIndex((function(e){return e.name===i}));this.deleteFilesFromInputDom([e]),null!=s&&delete t.parentElement.previousSibling.dataset.key,r&&window.URL.revokeObjectURL(r)}t.parentElement.parentElement.remove(),this.widget.focus()}formatBytes(e,t=0){if(!+e)return"0 Bytes";const i=t<0?0:t,n=Math.floor(Math.log(e)/Math.log(1024));return`${parseFloat((e/Math.pow(1024,n)).toFixed(i))} ${["bytes","kb","mb","gb","tb","pb"][n]}`}setValue(e){let t=!1;if(null!=e&&(e=Array.isArray(e)?e:[e]),null!=this.fileArr&&null!=e&&(t=JSON.stringify(FormView.FileAttachmentUtils.extractFileInfo(this.fileArr))===JSON.stringify(e)),!t){let t={};for(this.fileList.querySelectorAll(".cmp-adaptiveform-fileinput__filename").forEach((function(e){let i=e.dataset.key;if(void 0!==i){let e=i.substring(i.lastIndexOf("/")+1);t[e]=i}}));this.fileList.lastElementChild;)this.fileList.removeChild(this.fileList.lastElementChild);if(null!=e){let i=this;this.values=e.map((function(e,n){let s=!!window.File&&e.data instanceof window.File,r="string"==typeof e?e:e.name,a="string"==typeof e?e:s?"":e.data,o=e.size,l=a;return t[r]&&(l=t[r]),i.showFileList(r,o,null,l),r})),this.fileArr=[...e]}}}fileItem(e,t,i,n){let s=this,r=document.createElement("li");r.setAttribute("class","cmp-adaptiveform-fileinput__fileitem");let a=document.createElement("span"),o=document.createElement("span");o.setAttribute("class","cmp-adaptiveform-fileinput__filesize"),o.textContent=this.formatBytes(t),a.setAttribute("tabindex","0"),a.setAttribute("class","cmp-adaptiveform-fileinput__filename"),a.setAttribute("aria-label",e),a.textContent=e,a.addEventListener("keypress",(function(e){13!==e.keyCode&&32!==e.charCode||e.target.click()})),a.addEventListener("click",(function(e){s.handleFilePreview(e)})),r.appendChild(a),null!=n&&(a.dataset.key=n);let l=document.createElement("span"),u=document.createElement("span");return l.setAttribute("class","cmp-adaptiveform-fileinput__fileendcontainer"),u.setAttribute("tabindex","0"),u.setAttribute("class","cmp-adaptiveform-fileinput__filedelete"),u.setAttribute("aria-label",FormView.LanguageUtils.getTranslatedString(this.lang,"FileCloseAccessText")+e),u.setAttribute("role","button"),u.textContent="x",u.addEventListener("keypress",(function(e){13!==e.keyCode&&32!==e.charCode||e.target.click()})),u.addEventListener("click",(function(e){s.handleClick(e)})),l.appendChild(o),l.appendChild(u),r.appendChild(l),r}showFileList(e,t,i,n){if(!this.isMultiSelect()||null==e)for(;this.fileList.lastElementChild;)this.fileList.removeChild(this.fileList.lastElementChild);null!=e&&this.fileList.append(this.fileItem(e,t,i,n))}},I=class{#ae;#oe;#le;#ue;constructor(e){this.errors=!1,this.data=e.data,this.#ae=[],this.#oe=[],this.#le=[],this.#ue=this.#le}addMessage(e,t,i){this.errors=!0,this.#ae.push(t),this.#le.push(i),this.#oe.push(e)}getNextMessage(){if(0===this.#oe.length)return null;let e=this.#le.pop();return{code:this.#oe.pop(),somExpression:e,qualifiedName:e,message:this.#ae.pop()}}},w=class{data;contentType;attachments;constructor(e){this.data=e.data,this.contentType="application/json",this.attachments=e.attachments}getData(){return this.data}getContentType(){return this.contentType}getAttachments(){return this.attachments}toHTMLFormData(){let e=new FormData;this.contentType&&e.append("contentType",this.contentType),e.append("data",this.data);for(let t=0;t<this.attachments.length;t++){let i=this.attachments[t];if("undefined"!=typeof File&&i.data instanceof File)e.append("fileAttachments",i.data,i.name);else{let t=new Blob([JSON.stringify({data:i.data,name:i.name,contentType:i.contentType})],{type:"application/json"});e.append("fileAttachments",t)}e.append("fileAttachmentBindRefs",i.dataRef)}return e}toJsObject(){return{data:this.data,contentType:this.contentType,attachments:this.attachments}}};var A=i(6608);window.guideBridge=new class{#ce={};#de=[];#he="";#pe={};ConfigKeys={LOCALE_CONFIG:"localeConfig",RENDER_CONFIG:"renderConfig",SUBMIT_CONFIG:"submitConfig"};constructor(){let e=document.createEvent("CustomEvent");if(e.initCustomEvent(t.GUIDE_BRIDGE_INITIALIZE_START,!0,!0,{guideBridge:this}),window.dispatchEvent(e),window!==window.parent)try{window.parent.document.getElementById(window.name),window.parent.dispatchEvent(e)}catch(e){console.debug("Cross-origin access to parent window blocked")}let i=this;document.addEventListener(t.FORM_CONTAINER_INITIALISED,(function(e){let t=e.detail;i.#ce[t.getPath()]=t,i.#fe(t.getPath())}))}#fe(e){this.#de.forEach((function(t){t.formContainerPath===e&&t.handler.call(t.context),t.formContainerPath||t.handler.call(t.context)}))}getFormDataString(t){let i=this.getFormModel();if(!i)throw new Error("formModel is not defined");(0,e.readAttachments)(i).then((e=>{let n=Object.keys(e).flatMap((t=>e[t])),s=new w({data:JSON.stringify(i.exportData()),attachments:n}),r=new I({data:s});t&&"function"==typeof t.success&&t.success(r)}))}getFormDataObject(e){this.getFormDataString({success:function(t){e&&"function"==typeof e.success&&e.success(t)}})}getFormModel(){if(this.#he)return this.#ce[this.#he]?this.#ce[this.#he].getModel():null;{const e=this.#me();return this.#he=e,this.#ce[e]?this.#ce[e].getModel():null}}#me(){let e=this.#he;if(!e)for(let t in this.#ce)this.#ce.hasOwnProperty(t)&&(e=t);return e}validate(){let e=this.getFormModel();if(!e)throw new Error("formModel is not defined");let t=e.validate();return!(t&&t.length>0)}connect(e,t,i){if(t=t||this,i&&(this.#he=i),!e)throw new Error("handler arg is null");this.isConnected()?e.call(t):this.#de.push({handler:e,context:t,formContainerPath:i})}isConnected(){return!!this.getFormModel()}disableForm(){let e=this.getFormModel();if(!e)throw new Error("formModel is not defined");e.enabled=!1}reset(){let e=this.getFormModel();if(!e)throw new Error("formModel is not defined");e.dispatch({type:"reset"})}hideSubmitButtons(){if(!this.isConnected())throw new Error("GuideBridge is not connected");this.#ge("submit")}hideResetButtons(){if(!this.isConnected())throw new Error("GuideBridge is not connected");this.#ge("reset")}#ge(e){this.getFormModel().visit((t=>{t.properties["fd:buttonType"]===e&&(t.visible=!1,t.subscribe((e=>{e.target.getState(),e.payload.changes.forEach((e=>{"visible"===e.propertyName&&e.currentValue&&(t.visible=!1)}))})))}))}hideSaveButtons(){}hideSummaryPanel(){}trigger(e,t,i){let n;n=i?this.#ce[i]:this.#ce[this.#me()],n&&n.getFormElement()&&n.getFormElement().dispatchEvent(new CustomEvent(e,{detail:t}))}on(e,t){if(!this.isConnected())throw new Error("GuideBridge is not connected");{const i=this.#ce[this.#he];i&&i.getFormElement()&&i.getFormElement().addEventListener(e,t)}}registerConfig(e,t){this.#pe[e]||(this.#pe[e]=[]);const i="function"==typeof t?{fn:t,formContainerPath:this.#he}:{...t,formContainerPath:this.#he};return this.#pe[e].push(i),this.#pe[e]}resolveNode(e){return this.getFormModel().resolveQualifiedName(e)}getConfigsForKey(e){return this.#pe[e]||[]}};const C={Click:e.Click,Change:e.Change,Submit:e.Submit,Blur:e.Blur,AddItem:e.AddItem,RemoveItem:e.RemoveItem,UIChange:e.UIChange,Save:e.Save,CustomEvent:e.CustomEvent},N={formatDate:A.formatDate,parseDate:A.parseDate},j={FileObject:e.FileObject,extractFileInfo:e.extractFileInfo,readAttachments:e.readAttachments}})(),window.FormView=n})();
/*******************************************************************************
 * Copyright 2024 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/

if (typeof window.HamburgerMenu === 'undefined') {
    window.HamburgerMenu = class HamburgerMenu {
        static activeItemId = '';

        static bemBlock = 'cmp-adaptiveform-container__hamburger-menu';
        static nestingSupport = 10;
    
        static selectors  = {
            active: `.${HamburgerMenu.bemBlock}-item--active`,
            hamburgerMenuMainContainer: `.${HamburgerMenu.bemBlock}-container`,
            hamburgerMenuTopContainer: {
                self: `.${HamburgerMenu.bemBlock}-top`,
                hamburgerMenuIconContainer: `.${HamburgerMenu.bemBlock}-icon-container`,
                hamburgerMenuIcon: `.${HamburgerMenu.bemBlock}-icon`,
            },
            hamburgerMenuWidget: {
                hamburgerMenu: `.${HamburgerMenu.bemBlock}-dropdown`,
                hamburgerSubMenu: `.${HamburgerMenu.bemBlock}-submenu`,
                hamburgerMenuNavLink: `.${HamburgerMenu.bemBlock}-link`,
                hamburgerMenuCloseNavButton: `.${HamburgerMenu.bemBlock}-button--close`,
                hamburgerMenuOpenNavButton: `.${HamburgerMenu.bemBlock}-button--open`,
            },
            hamburgerMenuMiddleContainer: `.${HamburgerMenu.bemBlock}-middle`,
            hamburgerMenuBottomContainer: {
                self: `.${HamburgerMenu.bemBlock}-bottom`,
                hamburgerMenuActiveItemTitle: `.${HamburgerMenu.bemBlock}-active-item-title`,
                hamburgerMenuNextNavButton: `.${HamburgerMenu.bemBlock}-button--next`,
                hamburgerMenuPreviousNavButton: `.${HamburgerMenu.bemBlock}-button--prev`,
                hamburgerMenuNavButtonsContainer: `.${HamburgerMenu.bemBlock}-navigation-container`,
            },
        };
    
        static cssClasses = {
            active: `${HamburgerMenu.bemBlock}-item--active`,
            activeParent: `${HamburgerMenu.bemBlock}-item--activeparent`,
            hamburgerMenuWidget: {
                hamburgerMenu: `${HamburgerMenu.bemBlock}-dropdown`,
                hamburgerSubMenu: `${HamburgerMenu.bemBlock}-submenu`,
                hamburgerMenuNavLink: `${HamburgerMenu.bemBlock}-link`,
                hamburgerMenuCloseNavButton: `${HamburgerMenu.bemBlock}-button--close`,
                hamburgerMenuOpenNavButton: `${HamburgerMenu.bemBlock}-button--open`,
            },
        }

        constructor(formContainer) {
            this.formContainer = formContainer;
            formContainer._model.subscribe((action) => {
                const { payload } = action;
                const { changes, field } = payload;
                const { items } = field;
                if (changes && changes.length > 0) {
                    changes.forEach((change) => {
                        switch (change.propertyName) {
                            case "activeChild":
                                this.#handleActiveItem(field);
                                break;
                            case "items":
                                this.#handleItemsChange(change, items);
                                break;
                            case "visible":
                                this.#updateAttribute(field.id, 'data-panel-visible', field.visible);
                                break;
                            case "enabled":
                                this.#updateAttribute(field.id, 'data-panel-enabled', field.enabled);
                                break;
                        }
                    });
                }
            }, "fieldChanged");
        }

        #updateAttribute(id, attributeName, value) {
            const element = document.querySelector(`[data-panel-id='${id}']`);
            if (attributeName === 'data-panel-enabled' && element) {
                if (value === 'false') {
                    element.setAttribute('disabled', 'true');
                } else {
                    element.removeAttribute('disabled');
                }
            }
            if (element) {
                element.setAttribute(attributeName, value);
            }
        }

        #createListItem(item) {
            const li = document.createElement('li');
            const link = document.createElement('a');
            const textSpan = document.createElement('span');
            link.href = "#";
            textSpan.textContent = item?.label?.value;
            textSpan.setAttribute('tabindex', "0");
            link.appendChild(textSpan);
            li.appendChild(link);
            li.setAttribute('data-panel-id', item?.id);
            li.setAttribute('data-panel-visible', item?.visible);
            li.setAttribute('data-panel-enabled', item?.enabled);
            return li;
        }

        #handleItemsChange(change, items) {
            if (change?.prevValue !== null) {
                document.querySelector(`[data-panel-id='${change?.prevValue?.id}']`)?.remove();
            } else {
                items.forEach((item) => {
                    if (item.id === change.currentValue.id) {
                        const prevListItem = document.querySelector(`[data-panel-id='${items[change.currentValue.index - 1]?.id}']`);
                        const newListItem = this.#createListItem(change.currentValue);
                        prevListItem?.parentNode?.insertBefore(newListItem, prevListItem?.nextSibling);
                    }
                });
            }
        }


        #handleActiveItem(field) {
            const menu = document.querySelector(HamburgerMenu.selectors.hamburgerMenuWidget.hamburgerMenu);
            if (field !== null && field) {
                const activeListItem = document.querySelector(`[data-panel-id='${field.id}']`);
                if(activeListItem && activeListItem.tagName === 'LI') {
                    const menuItems = document.querySelectorAll(HamburgerMenu.selectors.hamburgerMenuWidget.hamburgerMenu + ' li');
                    const fieldModel = this.formContainer?.getField(activeListItem?.getAttribute('data-panel-id'))?.getModel();
                    const elementID = this.#checkFirstNonPanel(fieldModel);
                    const targetElement = menu.querySelector("[data-panel-id='"+ elementID + "']");
                    this.#resetMenuItems(menuItems);
                    this.#activateCurrentItem(targetElement);
                    const anchorElement = targetElement?.querySelector('a');
                    anchorElement?.classList.add(HamburgerMenu.cssClasses.active);
                    anchorElement?.querySelector('button')?.classList?.toggle(HamburgerMenu.cssClasses.hamburgerMenuWidget.hamburgerMenuCloseNavButton);
                    this.#updateSelectedPanelTitle(anchorElement);
                    this.#highlightMenuTree(anchorElement);
                    this.#renderBreadCrumbs(menu);
                }
            }
        }
    
         #updateSelectedPanelTitle(anchorElement, clickedAnchorElement) {
            const activeItemTitleContent = anchorElement?.innerText;
            const clickedAnchorElementText = clickedAnchorElement?.innerText;
            const activeItemTitle = document.querySelector(HamburgerMenu.selectors.hamburgerMenuBottomContainer.hamburgerMenuActiveItemTitle);
            activeItemTitle.innerText = activeItemTitleContent || clickedAnchorElementText || '';
        }
    
         #checkFirstNonPanel(fieldModel) {
            if(fieldModel && fieldModel._children && fieldModel._children[0]) {
                if(fieldModel._children[0]?.fieldType !== 'panel') {
                    return fieldModel._children[0].parent.id;
                }
                return this.#checkFirstNonPanel(fieldModel?._children[0])
            }
            return fieldModel?.id;
        }
    
         #clickHandler(event) {
            const menu = document.querySelector(HamburgerMenu.selectors.hamburgerMenuWidget.hamburgerMenu);
            event.stopPropagation();
            let targetElement = event.target.closest('li');    
            if(targetElement?.getAttribute('data-panel-enabled') === 'false') {
                return;
            }
            if(event.target.tagName === "BUTTON" && (event.target.classList.contains(HamburgerMenu.cssClasses.hamburgerMenuWidget.hamburgerMenuCloseNavButton) || event.target.classList.contains(HamburgerMenu.cssClasses.hamburgerMenuWidget.hamburgerMenuOpenNavButton)))  {
                const isExpanded = event.target.getAttribute('aria-expanded') === 'true';
                event.target.classList.toggle(HamburgerMenu.cssClasses.hamburgerMenuWidget.hamburgerMenuCloseNavButton);
                event.target.setAttribute('aria-expanded', !isExpanded);
                return;
            }
            const menuItems = document.querySelectorAll(HamburgerMenu.selectors.hamburgerMenuWidget.hamburgerMenu + ' li');
            const fieldModel = this.formContainer?.getModel().getElement(targetElement?.getAttribute('data-panel-id'));
            const elementID = this.#checkFirstNonPanel(fieldModel) || targetElement?.getAttribute('data-panel-id');
            
            const parentAnchorElement = targetElement?.querySelector('a');
            targetElement = menu.querySelector("[data-panel-id='"+ elementID + "']");
            this.#resetMenuItems(menuItems);
            this.#activateCurrentItem(targetElement);
            const anchorElement = targetElement?.querySelector('a');
            anchorElement?.classList.add(HamburgerMenu.cssClasses.active);
            anchorElement?.querySelector('button')?.classList?.toggle(HamburgerMenu.cssClasses.hamburgerMenuWidget.hamburgerMenuCloseNavButton);
            const isExpanded = anchorElement?.querySelector('button')?.getAttribute('aria-expanded') === 'true';
            anchorElement?.querySelector('button')?.setAttribute('aria-expanded', !isExpanded);
            this.#updateSelectedPanelTitle(anchorElement, parentAnchorElement);
            this.#highlightMenuTree(anchorElement, parentAnchorElement);

            this.formContainer.getModel().getElement('accordion-9fbafbc6e6');
    
            const itemId = targetElement?.getAttribute('data-panel-id') || HamburgerMenu.activeItemId;
            const form = this.formContainer?.getModel();
            const field = form?.getElement(itemId);
            menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
            this.#renderBreadCrumbs(menu);
            if (form && field) {
              form.setFocus(field);
            }
        }
    
        #resetMenuItems(menuItems) {
            menuItems.forEach(item => {
                const subMenu = item.querySelector(HamburgerMenu.selectors.hamburgerMenuWidget.hamburgerSubMenu);
                if (subMenu)  {
                    subMenu.style.display = 'none';
                    subMenu.setAttribute('aria-hidden', true);
                }
                const link = item.querySelector('a');
                if(link) {
                    link?.querySelector('button')?.classList.remove(HamburgerMenu.cssClasses.hamburgerMenuWidget.hamburgerMenuCloseNavButton);
                    link?.querySelector('button')?.classList.add(HamburgerMenu.cssClasses.hamburgerMenuWidget.hamburgerMenuOpenNavButton);
                    link?.classList.remove(HamburgerMenu.cssClasses.active, HamburgerMenu.cssClasses.activeParent);
                    link.style.fontWeight = 'normal';
                }
            });
        }
        
        #activateCurrentItem(currentItem) {
            while (currentItem) {
                const subMenu = currentItem.querySelector(HamburgerMenu.selectors.hamburgerMenuWidget.hamburgerSubMenu);
                if (subMenu)  {
                    subMenu.style.display = 'block';
                    subMenu.setAttribute('aria-hidden', false);
                }
                currentItem = currentItem.parentElement.closest('li');
            }
        }
    
        #menuItemClickHandler(event, subMenu, li, link) {
            event.preventDefault();
            if (li.getAttribute('data-panel-enabled') === 'false') {
                return;
            }
            const expanded = link.getAttribute('aria-expanded') === 'true';
            link.setAttribute('aria-expanded', !expanded);
            if (subMenu.style.display === 'flex' || subMenu.style.display === 'block') {
                subMenu.style.display = 'none';
                subMenu.setAttribute('aria-hidden', true);
            } else {
                subMenu.style.display = 'flex';
                subMenu.setAttribute('aria-hidden', false);
            }
        }
    
        #createDownArrowButton() {
            const downArrowButton = document.createElement('button');
            downArrowButton.type='button';
            downArrowButton.classList.add(HamburgerMenu.cssClasses.hamburgerMenuWidget.hamburgerMenuOpenNavButton);
            downArrowButton.setAttribute('aria-expanded', false);
            return downArrowButton;
        }
    
        #createHamburgerMenu(items, counter = 0) {
            if (counter >= HamburgerMenu.nestingSupport) {
                return;
            }
            if (!items?.length) return;
            const ul = document.createElement('ul');
            let activeItemTitleUpdated = false;
            items.forEach((item) => {
                if (item?.fieldType !== "panel") return;
    
                if (!activeItemTitleUpdated) {
                    const activeItemTitle = document.querySelector(HamburgerMenu.selectors.hamburgerMenuBottomContainer.hamburgerMenuActiveItemTitle);
                    if(activeItemTitle) {
                        activeItemTitle.innerText = item?.label?.value;
                        activeItemTitleUpdated = true;
                    }
                }
    
                const li = document.createElement('li');
                const link = document.createElement('a');
                link.setAttribute('role', 'menuitem');
                link.setAttribute('aria-expanded', 'false');
                const textSpan = document.createElement('span');
                textSpan.setAttribute('tabindex', "0");
                link.href = "#";
                textSpan.textContent = item?.label?.value;
                link.appendChild(textSpan);
                link.style.visibility = item?.label?.visible ? 'visible' : 'hidden';
                li.appendChild(link);
                
                li.setAttribute('data-panel-id', item?.id);
                li.setAttribute('data-panel-visible', item?.visible);
                li.setAttribute('data-panel-enabled', item?.enabled);
                const children = this.formContainer?.getModel()?.getElement(item.id)?._children;
                let flag = false;
    
                // setting an attibute(data-panel-has-input) if the item is having an input field
                if(children) {
                    for(let i = 0; i< children.length; i++) {
                        if(children[i].fieldType !== 'panel') {
                            flag = true;
                        }
                    }
                }
                if(flag) {
                    li.setAttribute('data-panel-has-input', flag);
                }
    
                link.classList.add(HamburgerMenu.cssClasses.hamburgerMenuWidget.hamburgerMenuNavLink);
                if (item?.repeatable) {
                    const subMenu = this.#createHamburgerMenu(item.items, counter + 1);
                    subMenu?.childNodes.forEach(child => ul.appendChild(child));
                } else if (Array.isArray(item.items) && item.items.length > 0) {
                    const subMenu = this.#createHamburgerMenu(item.items, counter + 1);
                    if (subMenu?.childNodes?.length) {
                        subMenu.classList.add(HamburgerMenu.cssClasses.hamburgerMenuWidget.hamburgerSubMenu);
                        li.appendChild(subMenu);
                        link.insertBefore(this.#createDownArrowButton(), link.firstChild);
                        link.addEventListener('click', (event) => {
                            this.#menuItemClickHandler(event, subMenu, li, link)
                        });
                        link.addEventListener('keydown', (event) => {
                            if(event.key === 'Enter' || event.key === ' ') {
                                this.#menuItemClickHandler(event, subMenu, li, link);
                            }
                        });
                    }
                }
                ul.appendChild(li);
            });
        
            return ul;
        }
    
        // Function to find the currently active li
        #findActiveLi() {
            return document.querySelector(HamburgerMenu.selectors.active).parentElement;
        }
    
        #highlightMenuTree(element, parentAnchorElement) {
            const closestLI = element?.closest('li');
            const clickedClosestLI = parentAnchorElement?.closest('li');
    
            const li = closestLI || clickedClosestLI;
        
            if (!li || li === document.body) {
                return;
            }
            let anchorElement = li?.querySelector('a');
    
            if(anchorElement) {
                anchorElement?.classList.add(HamburgerMenu.cssClasses.activeParent);
                anchorElement?.querySelector('button')?.classList.add(HamburgerMenu.cssClasses.hamburgerMenuWidget.hamburgerMenuCloseNavButton);
                if(anchorElement?.querySelector('button')?.classList.contains(HamburgerMenu.cssClasses.hamburgerMenuWidget.hamburgerMenuCloseNavButton)) {
                    anchorElement?.querySelector('button')?.setAttribute('aria-expanded', true);
                }
                if(li.parentElement.classList.contains(HamburgerMenu.cssClasses.hamburgerMenuWidget.hamburgerMenu)) {
                    anchorElement.style.fontWeight = 'bold'
                }
                this.#highlightMenuTree(li.parentElement);
            }
        }
    
        #isEligible(element, direction) {
            if (element && element?.getAttribute('data-panel-visible') === 'false' || element?.getAttribute('data-panel-enabled') === 'false' || (direction === 'prev' && element?.getAttribute('data-panel-has-input') !== 'true')) {
                return false;
            } else if (element && element.parentNode && element.parentNode !== document) {
                return this.#isEligible(element.parentNode);
            } else {
                return true;
            }
        }

        #moveTo(menuListItems, direction) {
            const currentActive = this.#findActiveLi();
            if (!currentActive) return;
        
            let newActiveItemIndex = -1;
            menuListItems.forEach((item, index) => {
                if (item.getAttribute('data-panel-id') === currentActive.getAttribute('data-panel-id')) {
                    newActiveItemIndex = direction === 'prev' ? index - 1 : index + 1;
                }
            });
        
            if (direction === 'prev' && newActiveItemIndex < 0) {
                newActiveItemIndex = menuListItems.length - 1;
            }
            while (!this.#isEligible(menuListItems[newActiveItemIndex], direction)) {
                if(direction === 'prev') {
                    newActiveItemIndex = (newActiveItemIndex - 1) % menuListItems.length;
                    if(newActiveItemIndex<=0) {
                        newActiveItemIndex = 0;
                        break;
                    }
                } else {
                    newActiveItemIndex = (newActiveItemIndex + 1) % menuListItems.length;
                }
            }
            const newActiveItem = menuListItems[newActiveItemIndex];
            HamburgerMenu.activeItemId = newActiveItem?.getAttribute('data-panel-id');
            newActiveItem?.click();
        }
    
        #movePrev(menuListItems) {
            this.#moveTo(menuListItems, 'prev');
        }
        
        #moveNext(menuListItems) {
            this.#moveTo(menuListItems, 'next');
        }
    
        #addEventsToNavigationButtons() {
            const previousNavButton = document.querySelector(HamburgerMenu.selectors.hamburgerMenuBottomContainer.hamburgerMenuPreviousNavButton);
            const nextNavButton = document.querySelector(HamburgerMenu.selectors.hamburgerMenuBottomContainer.hamburgerMenuNextNavButton);
            const menuListItems = document.querySelector(HamburgerMenu.selectors.hamburgerMenuWidget.hamburgerMenu).querySelectorAll('li');
            previousNavButton.addEventListener('click', () => this.#movePrev(menuListItems));
            nextNavButton.addEventListener('click', () => this.#moveNext(menuListItems));
        }
    
        #generateBreadcrumbs(breadcrumbs) {
            const container = document.createElement('nav');
            container.setAttribute('aria-label', 'Breadcrumb');
            const list = document.createElement('ul');
            list.style.listStyleType = 'none';
            list.style.padding = '0';
            list.style.margin = '0';
            if(breadcrumbs && breadcrumbs.length) {
                [...breadcrumbs].forEach((breadcrumb, index) => {
                    const listItem = document.createElement('li');
                    listItem.style.display = 'inline';
                    const span = document.createElement('span');
                    span.textContent = breadcrumb.innerText;
                    listItem.appendChild(span);
                    if (index < breadcrumbs.length - 1) {
                        const separator = document.createElement('span');
                        separator.textContent = ' > ';
                        separator.style.margin = '0 5px';
                        listItem.appendChild(separator);
                    }
                    if(index  ===  breadcrumbs?.length-1) {
                        listItem.style.fontWeight = 'bold';
                    }
                    list.appendChild(listItem);
                });
            }
            container.appendChild(list);
            return container;
        }
    
        #renderBreadCrumbs(menu) {
            const selectedPanels = menu.getElementsByClassName(HamburgerMenu.cssClasses.activeParent);
            const breadCrumbsContainer = document.querySelector(HamburgerMenu.selectors.hamburgerMenuMiddleContainer);
            breadCrumbsContainer.innerHTML = '';
            const breadCrumbs = this.#generateBreadcrumbs(selectedPanels)
            breadCrumbsContainer.appendChild(breadCrumbs);
            breadCrumbsContainer.scrollLeft = breadCrumbs.scrollWidth;
        }
    
        #renderHamburgerItems(panels) {
            const parentContainer = document.querySelector(HamburgerMenu.selectors.hamburgerMenuTopContainer.self);
            const hamburgerIcon = document.querySelector(HamburgerMenu.selectors.hamburgerMenuTopContainer.hamburgerMenuIcon);
            const hamburgerMenuIconContainer = document.querySelector(HamburgerMenu.selectors.hamburgerMenuTopContainer.hamburgerMenuIconContainer);
    
            const menu = this.#createHamburgerMenu(panels);
            if(menu) {
                menu.classList.add(HamburgerMenu.cssClasses.hamburgerMenuWidget.hamburgerMenu);
                menu.setAttribute('role', 'menu');
                menu.setAttribute('id', 'hamburger-menu');
    
                this.#attachHamburgerEventListeners(hamburgerIcon, menu);
                this.#attachOutsideClickHandler(hamburgerIcon, menu);
                this.#attachMenuEventListeners(menu);
                this.#styleSubmenuItems(menu);
                parentContainer.innerHTML='';
                parentContainer.appendChild(hamburgerMenuIconContainer);
                parentContainer.appendChild(menu);
    
                // Add events to navigation buttons
                this.#addEventsToNavigationButtons();
    
                 // Automatically click the first root list item if it exists
                const rootListItems = menu.querySelectorAll(HamburgerMenu.selectors.hamburgerMenuWidget.hamburgerMenu + ' > li');
                if (rootListItems[0] && rootListItems[0].tagName === 'LI') {
                    rootListItems[0].click();
                    menu.style.display = 'none';
                }
            }
        }
    
        #attachMenuEventListeners(menu) {
            menu.addEventListener('click', (event) => this.#clickHandler(event));
            menu.addEventListener('keydown', (event) => {
                if (event.key === 'Enter' || event.key === ' ') {
                  event.preventDefault();
                  this.#clickHandler(event);
                }
              });
            menu.addEventListener('ontouchstart', (event) => this.#clickHandler(event));
        }
    
        #attachHamburgerEventListeners(hamburgerIcon, menu) {
            const toggleMenuVisibility = () => {
                menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
            };
            hamburgerIcon?.addEventListener('click', toggleMenuVisibility);
            hamburgerIcon?.addEventListener('ontouchstart', toggleMenuVisibility);
        }
        
        #styleSubmenuItems(menu) {
            const rootListItems = menu.querySelectorAll(HamburgerMenu.selectors.hamburgerMenuWidget.hamburgerMenu + ' > li');
            rootListItems.forEach((item) => {
                let padding = 30;
                const submenus = item.querySelectorAll(HamburgerMenu.selectors.hamburgerMenuWidget.hamburgerSubMenu);
                submenus.forEach((submenu) => {
                    const links = submenu.querySelectorAll('a');
                    links.forEach((link) => {
                        if(link.querySelector('button')) {
                             link.style.paddingInlineStart = `${padding}px`;
                        } else {
                            link.style.paddingInlineStart = `${padding + 30}px`;
                        }
                    });
                    padding += 15;
                });
            });
        }
    
        #attachOutsideClickHandler(hamburger, menu) {
            window.addEventListener('click', (e) => {
                if (!hamburger.contains(e.target) && !menu.contains(e.target) && menu.style.display === 'flex') {
                    menu.style.display = 'none';
                }
            });
        }
    
        #getAllPanels() {
            let items = this.formContainer?._model.getItemsState() || [];
            const panels = items.filter(item => item?.fieldType ===  "panel");
            return panels;
        }
    
        init() {
            if(this.formContainer?.getModel()?.properties?.['fd:isHamburgerMenuEnabled']) {
                document.querySelector('.cmp-adaptiveform-container')?.setAttribute('data-cmp-hamburger-menu-enabled', 'true');
                const panels = this.#getAllPanels();
                this.#renderHamburgerItems(panels);
            }
        }
    }
}
/*******************************************************************************
 * Copyright 2024 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/

(function() {

    "use strict";
    class FormContainerV2 extends FormView.FormContainer {
        static NS = FormView.Constants.NS;
        static IS = "adaptiveFormContainer";
        static bemBlock = 'cmp-adaptiveform-container';
        static selectors  = {
            self: "[data-" + this.NS + '-is="' + this.IS + '"]',
        };
        static loadingClass = `${FormContainerV2.bemBlock}--loading`;
        #hamburgerMenuInstance = '';

        constructor(params) {
            super(params);
            let self = this;
            this.#hamburgerMenuInstance = new HamburgerMenu(this);
            this._model.subscribe((action) => {
                let state = action.target.getState();
                // execute the handler only if there are no rules configured on submitSuccess event.
                if (!state.events.submitSuccess || state.events.submitSuccess.length === 0) {
                    const globals = {
                        form: self.getModel().getRuleNode(),
                        event: {
                            type: action.type,
                            payload: action.payload,
                        }
                    };
                    FormView.customFunctions.defaultSubmitSuccessHandler(globals);
                }
            }, "submitSuccess");
            this._model.subscribe((action) => {
                let state = action.target.getState();
                // execute the handler only if there are no rules configured on submitError event.
                if (!state.events.submitError || state.events.submitError.length === 0) {
                    let defaultSubmissionError = FormView.LanguageUtils.getTranslatedString(self.getLang(), "InternalFormSubmissionError");
                    const globals = {
                        form: self.getModel().getRuleNode(),
                        event: {
                            type: action.type,
                            payload: action.payload,
                        }
                    };
                    FormView.customFunctions.defaultSubmitErrorHandler(defaultSubmissionError, globals);
                }
            }, "submitError");
            this._model.subscribe((action) => {
                let state = action.target.getState();
                // execute the handler only if there are no rules configured on custom:saveSuccess event.
                if (!state.events['custom:saveSuccess'] || state.events['custom:saveSuccess'].length === 0) {
                    console.log("Draft id = " + action?.payload?.body?.draftId);
                    window.alert(FormView.LanguageUtils.getTranslatedString(self.getLang(), "saveDraftSuccessMessage"));
                }
            }, "saveSuccess");
            this._model.subscribe((action) => {
                let state = action.target.getState();
                // execute the handler only if there are no rules configured on custom:saveError event.
                if (!state.events['custom:saveError'] || state.events['custom:saveError'].length === 0) {
                    window.alert(FormView.LanguageUtils.getTranslatedString(self.getLang(), "saveDraftErrorMessage"));
                }
            }, "saveError");
            this.#setupAutoSave(self.getModel());
        }

        initialiseHamburgerMenu() {
            this.#hamburgerMenuInstance.init();
        }

        /**
         * Register time based auto save
         * @param formModel.
         */
         #setupAutoSave(formModel) {
            const autoSaveProperties = formModel?.properties?.['fd:autoSave'];
            const enableAutoSave = this.#getAutoSaveAttribute();
            if (enableAutoSave) {
                const autoSaveStrategyType = autoSaveProperties['fd:autoSaveStrategyType'];
                const autoSaveInterval = autoSaveProperties['fd:autoSaveInterval'];
                const saveEndPoint = FormView.Utils.getContextPath() + '/adobe/forms/af/save/' + formModel.id;
                if (autoSaveStrategyType === 'time' && autoSaveInterval) {
                    console.log("Registering time based auto save");
                    setInterval(() => {
                        formModel.dispatch(new FormView.Actions.Save({
                            'action': saveEndPoint
                        }));
                    }, parseInt(autoSaveInterval) * 1000);
                }
            }
        }

        #getAutoSaveAttribute() {
            return this.getFormElement()?.getAttribute('data-cmp-auto-save') === 'true';
        }
    }

    async function onDocumentReady() {
        const startTime = new Date().getTime();
        let elements = document.querySelectorAll(FormContainerV2.selectors.self);

        for (let i = 0; i < elements.length; i++) {
            let loaderToAdd = document.querySelector("[data-cmp-adaptiveform-container-loader='"+ elements[i].id + "']");
            if(loaderToAdd){
                loaderToAdd.classList.add(FormContainerV2.loadingClass);
            }
            console.debug("Form loading started", elements[i].id);
        }
        function onInit(e) {
            let formContainer =  e.detail;
            let formEl = formContainer.getFormElement();
            formContainer.initialiseHamburgerMenu();
            setTimeout(() => {
                let loaderToRemove = document.querySelector("[data-cmp-adaptiveform-container-loader='"+ formEl.id + "']");
                if(loaderToRemove){
                    loaderToRemove.classList.remove(FormContainerV2.loadingClass);
                }
                const timeTaken = new Date().getTime() - startTime;
                console.debug("Form loading complete", formEl.id, timeTaken);
                }, 10);
        }
        document.addEventListener(FormView.Constants.FORM_CONTAINER_INITIALISED, onInit);
        await FormView.Utils.setupFormContainer(async ({
            _formJson, _prefillData, _path, _element
        }) => {
            let formContainer = new FormContainerV2({_formJson, _prefillData, _path, _element});
            // before initializing the form container load all the locale specific json resources
            // for runtime
            const formLanguage = formContainer.getLang();
            const aemLangUrl = `/etc.clientlibs/core/fd/af-clientlibs/core-forms-components-runtime-all/resources/i18n/${formLanguage}.json`;
            await FormView.LanguageUtils.loadLang(formLanguage, aemLangUrl, true);
            formContainer.subscribe();
            return formContainer;
        }, FormContainerV2.selectors.self, FormContainerV2.IS);
    }

    // This is to ensure that the there is no WCM Mode cookie when Form Container is rendered.
    // max-age=0 ensures that the cookie is deleted.
    document.cookie="wcmmode=disabled; max-age=0; path=/";
    
    if (document.readyState !== "loading") {
        onDocumentReady();
    } else {
        document.addEventListener("DOMContentLoaded", onDocumentReady);
    }
})();

/*******************************************************************************
 * Copyright 2023 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
(function() {

    "use strict";
    class Cache {

        store = {};

        put(el, key, value) {
            this.store[el.id ] = {};
            this.store[el.id][key] = value;
        }

        get(el, key) {
            return this.store[el.id][key];
        }
    }
    window.afCache = new Cache();
})();

/*******************************************************************************
 * Copyright 2022 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
(function() {

    "use strict";
    class DatePicker extends FormView.FormFieldBase {

        static NS = FormView.Constants.NS;
        static IS = "adaptiveFormDatePicker";
        static bemBlock = 'cmp-adaptiveform-datepicker';
        static selectors  = {
            self: "[data-" + this.NS + '-is="' + this.IS + '"]',
            widget: `.${DatePicker.bemBlock}__widget`,
            label: `.${DatePicker.bemBlock}__label`,
            description: `.${DatePicker.bemBlock}__longdescription`,
            qm: `.${DatePicker.bemBlock}__questionmark`,
            errorDiv: `.${DatePicker.bemBlock}__errormessage`,
            tooltipDiv: `.${DatePicker.bemBlock}__shortdescription`
        };

        constructor(params) {
            super(params);
        }

        getWidget() {
            return this.element.querySelector(DatePicker.selectors.widget);
        }

        getDescription() {
            return this.element.querySelector(DatePicker.selectors.description);
        }

        getLabel() {
            return this.element.querySelector(DatePicker.selectors.label);
        }

        getErrorDiv() {
            return this.element.querySelector(DatePicker.selectors.errorDiv);
        }

        getQuestionMarkDiv() {
            return this.element.querySelector(DatePicker.selectors.qm);
        }

        getTooltipDiv() {
            return this.element.querySelector(DatePicker.selectors.tooltipDiv);
        }

        updateValue(value) {
            if (this.widgetObject) {
                if (this.isActive()) {
                    // Replacing undefined / null with empty string on reset
                    this.widgetObject.setValue(value || '');
                } else {
                    // Replacing undefined / null with empty string on reset
                    this.widgetObject.setDisplayValue(value || '');
                }
            } else {
                // Replacing undefined / null with empty string on reset
                super.updateValue(value || '');
            }
        }

        updateReadOnly(readOnly, state) {
            super.updateReadOnly(readOnly, state);
            if (this.widgetObject != null) {
                this.widgetObject.markAsReadOnly(readOnly);
            }
        }


        setModel(model) {
            super.setModel(model);
            if (!this.#noFormats()) {
                if (this.widgetObject == null) {
                    this.widgetObject = new DatePickerWidget(this, this.getWidget(), model);
                }
                if (this.isActive()) {
                    this.widgetObject.setValue(model.value);
                } else {
                    this.widgetObject.setDisplayValue(model.value);
                }
                this.widgetObject.addEventListener('blur', (e) => {
                    this.setModelValue(this.widgetObject.getValue())
                    //setDisplayValue is required for cases where value remains same while focussing in and out.
                    this.widgetObject.setDisplayValue(this._model.value);
                    this.widgetObject.setCalendarWidgetValue(this._model.value);
                    this.setInactive();
                    this.triggerExit();
                }, this.getWidget());
                this.widgetObject.addEventListener('focus', (e) => {
                    this.widgetObject.setValue(e.target.value);
                    this.setActive();
                    this.triggerEnter();
                }, this.getWidget());
                this.widgetObject.addEventListener('input', (e) => {
                    if( e.target.value === '') {
                        // clear the value if user manually empties the value in date input box
                        this.setModelValue("");
                    }
                }, this.getWidget());
            } else {
                if (this.widget.value !== '') {
                    this.setModelValue(this.widget.value);
                }
                this.widget.addEventListener('blur', (e) => {
                    this.setModelValue(e.target.value);
                    this.setInactive();
                    this.triggerExit();
                });
                this.widget.addEventListener('focus', (e) => {
                    this.setActive();
                    this.triggerEnter();
                });
            }
        }

        #noFormats() {
            return (this._model.editFormat == null || this._model.editFormat === 'date|short') &&
                (this._model.displayFormat == null || this._model.displayFormat === 'date|short') && (this._model.displayValueExpression == null)
        }
    }

    FormView.Utils.setupField(({element, formContainer}) => {
        return new DatePicker({element, formContainer})
    }, DatePicker.selectors.self);
})();

/*******************************************************************************
 * Copyright 2023 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/

if (typeof window.DatePickerWidget === 'undefined') {

  window.DatePickerWidget = class {

    #widget = null;
    #model = null // passed by reference
    #options = null

    #lang = "en";

    #dp = null;
    #curInstance = null;
    #calendarIcon = null;
    #documentTouchListener = null;
    static #visible = false;
    static #clickedWindow;

    /** default configuration options
     *
     * yearsPerView: number of years to show in the yearset view
     *
     * width: with of the widget
     *
     * viewHeight: Height of the month,year and yearset view. This doesn't include
     *             the height of the header
     *
     * locale: locale information for the locale in which to show the datepicker which comprises of
     *        days: day names to display in the monthview
     *        months: month names to display in the yearview
     *        zero: string representation of zero in the locale. Numbers will be
     *              displayed in that locale only
     *        clearText: Text to display for the reset button
     *        name: name of the locale
     *
     * format: input format for the datepicker (not implemented)
     *
     * pickerType: type of the datetimepicker (date, datetime and time)
     *
     * positioning: element around which datepicker will be displayed. if null then it
     *              will be displayed around the input element
     *
     * showCalendarIcon: to show the Calendar on the right of the text field or not
     */
    #defaultOptions = {
      yearsPerView: 16,
      width: 340,
      viewHeight: 248,
      locale: {
        days: ["S","M","T","W","T","F","S"],
        months: ["January","February","March","April","May","June","July","August","September","October","November","December"],
        zero: "0",
        clearText: "Clear",
        name: "en_US"
      },
      format: "YYYY-MM-DD",
      pickerType: "date",
      positioning: null,
      showCalendarIcon: true
    }

    #dates = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31]
    /*
     *  Actions to perform when clicked on the datepicker buttons
     *  for different views
     *  caption: view to show when clicked on caption
     *           (Year/YearSet/Month/null) null means don't change the view
     *  li: view to show when clicked on date, month or year element
     *  upDown: add(up key) or subtract(down key) current date (for monthview),
     *          month(Year View) or year(YearSetView) with the number provided
     *  key: identifies the key that needs to be changed for that view
     */
    #viewAction = {
      Month: {
        caption: 'Year',
        li: null,
        key: "day",
        upDown: 7
      },
      Year: {
        caption: "Yearset",
        li: "Month",
        key: "month",
        upDown: 3
      },
      Yearset: {
        caption: null,
        li: "Year",
        key: "year",
        upDown: 4
      }
    }

    selectedDay = 0;
    selectedMonth = 0;
    selectedYear = 0;
    currentDay = 0;
    currentMonth = 0;
    currentYear = 0;
    //view="Month";
    #touchSupported = !!("ontouchstart" in window || window.DocumentTouch
        && document instanceof DocumentTouch);
    #defaultView = "Month";
    #keysEnabled = false;
    #focusedOnLi = false;
    #keyboardAccessibility = true;
    #scriptFocus;

    /* template for the clear Button */
    #clearButtonTemplate = '<div class="dp-clear">' +
        '<a></a>' +
        '</div>';

    /* template for the calendar
    * header contains the navigation icons (left and right arrows)
    * and the current caption (which can be date, year or month)
    *
    * monthview displays the grid for showing the dates for a particular
    * month
    *
    * yearview displays all the months of that year
    *
    * yearsetview displays a grid of 16 years. This can be configured
    * through the option: yearsPerView
    *
    */
    #calendarTemplate = '<div class="dp-header">' +
        '<div class="dp-leftnav"></div>' +
        '<div class="dp-caption"></div>' +
        '<div class="dp-rightnav"></div>' +
        '</div>' +
        '<div class="view dp-monthview"></div>' +
        '<div class="view dp-yearview"></div>' +
        '<div class="view dp-yearsetview"></div>';

    constructor(view, widget, model) {
      this.#model = model;
      this.#lang = view.getModel().lang;
      let editValFn = () => {
        return model.editValue;
      };
      let displayValueFn = () => {
        return model.displayValue;
      };
      this.#localizeDateElements(this.#defaultOptions, this.#lang);
      this.#options = Object.assign(
          {editValue: editValFn, displayValue: displayValueFn},
          this.#defaultOptions, this.#model._jsonModel);

      this.#initialiseCalenderElement();

      //update widget markup to have input type=text element.
      let newDatePickerElement = widget.cloneNode(true);
      newDatePickerElement.setAttribute("type", "text");
      newDatePickerElement.id = model.id + '-widget';

      widget.parentNode.replaceChild(newDatePickerElement, widget);
      this.#widget = view.getWidget();
      this.#attachField(view.getWidget(), this.#options);
    }

    #initialiseCalenderElement() {
      let self = this,
          html = "";
      if (this.#options.pickerType.match(/date/)) {
        html += this.#calendarTemplate;
      }
      html += this.#clearButtonTemplate;

      if (!this.#dp) {
        this.#dp = document.createElement("div");
        this.#dp.classList.add("datetimepicker", "datePickerTarget");
        this.#dp.innerHTML = html;
        //Always inserting it in body
        document.body.appendChild(this.#dp);
      }
      // attach click event on entire datePicker popup
      this.#dp.addEventListener("click",
          function (evnt) {
            //focus only if the device doesn't support touch
            // input otherwise on screen keyboard will popup
            if (!self.#touchSupported) {
              if (self.#curInstance) {
                self.#curInstance.$field.focus();
              }
            }
          }, false);
      "touchstart mousedown".split(" ").forEach(function (e) {
        self.#dp.addEventListener(e, function (evt) {
          self.#checkWindowClicked(evt)
        }, false);
      });

      this.$month = this.#dp.getElementsByClassName("dp-monthview")[0];
      this.$year = this.#dp.getElementsByClassName("dp-yearview")[0];
      this.$yearset = this.#dp.getElementsByClassName("dp-yearsetview")[0];

      this.clear = this.#dp.getElementsByClassName(
          "dp-clear")[0].getElementsByTagName("a")[0];
      this.clear.addEventListener("click", function (evnt) {
        if (self.view && self.#curInstance) {
          self.#clearDate(self.view);
        }
      });
      this.prevNavWidthBtn = this.#dp.getElementsByClassName("dp-leftnav")[0];
      this.prevNavWidthBtn.addEventListener("click",
          function (evnt) {
            if (self.view && self.#curInstance) {
              self.#adjustDate(-1, self.view, false)
            }
          });
      this.nextNavWidthBtn = this.#dp.getElementsByClassName("dp-rightnav")[0];
      this.nextNavWidthBtn.addEventListener("click",
          function (evnt) {
            if (self.view && self.#curInstance) {
              self.#adjustDate(1, self.view, false)
            }
          });
      this.caption = this.#dp.getElementsByClassName("dp-caption")[0];
      this.caption.addEventListener("click",
          function (evnt) {
            if (self.view && self.#curInstance) {
              if (!self.caption.classList.contains("disabled")) {
                self.#layout(self.#viewAction[self.view].caption);
              }
            }
          });
      if (this.#keyboardAccessibility) {
        [this.prevNavWidthBtn, this.caption, this.nextNavWidthBtn,
          this.clear].forEach(function (elem, i) {
          elem.setAttribute("tabIndex", i + 1);
        });
      }

    }

    /*
     * attaches the date picker to the field. This is a one time operation
     * First creates a configuration object and stores it in the field data attributes
     * then attaches event handlers on click, focus (to show the picker) and blur (to hide) events
     */
    #attachField(widget, options) {
      let inst = this.#newInst(widget, options),
          self = this,
          activateField = function (evnt) {
            if (!self.#curInstance) {
              self.#activateField(evnt);
            }

            if (self.#options.showCalendarIcon) {
              if (evnt.type === self.#getEvent()) {
                if (self._iconClicked) {
                  self._iconClicked = false;
                  if (DatePickerWidget.#visible) {
                    self.#hide(); // hide the calendar popup if visible when calendar icon is clicked
                    self.#curInstance.$field.focus(); // bring back focus in field
                  } else {
                    self.#show(); //// show the calendar popup if not visible when calendar icon is clicked
                  }
                }
              }
            } else {
              /*show the popup only if
               1. click/touch event
               2. focus event in case of non-touch devices and focus is not done using script
               */
              if (evnt.type === self.#getEvent() || (evnt.type === "focus"
                  && !self.#touchSupported && !self.#scriptFocus)) {
                self.#show(evnt);
              }
            }

            DatePickerWidget.#clickedWindow = true;
            self.#scriptFocus = false;
          },
          deactivateField = function (evnt) {
            //deactivate only if clicked outside window
            // on touch devices only keyboard or calendar should be active at once, touching keyboard should deactivate calendar
            if ((DatePickerWidget.#clickedWindow && !self.#focusedOnLi)
                && (self.#options.showCalendarIcon || !self.#touchSupported)) {
              self.#hide();
              self.#deactivateField();
              DatePickerWidget.#clickedWindow = true;
            }
          };

      window.afCache.put(widget, "datetimepicker", inst);

      widget.addEventListener(this.#getEvent(), activateField);
      widget.onfocus = activateField;
      widget.onblur = deactivateField;

      if (options.showCalendarIcon) {
        let existingCalendarIcons = widget.parentNode.querySelectorAll('.cmp-adaptiveform-datepicker__calendar-icon');
        existingCalendarIcons.forEach(icon => icon.remove());

        let calendarIcon = document.createElement("div");
        calendarIcon.classList.add("cmp-adaptiveform-datepicker__calendar-icon");

        widget.parentNode.insertBefore(calendarIcon, widget.nextSibling);

        if (this.#keyboardAccessibility) {
          calendarIcon.setAttribute("tabindex", 0);
        }
        calendarIcon.addEventListener(this.#getEvent(), function (evnt) {
          self._iconClicked = true;
          widget.click();
        });
        calendarIcon.addEventListener("keydown", function (event) {
          if (event.keyCode === 32 || event.keyCode === 13) {
            event.preventDefault();
            event.stopPropagation();
            self._iconClicked = true;
            widget.click();
          }
        });
        this.#calendarIcon = calendarIcon;
        if (options.readOnly) {
          this.markAsReadOnly(true)
        }
      }
    }

    markAsReadOnly(readonly) {
      if (readonly) {
        this.#calendarIcon.style.display = "none";
      } else {
        this.#calendarIcon.style.display = "";
      }
    }

    #newInst(widget, options) {
      return {
        $field: widget,
        locale: options.locale,
        positioning: options.positioning || widget,
        access: options.access,
        selectedDate: options.value,
        editValue: options.editValue,
        displayValue: options.displayValue,
        minValidDate: options.minimum,
        maxValidDate: options.maximum,
        exclMinDate: options.exclusiveMinimum,
        exclMaxDate: options.exclusiveMaximum
      }
    }

    /*
     * To check where the click happened, if happened outside the datepicker
     * then hide the picker. This is checked whether any ancestor of clicked target
     * has a class datePickerTarget. This class is added to the attached element as well
     */
    #checkWindowClicked(evnt) {
      let self = this;
      if (self.#curInstance) {
        // datepickerTarget class depicts that the component is a part of the Date Field
        // and on click of that class, we should not hide the datepicker or fire exit events.
        if (!evnt.target.closest(".datePickerTarget")) {
          //non-touch devices do not deactivate on blur. Hence needs to be done here
          if (self.#touchSupported) {
            self.#hide();
            //clicking outside a field doesn't blur the field in IPad. Doing it by script
            self.#curInstance.$field.blur();
            self.#deactivateField();
          } else {
            DatePickerWidget.#clickedWindow = true;
          }
        } else {
          DatePickerWidget.#clickedWindow = false;
        }
      }
    }

    /*
     * handling of key strokes. All the key strokes prevent the default browser action
     * unless specified otherwise
     * tab: set focus on calendar icon when dateinput field is active, navigates through date picker buttons when datepicker is open,
     * otherwise perform default browser action
     * escape: hides the datepicker
     * down arrow key: navigate the picker downwards by the number specified in actionView.upDown of the current View
     * up arrow key: navigate the picker upwards by the number specified in actionView.upDown of the current View
     * left arrow key: navigate the picker one unit of that view backward
     * right arrow key: navigate the picker one unit of that view forward
     * shift + up: perform the action that happens on clicking the caption (as specified in actionView.caption)
     * shift + left: perform the action that happens on clicking the left navigation button
     * shift + right: perform the action that happens on clicking the right navigation button
     * space/enter: triggers the click event for the current focused element from datepicker/ opens datepicker when calendar icon is focused.
     */
    #hotKeys(evnt) {
      var handled = false, date;
      switch (evnt.keyCode) {
        case 9: //tab
          // CQ-4239352 : Setting clickedWindow property to true on tabbing so that deactivateField logic gets executed
          // When clicking on "x" on input field in in IE and when selecting the content and releasing the mouse select outside the field
          // the click event is not trigerred on the field and hence activateField is not executed, so clickedWindow remains as false
          DatePickerWidget.#clickedWindow = true;
          handled = false;
          break;
        case 27://escape
          if (DatePickerWidget.#visible) {
            this.#hide();
            this.#curInstance.$field.focus();
            this.#deactivateField();
            handled = true;
          }
          break;
        case 32: //space
        case 13: // enter
          if (evnt.target.classList.contains("cmp-adaptiveform-datepicker__calendar-icon")) {
            if (!DatePickerWidget.#visible) {
              this.#show();
              handled = true;
            } else {
              this.$focusedDate.classList.add("dp-focus");
              handled = true;
            }
          }
          break;
        case 40: //down arrow key
          if (!DatePickerWidget.#visible) {
            this.#show();
            return;
          }
          this.$focusedDate.classList.add("dp-focus");
          break;
      }

      if (DatePickerWidget.#visible && this.#keysEnabled) {
        var v = this.#viewAction[this.view].key,
            updown = this.#viewAction[this.view].upDown;
        switch (evnt.keyCode) {
          case 9: // tab
            if (evnt.shiftKey) {
              if (evnt.target.classList.contains("dp-leftnav")
                  || evnt.target.classList.contains("dp-focus")) {
                this.#hide();
                this.#curInstance.$field.focus();
                handled = true;
              } else {
                handled = false;
              }
            } else {
              const buttonTabindex = evnt.target.getAttribute("tabindex");
              if (buttonTabindex === '0') {
                if (evnt.target.tagName.toLocaleLowerCase() === "input") {
                  this.#hide();
                  handled = false;
                } else {
                  this.prevNavWidthBtn.focus();
                  handled = true;
                }
              } else if (buttonTabindex === '4') {
                this.#hide();
                this.#curInstance.$field.focus();
                handled = true;
              } else {
                handled = false;
              }
            }
            break;
          case 32: //select on space
          case 13: // select on enter
            this.hotKeyPressed = true;
            this.#focusedOnLi = false;
            if (!this.#focusedOnLi) {
              evnt.target.click();
            } else {
              if (this.$focusedDate) {
                this.$focusedDate.click() //todo
              }
            }
            this.hotKeyPressed = false;
            handled = true;
            break;
          case 37: //left arrow key
            if (evnt.shiftKey) {
              this.prevNavWidthBtn.click();
            } else {
              this.#adjustDate(-1, v, true);
            }
            handled = true;
            break;
          case 38: //up arrow key
            if (evnt.shiftKey) {
              this.caption.click();
            } else {
              this.#adjustDate(-updown, v, true);
            }
            handled = true;
            break;
          case 39: //right arrow key
            if (evnt.shiftKey) {
              this.nextNavWidthBtn.click();
            } else {
              this.#adjustDate(+1, v, true);
            }
            handled = true;
            break;
          case 40: //down arrow key
            this.#adjustDate(updown, v, true);
            handled = true;
            break;
          default:
        }
      }
      if (handled) {
        evnt.preventDefault();
      }
    }

    /*
     * show the datepicker. //TODO: migrate this to vanilla js
     */
    #show() {
      this.#options.locale = this.#curInstance.locale;
      if (!DatePickerWidget.#visible) {
        let date  = new Date(),
            validDate,
            parsedDate;
        if (this.#curInstance.selectedDate) {
          validDate = this.#curInstance.selectedDate;
        } else if (this.#model.valid) {
          validDate = this.#model.value;
        }
        if (validDate) {
          parsedDate = validDate ? new Date(validDate) : null;
          date = (parsedDate == null || parsedDate == 'Invalid Date') ? date : parsedDate;
        }
        const timezoneOffset = date.getTimezoneOffset();
        date.setMinutes(date.getMinutes() + timezoneOffset);
        this.selectedDay = this.currentDay = date.getDate();
        this.selectedMonth = this.currentMonth = date.getMonth();
        this.selectedYear = this.currentYear = date.getFullYear();
        this.maxValidDate = this.#options.maximum ? new Date(
            this.#curInstance.maxValidDate) : null;
        this.minValidDate = this.#options.minimum ? new Date(
            this.#curInstance.minValidDate) : null;
        this.exclMaxDate = this.#curInstance.exclMaxDate;
        this.exclMinDate = this.#curInstance.exclMinDate;
        this.#dp.getElementsByClassName("dp-clear")[0].getElementsByTagName(
            "a")[0].innerText = this.#options.locale.clearText;
        this.#layout(this.#defaultView);
        this.#dp.style.display = "flex";
        this.#focusedOnLi = false;
        DatePickerWidget.#visible = true;
        this.#position();
        
        // Add document touch listener for mobile to close datepicker when tapping outside
        if (this.#touchSupported && !this.#documentTouchListener) {
          this.#documentTouchListener = (evt) => {
            if (DatePickerWidget.#visible && this.#curInstance) {
              this.#checkWindowClicked(evt);
            }
          };
          document.addEventListener("touchstart", this.#documentTouchListener, false);
        }
        
        if (this.#options.showCalendarIcon) {
          this.#curInstance.$field.setAttribute('readonly', true);    // when the datepicker is active, deactivate the field
        }
      }

      //   Disabling the focus on ipad  due to a bug where value of
      // date picker is not being set
      // Removing this code will only hamper one use case
      // where on ipad if you click on the calander then
      // the field becomes read only so
      // there is no indication where the current focus is
      // And  if you remove this foucs code all together
      // then what happens is that on desktop MF in iframe the exit event
      // is not getting called hence calander getting remained open even
      // when you click somewhere on window or focus into some other field
      if (this.#options.showCalendarIcon && !this.#touchSupported) {
        this.#curInstance.$field.focus(); // field loses focus after being marked readonly, causing blur event not to be fired later
      }
    }

    /*
     * position the datepicker around the positioning element //TODO: migrate this to vanilla js
     * provided in the options
     */
    #position() {
      let $elem = this.#curInstance.positioning,
          windowScrollX = window.scrollX,
          windowScrollY = window.scrollY,
          windowInnerHeight = window.innerHeight,
          windowInnerWidth = window.innerWidth,
          inputRect = $elem.getBoundingClientRect(),
          height = $elem.offsetHeight,
          top = this.#getOffset($elem).top + height,
          left = this.#getOffset($elem).left,
          styles = {"top": (top + "px"), "left": (left + "px")},
          diffBottom = top + this.#dp.offsetHeight - windowInnerHeight - windowScrollY, //this.#dp.offsetHeight is the widget's height
          newLeft,
          newTop;
      if (diffBottom > 0) {
        //can't appear at the bottom
        //check top
        newTop = top - height - this.#dp.offsetHeight - 20;
        if (newTop < windowScrollY) {
          //can't appear at the top as well ... the datePicker pop up overlaps the date field
          newTop = top - diffBottom;
        }
        styles.top = newTop + "px";
      }
      if (left + this.#dp.offsetWidth > windowScrollX + windowInnerWidth) {
        //align with the right edge
        newLeft = windowScrollX + windowInnerWidth - this.#dp.offsetWidth - 20;
        styles.left = newLeft + "px";
      }
      this.#dp.style.top = styles.top;
      this.#dp.style.left = styles.left;
      const localeObj = new Intl.Locale(this.#lang);
      if(localeObj?.textInfo?.direction == "rtl") {
        let right = windowInnerWidth - (left + inputRect.width); // Calculate right offset
        if (right + this.#dp.offsetWidth > windowInnerWidth) { // this.#dp.offsetWidth is the widget's width
          // Align with the right edge of the viewport
          right = windowScrollX + windowInnerWidth - this.#dp.offsetWidth - 20; // Adjust with a 20px margin
      }
        this.#dp.style.right = right + "px";
        this.#dp.style.left = "unset"
      }
      return this;
    }

    #getOffset(elem) {
      let box = elem.getBoundingClientRect();
      return {
        top: box.top + window.scrollY,
        left: box.left + window.scrollX
      };
    }

    /*
     * layout the nextView. if nextView is null return
     *
     */
    #layout(nextView) {
      if (nextView == null) {
        this.#hide();
      } else {
        if (this.view) {
          this['$' + this.view.toLowerCase()].style.display = "none";
        }
        this.view = nextView;
        this.caption.classList.toggle("disabled",
            !this.#viewAction[this.view].caption);
        this['$' + this.view.toLowerCase()].style.display = "block";
        this["show" + this.view]();
      }
      return this;
    }

    /*
     * show the month view
     */
    showMonth() {
      var self = this,
          curDate = new Date(this.currentYear, this.currentMonth),
          maxDay = this.#maxDate(this.currentMonth),
          prevMaxDay = this.#maxDate((this.currentMonth + 11) % 12),
          day1 = new Date(this.currentYear, this.currentMonth, 1).getDay(),
          data, display;
          var localizedYear = this.#getLocalizedYear(curDate);

      this.#tabulateView(
          {
            caption: this.#options.locale.months[this.currentMonth] + ", "
                + this.#convertNumberToLocale(localizedYear),
            header: this.#options.locale.days,
            numRows: 7,
            numColumns: 7,
            elementAt: function (row, col) {
              var day = (row - 1) * 7 + col - day1 + 1;
              var monthVal = self.currentMonth + 1;
              let gridId = "day-" + day;
              display = self.#convertNumberToLocale(day);
              data = day;
              if (day < 1) {
                display = self.#convertNumberToLocale(prevMaxDay + day);
                data = -1;
                monthVal = self.currentMonth;
              } else if (day > maxDay) {
                display = self.#convertNumberToLocale(day - maxDay);
                data = -1;
                monthVal = self.currentMonth + 2;
              } else {
                curDate.setDate(day);
                // check if the currentdate is valid based on max and min valid date
                if (self.#compareVal(curDate, self.maxValidDate,
                    self.exclMaxDate) || self.#compareVal(self.minValidDate,
                    curDate, self.exclMinDate)) {
                  data = -1;
                }
              }
              return {
                data: data,
                gridId: gridId,
                display: display,
                ariaLabel: self.#options.editValue(
                    self.currentYear + "-" + self.#pad2(monthVal)
                    + "-" + self.#pad2(display))
              };
            }
          });
    }

    /**
     * returns boolean based on val1, val2, checkEqual
     * For comparing date, use date object
     */
    #compareVal(val1, val2, checkEqual) {
      if (!val1 || !val2) {
        return false;
      }

      if (checkEqual) {
        return val1 >= val2;
      } else {
        return val1 > val2;
      }
    }

    /*
     * show the year view
     */
    showYear() {
      var self = this,
          minDate = this.minValidDate ? new Date(
                  this.minValidDate.getFullYear(), this.minValidDate.getMonth())
              : null,
          maxDate = this.maxValidDate ? new Date(
                  this.maxValidDate.getFullYear(), this.maxValidDate.getMonth())
              : null,
          curDate = new Date(this.currentYear, 0), //can't omit month, if only one param present it is treated as millisecond
          data,
          month;
          var localizedYear = this.#getLocalizedYear(curDate);
      this.#tabulateView(
          {
            caption: this.#convertNumberToLocale(localizedYear),
            numRows: 4,
            numColumns: 3,
            elementAt: function (row, col) {
              data = month = row * 3 + col;
              let gridId = "month-" + data;
              curDate.setMonth(month);
              if ((minDate && curDate < minDate) || (maxDate && curDate
                  > maxDate)) {
                data = -1;
              }
              return {
                data: data,
                gridId: gridId,
                display: self.#options.locale.months[month],
                ariaLabel: self.#options.locale.months[month] + " "
                    + self.currentYear
              };
            }
          });
    }

    #getLocalizedYear(date) {
      /*
      // Only Thai language return year according to Buddhist calendar, rest all languages follows gregorian calendar in practice.
      // The Buddhist Year in 2024 = 543 + 2024  = B.E. 2567 (reference https://wesak.org.my/calculating-b-e/)
      // Intl.DateTimeFormat#formatToParts returns number (2024) for all languages except for Thai (2567) & for Persian ('')
      // For Persian (''), returned year is not in numbers that is breaking next flow.
      */
      if(this.#lang === 'th') {
        const dateFormat = new Intl.DateTimeFormat(this.#lang, {
          year: 'numeric'
        });
        const dateParts = dateFormat.formatToParts(date);
        const yearObject = dateParts.find(yearObject => yearObject.type === "year");
        const localizedYear = yearObject.value;
        return Number(localizedYear);
      }
      else {
        return Number(date.getFullYear());
      }
    }

    /*
     * show the year set view
     */
    showYearset() {
      var year,
          minDate = this.minValidDate ? new Date(
              this.minValidDate.getFullYear(), 0) : null,
          maxDate = this.maxValidDate ? new Date(
              this.maxValidDate.getFullYear() + 1, 0) : null,
          curDate = new Date(),
          data,
          self = this;
      var localizedYear = this.#getLocalizedYear(new Date(this.currentYear, 0)),
          localizedYearSet = this.#getLocalizedYear(new Date(self.currentYear, 0));

      this.#tabulateView(
          {
            caption: this.#convertNumberToLocale(
                    localizedYear - this.#options.yearsPerView / 2) + "-"
                + this.#convertNumberToLocale(
                    localizedYear - this.#options.yearsPerView / 2
                    + this.#options.yearsPerView - 1),
            numRows: 4,
            numColumns: 4,
            elementAt: function (row, col) {
              data = year = localizedYearSet - 8 + (row * 4 + col);
              let gridId = "year-" + data;
              curDate.setFullYear(year);
              if ((minDate && curDate < minDate) || (maxDate && curDate
                  > maxDate)) {
                data = -1;
              }
              return {
                "data": data,
                "gridId": gridId,
                "display": self.#convertNumberToLocale(year),
                ariaLabel: year
              };
            }
          });
    }

    insertRow(rowNum, rowArray, isHeader, elementAt) {
      let $view = this["$" + this.view.toLowerCase()],
          $row = $view.getElementsByTagName("ul")[rowNum],
          items, $li, element, $tmp,
          self = this;
      if (!$row) {
        let rowEl = document.createElement("ul");
        rowEl.removeAttribute("aria-label");
        rowEl.classList.toggle("header", isHeader);
        $row = $view.appendChild(rowEl);
      }
      items = $row.getElementsByTagName("li").length;
      while (items++ < rowArray.length) {
        let listItemEl = document.createElement("li");
        listItemEl.id = "li-" + elementAt(rowNum, items).gridId;
        $tmp = $row.appendChild(listItemEl);
        if (!isHeader) {
          let cb = function (evnt) {
            self.#selectDate(evnt);
          };
          $tmp.addEventListener("click", cb);
        }
      }

      rowArray.forEach(function (el, index) {
        $li = $row.getElementsByTagName("li")[index];
        if (isHeader) {
          $li.innerText = rowArray[index];
        } else {
          element = rowArray[index];
          window.afCache.put($li, "value", element.data);
          if (self.#checkDateIsFocussed(element.data)) {
            if (self.$focusedDate) {
              self.$focusedDate.classList.remove("dp-focus");
              self.$focusedDate.setAttribute("tabindex", "-1");
            }
            self.$focusedDate = $li;
            if (self.#keysEnabled) {
              self.$focusedDate.classList.add("dp-focus")
            }
          }
          $li.setAttribute("title", element.ariaLabel);
          $li.setAttribute("aria-label", element.ariaLabel);
          $li.setAttribute("tabindex", -1);
          $li.classList.toggle("dp-selected",
              self.#checkDateIsSelected(element.data));
          $li.classList.toggle("disabled", element.data === -1);
          $li.innerText = element.display;
        }
      });
      return $row;
    }

    /*
     * creates a tabular view based on the options provided. The options that can be passed are
     * numRows: number of rows that needs rendering
     * numCols: number of columns that needs rendering
     * caption: text for the datepickers caption element
     * header: an array of elements that identifies the header row
     * elementAt: a function(row, column) that returns an object (data: <data>, display: <display>) where
     *            <data> is the value to set for that view when the element at (row,column) is clicked and
     *            <display> is the value that will be visible to the user
     */
    #tabulateView(options) {
      var r = 0, rows = 0,
          row = [],
          c;
      this.caption.innerHTML = options.caption;
      if (options.header) {
        this.insertRow(r++, options.header, true, options.elementAt);
      }
      while (r < options.numRows) {
        c = 0;
        while (c < options.numColumns) {
          row[c] = options.elementAt(r, c);
          c++;
        }
        this.insertRow(r++, row, false, options.elementAt);
      }
    }

    #hotKeysCallBack = this.#hotKeys.bind(this);

    #activateField(evnt) {
      let self = this;
      this.#curInstance = window.afCache.get(evnt.target, "datetimepicker");
      // Issue LC-7049:
      // datepickerTarget should be added when activate the field and should be removed
      // after the fields gets deactivated.
      if (this.#options.showCalendarIcon) {
        this.#curInstance.$field.parentNode.classList.add("datePickerTarget");
      }
      //enable hot keys only for non touch devices
      if (!this.#touchSupported && !this.#keysEnabled) {
        document.addEventListener("keydown", self.#hotKeysCallBack);
        this.#keysEnabled = true;
      }
    }

    #deactivateField() {
      let self = this;
      if (self.#curInstance) {
        if (this.#keysEnabled) {
          document.removeEventListener("keydown", self.#hotKeysCallBack);
          this.#keysEnabled = false;
        }
        // Remove document touch listener if it exists
        if (this.#documentTouchListener) {
          document.removeEventListener("touchstart", this.#documentTouchListener);
          this.#documentTouchListener = null;
        }
        // Issue LC-7049:
        // datepickerTarget should be added when activate the field and should be removed
        // after the fields gets deactivated. Otherwise clicking on any other datefield
        // will not hide the existing datepicker
        if (this.#options.showCalendarIcon) {
          self.#curInstance.$field.parentNode.classList.remove(
              "datePickerTarget");
        }
        self.#curInstance = null;
        this.#hideAllViews();
      }
    }

    #hide() {
      if (DatePickerWidget.#visible) {
        this.#dp.style.display = "none";
        this.#hideAllViews();
        DatePickerWidget.#visible = false;
        if (this.#options.showCalendarIcon) {
          this.#curInstance.$field.removeAttribute('readonly');    // when the datepicker is deactivated, activate the field
        }
      }
    }

    #hideAllViews() {
      this['$month'].replaceChildren();
      this['$year'].replaceChildren();
      this['$yearset'].replaceChildren();
      this['$month'].style.display = "none";
      this['$year'].style.display = "none";
      this['$yearset'].style.display = "none";
    }

    #adjustDate(step, view, focus) {
      let maxDate, prevMaxDate;
      let _focus = focus || false;
      switch (view.toLowerCase()) {
        case "day":
          this.currentDay += step;
          maxDate = this.#maxDate(this.currentMonth)
          if (this.currentDay < 1) {
            prevMaxDate = this.#maxDate((this.currentMonth - 1 + 12) % 12);
            this.currentDay = prevMaxDate + this.currentDay;
            return this.#adjustDate(-1, "month", _focus);
          }
          if (this.currentDay > maxDate) {
            this.currentDay -= maxDate;
            return this.#adjustDate(+1, "month", _focus);
          }
          break;
        case "month":
          this.currentMonth += step;
          if (this.currentMonth > 11) {
            this.currentYear++;
            this.currentMonth = 0;
          }
          if (this.currentMonth < 0) {
            this.currentYear--;
            this.currentMonth = 11;
          }
          break;
        case "year":
          this.currentYear += step;
          break;
        case "yearset":
          this.currentYear += step * this.#options.yearsPerView;
          break;
      }
      this.#layout(this.view);
      if (_focus) {
        this.#focusedOnLi = true;
        this.$focusedDate.setAttribute("tabindex", 0);
        this.$focusedDate.focus();
      }
    }

    #checkDateIsSelected(data) {
      switch (this.view.toLowerCase()) {
        case "month":
          return this.currentYear === this.selectedYear && this.currentMonth
              === this.selectedMonth && data === this.selectedDay;
        case "year":
          return this.currentYear === this.selectedYear && this.selectedMonth
              === data;
        case "yearset":
          return this.selectedYear === data;
      }
    }

    #checkDateIsFocussed(data) {
      switch (this.view.toLowerCase()) {
        case "month":
          return data === this.currentDay;
        case "year":
          return this.currentMonth === data;
        case "yearset":
          return this.currentYear === data;
      }
    }

    #convertNumberToLocale(number) {
      const zeroCode = this.#options.locale.zero.charCodeAt(0);
      number += "";
      let newNumber = [];
      for (let i = 0; i < number.length; i++) {
        newNumber.push(
            String.fromCharCode(zeroCode + parseInt(number.charAt(i))));
      }
      return newNumber.join("");
    }

    #clearDate(view) {
      this.#model.dispatch(new FormView.Actions.UIChange({'value': ''}));
      let existingSelectedItem = this['$' + view.toLowerCase()].getElementsByClassName("dp-selected")[0];
      if (existingSelectedItem) {
        existingSelectedItem.classList.remove("dp-selected");
      }
    }

    #getEvent() {
      return "click";//this.#touchSupported ? "touchstart" : "click";
    }

    #pad2(m) {
      return m = m < 10 ? "0" + m : m;
    }

    toString() {
      if(this.selectedYear === -1 || this.selectedMonth === -1 || this.selectedDay === -1){
        return "";
      }
      const formattedDate = `${this.selectedYear}-${this.#pad2(this.selectedMonth + 1)}-${this.#pad2(this.selectedDay)}`;
      return formattedDate;
    }

    #selectDate(evnt) {
      let val = window.afCache.get(evnt.target, "value"),
          nextView = this.#viewAction[this.view].li;

      //disabled dates have a value of -1. Do nothing in that case
      if (val === -1) {
        return;
      }
      switch (this.view.toLowerCase()) {
        case "month":
          this.selectedMonth = this.currentMonth;
          this.selectedYear = this.currentYear;
          this.selectedDay = val;
          this.setValue(this.toString());
          this.#model.dispatch(new FormView.Actions.UIChange({'value': this.toString()})); // updating model value to the latest when calender is changed
          this.#curInstance.$field.focus();
          let existingSelectedElement = this['$'
          + this.view.toLowerCase()].getElementsByClassName("dp-selected")[0];
          if (existingSelectedElement) {
            existingSelectedElement.classList.remove("dp-selected");
          }
          evnt.target.classList.add("dp-selected");
          break;
        case "year":
          this.currentMonth = val;
          break;
        case "yearset":
          this.currentYear = val;
          break;
      }
      this.#layout(nextView);
      //manually focus on the field if clicked on the popup buttons for non-touch device
      if (!this.#touchSupported) {
        //No need to focus if selection is made by pressing space.
        if (!this.hotKeyPressed) {
          this.#scriptFocus = true;
        }
      } else if (nextView == null) {
        //For touch devices, deactivate the field if a selection is made
        this.#deactivateField()
      }
    }

    #leapYear() {
      return this.currentYear % 400 === 0 || (this.currentYear % 100 !== 0
          && this.currentYear % 4 === 0);
    }

    #maxDate(m) {
      if (this.#leapYear() && m === 1) {
        return 29;
      } else {
        return this.#dates[m];
      }
    }

    #localizeDateElements(defaultOptions, locale) {
        var calendarSymbols = FormView.LanguageUtils.getTranslatedString(locale, "calendarSymbols");
        if (calendarSymbols && calendarSymbols.abbrdayNames) {
            defaultOptions.locale.days = calendarSymbols.abbrdayNames;
        }
        if (calendarSymbols && calendarSymbols.abbrdayNames) {
            defaultOptions.locale.months = calendarSymbols.monthNames;
        }
        var clearText = FormView.LanguageUtils.getTranslatedString(locale, "clearText");
        if (clearText) {
            defaultOptions.locale.clearText = clearText;
        }
        var zero = FormView.LanguageUtils.getTranslatedString(locale, "0");
        if (zero) {
            defaultOptions.locale.zero = zero;
        }
    }

    #isEditValueOrDisplayValue(value) {
      return (this.#model.editValue === value || this.#model.displayValue
          === value);
    }

    /**
     * returns the original value of format YYYY-MM-DD
     * @returns {*|string}
     */
    getValue() {
      if (this.#isEditValueOrDisplayValue(this.#widget.value)) {
        return this.#model.value; // if the widget has edit/display value thiss method should return model value
      }
      return this.#widget.value;
    }

    /**
     * Sets the formatted display value on the widget.
     * value should be in YYYY-MM-DD format
     * @param value
     */
    setDisplayValue(value) {
      if (this.#curInstance != null) {
        this.#curInstance.$field.value = this.#curInstance.displayValue(
            this.toString()) || value;
      } else {
        this.#widget.value = this.#model.displayValue || value;
      }
    }

    setCalendarWidgetValue(value) {
      if (this.#curInstance === null && this.#widget != null) {
        this.#curInstance = window.afCache.get(this.#widget, "datetimepicker");
      }
      if (this.#curInstance != null) {
        // also change the date of the calendar widget
        this.#curInstance.selectedDate = value;
      }
    }

    /**
     * Sets the formatted edit value on the widget
     * @param value
     */

    setValue(value) {
      let currDate;
      if (value instanceof Date && !isNaN(value)) {
        // If value is already a Date object and it's valid, use it as is
        currDate = value;
      } else {
        // Check if value is empty
        if (!value || value.trim() === '') {
          currDate = new Date();
        } else {
          let displayFormat = this.#model._jsonModel?.displayFormat;
          // If displayFormat is null/undefined, use default parsing
          if (!displayFormat) {
            currDate = new Date(value);
          } else {
            // Use FormView.Formatters.parseDate for custom formats
            currDate = FormView.Formatters.parseDate(value, this.#lang || 'en', displayFormat);
            // If parseDate failed (returned null), fallback to default parsing
            if (currDate === null) {
              currDate = new Date(value);
            }
            const timezoneOffset = currDate.getTimezoneOffset();
            currDate.setMinutes(currDate.getMinutes() + timezoneOffset);
          }
        }
      }

      if (!isNaN(currDate) && value != null) {
        //in case the value is directly updated from the field without using calendar widget
        this.selectedMonth = currDate.getMonth();
        this.selectedYear = currDate.getFullYear();
        this.selectedDay = currDate.getDate();
      } else {
        this.selectedYear
            = this.selectedMonth
            = this.selectedDay
            = -1;
      }
      if (this.#curInstance != null) {
        if (!this.#isEditValueOrDisplayValue(value)) {
          this.#curInstance.selectedDate = value;  // prevent edit/display value from getting set in calender
        }
        this.#curInstance.$field.value = this.#curInstance.editValue() || value;
      } else {
        this.#widget.value = value;
      }
    }

    addEventListener(event, handler, widget) {
      let inst = window.afCache.get(widget, "datetimepicker");
      inst.$field.addEventListener(event, function (e) {
        switch (e.type) {
          case 'blur':
            if (!DatePickerWidget.#visible) {
              handler(e);
            }
            break;
          case 'focus':
            handler(e);
            break;
          case 'input':
            handler(e);
            break;

        }
      });
    }

  }
}
/*******************************************************************************
 * Copyright 2022 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
(function() {

    "use strict";
    class TextInput extends FormView.FormFieldBase {

        static NS = FormView.Constants.NS;
        /**
         * Each FormField has a data attribute class that is prefixed along with the global namespace to
         * distinguish between them. If a component wants to put a data-attribute X, the attribute in HTML would be
         * data-{NS}-{IS}-x=""
         * @type {string}
         */
        static IS = "adaptiveFormTextInput";
        static bemBlock = 'cmp-adaptiveform-textinput'
        static selectors  = {
            self: "[data-" + this.NS + '-is="' + this.IS + '"]',
            widget: `.${TextInput.bemBlock}__widget`,
            label: `.${TextInput.bemBlock}__label`,
            description: `.${TextInput.bemBlock}__longdescription`,
            qm: `.${TextInput.bemBlock}__questionmark`,
            errorDiv: `.${TextInput.bemBlock}__errormessage`,
            tooltipDiv: `.${TextInput.bemBlock}__shortdescription`
        };

        constructor(params) {
            super(params);
        }

        getWidget() {
            return this.element.querySelector(TextInput.selectors.widget);
        }

        getDescription() {
            return this.element.querySelector(TextInput.selectors.description);
        }

        getLabel() {
            return this.element.querySelector(TextInput.selectors.label);
        }

        getErrorDiv() {
            return this.element.querySelector(TextInput.selectors.errorDiv);
        }

        getTooltipDiv() {
            return this.element.querySelector(TextInput.selectors.tooltipDiv);
        }

        getQuestionMarkDiv() {
            return this.element.querySelector(TextInput.selectors.qm);
        }

        setModel(model) {
            super.setModel(model);
            if (this.widget.value !== '') {
                this.setModelValue(this.widget.value);
            }
            this.widget.addEventListener('blur', (e) => {
                this.setModelValue(e.target.value);
                this.setWidgetValueToDisplayValue();
                this.setInactive();
                this.triggerExit();
            });
            this.widget.addEventListener('focus', (e) => {
                this.setActive();
                this.setWidgetValueToModelValue();
                this.triggerEnter();
            });
            if (model.fieldType === "multiline-input") {
                this.widget.addEventListener('keydown', (event) => {
                    if (event.key === 'Enter') {
                        // Prevent default action of Enter key to avoid form submission
                        event.preventDefault();
                        // Add a newline character to the widget value
                        let cursorPosition = this.widget.selectionStart;
                        let textBefore = this.widget.value.substring(0, cursorPosition);
                        let textAfter = this.widget.value.substring(this.widget.selectionEnd);
                        this.widget.value = textBefore + '\n' + textAfter;
                        this.widget.selectionStart = this.widget.selectionEnd = cursorPosition + 1;
                    }
                });
            }
        }
    }

    FormView.Utils.setupField(({element, formContainer}) => {
        return new TextInput({element, formContainer})
    }, TextInput.selectors.self);

})();

/*******************************************************************************
 * Copyright 2022 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
(function() {

    "use strict";
    class TelephoneInput extends FormView.FormFieldBase {

        static NS = FormView.Constants.NS;
        /**
         * Each FormField has a data attribute class that is prefixed along with the global namespace to
         * distinguish between them. If a component wants to put a data-attribute X, the attribute in HTML would be
         * data-{NS}-{IS}-x=""
         * @type {string}
         */
        static IS = "adaptiveFormTelephoneInput";
        static bemBlock = 'cmp-adaptiveform-telephoneinput'
        static selectors  = {
            self: "[data-" + this.NS + '-is="' + this.IS + '"]',
            widget: `.${TelephoneInput.bemBlock}__widget`,
            label: `.${TelephoneInput.bemBlock}__label`,
            description: `.${TelephoneInput.bemBlock}__longdescription`,
            qm: `.${TelephoneInput.bemBlock}__questionmark`,
            errorDiv: `.${TelephoneInput.bemBlock}__errormessage`,
            tooltipDiv: `.${TelephoneInput.bemBlock}__shortdescription`
        };

        constructor(params) {
            super(params);
        }

        getWidget() {
            return this.element.querySelector(TelephoneInput.selectors.widget);
        }

        getDescription() {
            return this.element.querySelector(TelephoneInput.selectors.description);
        }

        getLabel() {
            return this.element.querySelector(TelephoneInput.selectors.label);
        }

        getErrorDiv() {
            return this.element.querySelector(TelephoneInput.selectors.errorDiv);
        }

        getTooltipDiv() {
            return this.element.querySelector(TelephoneInput.selectors.tooltipDiv);
        }

        getQuestionMarkDiv() {
            return this.element.querySelector(TelephoneInput.selectors.qm);
        }

        setModel(model) {
            super.setModel(model);
            if (this.widget.value !== '') {
                this.setModelValue(this.widget.value);
            }
            this.widget.addEventListener('blur', (e) => {
                this.setModelValue(e.target.value);
                this.setWidgetValueToDisplayValue();
                this.setInactive();
                this.triggerExit();
            });
            this.widget.addEventListener('focus', (e) => {
                this.setActive();
                this.setWidgetValueToModelValue();
                this.triggerEnter();
            });
        }
    }

    FormView.Utils.setupField(({element, formContainer}) => {
        return new TelephoneInput({element, formContainer})
    }, TelephoneInput.selectors.self);

})();

/*******************************************************************************
 * Copyright 2022 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
(function() {

    "use strict";
    class EmailInput extends FormView.FormFieldBase {

        static NS = FormView.Constants.NS;
        /**
         * Each FormField has a data attribute class that is prefixed along with the global namespace to
         * distinguish between them. If a component wants to put a data-attribute X, the attribute in HTML would be
         * data-{NS}-{IS}-x=""
         * @type {string}
         */
        static IS = "adaptiveFormEmailInput";
        static bemBlock = 'cmp-adaptiveform-emailinput'
        static selectors  = {
            self: "[data-" + this.NS + '-is="' + this.IS + '"]',
            widget: `.${EmailInput.bemBlock}__widget`,
            label: `.${EmailInput.bemBlock}__label`,
            description: `.${EmailInput.bemBlock}__longdescription`,
            qm: `.${EmailInput.bemBlock}__questionmark`,
            errorDiv: `.${EmailInput.bemBlock}__errormessage`,
            tooltipDiv: `.${EmailInput.bemBlock}__shortdescription`
        };

        constructor(params) {
            super(params);
        }

        getWidget() {
            return this.element.querySelector(EmailInput.selectors.widget);
        }

        getDescription() {
            return this.element.querySelector(EmailInput.selectors.description);
        }

        getLabel() {
            return this.element.querySelector(EmailInput.selectors.label);
        }

        getErrorDiv() {
            return this.element.querySelector(EmailInput.selectors.errorDiv);
        }

        getTooltipDiv() {
            return this.element.querySelector(EmailInput.selectors.tooltipDiv);
        }

        getQuestionMarkDiv() {
            return this.element.querySelector(EmailInput.selectors.qm);
        }

        setModel(model) {
            super.setModel(model);
            if (this.widget.value !== '') {
                this.setModelValue(this.widget.value);
            }
            this.widget.addEventListener('blur', (e) => {
                this.setModelValue(e.target.value);
                this.setWidgetValueToDisplayValue();
                this.setInactive();
                this.triggerExit();
            });
            this.widget.addEventListener('focus', (e) => {
                this.setActive();
                this.setWidgetValueToModelValue();
                this.triggerEnter();
            });
        }
    }

    FormView.Utils.setupField(({element, formContainer}) => {
        return new EmailInput({element, formContainer})
    }, EmailInput.selectors.self);

})();

/*******************************************************************************
 * Copyright 2022 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/

/**
 * This class is responsible for interacting with the numeric input widget. It implements edit/display format
 * for numeric input, along with the following features
 * - Convert's input type number to text to support display/edit format (for example `$` symbol)
 * - One cannot type or paste alphabets in the html input element
 */

 if (typeof window.NumericInputWidget === 'undefined') {

     window.NumericInputWidget =  class {
         #widget=null
         #model=null // passed by reference
         #options=null
         #defaultOptions={
             value : null,
             curValue: null,
             pos: 0,
             lengthLimitVisible: true,
             zero:"0",
             decimal:".",
             minus:"-"
         }
         //TODO: to support writing in different locales \d should be replaced by [0-9] for different locales
         #matchArray ={
             "integer":"^[+-]?{digits}*$"
         }
         #regex=null
         #processedValue=null
         #engRegex=null
         #writtenInLocale=false
         #previousCompositionVal=""

         #toLatinForm    (halfOrFullWidthStr) {
             // refer http://www.fileformat.info/info/unicode/block/halfwidth_and_fullwidth_forms/utf8test.htm
             return halfOrFullWidthStr.replace(
                 /[\uff00-\uffef]/g,
                 function(ch) { return String.fromCharCode(ch.charCodeAt(0) - 0xfee0); }
             );
         }

         constructor(widget, model) {
             // initialize the widget and model
             this.#widget = widget;
             this.#model = model;
             // initialize options for backward compatibility
             this.#options = Object.assign({}, this.#defaultOptions, this.#model._jsonModel);
             let matchStr =  this.#matchArray[this.#options.type];
             if(matchStr) {
                 let ld = this.#options.leadDigits,
                     fd = this.#options.fracDigits,
                     ldstr = ld && ld !== -1 ? "{0,"+ld+"}"
                         : "*",
                     fdstr = fd && fd !== -1 ? "{0,"+fd+"}"
                         : "*";
                 matchStr =  matchStr.replace("{leading}",ldstr)
                     .replace("{fraction}",fdstr);
                 let localeStr = matchStr.replace(/{digits}/g,this.#getDigits())
                         .replace("{decimal}",this.#escape(this.#options.decimal)),
                     engStr = matchStr.replace(/{digits}/g,"[0-9]")
                         .replace("{decimal}","\\.")
                 this.#processedValue = !(this.#getDigits() === "[0123456789]" && this.#options.decimal === ".")
                 this.#regex = new RegExp(localeStr, "g");
                 this.#engRegex = new RegExp(engStr, "g");
             }

             // change the input type to text for patterns
             this.#widget.setAttribute("type", "text");
             this.#attachEventHandlers(widget);
         }

         #attachEventHandlers(widget, model) {
             widget.addEventListener('keydown', (e)=> {
                 this.#handleKeyDown(e);
             });
             widget.addEventListener('keypress', (e)=> {
                 this.#handleKeyPress(e);
             });
             widget.addEventListener('focus', (e)=> {
                 this.#widget.value = this.#model.value;
             });
             widget.addEventListener('paste', (e)=> {
                 this.#handlePaste(e);
             });
             widget.addEventListener('cut', (e)=> {
                 this.#handleCut(e);
             });
             widget.addEventListener('blur', (e) => {
                 this.#model.dispatch(new FormView.Actions.UIChange({'value': this.getValue(e.target.value)}));
                 this.#widget.value = this.#model.displayValue;
             });
             // IME specific handling, to handle japanese languages max limit
             this.#attachCompositionEventHandlers(widget);
         }

         #attachCompositionEventHandlers(widget) {
             let isComposing = false; // IME Composing going on
             let hasCompositionJustEnded = false; // Used to swallow keyup event related to compositionend
             // IME specific handling, to handle japanese languages max limit
             // since enter can also be invoked during composing, a special handling is done here
             let that = this,
                 changeCaratPosition = function() {
                     // change the carat selection position to further limit input of characters
                     let range = window.getSelection();
                     range.selectAllChildren(widget);
                     range.collapseToEnd();
                 };
             widget.addEventListener('keyup', function(event) {
                 if (/*isComposing || */hasCompositionJustEnded) {
                     if (that.#compositionUpdateCallback(event)) {
                         changeCaratPosition();
                     }
                     // IME composing fires keydown/keyup events
                     hasCompositionJustEnded = false;
                 }
             });
             widget.addEventListener('compositionstart',
                 function(event) {
                     isComposing = true;
                 });
             widget.addEventListener("compositionupdate",
                 function(event) {
                     // event.originalEvent.data refers to the actual content
                     if (that.#compositionUpdateCallback(event)) {
                         changeCaratPosition();
                     }
                 });
             widget.addEventListener("compositionend",
                 function(event) {
                     isComposing = false;
                     // some browsers (IE, Firefox, Safari) send a keyup event after
                     //  compositionend, some (Chrome, Edge) don't. This is to swallow
                     // the next keyup event, unless a keydown event happens first
                     hasCompositionJustEnded = true;
                 });
             widget.addEventListener("keydown",
                 function(event) {
                     // Safari on OS X may send a keydown of 229 after compositionend
                     if (event.which !== 229) {
                         hasCompositionJustEnded = false;
                     }
                 });
         }

         #getDigits() {
             let zeroCode = this.#options.zero.charCodeAt(0),
                 digits = "";
             for(let i = 0;i < 10;i++) {
                 digits += String.fromCharCode(zeroCode + i);
             }
             return "["+digits+"]"
         }

         #escape(str) {
             return str.replace(".", "\\.")
         }


         getValue(value) {
             // we support full width, half width and locale specific numbers
             value = this.#toLatinForm(value);
             if(value.length > 0 && this.#processedValue && !value.match(this.#engRegex)) {
                 this.#writtenInLocale = true;
                 value = this.#convertValueFromLocale(value);
             } else {
                 this.#writtenInLocale = false
             }
             if(value && value.length >= this.#options.combCells )
                 value = value.slice(0,this.#options.combCells);
             this.#previousCompositionVal = value;
             return value;
         }

         #compositionUpdateCallback(event) {
             let that = this;
             let flag = false;
             let leadDigits = that.#options.leadDigits;
             let fracDigits = that.#options.fracDigits;
             // we don't check use-case where just fracDigits is set since in case of composition update, the value to update is not known
             if (leadDigits !== -1) {
                 let val = this.#widget.value;
                 if (event.type === "compositionupdate" && event.originalEvent.data) {
                     val = val + event.originalEvent.data.substr(event.originalEvent.data.length - 1);
                 }
                 // can't use the existing regex (since current regex checks for english digits), rather doing leadDigit compare
                 let totalLength = leadDigits + (fracDigits !== -1 ? (fracDigits + that.#options.decimal.length) : 0);
                 if (val.indexOf(that.#options.decimal) === -1) {
                     totalLength = leadDigits;
                 }
                 let latinVal = this.#toLatinForm(val);
                 // match both since we support full width, half width and locale specific input
                 let match = latinVal.match(that.#regex)|| latinVal.match(this.#engRegex);
                 flag  = !match;
                 if (match === null) {
                     // entered invalid character, revert to previous value
                     that.#widget.value = that.#previousCompositionVal;
                     flag = true;
                 } else if (flag) {
                     // if max reached
                     let newVal = val.substr(0, totalLength);
                     that.#widget.value = newVal;
                     that.#previousCompositionVal = newVal;
                     flag = true;
                 } else {
                     that.#previousCompositionVal = val;
                 }
             }
             return flag;
         }

         trigger(event, detail) {
             if (!this.#widget) {
                 return this;
             }
             const eventName = event.split('.')[0];
             const isNativeEvent =
                 typeof document.body[`on${eventName}`] !== 'undefined';
             if (isNativeEvent) {
                 this.#widget.dispatchEvent(new Event(eventName));
                 return this;
             }
             const customEvent = new CustomEvent(eventName, {
                 detail: detail || null,
             });
             this.#widget.dispatchEvent(customEvent);
             return this;
         }

         getHTMLSupportedAttr(domElement, attr){
             try{
                 return domElement[attr];
             }
             catch (err){
                 return undefined;
             }
         }

         #handleKeyInput(event, character, code){
             if(event.ctrlKey && !(['paste', 'cut'].includes(event.type))) {
                 return true;
             }

             this.#handleKeyDown(arguments);
             this.#options.lengthLimitVisible = true;
             let val = this.#widget.value,
                 // if selectionStart attribute isn't supported then its value will be undefined
                 selectionStart = this.getHTMLSupportedAttr(this.#widget, "selectionStart") || 0,
                 isSelectionAttrSupported = !(selectionStart === undefined || selectionStart === null),
                 selectionEnd = this.getHTMLSupportedAttr(this.#widget, "selectionEnd") || 0,
                 combCells = parseInt(this.#options.combCells) || 0,
                 current,
                 change = character;

             if (combCells > 0 ) {
                 change = character.substr(0, combCells - val.length + selectionEnd - selectionStart);
             }

             // CQ-4245407 : selectionStart and selectionEnd attributes aren't supported in case of input type = number
             // it is used for providing native HTML5 implementation for numeric field, so no further processing is required
             // As it is specific to AF and AF doesn't support change event on each keypress, so this change should be fine
             if (!isSelectionAttrSupported) {
                 return true;
             }

             current = val.substr(0, selectionStart) + change + val.substr(selectionEnd);
             // done to handle support for both full width, half width or mixed input in number field
             let latinCurrentValue = this.#toLatinForm(current);

             if (!(this.#regex == null || latinCurrentValue.match(this.#regex) || latinCurrentValue.match(this.#engRegex))) {
                 event.preventDefault();
                 return false;
             }
             if (!(['keydown', 'cut'].includes(event.type)) && combCells && (val.length >= combCells || current.length > combCells) && selectionStart === selectionEnd) {
                 event.preventDefault();
                 return false;
             }

             this.#options.curValue = val;
             this.#previousCompositionVal = val;
             this.#options.pos = selectionStart;
         }

         #handleKeyDown(event){
             if (event) {
                 let code = event.charCode || event.which || event.keyCode || 0;
                 if(code === 8 || code === 46) // backspace and del
                     this.#handleKeyInput(event, "", code);
                 else if(code === 32) { // suppress space
                     event.preventDefault();
                     return false;
                 }
             }
         }

         #isValidChar(character) {
             character = this.#toLatinForm(character);
             let lastSingleDigitChar = String.fromCharCode(this.#options.zero.charCodeAt(0) + 9);
             // we only full width, half width and also locale specific if customer has overlayed the i18n file
             return (character >= "0" && character <= "9") || (character>=this.#options.zero && character<=lastSingleDigitChar) || character===this.#options.decimal || character===this.#options.minus;
         }

         isNonPrintableKey(key) {
             return (key   // In IE, event.key returns words instead of actual characters for some keys.
                 && !['MozPrintableKey','Divide','Multiply','Subtract','Add','Enter','Decimal','Spacebar','Del'].includes(key)
                 && key.length !== 1 )
         }

         #handleKeyPress(event){
             if (event) {
                 let code = event.charCode || event.which || event.keyCode || 0,
                     character = String.fromCharCode(code);

                 if(this.isNonPrintableKey(event.key)) { // mozilla also generates a keypress, along with keydown
                     return true;                                               // for all keys, so only handling printable keys in keypress
                 }

                 if (this.#isValidChar(character))
                     this.#handleKeyInput(event, character, code);
                 else if (!event.ctrlKey){
                     event.preventDefault();
                     return false;
                 }
             }
         }

         #handlePaste(event){
             if (event) {
                 // get the contents
                 let pastedChar = undefined;
                 if (window.clipboardData && window.clipboardData.getData) { // IE
                     pastedChar = window.clipboardData.getData('Text');
                 } else if ((event.originalEvent || event).clipboardData && (event.originalEvent || event).clipboardData.getData) {
                     pastedChar = (event.originalEvent || event).clipboardData.getData('text/plain');
                 }

                 if(pastedChar) {
                     let allPastedCharsValid = pastedChar.split('').every(function (character) {
                         return this.#isValidChar(character);
                     }, this);
                     if (allPastedCharsValid) {
                         // during paste we support both half width, full width and locale specific numbers
                         pastedChar = this.#toLatinForm(pastedChar);
                         this.#handleKeyInput(event, pastedChar, 0);
                     }
                     else if (!event.ctrlKey) {
                         event.preventDefault();
                         return false;
                     }
                 }
             }
         }

         #handleCut(event) {
             if (event) {
                 this.#handleKeyInput(event, "", 0);
             }
         }

         #convertValueToLocale(val) {
             let zeroCode = this.#options.zero.charCodeAt(0);
             return  val.map(function(c) {
                 if(c === ".") {
                     return this.#options.decimal;
                 } else if(c === "-") {
                     return this.#options.minus;
                 } else {
                     return String.fromCharCode(parseInt(c) + zeroCode);
                 }
             },this).join("");
         }

         #convertValueFromLocale(val) {
             val = this.#toLatinForm(val);
             let zeroCode = this.#options.zero.charCodeAt(0);
             return  val.map(function(c) {
                 if(c === this.#options.decimal) {
                     return ".";
                 } else if(c === this.#options.minus) {
                     return "-";
                 } else {
                     return (c.charCodeAt(0) - zeroCode).toString();
                 }
             },this).join("");
         }

         /**
          * Checks if the edit value is same as value present in the user control(html form element)
          * @returns {boolean}
          */
         #isValueSame() {
             return (((this.#model.value === null) && (this.#widget.value === "")) || (this.#model.value === this.#widget.value));
         }

         setValue(value) {
             // if the value is same, don't do anything
             if(!this.#isValueSame()){
                 if(value && this.#writtenInLocale) {
                     this.#widget.value = this.#convertValueToLocale(value);
                 } else {
                     this.#widget.value=  this.#model.displayValue;
                 }
             }
         }
     }
 }


/*******************************************************************************
 * Copyright 2022 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
(function() {

    "use strict";
    class NumberInput extends FormView.FormFieldBase {

        static NS = FormView.Constants.NS;
        static IS = "adaptiveFormNumberInput";
        static bemBlock = 'cmp-adaptiveform-numberinput';
        static selectors  = {
            self: "[data-" + this.NS + '-is="' + this.IS + '"]',
            widget: `.${NumberInput.bemBlock}__widget`,
            label: `.${NumberInput.bemBlock}__label`,
            description: `.${NumberInput.bemBlock}__longdescription`,
            errorDiv: `.${NumberInput.bemBlock}__errormessage`,
            qm: `.${NumberInput.bemBlock}__questionmark`,
            tooltipDiv: `.${NumberInput.bemBlock}__shortdescription`
        };

        constructor(params) {
            super(params);
        }

        getClass() {
            return NumberInput.IS;
        }

        getWidget() {
            return this.element.querySelector(NumberInput.selectors.widget);
        }

        getDescription() {
            return this.element.querySelector(NumberInput.selectors.description);
        }

        getLabel() {
            return this.element.querySelector(NumberInput.selectors.label);
        }

        getErrorDiv() {
            return this.element.querySelector(NumberInput.selectors.errorDiv);
        }

        getTooltipDiv() {
            return this.element.querySelector(NumberInput.selectors.tooltipDiv);
        }

        getQuestionMarkDiv() {
            return this.element.querySelector(NumberInput.selectors.qm);
        }

        initializeWidget() {
            this.widgetObject = new NumericInputWidget(this.getWidget(), this._model);
            this.getWidget().addEventListener('blur', (e) => {
                if(this.element) {
                    this.setInactive();
                }
            });
        }

        updateValue(value) {
            if (this.widgetObject == null && (this._model._jsonModel.editFormat || this._model._jsonModel.displayFormat || FormView.Utils.isUserAgent('safari'))) {
                this.initializeWidget();
            }
            if (this.widgetObject) {
                this.widgetObject.setValue(value);
                super.updateEmptyStatus();
            } else {
                super.updateValue(value);
            }
        }

        setModel(model) {
            super.setModel(model);
            // only initialize if patterns are set
            if (this._model._jsonModel.editFormat || this._model._jsonModel.displayFormat || this._model._jsonModel.displayValueExpression
                || this._model._jsonModel.type === 'integer' || FormView.Utils.isUserAgent('safari')) {
                if (this.widgetObject == null) {
                    this.initializeWidget();
                }
            } else {
                if (this.widget.value !== '') {
                    this.setModelValue(this.widget.value);
                }
                this.getWidget().addEventListener('blur', (e) => {
                    this.setModelValue(e.target.value);
                    if(this.element) {
                        this.setInactive();
                        this.triggerExit();
                    }
                });
            }
            this.getWidget().addEventListener('focus', (e) => {
                if (this.element) {
                    this.setActive();
                    this.triggerEnter();
                }
            });
        }
    }

    FormView.Utils.setupField(({element, formContainer}) => {
        return new NumberInput({element,formContainer})
    }, NumberInput.selectors.self);
})();

/*******************************************************************************
 * Copyright 2022 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
(function () {

    class Panel extends FormView.FormPanel {

        _templateHTML = {};
        #childIdMap = {}

        static NS = FormView.Constants.NS;
        static IS = "adaptiveFormPanel";
        static bemBlock = 'cmp-container';
        static selectors = {
            self: "[data-" + this.NS + '-is="' + this.IS + '"]',
            label: `.${Panel.bemBlock}__label`,
            description: `.${Panel.bemBlock}__longdescription`,
            qm: `.${Panel.bemBlock}__questionmark`,
            tooltipDiv: `.${Panel.bemBlock}__shortdescription`
        };

        constructor(params) {
            super(params);
        }

        getClass() {
            return Panel.IS;
        }

        setFocus(id) {
            super.setFocus(id);
            this.setActive();
        }

        getWidgetId(){
          return this.getId();
        }

        getWidget() {
            return null;
        }

        getDescription() {
            return this.element.querySelector(Panel.selectors.description);
        }

        getLabel() {
            return this.element.querySelector(Panel.selectors.label);
        }

        getErrorDiv() {
            //error div is not defined
            //return this.element.querySelector(Panel.selectors.errorDiv);
            return null;
        }

        getTooltipDiv() {
            return this.element.querySelector(Panel.selectors.tooltipDiv);
        }

        getQuestionMarkDiv() {
            return this.element.querySelector(Panel.selectors.qm);
        }

        addChild(childView) {
            super.addChild(childView);
            if (this.getCountOfAllChildrenInModel() === this.children.length) {
                this.#cacheElements(this.element);
                this.#cacheDivToAppendChildMarkup();
                this.cacheClosestFieldsInView();
            } else if (childView.getInstanceManager() != null) {
                // this is for cases when repeatable instances are added after first initialisation
                this.#cacheElements(this.element);
            }
        }

        getChildViewByIndex(index) {
            if (this.#getCachedElements()[index] != null) {
                return this.getChild(this.#getCachedElements()[index].id)
            }
        }

        /**
         * Adds unique HTML for added instance corresponding to requirements of different types of repeatableParent
         * @param instanceManager of the repeated component
         * @param addedModel of the repeated component
         * @param htmlElement of the repeated component
         */
        addRepeatableMarkup(instanceManager, addedModel, htmlElement) {
            let result = this.#getBeforeViewElement(instanceManager, addedModel.index);
            if (result.beforeViewElement != null) {
                result.beforeViewElement.after(htmlElement);
            } else if (result.parentElement != null) {
                if (result.parentElement.children.length == 0) {
                    result.parentElement.append(htmlElement);
                } else {
                    result.parentElement.insertBefore(htmlElement, result.parentElement.firstElementChild);
                }
            }
            return htmlElement;
        }

        handleChildRemoval(removedInstanceView) {
            this.children.splice(this.children.indexOf(removedInstanceView), 1);
            this.#cacheElements(this._elements.self);
        }

        handleChildAddition(childView) {
            //can't initiate cacheElement From here as children property of the panel is not updated at this point,
            // hence cacheElement is called from addChild method which ensures panel's addChild is called first and children
            // property is updated
        }

        #cacheElements(wrapper) {
            this._elements = {};
            this._elements.self = wrapper;
            this._elements.items = [];
            this.#childIdMap = {};
            for (let i = 0; i < this.children.length; i++) {
                this.#childIdMap[this.children[i].id] = this.children[i];
            }
            let components = this._elements.self.querySelectorAll("[data-cmp-is]");
            for (let i = 0; i < components.length; i++) {
                //only consider this panel's child and not children of some  child panel.
                if (this.#childIdMap.hasOwnProperty(components[i].id)) {
                    this._elements.items.push(components[i]);
                }
            }
        }

        #getCachedElements() {
            return this._elements.items;
        }

        #getCachedElementById(id) {
            for (let i = 0; i < this.#getCachedElements().length; i++) {
                if (this.#getCachedElements()[i].id == id) {
                    return this.#getCachedElements()[i];
                }
            }
        }

        #cacheDivToAppendChildMarkup() {
            if (this.children.length > 0 && this._templateHTML['divToAppendChild'] === undefined) {
                var fieldView = this.children[0];
                //because htmlElement cached for repeating is element.parentElement in instanceManager
                this._templateHTML['divToAppendChild'] = fieldView.element.parentElement.parentElement;
            }
        }

        #getBeforeViewElement(instanceManager, instanceIndex) {
            var result = {};
            var instanceManagerId = instanceManager.getId();
            if (instanceIndex == 0) {
                var closestNonRepeatableFieldId = this._templateHTML[instanceManagerId]['closestNonRepeatableFieldId'];
                var closestRepeatableFieldInstanceManagerIds = this._templateHTML[instanceManagerId]['closestRepeatableFieldInstanceManagerIds'];
                var indexToInsert = this.getIndexToInsert(closestNonRepeatableFieldId, closestRepeatableFieldInstanceManagerIds);
                if (indexToInsert > 0) {
                    result.beforeViewElement = this.#getCachedElements()[indexToInsert - 1].parentElement;
                } else {
                    result.parentElement = this._templateHTML['divToAppendChild'];
                }
            } else {
                let previousInstanceItemDiv = instanceManager.getElementAt(instanceIndex - 1);
                result.beforeViewElement = previousInstanceItemDiv;
            }
            return result;
        }
    }

    FormView.Utils.setupField(({element, formContainer}) => {
        return new Panel({element, formContainer})
    }, Panel.selectors.self);
})();

/*******************************************************************************
 * Copyright 2022 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
(function() {

    "use strict";
    class RadioButton extends FormView.FormOptionFieldBase {

        static NS = FormView.Constants.NS;
        /**
         * Each FormField has a data attribute class that is prefixed along with the global namespace to
         * distinguish between them. If a component wants to put a data-attribute X, the attribute in HTML would be
         * data-{NS}-{IS}-x=""
         * @type {string}
         */
        static IS = "adaptiveFormRadioButton";
        static bemBlock = 'cmp-adaptiveform-radiobutton';
        static selectors  = {
            self: "[data-" + this.NS + '-is="' + this.IS + '"]',
            widgets: `.${RadioButton.bemBlock}__widget`,
            widget: `.${RadioButton.bemBlock}__option__widget`,
            label: `.${RadioButton.bemBlock}__label`,
            description: `.${RadioButton.bemBlock}__longdescription`,
            qm: `.${RadioButton.bemBlock}__questionmark`,
            errorDiv: `.${RadioButton.bemBlock}__errormessage`,
            tooltipDiv: `.${RadioButton.bemBlock}__shortdescription`,
            option: `.${RadioButton.bemBlock}__option`,
            optionLabel: `.${RadioButton.bemBlock}__option-label`
        };

        constructor(params) {
            super(params);
            this.qm = this.element.querySelector(RadioButton.selectors.qm);
        }

        getWidgets() {
            return this.element.querySelector(RadioButton.selectors.widgets);
        }

        getWidget() {
          return this.element.querySelectorAll(RadioButton.selectors.widget);
        }

        getDescription() {
            return this.element.querySelector(RadioButton.selectors.description);
        }

        getLabel() {
            return this.element.querySelector(RadioButton.selectors.label);
        }

        getQuestionMarkDiv() {
            return this.element.querySelector(RadioButton.selectors.qm);
        }

        getTooltipDiv() {
            return this.element.querySelector(RadioButton.selectors.tooltipDiv);
        }

        getErrorDiv() {
            return this.element.querySelector(RadioButton.selectors.errorDiv);
        }

        getOptions() {
            return this.element.querySelectorAll(RadioButton.selectors.option);
        }

        #addWidgetListeners(optionWidget) {
            optionWidget.addEventListener('change', (e) => {
                this.setModelValue(e.target.value);
            });
            optionWidget.addEventListener('focus', (e) => {
                this.setActive();
            });
            optionWidget.addEventListener('blur', (e) => {
                this.setInactive();
            });
        }

        setModel(model) {
            super.setModel(model);
            this.widget.forEach(optionWidget => {
                this.#addWidgetListeners(optionWidget);
            });
        }

        updateEnabled(enabled, state) {
            this.element.setAttribute(FormView.Constants.DATA_ATTRIBUTE_ENABLED, enabled);
            let widgets = this.widget;
            widgets.forEach(widget => {
                if (enabled === false) {
                    if(state.readOnly === false){
                        widget.setAttribute(FormView.Constants.HTML_ATTRS.DISABLED, "disabled");
                    }
                } else if (state.readOnly === false) {
                    widget.removeAttribute(FormView.Constants.HTML_ATTRS.DISABLED);
                }
            });
        }

        updateReadOnly(readonly) {
            let widgets = this.widget;
            this.element.setAttribute(FormView.Constants.DATA_ATTRIBUTE_READONLY, readonly);
            widgets.forEach(widget => {
                if (readonly === true) {
                    widget.setAttribute(FormView.Constants.HTML_ATTRS.DISABLED, "disabled");
                } else {
                    widget.removeAttribute(FormView.Constants.HTML_ATTRS.DISABLED);
                }
            });
        }

        updateValidity(validity) {
            if(validity.valid === undefined) {
                this.element.removeAttribute(FormView.Constants.DATA_ATTRIBUTE_VALID);
                this.widget.forEach(widget => widget.removeAttribute(FormView.Constants.ARIA_INVALID));
            } else {
                this.element.setAttribute(FormView.Constants.DATA_ATTRIBUTE_VALID, validity.valid);
                this.widget.forEach(widget => widget.setAttribute(FormView.Constants.ARIA_INVALID, !validity.valid));
            }
        }

        updateValue(modelValue) {
            this.widget.forEach(widget => {
                if (modelValue != null && widget.value != null && (modelValue.toString() == widget.value.toString())) {
                    widget.checked = true;
                    widget.setAttribute(FormView.Constants.HTML_ATTRS.CHECKED, FormView.Constants.HTML_ATTRS.CHECKED);
                } else {
                    widget.checked = false;
                    widget.removeAttribute(FormView.Constants.HTML_ATTRS.CHECKED);
                }
            }, this)
            super.updateEmptyStatus();
        }

        #createRadioOption(value, itemLabel) {
            let richScreenReaderText = `${this._model.label.value}:  ${itemLabel}`;
            let plainScreenReaderText = window.DOMPurify ? window.DOMPurify.sanitize(richScreenReaderText, { ALLOWED_TAGS: [] }) : richScreenReaderText;

            const optionTemplate = `
            <div class="${RadioButton.selectors.option.slice(1)}">
                <label class="${RadioButton.selectors.optionLabel.slice(1)}">
                    <input type="radio" name="${this._model.name}" class="${RadioButton.selectors.widget.slice(1)}" value="${value}" aria-label="${plainScreenReaderText}" tabindex="0">
                    <span>${itemLabel}</span>
                </label>
            </div>`;

            const container = document.createElement('div'); // Create a container element to hold the template
            container.innerHTML = optionTemplate;
            let addedOptionWidget = container.querySelector(RadioButton.selectors.widget);
            if(this._model.readOnly === true || this._model.enabled === false) {
                addedOptionWidget.setAttribute("disabled", true);
                if(this._model.readOnly === true) {
                    addedOptionWidget.setAttribute("aria-readonly", true);
                }
            }
            this.#addWidgetListeners(addedOptionWidget);
            return container.firstElementChild; // Return the first child, which is the created option
        }

        updateEnum(newEnums) {
            super.updateEnumForRadioButtonAndCheckbox(newEnums, this.#createRadioOption);
            // refresh the widget references, to dynamically added options
            this.widget = this.getWidget();
        }

        updateEnumNames(newEnumNames) {
            super.updateEnumNamesForRadioButtonAndCheckbox(newEnumNames, this.#createRadioOption);
            // refresh the widget references, to dynamically added options
            this.widget = this.getWidget();
        }

        updateRequired(required, state) {
            if (this.widget) {
                this.element.toggleAttribute("required", required);
                this.element.setAttribute("data-cmp-required", required);
            }
        }

        syncMarkupWithModel() {
            super.syncMarkupWithModel();
            this.#syncWidgetName();
        }

        #syncWidgetName() {
            const name = this.getModel()?.name;
            this.widget.forEach(widget => {
                widget.setAttribute("name", `${this.id}_${name}`);
            });
        }
    }

    FormView.Utils.setupField(({element, formContainer}) => {
        return new RadioButton({element, formContainer});
    }, RadioButton.selectors.self);

})();

/*******************************************************************************
 * Copyright 2022 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
(function() {
    "use strict";

    class Text extends FormView.FormFieldBase {

            static NS = FormView.Constants.NS;
            static IS = "adaptiveFormText";
            static bemBlock = 'cmp-adaptiveform-text';

            static selectors  = {
                self: "[data-" + this.NS + '-is="' + this.IS + '"]'
            };

            constructor(params) {
                super(params);
            }

            getWidget() {
                return null;
            }

            getDescription() {
                return null;
            }

            getLabel() {
                return null;
            }

            getErrorDiv() {
                return null;
            }

            getTooltipDiv() {
                return null;
            }

            getQuestionMarkDiv() {
                return null;
            }

            getClass() {
                return Text.IS;
            }

            setFocus() {
                const fieldType = this.parentView?.getModel()?.fieldType;
                if (fieldType !== 'form' && this.parentView.setFocus) {
                    this.parentView.setFocus(this.getId());
                }
                this.setActive();
                this.element.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }

            updateValue(value) {
                // html sets undefined value as undefined string in input value, hence this check is added
                let actualValue = typeof value === "undefined" ? "" :  value;

                // Custom configuration for DOMPurify for RTE content
                const cleanHTML = (dirtyHTML) => {
                    // Specify the allowed tags and attributes
                    const allowedTags = [
                        'b', 'strong', 'caption', 'i', 'em', 'u',
                        'sub', 'sup', 'small', 'blockquote',
                        'ul', 'ol', 'li', 'a', 'img',
                        'table', 'tbody', 'tr', 'td', 'th',
                        'h1', 'h2', 'h3', 'h4', 'h5', 'h6',
                        'br', 'p', 'span'
                    ];
                    const allowedAttributes = [
                        'href', 'target', 'rel', '_rte_href',
                        'src', 'alt' , 'style', '_rte_a_id_repl',
                        'class', 'id', 'title', 'colspan', 'rowspan',
                        'cellPadding', 'cellSpacing', 'border', 'width', 'height', 'scope'
                    ];

                    // Sanitize the HTML
                    const sanitizedHTML = window.DOMPurify ? window.DOMPurify.sanitize(dirtyHTML, {
                        ALLOWED_TAGS: allowedTags,
                        ALLOWED_ATTR: allowedAttributes,
                    }) : dirtyHTML;

                    return sanitizedHTML;
                };

                const sanitizedValue = cleanHTML(actualValue);

                // since there is no widget for textview, the innerHTML is being changed
                if (this.element.children[0]) {
                    this.element.children[0].innerHTML = sanitizedValue;
                } else {
                    this.element.innerHTML = sanitizedValue;
                }
            }
    }

    FormView.Utils.setupField(({element, formContainer}) => {
        return new Text({element, formContainer})
    }, Text.selectors.self);
})();

/*******************************************************************************
 * Copyright 2022 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
(function() {


    "use strict";
    class CheckBoxGroup extends FormView.FormOptionFieldBase {

        static NS = FormView.Constants.NS;
        /**
         * Each FormField has a data attribute class that is prefixed along with the global namespace to
         * distinguish between them. If a component wants to put a data-attribute X, the attribute in HTML would be
         * data-{NS}-{IS}-x=""
         * @type {string}
         */
        static IS = "adaptiveFormCheckBoxGroup";
        static bemBlock = 'cmp-adaptiveform-checkboxgroup'
        static checkboxBemBlock = 'cmp-adaptiveform-checkbox'
        static selectors  = {
            self: "[data-" + this.NS + '-is="' + this.IS + '"]',
            widgets: `.${CheckBoxGroup.bemBlock}__widget`,
            widget: `.${CheckBoxGroup.bemBlock}__option__widget`,
            widgetLabel: `.${CheckBoxGroup.bemBlock}__label`,
            label: `.${CheckBoxGroup.bemBlock}__label`,
            description: `.${CheckBoxGroup.bemBlock}__longdescription`,
            qm: `.${CheckBoxGroup.bemBlock}__questionmark`,
            errorDiv: `.${CheckBoxGroup.bemBlock}__errormessage`,
            tooltipDiv: `.${CheckBoxGroup.bemBlock}__shortdescription`,
            item:  `.${CheckBoxGroup.bemBlock}-item`,
            optionLabel: `${CheckBoxGroup.bemBlock}__option-label`,
            optionLink: `${CheckBoxGroup.bemBlock}__links`
        };

        constructor(params) {
            super(params);
            this.qm = this.element.querySelector(CheckBoxGroup.selectors.qm)
            this.widgetLabel = this.element.querySelector(CheckBoxGroup.selectors.widgetLabel)
        }

        getWidgets() {
            return this.element.querySelector(CheckBoxGroup.selectors.widgets);
        }

        getWidget() {
          return this.element.querySelectorAll(CheckBoxGroup.selectors.widget);
        }

        getDescription() {
            return this.element.querySelector(CheckBoxGroup.selectors.description);
        }

        getLabel() {
            return this.element.querySelector(CheckBoxGroup.selectors.label);
        }

        getErrorDiv() {
            return this.element.querySelector(CheckBoxGroup.selectors.errorDiv);
        }

        getQuestionMarkDiv() {
            return this.element.querySelector(CheckBoxGroup.selectors.qm);
        }

        getTooltipDiv() {
            return this.element.querySelector(CheckBoxGroup.selectors.tooltipDiv);
        }

        getOptions() {
            return this.element.querySelectorAll(CheckBoxGroup.selectors.item);
        }

        #addWidgetListeners(optionWidget) {
            optionWidget.addEventListener('change', (e) => {
                this.#updateModelValue(optionWidget);
            });
            optionWidget.addEventListener('focus', (e) => {
                this.setActive();
            });
            optionWidget.addEventListener('blur', (e) => {
                this.setInactive();
            });
        }

        setModel(model) {
            super.setModel(model);
            this.widget.forEach(optionWidget => {
                this.#addWidgetListeners(optionWidget);
            });
            let optionLinks = this.element.querySelectorAll(`.${CheckBoxGroup.selectors.optionLink}`);
            const actionKeys = ['Enter', ' ', 'Spacebar', 'Space'];
            optionLinks.forEach(optionLink => {
                optionLink.addEventListener('keydown', (e)=>{
                    if(actionKeys.includes(e.key)) {
                        optionLink.click();
                    }
                });
            });
            this.#updateModelValue();
        }

        #updateModelValue() {
            let value = [];
            this.widget.forEach(widget => {
                if (widget.checked) {
                    value.push(widget.value)
                }
            }, this);
            if (value.length !== 0 || this._model.value != null) {
                this.setModelValue(value)
            }
        }

        updateValidity(validity) {
            if(validity.valid === undefined) {
                this.element.removeAttribute(FormView.Constants.DATA_ATTRIBUTE_VALID);
                this.widget.forEach(widget => widget.removeAttribute(FormView.Constants.ARIA_INVALID));
            } else {
                this.element.setAttribute(FormView.Constants.DATA_ATTRIBUTE_VALID, validity.valid);
                this.widget.forEach(widget => widget.setAttribute(FormView.Constants.ARIA_INVALID, !validity.valid));
            }
        }

        updateValue(modelValue) {
            modelValue = [].concat(modelValue);
            let selectedWidgetValues = modelValue.map(String);
            this.widget.forEach(widget => {
                if (selectedWidgetValues.includes((widget.value))) {
                    widget.checked = true
                    widget.setAttribute(FormView.Constants.HTML_ATTRS.CHECKED, FormView.Constants.HTML_ATTRS.CHECKED);
                } else {
                    widget.checked = false
                    widget.removeAttribute(FormView.Constants.HTML_ATTRS.CHECKED);
                }
            }, this)
            super.updateEmptyStatus();
        }

        #createCheckBoxItem(value, itemLabel) {
            // This doesn't cater for optionLink __links as toggelablelink component is hidden
            let richScreenReaderText = `${this._model.label.value}:  ${itemLabel}`;
            let plainScreenReaderText = window.DOMPurify ? window.DOMPurify.sanitize(richScreenReaderText, { ALLOWED_TAGS: [] }) : richScreenReaderText;
            const optionTemplate = `
            <div class="${CheckBoxGroup.selectors.item.slice(1)}">
                <label class="${CheckBoxGroup.selectors.optionLabel}">
                    <input type="checkbox" class="${CheckBoxGroup.selectors.widget.slice(1)}" name="${this._model.name}" value="${value}" aria-label="${plainScreenReaderText}" tabindex="0">
                    <span>${itemLabel}</span>
                </label>
            </div>`;

            const container = document.createElement('div'); // Create a container element to hold the template
            container.innerHTML = optionTemplate;
            let addedOptionWidget = container.querySelector(CheckBoxGroup.selectors.widget);
            if(this._model.readOnly === true || this._model.enabled === false) {
                addedOptionWidget.setAttribute("disabled", true);
                if(this._model.readOnly === true) {
                    addedOptionWidget.setAttribute("aria-readonly", true);
                }
            }
            this.#addWidgetListeners(addedOptionWidget);
            return container.firstElementChild; // Return the first child, which is the created option
        }
        updateEnum(newEnums) {
            super.updateEnumForRadioButtonAndCheckbox(newEnums, this.#createCheckBoxItem);
            // refresh the widget references, to dynamically added options
            this.widget = this.getWidget();
        }

        updateEnumNames(newEnumNames) {
            super.updateEnumNamesForRadioButtonAndCheckbox(newEnumNames, this.#createCheckBoxItem);
            // refresh the widget references, to dynamically added options
            this.widget = this.getWidget();
        }

        updateEnabled(enabled, state) {
            this.element.setAttribute(FormView.Constants.DATA_ATTRIBUTE_ENABLED, enabled);
            let widgets = this.widget;
            widgets.forEach(widget => {
                if (enabled === false) {
                    if(state.readOnly === false){
                        widget.setAttribute(FormView.Constants.HTML_ATTRS.DISABLED, "disabled");
                    }
                } else if (state.readOnly === false) {
                    widget.removeAttribute(FormView.Constants.HTML_ATTRS.DISABLED);
                }
            });
        }

        updateReadOnly(readonly) {
            let widgets = this.widget;
            this.element.setAttribute(FormView.Constants.DATA_ATTRIBUTE_READONLY, readonly);
            widgets.forEach(widget => {
                if (readonly === true) {
                    widget.setAttribute(FormView.Constants.HTML_ATTRS.DISABLED, "disabled");
                    widget.setAttribute("aria-readonly", true);
                } else {
                    widget.removeAttribute(FormView.Constants.HTML_ATTRS.DISABLED);
                    widget.removeAttribute("aria-readonly");
                }
            });
        }
        updateRequired(required, state) {
            if (this.widget) {
                this.element.toggleAttribute("required", required);
                this.element.setAttribute("data-cmp-required", required);
            }
        }

        syncMarkupWithModel() {
            super.syncMarkupWithModel();
            this.updateEnum(this._model.enum);
            this.updateEnumNames(this._model.enumNames);
        }
    }

    FormView.Utils.setupField(({element, formContainer}) => {
        return new CheckBoxGroup({element, formContainer})
    }, CheckBoxGroup.selectors.self);

})();

/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  ~ Copyright 2024 Adobe
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/
(function() {

    "use strict";
    class Button extends FormView.FormFieldBase {

        static NS = FormView.Constants.NS;
        /**
         * Each FormField has a data attribute class that is prefixed along with the global namespace to
         * distinguish between them. If a component wants to put a data-attribute X, the attribute in HTML would be
         * data-{NS}-{IS}-x=""
         * @type {string}
         */
        static IS = "adaptiveFormButton";
        static bemBlock = 'cmp-adaptiveform-button';
        static selectors  = {
            self: "[data-" + this.NS + '-is="' + this.IS + '"]',
            widget: `.${Button.bemBlock}__widget`,
            label: `.${Button.bemBlock}__text`,
            description: `.${Button.bemBlock}__longdescription`,
            qm: `.${Button.bemBlock}__questionmark`,
            tooltipDiv: `.${Button.bemBlock}__shortdescription`
        };

        constructor(params) {
            super(params);
            const formModel = this.formContainer?.getModel?.();
            if (!formModel) { return; }
            
            formModel.subscribe((action) => { // hide loader if validation fails (no submit performed)
                const errors = action?.payload;
                if (Array.isArray(errors) && errors.length > 0) {
                    this._hideLoader();
                }
            }, 'validationComplete');

            formModel.subscribe(() => { // hide loader on submit success
                this._hideLoader();
            }, 'submitSuccess');
            
            formModel.subscribe(() => { // hide loader on submit error
                this._hideLoader();
            }, 'submitError');
        }

        _container = null;

        _getContainer() {
            if (this._container) return this._container;
            const container = this.formContainer?.getFormElement?.();
            if (container) this._container = container;
            return this._container;
        }

        _showLoader() {
            const container = this._getContainer();
            if (container) {
                container.classList.add('cmp-adaptiveform-container--submitting');
            }
        }

        _hideLoader() {
            const container = this._getContainer();
            if (container) {
                container.classList.remove('cmp-adaptiveform-container--submitting');
            }
        }

        getQuestionMarkDiv() {
            return this.element.querySelector(Button.selectors.qm);
        }

        getLabel() {
            return this.element.querySelector(Button.selectors.label);
        }

        getWidget() {
            return this.element.querySelector(Button.selectors.widget);
        }

        /**
         * Return the description element.
         * @returns {HTMLElement}
         */
        getDescription() {
            return this.element.querySelector(Button.selectors.description);
        }

        getErrorDiv() {
            return null;
        }

        getTooltipDiv() {
            return this.element.querySelector(Button.selectors.tooltipDiv);
        }

        setModel(model) {
            super.setModel(model);
            this.getWidget().addEventListener("click", (event) => {
                if (this.widget.type === 'submit' || this.widget.type === 'reset') {
                    event.preventDefault();
                }
                if (this.widget.type === 'submit') {
                    this._showLoader();
                }
                this._model.dispatch(new FormView.Actions.Click());
            });
        }
    }

    FormView.Utils.setupField(({element, formContainer}) => {
        return new Button({element, formContainer})
    }, Button.selectors.self);

})();
/*******************************************************************************
 * Copyright 2022 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
(function(document) {

    "use strict";
     class Image extends FormView.FormFieldBase {

            static NS = FormView.Constants.NS;
            static IS = "adaptiveFormImage";
            static bemBlock = 'cmp-image';

            static selectors  = {
                self: "[data-" + this.NS + '-is="' + this.IS + '"]'
            };

            constructor(params) {
                super(params);
            }

            getClass() {
                return Image.IS;
            }

             getWidget() {
                 return null;
             }

             getDescription() {
                 return null;
             }

             getLabel() {
                 return null;
             }

             getErrorDiv() {
                 return null;
             }

             getTooltipDiv() {
                 return null;
             }

             getQuestionMarkDiv() {
                 return null;
             }

            setFocus() {
                this.setActive();
            }

            updateValue(value) {
                if (this.element) {
                    this.element.setAttribute('data-cmp-src', value);
                    const imgElement = this.element.querySelector('img');
                    if (imgElement) {
                        imgElement.setAttribute('src', value);
                    }
                }
            }
    }

    FormView.Utils.setupField(({element, formContainer}) => {
        return new Image({element, formContainer})
    }, Image.selectors.self);
})();

/*******************************************************************************
 * Copyright 2022 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
(function() {

    "use strict";
    class DropDown extends FormView.FormOptionFieldBase {

        static NS = FormView.Constants.NS;
        /**
         * Each FormField has a data attribute class that is prefixed along with the global namespace to
         * distinguish between them. If a component wants to put a data-attribute X, the attribute in HTML would be
         * data-{NS}-{IS}-x=""
         * @type {string}
         */
        static IS = "adaptiveFormDropDown";
        static bemBlock = 'cmp-adaptiveform-dropdown';
        static selectors  = {
            self: "[data-" + this.NS + '-is="' + this.IS + '"]',
            widget: `.${DropDown.bemBlock}__widget`,
            options: `.${DropDown.bemBlock}__option`,
            label: `.${DropDown.bemBlock}__label`,
            description: `.${DropDown.bemBlock}__longdescription`,
            qm: `.${DropDown.bemBlock}__questionmark`,
            errorDiv: `.${DropDown.bemBlock}__errormessage`,
            tooltipDiv: `.${DropDown.bemBlock}__shortdescription`
        };

        constructor(params) {
            super(params);
            this.qm = this.element.querySelector(DropDown.selectors.qm);
        }

        getWidget() {
            return this.element.querySelector(DropDown.selectors.widget);
        }

        getDescription() {
            return this.element.querySelector(DropDown.selectors.description);
        }

        getLabel() {
            return this.element.querySelector(DropDown.selectors.label);
        }

        getErrorDiv() {
            return this.element.querySelector(DropDown.selectors.errorDiv);
        }

        getQuestionMarkDiv() {
            return this.element.querySelector(DropDown.selectors.qm);
        }

        getTooltipDiv() {
            return this.element.querySelector(DropDown.selectors.tooltipDiv);
        }

        getOptions() {
            return this.element.querySelectorAll(DropDown.selectors.options);
        }

         #checkIfEqual = function(value, optionValue, multiSelect) {
            if(multiSelect) {
                let isPresent = false;
                value.forEach((saveValue) => {
                    if(String(saveValue) === optionValue)  // save value can be number and boolean also.
                        isPresent = true;
                })
                return isPresent;
            }
            return String(value) === optionValue;
        }

        updateEnabled(enabled, state) {
            this.element.setAttribute(FormView.Constants.DATA_ATTRIBUTE_ENABLED, enabled);
            let widget = this.widget;
            if (enabled === false) {
                if(state.readOnly === false){
                    widget.setAttribute(FormView.Constants.HTML_ATTRS.DISABLED, "disabled");
                }
            } else if (state.readOnly === false) {
                widget.removeAttribute(FormView.Constants.HTML_ATTRS.DISABLED);
            }
        }

        updateReadOnly(readonly) {
            let widget = this.widget;
            this.element.setAttribute(FormView.Constants.DATA_ATTRIBUTE_READONLY, readonly);
            if (readonly === true) {
                widget.setAttribute(FormView.Constants.HTML_ATTRS.DISABLED, "disabled");
                widget.setAttribute("aria-readonly", true);
            } else {
                widget.removeAttribute(FormView.Constants.HTML_ATTRS.DISABLED);
                widget.removeAttribute("aria-readonly");
            }
        }

        updateValue(value) {
            if(value == null) { // if undefined or null, reset the widget
                this.widget.selectedIndex = -1;
                return;
            }
            let isMultiSelect = this._model.isArrayType();
            [...this.widget].forEach((option) => {
                // clear of any selection, and re-add selection (otherwise HTML shows stale state if it already existed)
                option.removeAttribute('selected');
                if(this.#checkIfEqual(value, option.value, isMultiSelect)) {
                    option.setAttribute('selected', 'selected');
                }
            });
            super.updateEmptyStatus();
        }

        #createDropDownOptions(value, label) {
            const optionTemplate = `<option value="${value}" class="${DropDown.selectors.options.slice(1)}">${label}</option>`;
            const container = document.createElement('div'); // Create a container element to hold the template
            container.innerHTML = optionTemplate;
            return container.firstElementChild; // Return the first child, which is the created option
        }

        #removeAllOptions() {
            while(this.getOptions().length !== 0) {
                this.getWidget().remove(this.getOptions().length) // not removing the blank option
            }
        }

        /**
         * @override
         * Method for updating the saved value in the option field.
         * It contains the logic for updating the 'enum' value.
         *
         * @param {Array} newEnums - An array of primitive values to be saved in the option field.
         */
        updateEnum(newEnums) {
            let options = this.getOptions();
            let currentEnumSize = options.length;
            let startIndex = options[0] && options[0].value === '' ? 1 : 0; // Check if the first option is a blank option

            // Update existing options and add new options in the same loop
            newEnums.forEach((value, index) => {
                if (index + startIndex < currentEnumSize) {
                    // Update existing option
                    options[index + startIndex].value = value;
                } else {
                    // Add new option
                    this.getWidget().add(this.#createDropDownOptions(value, value));
                }
            });

            // Remove extra options, but never remove the first option
            while (currentEnumSize > newEnums.length + startIndex) {
                this.getWidget().remove(currentEnumSize--);
            }
        }

        /**
         * @override
         * Method for updating the display value in the option field.
         * It contains the logic for updating the 'enumNames' value.
         *
         * @param {Array} newEnumNames - An array of primitive values to be displayed in the option field.
         */
        updateEnumNames(newEnumNames) {
            let options = this.getOptions();
            let currentEnumNameSize = options.length;
            if(currentEnumNameSize === 0) {  // case 1: Create all dropdown new options
                newEnumNames.forEach((value) => {
                    this.getWidget().add(this.#createDropDownOptions(value, value));
                })
            } else if(currentEnumNameSize > newEnumNames.length) {  // case 2: Replace existing enumNames, remaining enumNames = enums
                newEnumNames.forEach((value, index) => {
                    options[index].text = value;
                });

                options.forEach((option, index) => {
                    if(index >= newEnumNames.length) {
                        option.text = option.value;
                    }
                })
            } else {    // case 3: Replace all existing enumNames
                options.forEach((option, index) => {
                    option.text = newEnumNames[index];
                });
            }
        }

        setModel(model) {
            super.setModel(model);
            if (this.widget.value !== '') {
                this.#updateModelValue(this.widget);
            }
            this.widget.addEventListener('change', (e) => {
                this.#updateModelValue(e.target);
            });
            this.widget.addEventListener('focus', (e) => {
                this.setActive();
                this.triggerEnter();
            });
            this.widget.addEventListener('blur', (e) => {
                this.setInactive();
                this.triggerExit();
            });
        }

        #updateModelValue(widget) {
            if(this._model.isArrayType()) {
                let valueArray = [];
                [...this.widget].forEach((option) => {
                    if(option.selected) {
                        valueArray.push(option.value);
                    }
                });
                if (valueArray.length !== 0 || this._model.value != null) {
                    this.setModelValue(valueArray);
                }
            } else {
                this.setModelValue(widget.value);
            }
        }
    }

    FormView.Utils.setupField(({element, formContainer}) => {
        return new DropDown({element, formContainer})
    }, DropDown.selectors.self);

})();

/*******************************************************************************
 * Copyright 2025 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/

/**
 * This class is responsible for interacting with the file input widget. It implements the file preview,
 * file list, handling invalid file size, file name, file mime type functionality
 */

if (typeof window.FileInputWidget === 'undefined') {
    window.FileInputWidget = class extends FormView.FormFileInputWidget {

        constructor(params) {
            super(params);
            this.invalidFeature = {
                ...this.invalidFeature,
                "SIZE_ZERO": 4
            }
        }

        attachEventHandlers(widget, dragArea, model) {
            super.attachEventHandlers(widget, dragArea, model)
            const customBtn = dragArea?.querySelector(".cmp-adaptiveform-fileinput__widgetlabel")
            customBtn?.addEventListener("click", () => {
                widget.click();
            });
            customBtn?.addEventListener('keydown', function(event) {
                // Check if the Enter key is pressed
                if (event.key === 'Enter' || event.keyCode === 13) {
                    // Trigger the click event of the file input
                    widget.click();
                }
            });
        }
        
        fileItem(fileName, fileSize, comment, fileUrl) {
            let self = this;
            let id = `${Date.now() + '_' + Math.floor(Math.random() * 10000)}_file_size`
            let fileItem = document.createElement('li');
            fileItem.setAttribute("class", "cmp-adaptiveform-fileinput__fileitem");
            let fileNameDom = document.createElement('a');
            let fileSizeDom = document.createElement('span');

            fileSizeDom.setAttribute('class', "cmp-adaptiveform-fileinput__filesize");
            fileSizeDom.setAttribute('id', id);
            fileSizeDom.textContent = this.formatBytes(fileSize);

            fileNameDom.setAttribute('tabindex', '0');
            fileNameDom.setAttribute('class', "cmp-adaptiveform-fileinput__filename");
            fileNameDom.setAttribute('aria-describedBY', id);
            fileNameDom.textContent = fileName;
            fileNameDom.addEventListener('keypress', function(e) {
                if (e.keyCode === 13 || e.charCode === 32) {
                    e.target.click();
                }
            });
            fileNameDom.addEventListener('click', function(e) {
                self.handleFilePreview(e);
            });
            fileItem.appendChild(fileNameDom);
            if(fileUrl != null){
                fileNameDom.dataset.key = fileUrl;
            }
            let fileEndContainer = document.createElement('span');
            let fileClose = document.createElement('button');
            fileEndContainer.setAttribute('class', "cmp-adaptiveform-fileinput__fileendcontainer");
            fileClose.setAttribute('tabindex', '0');
            fileClose.setAttribute('class', "cmp-adaptiveform-fileinput__filedelete");
            fileClose.setAttribute('aria-label', FormView.LanguageUtils.getTranslatedString(this.lang, "FileCloseAccessText") + fileName);
            fileClose.textContent = "x";
            fileClose.addEventListener('keypress', function(e) {
                if (e.keyCode === 13 || e.charCode === 32) {
                    e.target.click();
                }
            });
            fileClose.addEventListener('click', function(e) {
                self.handleClick(e);
            });
            fileEndContainer.appendChild(fileSizeDom);
            fileEndContainer.appendChild(fileClose);
            fileItem.appendChild(fileEndContainer);
            return fileItem;
        }
        validateFile(file, invalidFilesByType) {
            let currFileName = file.name.split("\\").pop();
            let size = file.size / 1024 / 1024;
            if (file.size === 0) {
                invalidFilesByType.SIZE_ZERO.push(currFileName);
                return false;
            } else if (size > parseFloat(this.options.maxFileSize)) {
                invalidFilesByType.SIZE.push(currFileName);
                return false;
            } else if (!FileInputWidget.isValid(currFileName)) {
                invalidFilesByType.NAME.push(currFileName);
                return false;
            } else {
                let isMatch = false;
                let extension = currFileName.split('.').pop();
                let mimeType = (file.type) ? file.type : this.extensionToMimeTypeMap[extension];
                if (mimeType && mimeType.trim().length > 0) {
                    isMatch = this.regexMimeTypeList.some(rx => rx.test(mimeType));
                }
                if (!isMatch) {
                    invalidFilesByType.MIMETYPE.push(currFileName);
                    return false;
                }
            }
            return true;
        }
        handleChange(filesUploaded) {
            if (!this.isFileUpdate) {
                let self = this,
                    files = filesUploaded;
                // Object of arrays to collect invalid file names by type
                let invalidFilesByType = { SIZE: [], SIZE_ZERO: [], NAME: [], MIMETYPE: [] };
                if (typeof files !== "undefined") {
                    let invalidFilesIndexes = [];
                    Array.from(files).forEach(function (file, fileIndex) {
                        if (self.validateFile(file, invalidFilesByType)) {
                            if (self.isMultiSelect()) {
                                self.values.push(file.name.split("\\").pop());
                                self.fileArr.push(file);
                            } else {
                                self.values = [file.name.split("\\").pop()];
                                self.fileArr = [file];
                            }
                        } else {
                            invalidFilesIndexes.push(fileIndex);
                        }
                    }, this);
                    if (invalidFilesIndexes.length > 0 && this.widget !== null) {
                        this.deleteFilesFromInputDom(invalidFilesIndexes);
                    }
                }
                // set the new model value.
                this.model.value = this.fileArr;
                // Collate all error messages
                let errorMessages = [];
                if (invalidFilesByType.SIZE_ZERO.length > 0) {
                    errorMessages.push(this.showInvalidMessage(invalidFilesByType.SIZE_ZERO.join(', '), this.invalidFeature.SIZE_ZERO));
                }
                if (invalidFilesByType.SIZE.length > 0) {
                    errorMessages.push(this.showInvalidMessage(invalidFilesByType.SIZE.join(', '), this.invalidFeature.SIZE));
                }
                if (invalidFilesByType.NAME.length > 0) {
                    errorMessages.push(this.showInvalidMessage(invalidFilesByType.NAME.join(', '), this.invalidFeature.NAME));
                }
                if (invalidFilesByType.MIMETYPE.length > 0) {
                    errorMessages.push(this.showInvalidMessage(invalidFilesByType.MIMETYPE.join(', '), this.invalidFeature.MIMETYPE));
                }
                if (errorMessages.length > 0) {
                    alert(errorMessages.join('\n'));
                }
            }
            this.widget.value = null;
        }
        showInvalidMessage(fileNames, invalidFeature) {
            let that = this;
            let IS_IPAD = navigator.userAgent.match(/iPad/i) !== null,
                IS_IPHONE = (navigator.userAgent.match(/iPhone/i) !== null);
            if (IS_IPAD || IS_IPHONE) {
                setTimeout(function () {
                    return that.invalidMessage(fileNames, invalidFeature);
                }, 0);
            } else {
                return this.invalidMessage(fileNames, invalidFeature);
            }
        }
        invalidMessage(fileNames, invalidFeature) {
            const customMessages = this.options.constraintMessages || {};
            const messages = {
                [this.invalidFeature.SIZE]: customMessages.maxFileSize || FormView.LanguageUtils.getTranslatedString(this.lang, "FileSizeGreater", [fileNames, this.options.maxFileSize]),
                [this.invalidFeature.NAME]: customMessages.invalidFileName || FormView.LanguageUtils.getTranslatedString(this.lang, "FileNameInvalid", [fileNames]),
                [this.invalidFeature.MIMETYPE]: customMessages.invalidMimeType || FormView.LanguageUtils.getTranslatedString(this.lang, "FileMimeTypeInvalid", [fileNames]),
                [this.invalidFeature.SIZE_ZERO]: customMessages.zeroFileSize || FormView.LanguageUtils.getTranslatedString(this.lang, "FileSizeZero", [fileNames])
            };
            return messages[invalidFeature];
        }

        handleClick (event){
            let elem = event.target,
                text = elem.parentElement.previousSibling.textContent,
                index = this.getIndexOfText(text, elem.parentElement),
                url = elem.parentElement.previousSibling.dataset.key,
                objectUrl = elem.parentElement.previousSibling.dataset.objectUrl;   
            if (index !== -1) {
                this.values.splice(index, 1);
                this.fileArr.splice(index, 1);
                // set the model with the new value
                this.model.value = this.fileArr;
                // value and fileArr contains items of both URL and file types, hence while removing from DOM
                // get the correct index as per this.#widget.files
                let domIndex = Array.from(this.widget.files).findIndex(function(file) {
                return file.name === text;
                });
                this.deleteFilesFromInputDom([domIndex]);
                if (url != null) {
                    // remove the data so that others don't use this url
                    delete elem.parentElement.previousSibling.dataset.key;
                }
                if(objectUrl) {
                    // revoke the object URL to avoid memory leaks in browser
                    // since file is anyways getting deleted, remove the object URL's too
                    window.URL.revokeObjectURL(objectUrl);
                }
            }
            // Remove the dom from view
            //All bound events and jQuery data associated with the element are also removed
            elem.parentElement.parentElement.remove();
            // Set the focus on file upload button after click of close
            this.widget.focus();

        }
    }
}
/*******************************************************************************
 * Copyright 2025 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
(function() {

    "use strict";
    class FileInputV4 extends FormView.FormFileInput {

        static NS = FormView.Constants.NS;
        /**
         * Each FormField has a data attribute class that is prefixed along with the global namespace to
         * distinguish between them. If a component wants to put a data-attribute X, the attribute in HTML would be
         * data-{NS}-{IS}-x=""
         * @type {string}
         */
        static IS = "adaptiveFormFileInput";
        static bemBlock = 'cmp-adaptiveform-fileinput'
        static selectors  = {
            self: "[data-" + this.NS + '-is="' + this.IS + '"]',
            widget: `.${FileInputV4.bemBlock}__widget`,
            label: `.${FileInputV4.bemBlock}__label`,
            description: `.${FileInputV4.bemBlock}__longdescription`,
            qm: `.${FileInputV4.bemBlock}__questionmark`,
            errorDiv: `.${FileInputV4.bemBlock}__errormessage`,
            tooltipDiv: `.${FileInputV4.bemBlock}__shortdescription`,
            fileListDiv : `.${FileInputV4.bemBlock}__filelist`,
            attachButtonLabel : `.${FileInputV4.bemBlock}__widgetlabel`,
            dragArea: `.${FileInputV4.bemBlock}__dragarea`
        };

        constructor(params) {
            super(params);
        }
        widgetFields = {
            widget: this.getWidget(),
            fileListDiv: this.getFileListDiv(),
            model: () => this._model,
            dragArea: this.getDragArea()
        };
        
        getWidget() {
            return this.element.querySelector(FileInputV4.selectors.widget);
        }

        getDragArea() {
            return this.element.querySelector(FileInputV4.selectors.dragArea);
        }

        getDescription() {
            return this.element.querySelector(FileInputV4.selectors.description);
        }

        getLabel() {
            return this.element.querySelector(FileInputV4.selectors.label);
        }

        getErrorDiv() {
            return this.element.querySelector(FileInputV4.selectors.errorDiv);
        }

        getTooltipDiv() {
            return this.element.querySelector(FileInputV4.selectors.tooltipDiv);
        }

        getQuestionMarkDiv() {
            return this.element.querySelector(FileInputV4.selectors.qm);
        }

        getFileListDiv() {
            return this.element.querySelector(FileInputV4.selectors.fileListDiv);
        }

        getAttachButtonLabel() {
            return this.element.querySelector(FileInputV4.selectors.attachButtonLabel);
        }

        updateEnabled(enabled, state) {
            if (this.widget) {
                this.element.setAttribute(FormView.Constants.DATA_ATTRIBUTE_ENABLED, enabled);
                const isDisabled = !enabled || state.readOnly;
                if (isDisabled) {
                    this.widget.setAttribute("disabled", "disabled");
                } else {
                    this.widget.removeAttribute("disabled");
                }
            }
        }

        updateValue(value) {
            if (this.widgetObject == null) {
                this.widgetObject = new FileInputWidget(this.widgetFields);
            }
            this.widgetObject.setValue(value);
            super.updateEmptyStatus();
        }

        setModel(model) {
            super.setModel(model);
            if (this.widgetObject == null) {
                this.widgetObject = new FileInputWidget(this.widgetFields);
            }
            this.getAttachButtonLabel().addEventListener('focus', () => {
                this.setActive();
            })
            this.getAttachButtonLabel().addEventListener('blur', () => {
                this.setInactive();
            })
        }

        syncWidget() {
            let widgetElement = this.getWidget ? this.getWidget() : null;
            if (widgetElement) {
                widgetElement.id = this.getId() + "__widget";
                const closestElement = widgetElement?.previousElementSibling;
                if (closestElement && closestElement.tagName.toLowerCase() === 'label') {
                    closestElement.setAttribute('for', this.getId() + "__widget");
                } else {
                    this.getAttachButtonLabel().removeAttribute('for');
                }
            }
        }
    }

    FormView.Utils.setupField(({element, formContainer}) => {
        return new FileInputV4({element, formContainer})
    }, FileInputV4.selectors.self);

})();

/*******************************************************************************
 * Copyright 2022 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
(function () {

    function onAccordionMixinLoaded(event) {
        const AccordionMixin = event.detail.AccordionMixin;

        class Accordion extends AccordionMixin(FormView.FormPanel) {

            static NS = FormView.Constants.NS;
            static DATA_ATTRIBUTE_VISIBLE = 'data-cmp-visible';
            _templateHTML = {};
            static selectors = {
                self: "[data-" + this.NS + '-is="' + this.IS + '"]',
                widget: `.${Accordion.bemBlock}__widget`,
                description: `.${Accordion.bemBlock}__longdescription`,
                qm: `.${Accordion.bemBlock}__questionmark`,
                tooltipDiv: `.${Accordion.bemBlock}__shortdescription`,
                label: `.${Accordion.bemBlock}__label`,
                item: `.${Accordion.bemBlock}__item`
            };

            static keyCodes = {
                ENTER: 13,
                SPACE: 32,
                END: 35,
                HOME: 36,
                ARROW_LEFT: 37,
                ARROW_UP: 38,
                ARROW_RIGHT: 39,
                ARROW_DOWN: 40
            };

            constructor(params) {
                super(params);
                const {element} = params;
                this.cacheElements(element);
                if (this.getCachedItems()) {
                    var expandedItems = this.getExpandedItems();
                    // multiple expanded items annotated, display the last item open.
                    if (expandedItems.length > 1) {
                        var lastExpandedItem = expandedItems[expandedItems.length - 1]
                        this.expandItem(lastExpandedItem);
                        this.collapseAllOtherItems(lastExpandedItem.id);
                    }
                    this.refreshItems();
                    this.#bindEvents();
                }
            }

            getClass() {
                return Accordion.IS;
            }

            getWidget() {
                return null;
            }

            getDescription() {
                return this.element.querySelector(Accordion.selectors.description);
            }

            getLabel() {
                return this.element.querySelector(Accordion.selectors.label);
            }

            getErrorDiv() {
                return null;
            }

            getTooltipDiv() {
                return this.element.querySelector(Accordion.selectors.tooltipDiv);
            }

            getQuestionMarkDiv() {
                return this.element.querySelector(Accordion.selectors.qm);
            }

            setFocus(id) {
                super.setFocus(id);
                this.setActive();
                this.#collapseAllItems();
                const item = this.getItemById(id + '-item');
                this.expandItem(item)
            }

            #collapseAllItems() {
                var items = this.getCachedItems();
                if (items) {
                    for (var i = 0; i < items.length; i++) {
                        if (this.isItemExpanded(items[i])) {
                            this.collapseItem(items[i])
                        }
                    }
                }
            }

            /**
             * Binds Accordion event handling.
             *
             * @private
             */
            #bindEvents() {
                var buttons = this.getCachedButtons();
                if (buttons) {
                    var _self = this;
                    for (var i = 0; i < buttons.length; i++) {
                        (function (index) {
                            buttons[index].addEventListener("click", function (event) {
                                var itemDivId = _self.#convertToItemDivId(buttons[index].id);
                                _self.toggle(itemDivId);
                                _self.collapseAllOtherItems(itemDivId);
                                _self.#focusButton(buttons[index].id);
                            });
                            buttons[index].addEventListener("keydown", function (event) {
                                _self.#onButtonKeyDown(event, buttons[index].id);
                            });
                        })(i);
                    }
                }
            }

            /**
             * Binds Accordion event handling.
             *
             * @private
             */
            #bindEventsToAddedChild(addedChildId) {
                var _self = this;
                var buttonId = addedChildId + Accordion.idSuffixes.button;
                var button = this.#getButtonById(buttonId);
                button.addEventListener("click", function (event) {
                    var itemDivId = _self.#convertToItemDivId(buttonId);
                    _self.toggle(itemDivId);
                    _self.collapseAllOtherItems(itemDivId);
                    _self.#focusButton(buttonId);
                });
                button.addEventListener("keydown", function (event) {
                    _self.#onButtonKeyDown(event, buttonId);
                });
            }

            /**
             * Handles button keydown events.
             *
             * @private
             * @param {Object} event The keydown event
             * @param {Number} id The id of the button triggering the event
             */
            #onButtonKeyDown(event, id) {
                var buttons = this.getCachedButtons();
                var lastIndex = buttons.length - 1;
                var index = this.#getButtonIndexById(id);

                switch (event.keyCode) {
                    case Accordion.keyCodes.ARROW_LEFT:
                    case Accordion.keyCodes.ARROW_UP:
                        event.preventDefault();
                        if (index > 0) {
                            this.#focusButton(buttons[index - 1].id);
                        }
                        break;
                    case Accordion.keyCodes.ARROW_RIGHT:
                    case Accordion.keyCodes.ARROW_DOWN:
                        event.preventDefault();
                        if (index < lastIndex) {
                            this.#focusButton(buttons[index + 1].id);
                        }
                        break;
                    case Accordion.keyCodes.HOME:
                        event.preventDefault();
                        this.#focusButton(buttons[0].id);
                        break;
                    case Accordion.keyCodes.END:
                        event.preventDefault();
                        this.#focusButton(buttons[lastIndex].id);
                        break;
                    case Accordion.keyCodes.ENTER:
                    case Accordion.keyCodes.SPACE:
                        event.preventDefault();
                        var itemDivId = this.#convertToItemDivId(buttons[index].id);
                        this.toggle(itemDivId);
                        this.collapseAllOtherItems(itemDivId);
                        this.#focusButton(buttons[index].id);
                        break;
                    default:
                        return;
                }
            }

            /**
             * Focuses the button at the provided index.
             *
             * @private
             * @param {Number} id The id of the button to focus
             */
            #focusButton(id) {
                var button = this.#getButtonById(id);
                button.focus();
            }

            addChild(childView) {
                super.addChild(childView);
                this.#cacheTemplateHTML(childView);
                if (this.getCountOfAllChildrenInModel() === this.children.length) {
                    this.cacheClosestFieldsInView();
                    this.handleHiddenChildrenVisibility();
                }
            }

            /**
             * Adds unique HTML for added instance corresponding to requirements of different types of repeatableParent
             * @param instanceManager of the repeated component
             * @param addedModel of the repeated component
             * @param htmlElement of the repeated component
             */
            addRepeatableMarkup(instanceManager, addedModel, htmlElement) {
                var accordionItemDivToBeRepeated = this.#prepareAccordionMarkupToBeAdded(instanceManager, addedModel, htmlElement);
                let result = this.#getBeforeViewElement(instanceManager, addedModel.index);
                if (result.beforeViewElement != null) {
                    result.beforeViewElement.after(accordionItemDivToBeRepeated);
                } else if (result.parentElement != null) {
                    var firstChildAccordionItem = result.parentElement.querySelector(Accordion.selectors.item);
                    if (firstChildAccordionItem != null) {
                        result.parentElement.insertBefore(accordionItemDivToBeRepeated, firstChildAccordionItem);
                    } else {
                        result.parentElement.append(accordionItemDivToBeRepeated);
                    }
                }
                this.#showHideRepeatableButtons(instanceManager);
                return accordionItemDivToBeRepeated;
            }

            focusOnRepeatableInstances(id) {
                const panelId = id.replace(Accordion.idSuffixes.item, "");
                const form = this.formContainer.getModel();
                const tab = this.getModel().getState().items.find(item => item.type === 'array')?.items?.find(subItem => subItem.id === panelId)
                const field = form.getElement(tab?.id);
                if (field) {
                    setTimeout(() => {form.setFocus(field)}, 0);
                }
            }

            handleChildAddition(childView) {
                var itemDivToExpand;
                this.cacheElements(this._elements.self);
                this.#bindEventsToAddedChild(childView.id);
                if (childView.getInstanceManager().getModel().minOccur != undefined && childView.getInstanceManager().children.length > childView.getInstanceManager().getModel().minOccur) {
                    itemDivToExpand = this.getItemById(childView.id + Accordion.idSuffixes.item);
                } else {
                    //this will run at initial runtime loading when the repeatable panel is being added minOccur no of times.
                    // in this case we want the focus to stay at first tab
                    itemDivToExpand = this.findFirstVisibleChild(this.getCachedItems());
                }
                this.expandItem(itemDivToExpand);
                this.collapseAllOtherItems(itemDivToExpand.id);

                const cachedItems = this.getCachedItems();
                const newIndex = cachedItems.indexOf(itemDivToExpand);
                this.getCachedButtons()[newIndex].classList.remove(this.constructor.cssClasses.button.stepped);
                this.getCachedPanels()[newIndex].classList.remove(this.constructor.cssClasses.panel.stepped);

                this.focusOnRepeatableInstances(itemDivToExpand.id);

                this.#showHideRepeatableButtons(childView.getInstanceManager());
            }

            handleChildRemoval(removedInstanceView) {
                var removedAccordionItemDivId = removedInstanceView.element.id + Accordion.idSuffixes.item;
                var removedAccordionItemDiv = this.getItemById(removedAccordionItemDivId);
                
                // Find the previous item before removing the current one
                var cachedItems = this.getCachedItems();
                var currentIndex = cachedItems.indexOf(removedAccordionItemDiv);
                var itemDivToExpand = null;
                
                // If there are items and current item is found
                if (cachedItems && cachedItems.length > 0 && currentIndex > -1) {
                    // If there's a previous item, use it
                    if (currentIndex > 0) {
                        itemDivToExpand = cachedItems[currentIndex - 1];
                    } else {
                        // If we're removing the first item, use the next one if available
                        itemDivToExpand = cachedItems[1] || null;
                    }
                }
                
                // Now remove the item
                removedAccordionItemDiv.remove();
                this.children.splice(this.children.indexOf(removedInstanceView), 1);
                this.cacheElements(this._elements.self);
                
                // Expand the target item if found
                if (itemDivToExpand) {
                    this.expandItem(itemDivToExpand);
                    this.collapseAllOtherItems(itemDivToExpand.id);
                    this.focusOnRepeatableInstances(itemDivToExpand.id)
                }

                this.#showHideRepeatableButtons(removedInstanceView.getInstanceManager());
            }

            #syncLabel() {
                let labelElement = typeof this.getLabel === 'function' ? this.getLabel() : null;
                if (labelElement) {
                    labelElement.setAttribute('for', this.getId());
                }
            }

            syncMarkupWithModel() {
                super.syncMarkupWithModel();
                this.#syncLabel();
                for (var itemDiv of this.getCachedItems()) {
                    this.#syncAccordionMarkup(itemDiv);
                }
            }

            getChildViewByIndex(index) {
                var accordionPanels = this.getCachedPanels();
                var fieldId = accordionPanels[index].id.substring(0, accordionPanels[index].id.lastIndexOf("-"));
                return this.getChild(fieldId);
            }

            #getBeforeViewElement(instanceManager, instanceIndex) {
                var result = {};
                var instanceManagerId = instanceManager.getId();
                if (instanceIndex == 0) {
                    var closestNonRepeatableFieldId = this._templateHTML[instanceManagerId]['closestNonRepeatableFieldId'];
                    var closestRepeatableFieldInstanceManagerIds = this._templateHTML[instanceManagerId]['closestRepeatableFieldInstanceManagerIds'];
                    var indexToInsert = this.getIndexToInsert(closestNonRepeatableFieldId, closestRepeatableFieldInstanceManagerIds);
                    if (indexToInsert > 0) {
                        result.beforeViewElement = this.getCachedItems()[indexToInsert - 1];
                    } else {
                        result.parentElement = this.element;
                    }
                } else {
                    let previousInstanceElement = this.#getRepeatableElementAt(instanceManager, instanceIndex - 1);
                    result.beforeViewElement = previousInstanceElement;
                }
                return result;
            }

            #getRepeatableElementAt(instanceManager, index) {
                let childId = instanceManager._model.items.find((model) => model.index === index)?.id;
                return this.element.querySelector(`#${childId}${Accordion.idSuffixes.item}`);
            }

            #prepareAccordionMarkupToBeAdded(instanceManager, addedModel, htmlElement) {
                var accordionItemDivToBeRepeated = this._templateHTML[instanceManager.getId()]['accordionItemDiv'].cloneNode(true);
                var itemDivId = accordionItemDivToBeRepeated.id;
                var accordionPanelId = this.#convertToPanelId(itemDivId);
                var accordionPanelToBeRepeated = accordionItemDivToBeRepeated.querySelector('#' + accordionPanelId);
                while (accordionPanelToBeRepeated.hasChildNodes()) {
                    accordionPanelToBeRepeated.removeChild(accordionPanelToBeRepeated.firstChild);
                }
                accordionPanelToBeRepeated.append(htmlElement);
                this.#syncAccordionMarkup(accordionItemDivToBeRepeated);
                return accordionItemDivToBeRepeated;
            }

            #syncAccordionMarkup(accordionItemDiv) {
                var accordionItemDivId = accordionItemDiv.id;
                var accordionPanelId = this.#convertToPanelId(accordionItemDivId);
                var accordionButtonId = this.#convertToButtonId(accordionItemDivId);
                var accordionButton = accordionItemDiv.querySelector('#' + accordionButtonId);
                var accordionPanelDiv = accordionItemDiv.querySelector('#' + accordionPanelId);
                var childViewId = accordionItemDiv.querySelector("[data-cmp-is]").id;
                accordionItemDiv.id = childViewId + Accordion.idSuffixes.item;
                accordionButton.id = childViewId + Accordion.idSuffixes.button;
                accordionPanelDiv.id = childViewId + Accordion.idSuffixes.panel;
                accordionButton.setAttribute("aria-controls", childViewId + Accordion.idSuffixes.panel);
                accordionPanelDiv.setAttribute("aria-labelledby", childViewId + Accordion.idSuffixes.button);
                var accordionAdd = accordionItemDiv.querySelector(".cmp-accordion__add-button");
                if (accordionAdd) {
                    accordionAdd.setAttribute('data-cmp-hook-add-instance', childViewId);
                }
                var accordionRemove = accordionItemDiv.querySelector(".cmp-accordion__remove-button");
                if (accordionRemove) {
                    accordionRemove.setAttribute('data-cmp-hook-remove-instance', childViewId);
                }
            }

            #cacheTemplateHTML(childView) {
                if (childView.getInstanceManager() != null && (this._templateHTML == null || this._templateHTML[childView.getInstanceManager().getId()] == null)) {
                    var accordionItemDivId = childView.element.id + Accordion.idSuffixes.item;
                    var instanceManagerId = childView.getInstanceManager().getId();
                    var accordionItemDiv = this.getItemById(accordionItemDivId);
                    this._templateHTML[instanceManagerId] = {};
                    this._templateHTML[instanceManagerId]['accordionItemDiv'] = accordionItemDiv;
                }
            }

            #getButtonById(buttonId) {
                var buttons = this.getCachedButtons();
                if (buttons) {
                    for (var i = 0; i < buttons.length; i++) {
                        if (buttons[i].id === buttonId) {
                            return buttons[i];
                        }
                    }
                }
            }

            #getButtonIndexById(buttonId) {
                var buttons = this.getCachedButtons();
                if (buttons) {
                    for (var i = 0; i < buttons.length; i++) {
                        if (buttons[i].id === buttonId) {
                            return i;
                        }
                    }
                }
                return -1;
            }

            /**
             * Changes provided panel or buttonId to ItemId
             *
             * @private
             * @param {Number} id The id of the panel/button to convert to corresponding item div
             */
            #convertToItemDivId(idToConvert) {
                return idToConvert.substring(0, idToConvert.lastIndexOf("-")) + Accordion.idSuffixes.item;
            }

            /**
             * Changes provided panel or item id to Button Id
             *
             * @private
             * @param {Number} id The id of the panel/item to convert to corresponding button id
             */
            #convertToButtonId(idToConvert) {
                return idToConvert.substring(0, idToConvert.lastIndexOf("-")) + Accordion.idSuffixes.button;
            }

            /**
             * Changes provided button or item id to Panel Id
             *
             * @private
             * @param {Number} id The id of the button/item to convert to corresponding button id
             */
            #convertToPanelId(idToConvert) {
                return idToConvert.substring(0, idToConvert.lastIndexOf("-")) + Accordion.idSuffixes.panel;
            }

            updateChildVisibility(visible, state) {
                this.updateVisibilityOfNavigationElement(this.getItemById(state.id + Accordion.idSuffixes.item), visible);
                if (!visible) {
                    var expandedItems = this.getExpandedItems();
                    for (let i = 0; i < expandedItems.length; i++) {
                        if (expandedItems[i].getAttribute(Accordion.DATA_ATTRIBUTE_VISIBLE) === 'false') {
                            this.collapseItem(expandedItems[i]);
                        }
                    }
                    let child = this.findFirstVisibleChild(this.getCachedItems());
                    if (child) {
                        this.expandItem(child);
                    }
                }
            }

            getRepeatableRootElement(childView) {
                return this.element.querySelector('#' + childView.id + '-item div[data-cmp-hook-adaptiveFormAccordion="repeatableButton"]')
            }

            #showHideRepeatableButtons(instanceManager) {
                const {_model: {minOccur, maxOccur, items = []} = {}, children} = instanceManager;
                children.forEach(child => {
                    const addButtonElement = this.element.querySelector('#' + child.id + '-item')?.querySelector('[data-cmp-hook-add-instance]');
                    const removeButtonElement = this.element.querySelector('#' + child.id + '-item')?.querySelector('[data-cmp-hook-remove-instance]');
                    if (addButtonElement) {
                        addButtonElement.setAttribute(Accordion.DATA_ATTRIBUTE_VISIBLE, !(items.length === maxOccur && maxOccur != -1))
                    }
                    if (removeButtonElement) {
                        removeButtonElement.setAttribute(Accordion.DATA_ATTRIBUTE_VISIBLE, items.length > minOccur && minOccur != -1)
                    }
                });
            }
        }

        FormView.Utils.setupField(({element, formContainer}) => {
            return new Accordion({element, formContainer})
        }, Accordion.selectors.self);
    }

    if (window.Forms && window.Forms.CoreComponentsCommons && window.Forms.CoreComponentsCommons.AccordionMixin) {
        onAccordionMixinLoaded({ detail: { AccordionMixin: window.Forms.CoreComponentsCommons.AccordionMixin } });
    } else {
        window.addEventListener('AccordionMixinLoaded', onAccordionMixinLoaded);
    }
})();

/*******************************************************************************
 * Copyright 2022 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/

(function () {

    class Tabs extends FormView.FormTabs {
        _templateHTML = {};
        static NS = FormView.Constants.NS;
        static IS = "adaptiveFormTabs";
        static bemBlock = "cmp-tabs";
        static selectors = {
            self: "[data-" + this.NS + '-is="' + this.IS + '"]',
            active: {
                tab: "cmp-tabs__tab--active",
                tabpanel: "cmp-tabs__tabpanel--active"
            },
            stepped: {
                tab: "cmp-tabs__tab--stepped",
                tabpanel: "cmp-tabs__tabpanel--stepped"
            },
            label: `.${Tabs.bemBlock}__label`,
            description: `.${Tabs.bemBlock}__longdescription`,
            qm: `.${Tabs.bemBlock}__questionmark`,
            tooltipDiv: `.${Tabs.bemBlock}__shortdescription`,
            olTabList: `.${Tabs.bemBlock}__tablist`,
            widget: `.${Tabs.bemBlock}__tablist`
        };

        constructor(params) {
            super(params, Tabs.NS, Tabs.IS, Tabs.selectors);
        }


        getClass() {
            return Tabs.IS;
        }

        setFocus(id) {
            super.setFocus(id);
            this.setActive();
            if (id) {
                this.navigateAndFocusTab(id + '__tab');
            }
        }

        getWidget() {
            return this.element.querySelector(Tabs.selectors.widget);
        }

        getDescription() {
            return this.element.querySelector(Tabs.selectors.description);
        }

        getLabel() {
            return this.element.querySelector(Tabs.selectors.label);
        }

        getErrorDiv() {
            return this.element.querySelector(Tabs.selectors.errorDiv);
        }

        getTooltipDiv() {
            return this.element.querySelector(Tabs.selectors.tooltipDiv);
        }

        getQuestionMarkDiv() {
            return this.element.querySelector(Tabs.selectors.qm);
        }
    }

    FormView.Utils.setupField(({element, formContainer}) => {
        return new Tabs({element, formContainer})
    }, Tabs.selectors.self);

}());

/*******************************************************************************
 * Copyright 2022 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/

(function () {

    function onWizardMixinLoaded(event) {
        const WizardMixin = event.detail.WizardMixin;
        const keyCodes = {
            END: 35,
            HOME: 36,
            ARROW_LEFT: 37,
            ARROW_UP: 38,
            ARROW_RIGHT: 39,
            ARROW_DOWN: 40
        };

        class Wizard extends WizardMixin(FormView.FormPanel) {

            _templateHTML = {};

            static NS = FormView.Constants.NS;
            static #tabIdSuffix = "_wizard-item-nav";
            static #wizardPanelIdSuffix = "__wizardpanel";

            static selectors = {
                self: "[data-" + Wizard.NS + '-is="' + Wizard.IS + '"]',
                active: {
                    tab: "cmp-adaptiveform-wizard__tab--active",
                    wizardpanel: "cmp-adaptiveform-wizard__wizardpanel--active"
                },
                stepped: {
                    tab: "cmp-adaptiveform-wizard__tab--stepped",
                    wizardpanel: "cmp-adaptiveform-wizard__wizardpanel--stepped",
                },
                label: `.${Wizard.bemBlock}__label`,
                description: `.${Wizard.bemBlock}__longdescription`,
                qm: `.${Wizard.bemBlock}__questionmark`,
                widget: `.${Wizard.bemBlock}__widget`,
                tooltipDiv: `.${Wizard.bemBlock}__shortdescription`,
                previousButton: `.${Wizard.bemBlock}__previousNav`,
                previousButtonHidden: "cmp-adaptiveform-wizard__previousNav--hidden",
                nextButton: `.${Wizard.bemBlock}__nextNav`,
                previousButtonV2: `.${Wizard.bemBlock}__nav--previous`,
                nextButtonV2: `.${Wizard.bemBlock}__nav--next`,
                nextButtonHidden: "cmp-adaptiveform-wizard__nextNav--hidden",
                olTabList: `.${Wizard.bemBlock}__tabList`
            };

            constructor(params) {
                super(params);
                const {element} = params;
                this.cacheElements(element);
                this.setActive(this.getCachedTabs())
                this._active = this.getActiveIndex(this.getCachedTabs());
                this.#setNavigationRange();
                this.#hideUnhideNavButtons(this._active);
                this.refreshActive();

                this.#bindEvents();
            }

            getClass() {
                return Wizard.IS;
            }

            setFocus(id) {
                super.setFocus(id);
                this.setActive();
                const index = this.#getTabIndexById(id + '_wizard-item-nav');
                this.navigate(index);
            }

            getWidget() {
                return this.element.querySelector(Wizard.selectors.widget);
            }

            getDescription() {
                return this.element.querySelector(Wizard.selectors.description);
            }

            getLabel() {
                return this.element.querySelector(Wizard.selectors.label);
            }

            getErrorDiv() {
                return this.element.querySelector(Wizard.selectors.errorDiv);
            }

            getTooltipDiv() {
                return this.element.querySelector(Wizard.selectors.tooltipDiv);
            }

            getQuestionMarkDiv() {
                return this.element.querySelector(Wizard.selectors.qm);
            }

            getPreviousButtonDiv() {
                return (this.element.querySelector(Wizard.selectors.previousButton) || this.element.querySelector(Wizard.selectors.previousButtonV2));
            }

            getNextButtonDiv() {
                return (this.element.querySelector(Wizard.selectors.nextButton) || this.element.querySelector(Wizard.selectors.nextButtonV2));
            }

            #getTabListElement() {
                return this.element.querySelector(Wizard.selectors.olTabList)
            }


            /**
             * Binds navigation buttons event handling
             *
             * @private
             */
            #bindEvents() {
                const _self = this;
                const actionKeys = ['Enter', ' ', 'Spacebar', 'Space'];

                ["click", "keydown"].forEach(function(event){
                    _self.getNextButtonDiv().addEventListener(event, function(event){
                        if (event.type ==='click' || (event.type === 'keydown' && actionKeys.includes(event.key))) {
                            _self.#navigateToNextTab();
                        }
                    });
                    _self.getPreviousButtonDiv().addEventListener(event, function(event){
                        if (event.type ==='click' || (event.type === 'keydown' && actionKeys.includes(event.key))) {
                            _self.#navigateToPreviousTab();
                        }
                    });
                })
            }

            /**
             * Handles tab keydown events
             *
             * @private
             * @param {Object} event The keydown event
             */
            #onKeyDown(event) {
                const index = this._active;

                const lastIndex = this.getCachedTabs().length - 1;

                switch (event.keyCode) {
                    case keyCodes.ARROW_LEFT:
                    case keyCodes.ARROW_UP:
                        event.preventDefault();
                        if (index > 0) {
                            this.#navigateAndFocusTab(index - 1);
                        }
                        break;
                    case keyCodes.ARROW_RIGHT:
                    case keyCodes.ARROW_DOWN:
                        event.preventDefault();
                        if (index < lastIndex) {
                            this.#navigateAndFocusTab(index + 1);
                        }
                        break;
                    case keyCodes.HOME:
                        event.preventDefault();
                        this.#navigateAndFocusTab(0);
                        break;
                    case keyCodes.END:
                        event.preventDefault();
                        this.#navigateAndFocusTab(lastIndex);
                        break;
                    default:
                        return;
                }
            }

            /**
             * Refreshes the tab markup based on the current {@code Tabs_active} index
             *
             * @private
             */
            refreshActive() {
                super.refreshActive();
                this.#hideUnhideNavButtons(this._active);
            }

            /**
             * Focuses the element and prevents scrolling the element into view
             *
             * @param {HTMLElement} element Element to focus
             */
            focusWithoutScroll(element) {
                const x = window.scrollX || window.pageXOffset;
                const y = window.scrollY || window.pageYOffset;
                element.focus();
                window.scrollTo(x, y);
            }


            getFocusElementId() {
                const activeIndex = this._active;
                const activeTabElement = this.getCachedTabs()[activeIndex];
                return activeTabElement.id.substring(0, activeTabElement.id.lastIndexOf(Wizard.#tabIdSuffix));
            }

            #navigateToNextTab() {
                const activeIndex = this._active;
                const activeTabElement = this.getCachedTabs()[activeIndex];
                const activeChildId = activeTabElement.id.substring(0, activeTabElement.id.lastIndexOf(Wizard.#tabIdSuffix));
                const activeChildView = this.getChild(activeChildId);
                let activeChildModel;
                if (activeChildView) {
                    activeChildModel = activeChildView.getModel();
                } else {
                    activeChildModel = this.getModel().items.find(child => child.id === activeChildId);
                }
                let validationErrorList;
                if (!this.#isAuthoring()) {
                    validationErrorList = activeChildModel.validate();
                }
                if (validationErrorList === undefined || validationErrorList.length == 0) {
                    let tabs = this.getCachedTabs();
                    let nextVisibleIndex = this.#findNextVisibleChildIndex(activeIndex);
                    if (tabs && nextVisibleIndex >= 0) {
                        this.#navigateAndFocusTab(nextVisibleIndex);
                    }
                }
                this.#hideUnhideNavButtons(this._active);
            }

            #isAuthoring() {
                return window.Granite && window.Granite.author;
            }

            #navigateToPreviousTab() {
                const activeIndex = this._active;
                const tabs = this.getCachedTabs();
                const lastVisibleIndex = this.#findLastVisibleChildIndex(activeIndex);
                if (tabs && lastVisibleIndex >= 0) {
                    this.#navigateAndFocusTab(lastVisibleIndex);
                }
                this.#hideUnhideNavButtons(this._active);
            }

            /**
             * Hides or shows, next and previous navigation buttons
             *
             * @private
             * @param {Number} index The index of the tab to navigate to
             * @param {Number} total number of tabs
             */
            #hideUnhideNavButtons(activeTabIndex) {
                const tabsLength = this.getCachedTabs() ? this.getCachedTabs().length : 0;

                const nextVisible = this.#findNextVisibleChildIndex(activeTabIndex);
                const previousVisible = this.#findLastVisibleChildIndex(activeTabIndex);

                if (tabsLength === 0 || this.maxEnabledTab <= this.minEnabledTab) {
                    this.getPreviousButtonDiv().setAttribute(Wizard.DATA_ATTRIBUTE_VISIBLE, "false");
                    this.getNextButtonDiv().setAttribute(Wizard.DATA_ATTRIBUTE_VISIBLE, "false");
                }

                if (activeTabIndex <= this.minEnabledTab || previousVisible === -1) {
                    this.getPreviousButtonDiv().setAttribute(Wizard.DATA_ATTRIBUTE_VISIBLE, "false");
                }
                if (activeTabIndex === this.maxEnabledTab || nextVisible === -1) {
                    this.getNextButtonDiv().setAttribute(Wizard.DATA_ATTRIBUTE_VISIBLE, "false");
                }

                if (tabsLength > 1 && activeTabIndex > this.minEnabledTab && previousVisible > -1) {
                    this.getPreviousButtonDiv().setAttribute(Wizard.DATA_ATTRIBUTE_VISIBLE, "true");
                }

                if (activeTabIndex < this.maxEnabledTab && nextVisible > -1) {
                    this.getNextButtonDiv().setAttribute(Wizard.DATA_ATTRIBUTE_VISIBLE, "true");
                }
            }

            #setNavigationRange() {
                const wizardPanels = this.getCachedWizardPanels();
                if (wizardPanels) {
                    this.maxEnabledTab = wizardPanels.length - 1;
                    this.minEnabledTab = 0;
                    for (let i = 0; i < wizardPanels.length; i++) {
                        if (!this.#childComponentVisible(this.getCachedWizardPanels()[i])) {
                            this.minEnabledTab = i + 1;
                        } else {
                            break;
                        }
                    }
                    for (let i = wizardPanels.length - 1; i >= 0; i--) {
                        if (!this.#childComponentVisible(this.getCachedWizardPanels()[i])) {
                            this.maxEnabledTab = i;
                        } else {
                            break;
                        }
                    }
                    this.minEnabledTab = Math.max(0, this.minEnabledTab);
                    this.maxEnabledTab = Math.min(this.getCachedTabs().length - 1, this.maxEnabledTab);
                }
            }

            #childComponentVisible(wizardTab) {
                return wizardTab.children[0].getAttribute('data-cmp-visible') === 'true';
            }

            #findNextVisibleChildIndex(currentIndex) {
                const tabs = this.getCachedTabs();
                const tabsLength = tabs ? tabs.length : 0;
                for (let i = currentIndex + 1; i < tabsLength; i++) {
                    let isVisible = tabs[i].getAttribute(Wizard.DATA_ATTRIBUTE_VISIBLE);
                    if (isVisible === null || isVisible === 'true') {
                        return i;
                    }
                }
                return -1;
            }

            #findLastVisibleChildIndex(currentIndex) {
                const tabs = this.getCachedTabs();
                if (tabs) {
                    for (let i = currentIndex - 1; i >= 0; i--) {
                        let isVisible = tabs[i].getAttribute(Wizard.DATA_ATTRIBUTE_VISIBLE);
                        if (isVisible === null || isVisible === 'true') {
                            return i;
                        }
                    }
                }
                return -1;
            }

            /**
             * Navigates to the item at the provided index and ensures the active tab gains focus
             *
             * @private
             * @param {Number} index The index of the item to navigate to
             */
            #navigateAndFocusTab(index) {
                this.navigate(index);
                this.focusWithoutScroll(this.getCachedTabs()[index]);
                const id = this.getFocusElementId();
                this.focusToFirstVisibleField(id);
            }
   
            #syncWizardNavLabels() {
                const tabs = this.getCachedTabs();
                const wizardPanels = this.getCachedWizardPanels();
                if (tabs) {
                    for (let i = 0; i < tabs.length; i++) {
                        let id = wizardPanels[i].querySelectorAll("[data-cmp-is]")[0].id;
                        tabs[i].id = id + Wizard.#tabIdSuffix;
                        tabs[i].setAttribute("aria-controls", id + Wizard.#wizardPanelIdSuffix);
                    }
                }
            }

            #syncWizardPanels() {
                const wizardPanels = this.getCachedWizardPanels();
                if (wizardPanels) {
                    for (let i = 0; i < wizardPanels.length; i++) {
                        let id = wizardPanels[i].querySelectorAll("[data-cmp-is]")[0].id;
                        wizardPanels[i].id = id + Wizard.#wizardPanelIdSuffix;
                        wizardPanels[i].setAttribute("aria-labelledby", id + Wizard.#tabIdSuffix);
                    }
                }
            }

            syncMarkupWithModel() {
                super.syncMarkupWithModel();
                this.#syncWizardNavLabels();
                this.#syncWizardPanels();
            }

            handleChildAddition(childView) {
                if (childView.getInstanceManager() != null && this._templateHTML[childView.getInstanceManager().getId()] != null) {
                    let navigationTabToBeRepeated = this._templateHTML[childView.getInstanceManager().getId()]['navigationTab']
                        .cloneNode(true);
                    navigationTabToBeRepeated.id = childView.id + Wizard.#tabIdSuffix;
                    navigationTabToBeRepeated.setAttribute("aria-controls", childView.id + Wizard.#wizardPanelIdSuffix);
                    let instanceIndex = childView.getModel().index;
                    let instanceManagerId = childView.getInstanceManager().getId()
                    if (instanceIndex == 0) {
                        let closestNonRepeatableFieldId = this._templateHTML[instanceManagerId]['closestNonRepeatableFieldId'];
                        let closestRepeatableFieldInstanceManagerIds = this._templateHTML[instanceManagerId]['closestRepeatableFieldInstanceManagerIds'];
                        let indexToInsert = this.getIndexToInsert(closestNonRepeatableFieldId, closestRepeatableFieldInstanceManagerIds);
                        if (indexToInsert == 0) {
                            let tabListParentElement = this.#getTabListElement();
                            tabListParentElement.insertBefore(navigationTabToBeRepeated, tabListParentElement.firstChild);
                        } else {
                            let beforeElement = this.getCachedTabs()[indexToInsert - 1];
                            beforeElement.after(navigationTabToBeRepeated);
                        }
                    } else {
                        let beforeTabNavElementId = childView.getInstanceManager().children[instanceIndex - 1].element.id + Wizard.#tabIdSuffix
                        let beforeElement = this.getTabNavElementById(beforeTabNavElementId);
                        beforeElement.after(navigationTabToBeRepeated);
                    }
                    this.cacheElements(this._elements.self);
                    let repeatedWizardPanel = this.#getWizardPanelElementById(childView.id + Wizard.#wizardPanelIdSuffix);
                    repeatedWizardPanel.setAttribute("aria-labelledby", childView.id + Wizard.#tabIdSuffix);
                    
                    const steppedTabClass = Array.from(navigationTabToBeRepeated.classList).find(cls => cls.includes('--stepped'));
                    if (steppedTabClass) {
                        navigationTabToBeRepeated.classList.remove(steppedTabClass);
                    }
                    const steppedWizardPanelClass = Array.from(repeatedWizardPanel.classList).find(cls => cls.includes('--stepped'));
                    if (steppedWizardPanelClass) {
                        repeatedWizardPanel.classList.remove(steppedWizardPanelClass);
            }
                    this.refreshActive();
                    this.#getTabIndexById();
                    if (childView.getInstanceManager().getModel().minOccur != undefined && childView.getInstanceManager().children.length > childView.getInstanceManager().getModel().minOccur) {
                        this.#navigateAndFocusTab(this.#getTabIndexById(navigationTabToBeRepeated.id));
                    }
                }
            }

            handleChildRemoval(removedInstanceView) {
                let removedTabPanelId = removedInstanceView.element.id + Wizard.#wizardPanelIdSuffix;
                let removedTabNavId = removedTabPanelId.substring(0, removedTabPanelId.lastIndexOf("__")) + Wizard.#tabIdSuffix;
                let wizardPanelElement = this.#getWizardPanelElementById(removedTabPanelId);
                let tabNavElement = this.getTabNavElementById(removedTabNavId);

                const tabs = this.getCachedTabs();
                const currentIndex = Array.from(tabs).findIndex(tab => tab.id === removedTabNavId);
                let nextIndex = -1;
                
                if (currentIndex === 0) {
                    // If removing first tab, focus on the next one
                    nextIndex = 1;
                } else {
                    // Look for previous visible tab
                    for (let i = currentIndex - 1; i >= 0; i--) {
                        nextIndex = i;
                        break;
                    }
                }
                
                tabNavElement.remove();
                wizardPanelElement.remove();
                this.children.splice(this.children.indexOf(removedInstanceView), 1);
                this.cacheElements(this._elements.self);
                this._active = this.getActiveIndex(this.getCachedTabs());
                this.refreshActive();

                // Focus the next tab after active state is updated
                if (nextIndex !== -1 && tabs[nextIndex]) {
                    this.#navigateAndFocusTab(nextIndex);    
                }
            }

            addChild(childView) {
                super.addChild(childView);
                this.#cacheTemplateHTML(childView);
                //when all children are available in view
                if (this.getCountOfAllChildrenInModel() === this.children.length) {
                    this.cacheClosestFieldsInView();
                    this.handleHiddenChildrenVisibility();
                }
                this.#setNavigationRange();
                this.#hideUnhideNavButtons(this._active);
            }

            getChildViewByIndex(index) {
                let wizardPanels = this.getCachedWizardPanels();
                let fieldId = wizardPanels[index].id.substring(0, wizardPanels[index].id.lastIndexOf("__"));
                return this.getChild(fieldId);
            }

            /**
             * Adds unique HTML for added instance corresponding to requirements of different types of repeatableParent
             * @param instanceManager of the repeated component
             * @param addedModel of the repeated component
             * @param htmlElement of the repeated component
             */
            addRepeatableMarkup(instanceManager, addedModel, htmlElement) {
                let elementToEnclose = this._templateHTML[instanceManager.getId()]['targetWizardPanel'].cloneNode(false);
                elementToEnclose.id = addedModel.id + Wizard.#wizardPanelIdSuffix;
                let result = this.#getBeforeViewElement(instanceManager, addedModel.index);
                let beforeViewElement = result.beforeViewElement;
                beforeViewElement.after(elementToEnclose);
                elementToEnclose.append(htmlElement.querySelector('#' + addedModel.id));
                return elementToEnclose;
            }

            #cacheTemplateHTML(childView) {
                if (childView.getInstanceManager() != null && (this._templateHTML == null || this._templateHTML[childView.getInstanceManager().getId()] == null)) {
                    let tabId = childView.element.id + Wizard.#tabIdSuffix;
                    let wizardPanelId = childView.element.id + Wizard.#wizardPanelIdSuffix;
                    let instanceManagerId = childView.getInstanceManager().getId();
                    let navigationTabToBeRepeated = this.getTabNavElementById(tabId);
                    let wizardPanelToBeRepeated = this.#getWizardPanelElementById(wizardPanelId)
                    this._templateHTML[instanceManagerId] = {};
                    this._templateHTML[instanceManagerId]['navigationTab'] = navigationTabToBeRepeated;
                    this._templateHTML[instanceManagerId]['targetWizardPanel'] = wizardPanelToBeRepeated;
                }
            }

            #getWizardPanelElementById(wizardPanelId) {
                let wizardPanels = this.getCachedWizardPanels();
                if (wizardPanels) {
                    for (let i = 0; i < wizardPanels.length; i++) {
                        if (wizardPanels[i].id === wizardPanelId) {
                            return wizardPanels[i];
                        }
                    }
                }
            }

            #getTabIndexById(tabId) {
                let tabs = this.getCachedTabs();
                if (tabs) {
                    for (let i = 0; i < tabs.length; i++) {
                        if (tabs[i].id === tabId) {
                            return i;
                        }
                    }
                }
                return -1;
            }

            #getBeforeViewElement(instanceManager, instanceIndex) {
                let result = {};
                let instanceManagerId = instanceManager.getId();
                if (instanceIndex == 0) {
                    let closestNonRepeatableFieldId = this._templateHTML[instanceManagerId]['closestNonRepeatableFieldId'];
                    let closestRepeatableFieldInstanceManagerIds = this._templateHTML[instanceManagerId]['closestRepeatableFieldInstanceManagerIds'];
                    let indexToInsert = this.getIndexToInsert(closestNonRepeatableFieldId, closestRepeatableFieldInstanceManagerIds);
                    let wizardPanels = this.getCachedWizardPanels();
                    if (indexToInsert > 0) {
                        result.beforeViewElement = this.#getWizardPanelElementById(wizardPanels[indexToInsert - 1].id);
                    } else {
                        result.beforeViewElement = this.getPreviousButtonDiv();
                    }
                } else {
                    let previousInstanceElement = this.#getRepeatableElementAt(instanceManager, instanceIndex - 1)
                    result.beforeViewElement = previousInstanceElement;
                }
                return result;
            }

            #getRepeatableElementAt(instanceManager, index) {
                let childId = instanceManager._model.items.find((model) => model.index === index)?.id;
                return this.element.querySelector(`#${childId}${Wizard.#wizardPanelIdSuffix}`);
            }

            updateChildVisibility(visible, state) {
                this.updateVisibilityOfNavigationElement(this.getTabNavElementById(state.id + Wizard.#tabIdSuffix), visible);
                let activeTabNavElement = this.getCachedTabs()[this._active];
                this.#setNavigationRange();
                this.#hideUnhideNavButtons(this._active);
                if (!visible && activeTabNavElement.id === state.id + Wizard.#tabIdSuffix) {
                    let child = this.findFirstVisibleChild(this.getCachedTabs());
                    if (child) {
                        this.#navigateAndFocusTab(this.#getTabIndexById(child.id));
                    }
                }
            }
        }

        FormView.Utils.setupField(({element, formContainer}) => {
            return new Wizard({element, formContainer})
        }, Wizard.selectors.self);
    }

    if (window.Forms && window.Forms.CoreComponentsCommons && window.Forms.CoreComponentsCommons.WizardMixin) {
        onWizardMixinLoaded({ detail: { WizardMixin: window.Forms.CoreComponentsCommons.WizardMixin } });
    } else {
        window.addEventListener('WizardMixinLoaded', onWizardMixinLoaded);
    }

}());

/*******************************************************************************
 * Copyright 2023 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/

(function () {

    class VerticalTabs extends FormView.FormTabs {
        _templateHTML = {};
        static NS = FormView.Constants.NS;
        static IS = "adaptiveFormVerticalTabs";
        static bemBlock = "cmp-verticaltabs";
        static selectors = {
            self: "[data-" + this.NS + '-is="' + this.IS + '"]',
            active: {
                tab: "cmp-verticaltabs__tab--active",
                tabpanel: "cmp-verticaltabs__tabpanel--active"
            },
            stepped: {
                tab: "cmp-verticaltabs__tab--stepped",
                tabpanel: "cmp-verticaltabs__tabpanel--stepped"
            },
            label: `.${VerticalTabs.bemBlock}__label`,
            description: `.${VerticalTabs.bemBlock}__longdescription`,
            qm: `.${VerticalTabs.bemBlock}__questionmark`,
            tooltipDiv: `.${VerticalTabs.bemBlock}__shortdescription`,
            olTabList: `.${VerticalTabs.bemBlock}__tablist`,
            widget: `.${VerticalTabs.bemBlock}__tabs-container`
        };

        constructor(params) {
            super(params, VerticalTabs.NS, VerticalTabs.IS, VerticalTabs.selectors);
        }

        getClass() {
            return VerticalTabs.IS;
        }

        setFocus(id) {
            super.setFocus(id);
            this.setActive();
            if(id) {
                this.navigateAndFocusTab(id + '__tab');
            }
        }

        getWidget() {
            return this.element.querySelector(VerticalTabs.selectors.widget);
        }

        getDescription() {
            return this.element.querySelector(VerticalTabs.selectors.description);
        }

        getLabel() {
            return this.element.querySelector(VerticalTabs.selectors.label);
        }

        getErrorDiv() {
            return this.element.querySelector(VerticalTabs.selectors.errorDiv);
        }

        getTooltipDiv() {
            return this.element.querySelector(VerticalTabs.selectors.tooltipDiv);
        }

        getQuestionMarkDiv() {
            return this.element.querySelector(VerticalTabs.selectors.qm);
        }
    }

    FormView.Utils.setupField(({element, formContainer}) => {
        return new VerticalTabs({element, formContainer})
    }, VerticalTabs.selectors.self);

}());

/*******************************************************************************
 * Copyright 2023 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
(function() {

    "use strict";
    class Recaptcha extends FormView.FormFieldBase {

        static NS = FormView.Constants.NS;
        static IS = "adaptiveFormRecaptcha";
        static bemBlock = 'cmp-adaptiveform-recaptcha';
        static selectors  = {
            self: "[data-" + this.NS + '-is="' + this.IS + '"]',
            widget: `.${Recaptcha.bemBlock}__widget`,
            label: `.${Recaptcha.bemBlock}__label`,
            errorDiv: `.${Recaptcha.bemBlock}__errormessage`
        };

        constructor(params) {
            super(params);
        }

        getWidget() {
            return this.element.querySelector(Recaptcha.selectors.widget);
        }

        getDescription() {
            return null;
        }

        getLabel() {
            return this.element.querySelector(Recaptcha.selectors.label);
        }

        getTooltipDiv() {
            return null;
        }

        getErrorDiv() {
            return this.element.querySelector(Recaptcha.selectors.errorDiv);
        }

        getQuestionMarkDiv() {
            return null;
        }

    	initializeWidget() {
            this.widgetObject = new RecaptchaWidget(this, this._model, this.getWidget());
            this.getWidget().addEventListener('blur', (e) => {
                if(this.element) {
                    this.setInactive();
                }
            });

        }

        setModel(model) {
            super.setModel(model);
            if (this.widgetObject == null) {
                    this.initializeWidget();
            } else {
                if (this.widget.value !== '') {
                    this._model.dispatch(new FormView.Actions.UIChange({'value': this.widget.value}));
                }
            }
        }
    }

    FormView.Utils.setupField(({element, formContainer}) => {
        return new Recaptcha({element, formContainer})
    }, Recaptcha.selectors.self);

})();

/*******************************************************************************
 * Copyright 2023 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/

/**
 * This class is responsible for interacting with the recaptcha widget. It displays Google reCAPTCHA challenge.
 */

if (typeof window.RecaptchaWidget === 'undefined') {
    window.RecaptchaWidget = class {
        #widget = null
        #model = null // passed by reference
        #options = null
        #lang = 'en'
        static FD_CAPTCHA = "fd:captcha";

        constructor(view, model, widget) {
            // initialize the widget and model
            this.#widget = widget;
            this.#model = model;
            this.#widget = document.createElement("div");
            this.#widget.classList.add("cmp-adaptiveform-recaptcha__widget");
            this.#lang = view.formContainer.getModel().lang;

            //Always inserting it in body
            document.body.appendChild(this.#widget);
            this.#options = Object.assign({}, this.#model._jsonModel);

            this.#renderRecaptcha(widget);
        }

        #renderRecaptcha(element) {

            var self = this;
            var recaptchaConfigData = this.#options;
            element.innerHTML = '<div class="g-recaptcha"></div>';
            var gcontainer = document.getElementsByClassName("g-recaptcha")[0];
            var widgetId;
            var url = recaptchaConfigData.properties[RecaptchaWidget.FD_CAPTCHA].config.uri;
            if (recaptchaConfigData.properties[RecaptchaWidget.FD_CAPTCHA].config.size == "invisible") {
                gcontainer.classList.add('g-recaptcha-invisible');
                recaptchaConfigData.required = false;
            }

            var successCallback = function(response) {
                self.setCaptchaModel(response);
            };

            var expiredCallback = function() {
                if (isRecaptchaEnterprise()) {
                    grecaptcha.enterprise.reset(widgetId);
                } else {
                    grecaptcha.reset(widgetId);
                }
                self.setCaptchaModel("");
            };

            var onloadCallbackInternal = function() {
                widgetId = isRecaptchaEnterprise() ? grecaptcha.enterprise.render(gcontainer, gparameters)
                    : grecaptcha.render(gcontainer, gparameters);
                return widgetId;
            };

            var gparameters = {
                'sitekey': recaptchaConfigData.properties[RecaptchaWidget.FD_CAPTCHA].config.siteKey,
                'size': recaptchaConfigData.properties[RecaptchaWidget.FD_CAPTCHA].config.size,
                'theme': recaptchaConfigData.properties[RecaptchaWidget.FD_CAPTCHA].config.theme || 'light',
                'type': recaptchaConfigData.properties[RecaptchaWidget.FD_CAPTCHA].config.type || 'image',
                'callback': successCallback,
                'expired-callback': expiredCallback
            };

            const isRecaptchaEnterprise = function () {
                return recaptchaConfigData.properties[RecaptchaWidget.FD_CAPTCHA].config.version === "enterprise";
            }
            const isScoreBasedKey = function () {
                return isRecaptchaEnterprise() && recaptchaConfigData.properties[RecaptchaWidget.FD_CAPTCHA].config.keyType === "score";
            }

            window.onloadRecaptchaCallback = onloadCallbackInternal;

            var runtimeLocale = this.#lang;

            var scr = document.createElement('script');
            let queryParams = isScoreBasedKey() ? "?render=" + recaptchaConfigData.properties[RecaptchaWidget.FD_CAPTCHA].config.siteKey
                : "?onload=onloadRecaptchaCallback&render=explicit";
            queryParams += "&hl=" + runtimeLocale;
            scr.src = url + queryParams;
            scr.async = true;
            element.appendChild(scr);
        }

        setCaptchaModel = function(response) {
            this.#model.dispatch(new FormView.Actions.UIChange({'value': response}));
        }
    }
}

/*******************************************************************************
 * Copyright 2022 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
(function() {


    "use strict";
    class CheckBox extends FormView.FormCheckBox {

        static NS = FormView.Constants.NS;
        /**
         * Each FormField has a data attribute class that is prefixed along with the global namespace to
         * distinguish between them. If a component wants to put a data-attribute X, the attribute in HTML would be
         * data-{NS}-{IS}-x=""
         * @type {string}
         */
        static IS = "adaptiveFormCheckBox";
        static bemBlock = 'cmp-adaptiveform-checkbox'
        static selectors  = {
            self: "[data-" + this.NS + '-is="' + this.IS + '"]',
            widget: `.${CheckBox.bemBlock}__widget`,
            widgetLabel: `.${CheckBox.bemBlock}__label`,
            label: `.${CheckBox.bemBlock}__label`,
            description: `.${CheckBox.bemBlock}__longdescription`,
            qm: `.${CheckBox.bemBlock}__questionmark`,
            errorDiv: `.${CheckBox.bemBlock}__errormessage`,
            tooltipDiv: `.${CheckBox.bemBlock}__shortdescription`
        };

        constructor(params) {
            super(params);
            this.qm = this.element.querySelector(CheckBox.selectors.qm)
            this.widgetLabel = this.element.querySelector(CheckBox.selectors.widgetLabel)
        }

        getWidget() {
            return this.element.querySelector(CheckBox.selectors.widget);
        }

        getDescription() {
            return this.element.querySelector(CheckBox.selectors.description);
        }

        getLabel() {
            return this.element.querySelector(CheckBox.selectors.label);
        }

        getErrorDiv() {
            return this.element.querySelector(CheckBox.selectors.errorDiv);
        }

        getQuestionMarkDiv() {
            return this.element.querySelector(CheckBox.selectors.qm);
        }

        getTooltipDiv() {
            return this.element.querySelector(CheckBox.selectors.tooltipDiv);
        }

        updateEnabled(enabled, state) {
            if (this.widget) {
                this.element.setAttribute(FormView.Constants.DATA_ATTRIBUTE_ENABLED, enabled);
                const isDisabled = !enabled || state.readOnly;
                if (isDisabled) {
                    this.widget.setAttribute("disabled", "disabled");
                } else {
                    this.widget.removeAttribute("disabled");
                }
            }
        }

        updateReadOnly(readonly) {
            if (this.widget) {
                this.element.setAttribute(FormView.Constants.DATA_ATTRIBUTE_READONLY, readonly);
                if (readonly === true) {
                    this.widget.setAttribute(FormView.Constants.HTML_ATTRS.DISABLED, "disabled");
                } else {
                    this.widget.removeAttribute(FormView.Constants.HTML_ATTRS.DISABLED);
                }
            }
        }
    }

    FormView.Utils.setupField(({element, formContainer}) => {
        return new CheckBox({element, formContainer})
    }, CheckBox.selectors.self);

})();

/*******************************************************************************
 * Copyright 2023 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
(function() {

    "use strict";
    class Fragment extends FormView.FormPanel {

        static NS = FormView.Constants.NS;
        /**
         * Each FormField has a data attribute class that is prefixed along with the global namespace to
         * distinguish between them. If a component wants to put a data-attribute X, the attribute in HTML would be
         * data-{NS}-{IS}-x=""
         * @type {string}
         */
        static IS = "adaptiveFormFragment";
        static bemBlock = 'cmp-adaptiveform-fragment'
        static selectors  = {
            self: "[data-" + this.NS + '-is="' + this.IS + '"]',
            widget: `.${Fragment.bemBlock}__widget`,
            label: `.${Fragment.bemBlock}__label`,
            description: `.${Fragment.bemBlock}__longdescription`,
            qm: `.${Fragment.bemBlock}__questionmark`,
            errorDiv: `.${Fragment.bemBlock}__errormessage`,
            tooltipDiv: `.${Fragment.bemBlock}__shortdescription`
        };

        constructor(params) {
            super(params);
        }

        getWidget() {
            return this.element.querySelector(Fragment.selectors.widget);
        }

        getDescription() {
            return this.element.querySelector(Fragment.selectors.description);
        }

        getLabel() {
            return this.element.querySelector(Fragment.selectors.label);
        }

        getErrorDiv() {
            return this.element.querySelector(Fragment.selectors.errorDiv);
        }

        getTooltipDiv() {
            return this.element.querySelector(Fragment.selectors.tooltipDiv);
        }

        getQuestionMarkDiv() {
            return this.element.querySelector(Fragment.selectors.qm);
        }
    }

    FormView.Utils.setupField(({element, formContainer}) => {
        return new Fragment({element, formContainer})
    }, Fragment.selectors.self);

})();

/*******************************************************************************
 * Copyright 2023 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
(function() {


    "use strict";
    class Switch extends FormView.FormCheckBox {

        static NS = FormView.Constants.NS;
        static IS = "adaptiveFormSwitch";
        static bemBlock = 'cmp-adaptiveform-switch';
        static selectors  = {
            self: "[data-" + this.NS + '-is="' + this.IS + '"]',
            widget: `.${Switch.bemBlock}__widget`,
            label: `.${Switch.bemBlock}__label`,
            description: `.${Switch.bemBlock}__longdescription`,
            errorDiv: `.${Switch.bemBlock}__errormessage`,
            qm: `.${Switch.bemBlock}__questionmark`,
            tooltipDiv: `.${Switch.bemBlock}__shortdescription`
        };

        constructor(params) {
            super(params);
            this.qm = this.element.querySelector(Switch.selectors.qm)
        }

        getClass() {
            return Switch.IS;
        }

        getWidget() {
            return this.element.querySelector(Switch.selectors.widget);
        }

        getDescription() {
            return this.element.querySelector(Switch.selectors.description);
        }

        getLabel() {
            return this.element.querySelector(Switch.selectors.label);
        }

        getErrorDiv() {
            return this.element.querySelector(Switch.selectors.errorDiv);
        }

        getTooltipDiv() {
            return this.element.querySelector(Switch.selectors.tooltipDiv);
        }

        getQuestionMarkDiv() {
            return this.element.querySelector(Switch.selectors.qm);
        }
    }

    FormView.Utils.setupField(({element, formContainer}) => {
        return new Switch({element,formContainer})
    }, Switch.selectors.self);

})();

/*******************************************************************************
 * Copyright 2023 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/

(function () {

    class TermsAndConditions extends FormView.FormPanel {
        static NS = FormView.Constants.NS;
        static IS = "adaptiveFormTermsAndConditions";
        static bemBlock = 'cmp-adaptiveform-termsandcondition';
        static selectors = {
            self: "[data-" + this.NS + '-is="' + this.IS + '"]',
            label: `.${TermsAndConditions.bemBlock}__label`,
            description: `.${TermsAndConditions.bemBlock}__longdescription`,
            qm: `.${TermsAndConditions.bemBlock}__questionmark`,
            tooltipDiv: `.${TermsAndConditions.bemBlock}__shortdescription`,
            tncContentWrapper: `.${TermsAndConditions.bemBlock}__content-container`,
            closePopupButton: `.${TermsAndConditions.bemBlock}__close-button`
        };

        constructor(params) {
            super(params);
            this.#handleScroll()
        }

        addChild(childView) {
            super.addChild(childView);
            if (childView.getModel()._jsonModel.fieldType === 'checkbox-group') {
                this.#addLinkClickListener(childView);
            }
            if (childView.getModel()._jsonModel.fieldType === 'checkbox') {
                this.#handlePopup(childView);
            }
        }

        #addLinkClickListener(childView) {
            childView.getWidgets().querySelectorAll('label').forEach((item) => {
                const checkboxInput = item.querySelector('input');
                item.querySelector('a').addEventListener('click', (e) => {
                    checkboxInput.click();
                })
            })
        }

        #handleScroll() {
            const intersection = this.element.querySelector('.cmp-adaptiveform-termsandcondition__text-intersect');
            if (intersection) {
                const self = this;
                const io = new IntersectionObserver(onIntersection, {
                    threshold: [1],
                })
                function onIntersection ([{isIntersecting}]) {
                    const isEnabled = self.getModel()?.enabled && !self.getModel()?.readOnly;
                    if (isIntersecting) {
                        if (isEnabled) {
                              self.children.filter(c => c.getModel()._jsonModel.fieldType === 'checkbox').forEach(cb => {
                                cb.getModel().enabled = true;
                        })}
                        io.unobserve(intersection);
                    }
                }
                io.observe(intersection)
            }
        }

        #handlePopup(approvalCheckbox) {
            const closePopUpBtn = this.getClosePopupButton();
            if (closePopUpBtn) {
                closePopUpBtn.addEventListener('click', () => {
                    this.toggleAttribute(this.getContentDivWrapper(), false, 'data-cmp-visible', false);
                })

                approvalCheckbox.label.addEventListener('click', () => {
                    const contentDiv = this.getContentDivWrapper();
                    if (contentDiv) {
                        this.toggleAttribute(this.getContentDivWrapper(), true, 'data-cmp-visible', false);
                    }
                })
            }
        }

        getContentDivWrapper() {
            return this.element.querySelector(TermsAndConditions.selectors.tncContentWrapper);
        }

        getClosePopupButton() {
            return this.element.querySelector(TermsAndConditions.selectors.closePopupButton);
        }

        getWidget() {
            return null;
        }

        getDescription() {
            return this.element.querySelector(TermsAndConditions.selectors.description);
        }

        getLabel() {
            return null;
        }

        getErrorDiv() {
            return null;
        }

        getTooltipDiv() {
            return this.element.querySelector(TermsAndConditions.selectors.tooltipDiv);
        }

        getQuestionMarkDiv() {
            return this.element.querySelector(TermsAndConditions.selectors.qm);
        }
    }

    FormView.Utils.setupField(({element, formContainer}) => {
        return new TermsAndConditions({element, formContainer})
    }, TermsAndConditions.selectors.self);
})();

/*******************************************************************************
 * Copyright 2024 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
(function() {

    "use strict";
    class HCaptcha extends FormView.FormFieldBase {

        static NS = FormView.Constants.NS;
        static IS = "adaptiveFormHCaptcha";
        static bemBlock = 'cmp-adaptiveform-hcaptcha';
        static selectors  = {
            self: "[data-" + this.NS + '-is="' + this.IS + '"]',
            widget: `.${HCaptcha.bemBlock}__widget`,
            label: `.${HCaptcha.bemBlock}__label`,
            errorDiv: `.${HCaptcha.bemBlock}__errormessage`
        };

        constructor(params) {
            super(params);
        }

        getWidget() {
            return this.element.querySelector(HCaptcha.selectors.widget);
        }

        getDescription() {
            return null;
        }

        getLabel() {
            return this.element.querySelector(HCaptcha.selectors.label);
        }

        getTooltipDiv() {
            return null;
        }

        getErrorDiv() {
            return this.element.querySelector(HCaptcha.selectors.errorDiv);
        }

        getQuestionMarkDiv() {
            return null;
        }

    	initializeWidget() {
            this.widgetObject = new HCaptchaWidget(this, this._model, this.getWidget());
            this.getWidget().addEventListener('blur', (e) => {
                if(this.element) {
                    this.setInactive();
                }
            });

        }

        setModel(model) {
            super.setModel(model);
            if (this.widgetObject == null) {
                    this.initializeWidget();
            } else {
                if (this.widget.value !== '') {
                    this._model.value = this.widget.value;
                }
            }
        }
    }

    FormView.Utils.setupField(({element, formContainer}) => {
        return new HCaptcha({element, formContainer})
    }, HCaptcha.selectors.self);

})();

/*******************************************************************************
 * Copyright 2024 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/

/**
 * This class is responsible for interacting with the hCaptcha widget. It displays hCaptcha challenge.
 */

if (typeof window.HCaptchaWidget === 'undefined') {
    window.HCaptchaWidget = class {
        #widget = null
        #model = null // passed by reference
        #options = null
        #lang = 'en'
        static FD_CAPTCHA = "fd:captcha";

        constructor(view, model, widget) {
            // initialize the widget and model
            this.#widget = widget;
            this.#model = model;
            this.#widget = document.createElement("div");
            this.#widget.classList.add("cmp-adaptiveform-hcaptcha__widget");
            this.#lang = view.formContainer.getModel().lang;

            //Always inserting it in body
            document.body.appendChild(this.#widget);
            this.#options = Object.assign({}, this.#model._jsonModel);

            this.#renderHCaptcha(widget);
        }

        #renderHCaptcha(element) {

            const self = this;
            const hCaptchaConfigData = this.#options;
            element.innerHTML = '<div class="h-captcha"></div>';
            const hcontainer = document.getElementsByClassName("h-captcha")[0];
            let widgetId;
            const url = hCaptchaConfigData.properties[HCaptchaWidget.FD_CAPTCHA].config.uri;

            const successCallback = function(response) {
                self.setCaptchaModel(response);
            };

            const expiredCallback = function() {
                hcaptcha.reset(widgetId);
                self.setCaptchaModel("");
            };

            const onloadCallbackInternal = function() {
                widgetId = hcaptcha.render(
                    hcontainer,
                    hparameters
                );
                return widgetId;
            };

            const hparameters = {
                'sitekey': hCaptchaConfigData.properties[HCaptchaWidget.FD_CAPTCHA].config.siteKey,
                'size': hCaptchaConfigData.properties[HCaptchaWidget.FD_CAPTCHA].config.size,
                'theme': hCaptchaConfigData.properties[HCaptchaWidget.FD_CAPTCHA].config.theme || 'light',
                'callback': successCallback,
                'expired-callback': expiredCallback
            };

            window.onloadHCaptchaCallback = onloadCallbackInternal;

            const runtimeLocale = this.#lang;

            const scr = document.createElement('script');
            scr.src = url + "?onload=onloadHCaptchaCallback&render=explicit&hl=" + runtimeLocale;
            scr.async = true;
            element.appendChild(scr);
        }

        setCaptchaModel = function(response) {
            this.#model.dispatch(new FormView.Actions.UIChange({'value': response}));
        }
    }
}

/*******************************************************************************
 * Copyright 2024 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/

(function () {

  "use strict";
  class Review extends FormView.FormFieldBase {

    static NS = FormView.Constants.NS;
    /**
     * Each FormField has a data attribute class that is prefixed along with the global namespace to
     * distinguish between them. If a component wants to put a data-attribute X, the attribute in HTML would be
     * data-{NS}-{IS}-x=""
     * @type {string}
     */
    static IS = "adaptiveFormReview";
    static bemBlock = 'cmp-adaptiveform-review';
    static templateAttribute = 'data-cmp-review';
    static DATA_ATTRIBUTE_VISIBLE = 'data-cmp-visible';
    static FIELD_TYPE = FormView.Constants.FIELD_TYPE;
    static HIDE_FIELD_FROM_REVIEW = [Review.FIELD_TYPE.BUTTON, Review.FIELD_TYPE.PLAIN_TEXT, Review.FIELD_TYPE.CAPTCHA, Review.FIELD_TYPE.IMAGE];
    static panelModifier = '__panel--repeatable';
    static fieldModifier = '__field--';
    static selectors = {
      self: "[data-" + this.NS + '-is="' + this.IS + '"]',
      container: `.${Review.bemBlock}__container`,
      templates: "template[data-cmp-review-fieldType]",
      label: '[' + Review.templateAttribute + '-label]',
      value: '[' + Review.templateAttribute + '-value]',
      editButton:'[' + Review.templateAttribute + '-editButton]',
      fieldId: Review.templateAttribute + '-fieldId',
      fieldType: Review.templateAttribute + '-fieldType',
      panelContent:'[' + Review.templateAttribute + '-content]',
      labelContainer: `.${Review.bemBlock}__label-container`,
      intersection: Review.templateAttribute + "-intersection="
    };
    static intersectionOptions = {
      root: null,
      rootMargin: "0px",
      threshold: Review.buildThresholdList(),
    };
    static buildThresholdList() {
      let thresholds = [];
      let numSteps = 20;
      for (let i = 1.0; i <= numSteps; i++) {
        thresholds.push(i / numSteps);
      }
      thresholds.push(0);
      return thresholds;
    }

    static sanitizedValue(value, options) {
      if(options){
        return window.DOMPurify ?  window.DOMPurify.sanitize(value, options) : value;
      }
      return window.DOMPurify ?  window.DOMPurify.sanitize(value) : value;
    }

    static hasChild(element) {
      return element && element.children && element.children.length;
    }

    static addClassModifier(element, item) {
      if(item.fieldType !== Review.FIELD_TYPE.PANEL){
        element.querySelector('div').classList.add(Review.bemBlock + Review.fieldModifier + item.fieldType);
      }
      if(item.repeatable){
        element.querySelector('div').classList.add(Review.bemBlock + Review.panelModifier);
      }
      if(item.name){
        element.querySelector('div').classList.add(item.name);
      }
    }

    static renderLabel(element, item) {
      const label = element.querySelector(Review.selectors.label);
      label.innerHTML = item.fieldType === Review.FIELD_TYPE.PLAIN_TEXT ? Review.sanitizedValue(item.value) : Review.sanitizedValue(item?.label?.value, {ALLOWED_TAGS: [] });
      if (item.required) {
        label.setAttribute('data-cmp-required', item.required);
      }
    }

    static renderValue(element, item) {
      const value = element.querySelector(Review.selectors.value);
      if (value) {
        const plainText = Review.getValue(item, item.value) || '';
        value.innerHTML = Review.sanitizedValue(plainText);
      }
    }

    static addAccessibilityAttributes(element, item) {
      const container = element.querySelector('div');
      const label = element.querySelector(Review.selectors.label);
      const value = element.querySelector(Review.selectors.value);
      const editButton = element.querySelector(Review.selectors.editButton);
      const id = `${item.id}-review-label`;
      if(label){
        label.setAttribute('id', id);
        container.setAttribute('role', 'region');  
        container.setAttribute('aria-labelledby', id);
      }
      if(value){
        value.setAttribute('aria-labelledby', id);
      }
      if(editButton && editButton.getAttribute(Review.DATA_ATTRIBUTE_VISIBLE) === 'true'){
        editButton.setAttribute('aria-describedby', id);
      }
    }

    static isRepeatable(item) {
      return item.fieldType === Review.FIELD_TYPE.PANEL && item.type === 'array'
    }

    /* return value of the field, if value is array then return comma separated string and 
      if value is file then return file name
    */
    static getValue(item, value) {
      if (value === undefined || value === null) return '';
      if (item.fieldType === Review.FIELD_TYPE.FILE_INPUT) {
        return Array.isArray(value) ? value.filter(file => file && file.name).map(file => file.name).join(', ') : (value.name || '');
      }
      if (Array.isArray(item.enumNames)) {
        const values = Array.isArray(value) ? value : [value];
        return values.reduce((names, val) => {
          const index = item.enum.indexOf(val);
          if (index >= 0) {
            names.push(item.enumNames[index]);
          }
          return names;
        }, []).join(', ');
      }
      if (Array.isArray(value)) {
        return value.join(', ');
      }
      return value;
    }

    constructor(params) {
      super(params);
      this.#attachIntersectionObserver();
      this.#attachClickEventOnEdit();
      this.#setFieldTemplateMapping();
    }
    getContainer() {
      return this.element.querySelector(Review.selectors.container);
    }
    getTemplates() {
      return this.element.querySelectorAll(Review.selectors.templates);
    }
    getIntersectionElement() {
      return this.element.querySelector("[" + Review.selectors.intersection + this.id + "]");
    }
    getWidget() { return null }
    getDescription() { return null; }
    getLabel() { return null; }
    getErrorDiv() { return null; }
    getTooltipDiv() { return null; }
    getQuestionMarkDiv() { return null; }
    setModel(model) {
      super.setModel(model);
    }

    // attach intersection observer to the review container for lazy loading
    #attachIntersectionObserver() {
      let observer = new IntersectionObserver(this.#intersectionObserverHandler.bind(this), Review.intersectionOptions);
      const ele = this.getIntersectionElement();
      if(ele){
        observer.observe(ele);
      }
    }

    // attach click event on edit button to set focus on the field
    #attachClickEventOnEdit() {
      this.getContainer().addEventListener('click', this.#clickHandler.bind(this))
    }

    // create template mapping based on field type and use it to render review fields
    #setFieldTemplateMapping() {
      const templates = this.getTemplates();
      let mappings = {};
      templates.forEach(template => {
        const type = template.getAttribute(Review.selectors.fieldType);
        mappings[type || 'default'] = template;
      });
      this.templateMappings = mappings;
    }

    // click handler to set focus on the field when use click on edit button
    #clickHandler(event) {
      if (event?.target?.nodeName === 'BUTTON') {
        const id = event.target.getAttribute(Review.selectors.fieldId);
        const form = this.formContainer.getModel();;
        const field = this.formContainer.getField(id);
        if (form && field) {
          form.setFocus(field._model);
        }
      }
    }

     // if review container is in view port then render review fields
    #intersectionObserverHandler(entries) {
      entries.forEach(entry => {
        if (entry.isIntersecting && this._model) {
          const panels = this.#getPanels();
          const reviewContainer = this.getContainer();
          const children = this.#renderReviewFields(panels);
          reviewContainer.innerHTML = '';
          reviewContainer.appendChild(children);
        }
      })
    }

    // iterate over all the panels or linked panels and render child of each panel
    #renderReviewFields(items) {
      if (!items) return;
      const currentFragment = document.createDocumentFragment();
      items.filter(item => item.visible !== false && item.fieldType && item[':type']).forEach(item => {
        if (Review.isRepeatable(item)) {
          const repeatableItems = this.getModel().form.getElement(item.id).getState();
          const repeatablePanel = this.#renderReviewFields(repeatableItems.items);
          if (Review.hasChild(repeatablePanel)) {
            currentFragment.appendChild(repeatablePanel);
          }
        } else {
          let template = this.templateMappings[item.fieldType] || this.templateMappings['default'];
          const cloneNode = template.content.cloneNode(true);
          Review.addClassModifier(cloneNode, item);
          Review.renderLabel(cloneNode, item);
          this.#renderEditButton(cloneNode, item);
          if (item.fieldType === Review.FIELD_TYPE.PANEL) {
            const fields = this.#renderReviewFields(item.items);
            if (Review.hasChild(fields)) {
              const labelContainer = cloneNode.querySelector(Review.selectors.labelContainer);
              if(item?.label?.visible === false && labelContainer){
                labelContainer.remove();
              }
              Review.addAccessibilityAttributes(cloneNode, item);
              const contentElement = cloneNode.querySelector(Review.selectors.panelContent);
              if(contentElement){
                contentElement.appendChild(fields);
              }
              currentFragment.appendChild(cloneNode);
            }
          } else if (!Review.HIDE_FIELD_FROM_REVIEW.includes(item.fieldType) && !item[':type'].endsWith('review')) {
            Review.renderValue(cloneNode, item);
            Review.addAccessibilityAttributes(cloneNode, item);
            currentFragment.appendChild(cloneNode);
          }
        }
      });
      return currentFragment;
    }

    #getPanels() {
      const linkedPanels = this.getModel().properties["fd:linkedPanels"] || [];
      if (linkedPanels.length) {
        return this.#getLinkedPanels([...linkedPanels]);
      }
      return this.#getAllPanels();
    }

    // return all top lavel panels if author has not linked any panel
    #getAllPanels() {
      let state = this.getModel().form.getState();
      while (state?.items?.length === 1) {
        state = state.items[0];
      }
      return state.items || [];
    }

    // return linked panels if author has linked any panel
    #getLinkedPanels(linkedPanels) {
      let queue = [], result = [];
      let state = this.getModel().form.getState();
      queue.push(state);
      while (queue.length && linkedPanels.length) {
        const items = Array.isArray(queue[0]) ? queue[0] : [queue[0]];
        items.forEach(item => {
          const index = linkedPanels.indexOf(item.name);
          if (index > -1) {
            result.push(item);
            linkedPanels.splice(index, 1);
          }
          if (item.items) {
            queue.push(item.items);
          }
        })
        queue.shift();
      }
      return result;
    }

    // render edit button of the field
    #renderEditButton(cloneNode, item) {
      const editButton = cloneNode.querySelector(Review.selectors.editButton);
      if (editButton) {
        editButton.setAttribute(Review.selectors.fieldId, item.id);
        editButton.setAttribute('aria-label', item?.label?.value);
        if (item.enabled === false) {
          editButton.setAttribute('disabled', true);
        }
        editButton.setAttribute(Review.DATA_ATTRIBUTE_VISIBLE, this.#isVisibleEditButton(item.fieldType));
      }
    }
    #isVisibleEditButton(fieldType) {
      let editModeAction = this.getModel().properties?.['fd:editModeAction'];
      if (editModeAction === 'both' ||
        (editModeAction === Review.FIELD_TYPE.PANEL && fieldType === Review.FIELD_TYPE.PANEL) ||
        (editModeAction === 'field' && fieldType !== Review.FIELD_TYPE.PANEL)) {
        return true;
      }
      return false;
    }
  }

  FormView.Utils.setupField(({ element, formContainer }) => {
    return new Review({ element, formContainer })
  }, Review.selectors.self);

})();

/*******************************************************************************
 * Copyright 2024 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
(function() {

    "use strict";
    class Turnstile extends FormView.FormFieldBase {

        static NS = FormView.Constants.NS;
        static IS = "adaptiveFormTurnstile";
        static bemBlock = 'cmp-adaptiveform-turnstile';
        static selectors  = {
            self: "[data-" + this.NS + '-is="' + this.IS + '"]',
            widget: `.${Turnstile.bemBlock}__widget`,
            label: `.${Turnstile.bemBlock}__label`,
            errorDiv: `.${Turnstile.bemBlock}__errormessage`
        };

        constructor(params) {
            super(params);
        }

        getWidget() {
            return this.element.querySelector(Turnstile.selectors.widget);
        }

        getDescription() {
            return null;
        }

        getLabel() {
            return this.element.querySelector(Turnstile.selectors.label);
        }

        getTooltipDiv() {
            return null;
        }

        getErrorDiv() {
            return this.element.querySelector(Turnstile.selectors.errorDiv);
        }

        getQuestionMarkDiv() {
            return null;
        }

    	initializeWidget() {
            this.widgetObject = new TurnstileWidget(this, this._model, this.getWidget());
            this.getWidget().addEventListener('blur', (e) => {
                if(this.element) {
                    this.setInactive();
                }
            });

        }

        setModel(model) {
            super.setModel(model);
            if (this.widgetObject == null) {
                    this.initializeWidget();
            } else {
                if (this.widget.value !== '') {
                    this._model.dispatch(new FormView.Actions.UIChange({'value': this.widget.value}));
                }
            }
        }
    }

    FormView.Utils.setupField(({element, formContainer}) => {
        return new Turnstile({element, formContainer})
    }, Turnstile.selectors.self);

})();

/*******************************************************************************
 * Copyright 2024 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/

/**
 * This class is responsible for interacting with the turnstile widget. It displays turnstile challenge.
 */

if (typeof window.TurnstileWidget === 'undefined') {
    window.TurnstileWidget = class {
        #widget = null
        #model = null // passed by reference
        #options = null
        #lang = 'en'
        static FD_CAPTCHA = "fd:captcha";

        constructor(view, model, widget) {
            // initialize the widget and model
            this.#widget = widget;
            this.#model = model;
            this.#widget = document.createElement("div");
            this.#widget.classList.add("cmp-adaptiveform-turnstile__widget");
            this.#lang = view.formContainer.getModel().lang;

            //Always inserting it in body
            document.body.appendChild(this.#widget);
            this.#options = Object.assign({}, this.#model._jsonModel);

            this.#renderTurnstile(widget);
        }

        #renderTurnstile(turnstileContainer) {

            const self = this;
            const turnstileConfigData = this.#options;
            let widgetId;
            const url = turnstileConfigData.properties[TurnstileWidget.FD_CAPTCHA].config.uri;

            const successCallback = function(response) {
                self.setCaptchaModel(response);
            };

            const expiredCallback = function() {
                turnstile.reset(widgetId);
                self.setCaptchaModel("");
            };

            const onloadCallbackInternal = function() {
                widgetId = turnstile.render(
                    turnstileContainer,
                    turnstileParameters
                );
                return widgetId;
            };

            const turnstileParameters = {
                'sitekey': this.#model.captchaSiteKey,
                'size': turnstileConfigData.properties[TurnstileWidget.FD_CAPTCHA].config.size,
                'theme': turnstileConfigData.properties[TurnstileWidget.FD_CAPTCHA].config.theme || 'light',
                'callback': successCallback,
                'expired-callback': expiredCallback,
                'language': this.#lang
            };

            window.onloadTurnstileCallback = onloadCallbackInternal;
            const scr = document.createElement('script');
            const queryParams = (this.#model.captchaDisplayMode === 'invisible')
                ? "?render=explicit"
                : "?onload=onloadTurnstileCallback&render=explicit";
            scr.src = url + queryParams;
            scr.async = true;
            turnstileContainer.appendChild(scr);
        }

        setCaptchaModel(response) {
            this.#model.dispatch(new FormView.Actions.UIChange({'value': response}));
        }
    }
}

/*******************************************************************************
 * Copyright 2025 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/

if(window.GeoLocationQuery === undefined) {
        window.GeoLocationQuery = class GeoLocationQuery {
        constructor() {
            this._active = false;
        }

        init(success, failure) {
            this._successHandler = success;
            this._errorHandler = failure;
            this._active = true;
            return this;
        }

        _handleSuccess(data) {
            if (this._successHandler) {
                this._successHandler(data);
            }
        }

        _handleError(err) {
            if (this._errorHandler) {
                this._errorHandler(err);
            }
        }

        query() {
            const onSuccess = (pos) => {
                if (this._active) {
                    this._handleSuccess(pos);
                }
                this._active = false;
            };

            const onError = (err) => {
                if (this._active) {
                    this._handleError(err);
                }
                this._active = false;
            };

            navigator.geolocation.getCurrentPosition(onSuccess, onError, { timeout: 10000 });
        }

        cancel() {
            this._active = false;
        }
    }
}
/*******************************************************************************
 * Copyright 2025 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/


(function() {
    "use strict";
    /**
     * class definition for GeoLocationQueryRequest
     * encapsulated success and error handlers
    */
    class Scribble extends FormView.FormFieldBase {
        _geoLocQuery=null;
        _signSubmitted=false;
        _enforceGeoLoc=!!navigator.userAgent.match(/iPad/i);
        existingSign = '';
        existingCanvas = '';
        lang = "en";
        static NS = FormView.Constants.NS;
        static IS = "adaptiveFormScribble";
        static bemBlock = 'cmp-adaptiveform-scribble';
        static selectors  = {
            self: `[data-${this.NS}-is="${this.IS}"]`,
            scribbleContainer: `.${Scribble.bemBlock}__container`,
            scribbleContainerPanel: `.${Scribble.bemBlock}__panel`,
            keyboardSignBox: `.${Scribble.bemBlock}__keyboard-sign-box`,
            scribbleControlPanel: `.${Scribble.bemBlock}__controlpanel`,
            geoCanvas: `.${Scribble.bemBlock}__geocanvas`,
            canvasSignedContainer: `.${Scribble.bemBlock}__canvas-signed-container`,
            canvas: `.${Scribble.bemBlock}__canvas`,
            label: `.${Scribble.bemBlock}__label`,
            description: `.${Scribble.bemBlock}__longdescription`,
            qm: `.${Scribble.bemBlock}__questionmark`,
            errorDiv: `.${Scribble.bemBlock}__errormessage`,
            tooltipDiv: `.${Scribble.bemBlock}__shortdescription`,
            scribbleCloseButton: `.${Scribble.bemBlock}__button-close`,
            brushControl: `.${Scribble.bemBlock}__control-brush`,
            scribbleGeoControl: `.${Scribble.bemBlock}__control-geo`,
            clearControl: `.${Scribble.bemBlock}__control-clear`,
            scribbleTextControl: `.${Scribble.bemBlock}__control-text`,
            scribbleMessage: `.${Scribble.bemBlock}__control-message`,
            clearSignButton: `.${Scribble.bemBlock}__button--primary`,
            cancelClearSignButton: `.${Scribble.bemBlock}__button--secondary`,
            clearSignContainer: `.${Scribble.bemBlock}__clearsign-container`,
            scribbleSubmitControl: `.${Scribble.bemBlock}__save-button`,
            scribbleBrushList: `.${Scribble.bemBlock}__brushlist`,
            signCanvases: `.${Scribble.bemBlock}__signcanvases`,
            saveCanvas: `.${Scribble.bemBlock}__save-button`,
            canvasSignedImage: `.${Scribble.bemBlock}__canvas-signed-image`,
            mainCanvas: `.${Scribble.bemBlock}__canvas__main`
        };

        constructor(params) {
            super(params);
            this.initializeScribble();
        }

        setModel(model) {
            super.setModel(model);
            this.lang = model.lang;
        }

        initializeScribble() {
            this.getCanvasContainer().addEventListener('click', () => this.scribbleContainerClickHandler());
            this.initScribbleModal();
        }
        
        getWidget() {
            return this.element.querySelector(Scribble.selectors.canvasSignedContainer);
        }

        getLabel() {
            return this.element.querySelector(Scribble.selectors.label);
        }

        getErrorDiv() {
            return this.element.querySelector(Scribble.selectors.errorDiv);
        }

        getTooltipDiv() {
            return this.element.querySelector(Scribble.selectors.tooltipDiv);
        }

        getQuestionMarkDiv() {
            return this.element.querySelector(Scribble.selectors.qm);
        }

        getScribbleControlPanel() {
            return this.element.querySelector(Scribble.selectors.scribbleControlPanel);
        }

        getScribbleContainer() {
            return this.element.querySelector(Scribble.selectors.scribbleContainer);
        }

        getMessage() {
            return this.element.querySelector(Scribble.selectors.scribbleMessage);
        }

        getClearSignContainer() {
            return this.element.querySelector(Scribble.selectors.clearSignContainer);
        }

        getClearSignButton() {
            return this.element.querySelector(Scribble.selectors.clearSignButton);
        }

        getCancelClearSignButton() {
            return this.element.querySelector(Scribble.selectors.cancelClearSignButton);
        }

        getBrushList() {
            return this.element.querySelector(Scribble.selectors.scribbleBrushList);
        }

        getBrush() {
            return this.element.querySelector(Scribble.selectors.brushControl);
        }

        getClearControl() {
            return this.element.querySelector(Scribble.selectors.clearControl);
        }

        getSaveControl() {
            return this.element.querySelector(Scribble.selectors.saveCanvas);
        }

        getGeoLocationIcon() {
            return this.element.querySelector(Scribble.selectors.scribbleGeoControl);
        }

        getTextSignControl() {
            return this.element.querySelector(Scribble.selectors.scribbleTextControl);
        }

        getScribbleContainerPanel() {
            return this.element.querySelector(Scribble.selectors.scribbleContainerPanel);
        }

        getKeyboardSignBox() {
            return this.element.querySelector(Scribble.selectors.keyboardSignBox);
        }

        getGeoCanvas() {
            return this.element.querySelector(Scribble.selectors.geoCanvas);
        }

        getCanvasContainer() {
            return this.element.querySelector(Scribble.selectors.canvasSignedContainer);
        }

        getScribbleCloseButton() {
            return this.element.querySelector(Scribble.selectors.scribbleCloseButton);
        }

        getCanvas() {
            return this.element.querySelector(Scribble.selectors.canvas);
        }

        getMainCanvas() {
            return this.element.querySelector(Scribble.selectors.mainCanvas);
        }

        getSignCanvasesContainer() {
            return this.element.querySelector(Scribble.selectors.signCanvases);
        }

        getDescription() {
            return this.element.querySelector(Scribble.selectors.description);
        }

        getSignedCanvasImage() {
            return this.element.querySelector(Scribble.selectors.canvasSignedImage);
        }

        showMessage(msg){
            if(this._msgTimeout) { clearTimeout(this._msgTimeout); this._msgTimeout=0; }
             const scribbleMessage = this.getMessage();
             scribbleMessage.innerHTML = msg;
             scribbleMessage.style.display = 'block';
             this._msgTimeout = window.setTimeout(function(){
                scribbleMessage.innerHTML = '';
             },15000);
        }

        openClearSignModal() {
            const clearSignContainer = this.getClearSignContainer();
            const clearSignButton = this.getClearSignButton();
            const cancelClearSignButton = this.getCancelClearSignButton();
        
            clearSignContainer.style.display = 'inline-block';
            // Set focus to the clear sign modal container for accessibility
            clearSignContainer.setAttribute('tabindex', '-1');
            clearSignContainer.focus();
        
            const handleClearSign = () => {
                this.existingSign = '';
                const mainCanvas = this.getMainCanvas();
                const existingCanvas = this.existingCanvas;
        
                if (mainCanvas && existingCanvas) {
                    mainCanvas.parentNode.replaceChild(existingCanvas, mainCanvas);
                    const ctx = existingCanvas.getContext('2d');
                    ctx.clearRect(0, 0, existingCanvas.width, existingCanvas.height);
                }
        
                const geoCanvas = this.getGeoCanvas();
                if (geoCanvas) {
                    const geoCtx = geoCanvas.getContext('2d');
                    geoCtx.clearRect(0, 0, geoCanvas.width, geoCanvas.height);
                }
        
                this.enableControls(['brushes', 'geolocation', 'clearSign', 'textSign', 'save']);
        
                const signedImage = this.getSignedCanvasImage();
                if (signedImage) {
                    signedImage.removeAttribute('alt');
                    signedImage.removeAttribute('title');
                    signedImage.removeAttribute('src');
                    signedImage.removeAttribute('style');
                    this.element.querySelector('.cmp-adaptiveform-scribble__clear-sign')?.remove();
                    clearSignContainer.style.display = 'none';
                    this.getKeyboardSignBox().value = '';
                }
        
                this._signSubmitted = false;
                this.setModelValue(undefined);
            };
        
            clearSignButton.addEventListener('click', handleClearSign);
        
            cancelClearSignButton.addEventListener('click', () => {
                clearSignContainer.style.display = 'none';
            });
        }

        createCanvas() {
            const mainCanvas = document.createElement('canvas');
            mainCanvas.classList.add('cmp-adaptiveform-scribble__canvasImage');
        }

        updateEmptyStatus () {
            super.updateEmptyStatus();
        }

        updateValue(value) {
            let that = this;
            this._model.serialize().then((files) => {
                if (files && files.length > 0 && files[0]) {
                    let signatureDataUrl = files[0].data;
                    signatureDataUrl = typeof signatureDataUrl === "undefined" ? null : signatureDataUrl;
                    const signedImage = that.getSignedCanvasImage();
                    if (signedImage && signatureDataUrl) {
                        signedImage.src = signatureDataUrl;
                        signedImage.setAttribute('alt', FormView.LanguageUtils.getTranslatedString(this.lang, 'signature') || 'Signature');
                        signedImage.setAttribute('title', FormView.LanguageUtils.getTranslatedString(this.lang, 'signature') || 'Signature');
                        that.updateEmptyStatus();
                    }
                }
            });
        }

        isCanvasEmpty(canvas) {
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // Get pixel data from the canvas
            const imageData = ctx.getImageData(0, 0, width, height);
            
            // Check if any pixel is not transparent (not [0, 0, 0, 0] = transparent)
            for (let i = 0; i < imageData.data.length; i += 4) {
                if (imageData.data[i + 3] > 0) {
                    return false; // Found non-transparent pixel
                }
            }
            
            return true; // No non-transparent pixels found
        }

        submitSign() {
            if (!this.isCanvasEmpty(this.canvas)) {
                const mainCanvas = this.createMainCanvas();
                const sigCnv = this.getCanvas(); // Get the sign canvas
                const geoCnv = this.getGeoCanvas(); // Get the geo canvas
        
                this.drawCanvasesOnMainCanvas(mainCanvas, sigCnv, geoCnv);
        
                this.existingCanvas = sigCnv;
                sigCnv.height = mainCanvas.height;
                sigCnv.parentNode.replaceChild(mainCanvas, sigCnv);
        
                let submitData = mainCanvas.toDataURL("image/png");
                submitData = submitData.replace("data:image/png;base64,", "data:image/png;name=fd_type_signature.png;base64,")
                this.existingSign = mainCanvas;
        
                this.updateSignedImage(submitData);
                this.setModelValue(submitData);
                this.addClearSignButton();
        
                if (this._geoLocQuery) {
                    this._geoLocQuery.cancel(); // Cancel the current geo loc request
                }
        
                this.closeEditModal();
                this._signSubmitted = true;
            }
        }

        createMainCanvas() {
            const mainCanvas = document.createElement('canvas');
            mainCanvas.classList.add('cmp-adaptiveform-scribble__canvas__main');
            mainCanvas.ariaLabel = FormView.LanguageUtils.getTranslatedString(this.lang, "SignatureCanvas");
            return mainCanvas;
        }

        drawCanvasesOnMainCanvas(mainCanvas, sigCnv, geoCnv) {
            const ctx = mainCanvas.getContext('2d');
            if (geoCnv && geoCnv.width > 0 && geoCnv.height > 0) {
                // Set the dimensions of the mainCanvas to accommodate both canvases vertically
                mainCanvas.width = Math.max(sigCnv.width, geoCnv.width);
                mainCanvas.height = sigCnv.height + geoCnv.height;
                // Draw the sign canvas on the main canvas
                ctx.drawImage(sigCnv, 0, 0);
                // Draw the geo canvas below the sign canvas
                ctx.drawImage(geoCnv, 0, sigCnv.height, geoCnv.width, geoCnv.height);
            } else {
                mainCanvas.width = sigCnv.width;
                mainCanvas.height = sigCnv.height;
                ctx.drawImage(sigCnv, 0, 0);
            }
        }

        updateSignedImage(newData) {
            const img = this.getSignedCanvasImage();
            img.src = newData;
            img.style.width = '100%';
            img.style.height = '150px';
        }

        addClearSignButton() {
            const clearSignButton = document.createElement('div');
            clearSignButton.setAttribute('role', 'button');
            clearSignButton.setAttribute('tabindex', '0');
            clearSignButton.setAttribute('aria-label', FormView.LanguageUtils.getTranslatedString(this.lang, 'clearSign') || 'Clear Signature');
            clearSignButton.classList.add('cmp-adaptiveform-scribble__clear-sign');

            const mainCanvasImageContainer = this.getCanvasContainer();
            mainCanvasImageContainer.appendChild(clearSignButton);

            clearSignButton.addEventListener('click', (e) => {
                e.stopPropagation();
                this.openClearSignModal();
            });
            // Keyboard accessibility: allow Enter/Space to trigger clear
            clearSignButton.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    this.openClearSignModal();
                }
            });
        }

        geoQueryErrorHandler(err){
            this.showMessage('errorFetchGeoLocation');
        }

        renderBrushList() {
            [2,3,4,5,6,7,8,9,10].forEach((brush) => {
                var divel = document.createElement('div');
                var cnv = document.createElement('canvas');
                var ctx = cnv.getContext('2d');
                cnv.style.border='1px solid #AAAAAA';
                cnv.width=100;
                cnv.height=20;
                cnv.style.backgroundColor = 'white';
                cnv.ariaLabel = FormView.LanguageUtils.getTranslatedString(this.lang, "brushSize") + brush;
                ctx.lineWidth=brush;
                ctx.beginPath();
                ctx.moveTo(10,cnv.height/2);
                ctx.lineTo(cnv.width-10,cnv.height/2);
                ctx.stroke();
                divel.appendChild(cnv);
                divel.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.context.lineWidth=brush;
                    this.toggleBrushList();
                })
                this.getBrushList().append(divel);
             });
        }

        resizeCanvas(percentage) {
            const signCanvas = this.getCanvas();
            const ctx = signCanvas.getContext('2d', { willReadFrequently: true });
            const container = this.getCanvasContainer();
            this.getSignCanvasesContainer().style.width = `${percentage}%`;
            
            // Ensure the canvas has valid dimensions
            if (signCanvas.width === 0 || signCanvas.height === 0) {
                return;
            }
            
            // Save the content of the canvas if it has valid dimensions
            let imgData = null;
            if (signCanvas.width > 0 && signCanvas.height > 0) {
                imgData = ctx.getImageData(0, 0, signCanvas.width, signCanvas.height);
            }
            // Calculate the new width based on the percentage of the container's width
            const newWidth = container.offsetWidth * (percentage / 100);
            // Set the new width and height of the canvas
            signCanvas.width = newWidth;
            // Restore the content back to the resized canvas if it has valid content
            if (imgData) {
                ctx.putImageData(imgData, 0, 0);
            }
        }

        geoQuerySuccessHandler(position) {
            if (position && position.coords) {
                this.showMessage('');
                const { latitude, longitude } = position.coords;
                const latStr = `Latitude: ${latitude}`;
                const longStr = `Longitude: ${longitude}`;
                const dateObj = new Date();
                const tZone = (dateObj.getTimezoneOffset() / 60) * -1;
                const timeStr = `${dateObj.getTime()}: ${(dateObj.getMonth() + 1)}/${dateObj.getDate()}/${dateObj.getFullYear()} ${dateObj.getHours()}:${dateObj.getMinutes()}:${dateObj.getSeconds()}${tZone > 0 ? ' +' : ' '}${tZone}`;
                this.updateGeoCanvas(latStr, longStr, timeStr);
            }
        }

        updateGeoCanvas(latStr, longStr, timeStr) {
            const geoCanvas = this.getGeoCanvas();
            geoCanvas.style.height = '50px';
            geoCanvas.style.width = '200px';
            geoCanvas.style.display = 'block';

            if (geoCanvas) {
                const ctx = geoCanvas.getContext('2d');
                geoCanvas.width = geoCanvas.offsetWidth;
                geoCanvas.height = geoCanvas.offsetHeight;

                ctx.font = 'bold 10px Arial'; // Font size and type
                ctx.fillStyle = 'black'; // Text color
                ctx.measureText("m").width * 1.5;
                let x = 0;
                let y = 15;

                // Draw the text on the canvas
                ctx.fillText(latStr, x, y);
                ctx.fillText(longStr, x, y + 15);
                ctx.fillText(timeStr, x, y + 30);
            }
        }

        handleGeoLocation() {
            if (navigator.geolocation) {
                this._geoLocQuery = new GeoLocationQuery();
                this._geoLocQuery.init(
                    this.geoQuerySuccessHandler.bind(this),
                    this.geoQueryErrorHandler.bind(this)
                );
                this._geoLocQuery.query();
                var message = FormView.LanguageUtils.getTranslatedString(this.lang, 'geoLocationFetch');
                this.showMessage(message);
            }
        }

        geoQueryErrorHandler(err) {
            var message = FormView.LanguageUtils.getTranslatedString(this.lang, 'geoLocationError')
            this.showMessage(message);
        }

        enableControls(controls) {
            controls.forEach(control => {
                const element = this.element.querySelector('[data-cmp-scribble-button="'+ control +'"]');
                element?.classList.remove('disable_button');
                element?.removeAttribute('disabled');
            });
        }

        disableControl(controls) {
            controls.forEach(control => {
                const element = this.element.querySelector('[data-cmp-scribble-button="'+ control +'"]');
                element?.classList.add('disable_button');
                element?.setAttribute('disabled', 'true');
            });
        }

        toggleBrushList(event) {
            var brushList = this.getBrushList();
            if(getComputedStyle(brushList).display === 'none') {
                brushList.style.display = 'block';
            } else {
                brushList.style.display = 'none';
            }
        }

        controlPanelClickHandler(event) {
            const scribbleButton = event.target.getAttribute('data-cmp-scribble-button');
            switch(scribbleButton){
                case 'save':
                    this.submitSign();
                    break;
                case 'close':
                    this.closeEditModal();
                    break;
                case 'clearSign':
                    this.eraseSignature();
                    this.widget.value = '';
                    break;
                case 'textSign':
                    this.enableSignatureTextBox();
                    break;
                case 'geolocation':
                    this.handleGeoLocation();
                    break;
                case 'brushes':
                    this.handleBrush(event);
                    this.toggleBrushList();
                    break;
            }
        }

        closeEditModal() {
            if(this.getCanvas()) this.getCanvas().style.display = 'block';
            if(!this._signSubmitted) {
                this.eraseSignature()
            }
            this.hideScribbleModal();
        }

        handleBrush(evt){
            this.getKeyboardSignBox().style.display = 'none';
            if (this.canvas.style.display == "none") {
                this.canvas.style.display = "block";
                this.context.clearRect(0, 0, this.canvas?.width, this.canvas?.height);
                this.eraseSignature();
                this.initializeCanvas();
            }
        }
        initScribbleModal() {
            const controlPanel = this.getScribbleControlPanel();
            const toggleBrushListIcon = this.getBrush();
            const brushList = this.getBrushList();
            const keyboardSignBox = this.getKeyboardSignBox();
        
            this.renderBrushList();
        
            this.addEventListeners(controlPanel, 'click', this.controlPanelClickHandler.bind(this));
        
            keyboardSignBox.addEventListener('input', (event) => {
                if (event?.target?.value) {
                    this.enableControls(['save', 'clearSign']);
                } else {
                    this.disableControl(['save', 'clearSign']);
                }
            });
        
            keyboardSignBox.addEventListener('keyup', () => {
                this.updateKeyboardSignBoxFont(keyboardSignBox);
            });
        
            document.addEventListener('click', (event) => {
                if (!brushList.contains(event.target) && !toggleBrushListIcon.contains(event.target)) {
                    brushList.style.display = 'none';
                }
            });
        }
        
        addEventListeners(element, eventType, handler, checkDisabled = false) {
            if (element) {
                element.addEventListener(eventType, (event) => {
                    if (!checkDisabled || element.getAttribute('disabled') !== 'true') {
                        handler(event);
                    }
                });
            }
        }
        
        updateKeyboardSignBoxFont(keyboardSignBox) {
            const fontFamily = "sans-serif, Georgia";
            const fontStyle = "italic";
            keyboardSignBox.style.font = `${fontStyle} 2rem ${fontFamily}`;
            const value = keyboardSignBox.value;
            const canvas = this.getCanvas();
            const ctx = this.context;
            const maxFontSize = 10; // rem
            const minFontSize = 1;  // rem
            // Set to max font size to measure
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // Find the largest font size that fits the text within the canvas width
            let fontSize = maxFontSize;
            ctx.font = `${fontStyle} ${fontSize}rem ${fontFamily}`;
            let textWidth = ctx.measureText(value).width;
            const canvasWidth = canvas.width;
            while (fontSize > minFontSize && textWidth > canvasWidth) {
                fontSize -= 0.5;
                ctx.font = `${fontStyle} ${fontSize}rem ${fontFamily}`;
                textWidth = ctx.measureText(value).width;
            }
            fontSize = Math.max(minFontSize, fontSize);
            ctx.font = `${fontStyle} ${fontSize}rem ${fontFamily}`;
            ctx.fillText(value, 0, canvas.height / 2);
        }

        enableSignatureTextBox() {
            this.eraseSignature();
            this.getKeyboardSignBox().style.display = "inline-block";
            this.getCanvas().style.display = "none";
        }

        eraseSignature() {
            this.context?.clearRect(0, 0, this.canvas?.width, this.canvas?.height);
            const geoCnv = this.getGeoCanvas();
            if(geoCnv) {
                const geoCanvasContext = geoCnv?.getContext('2d');
                geoCanvasContext?.clearRect(0, 0, geoCnv.width, geoCnv.height);
                geoCnv.style.display = 'none';
            }
            this.getKeyboardSignBox().value='';
            this.disableControl(['clearSign','save']);
        }

        resizeAndFixCanvas() {
            const dpr = window.devicePixelRatio || 1;
            let imgData = null;
            if (this.canvas.width > 0 && this.canvas.height > 0) {
                imgData = this.context.getImageData(0, 0, this.canvas.width, this.canvas.height);
            }
            this.canvas.width = this.canvas.offsetWidth * dpr;
            this.canvas.height = this.canvas.offsetHeight * dpr;
            if (imgData) {
                this.context.putImageData(imgData, 0, 0);
            }
        }

        handleCanvasEvent(event) {
            switch (event.type) {
                case 'mousedown':
                case 'touchstart':
                    this.startDrawing(event);
                    break;
                case 'mousemove':
                case 'touchmove':
                    this.draw(event);
                    break;
                case 'mouseup':
                case 'mouseleave':
                case 'touchend':
                case 'touchcancel':
                    this.stopDrawing();
                    break;
            }
        }

        addCanvasEventListeners() {
            const events = ['mousedown', 'mousemove', 'mouseup', 'mouseleave', 'touchstart', 'touchmove', 'touchend', 'touchcancel'];
            events.forEach(event => {
                this.canvas.addEventListener(event, this.handleCanvasEvent.bind(this));
            });
        }

        initializeCanvas() {
            if(this.existingSign) {
                this.getCanvasContainer().style.width = '100%';
                this.getMainCanvas().style.border = '1px solid black';
                this.getKeyboardSignBox().style.display = 'none';
                this.disableControl(['brushes','geolocation','clearSign','textSign','save']);
            } else {
                this.canvas = this.getCanvas();
                this.canvas.style.display = 'block';
                this.context = this.canvas.getContext('2d', { willReadFrequently: true });
                this.resizeCanvas(100);
                this.resizeAndFixCanvas();
                if (this.canvas) {
                    this.canvas.style.border = '1px dashed #AAAAAA';
                    this.getKeyboardSignBox().style.display = 'none';
                    this.addCanvasEventListeners();
                    this.isDrawing = false;
                }
            }
            // Add event listener for window resize to make the canvas responsive
            window.addEventListener('resize', this.resizeAndFixCanvas.bind(this));
        // }
        }

        showScribbleModal() {
            if(window.getComputedStyle(this.getScribbleContainer()).display !== 'block') {
                this.disableControl(['clearSign','save']);
            }
            const container = this.getScribbleContainer();
            container.style.display = 'block';
            // Set focus to the modal container for accessibility
            container.setAttribute('tabindex', '-1');
            container.focus();
        }

        hideScribbleModal() {
            this.getScribbleContainer().style.display = 'none';
        }

        scribbleContainerClickHandler() {
            this.showScribbleModal();
            this.initializeCanvas();
        }
        
        startDrawing(event) {
            // Ensure the context is initialized
            if (!this.context) {
                return;
            }
        
            // Normalize event coordinates for touch events
            const { offsetX, offsetY } = this.getEventCoordinates(event);
        
            this.isDrawing = true;
            this.context.beginPath();
            this.context.moveTo(offsetX, offsetY);
        }

        getMousePos(event) {
            const rect = this.canvas.getBoundingClientRect();
            const offsetX = event.clientX - rect.left;
            const offsetY = event.clientY - rect.top;
            return { offsetX, offsetY };
        }

        getEventCoordinates(event) {
            const rect = this.canvas.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            if (event.touches && event.touches.length > 0) {
                const touch = event.touches[0];
                return {
                    offsetX: (touch.clientX - rect.left) * dpr,
                    offsetY: (touch.clientY - rect.top) * dpr
                };
            } else {
                return {
                    offsetX: (event.clientX - rect.left) * dpr,
                    offsetY: (event.clientY - rect.top) * dpr
                };
            }
        }

        draw(event) {
            if (!this.isDrawing) return;
            const { offsetX, offsetY } = this.getEventCoordinates(event);
            this.context.lineTo(offsetX, offsetY);
            this.context.stroke();
            this.enableControls(['clearSign','save']);
        }

        stopDrawing() {
            if (this.isDrawing) {
                this.context.closePath();
                this.isDrawing = false;
            }
        }
    }

    FormView.Utils.setupField(({element, formContainer}) => {
        return new Scribble({element, formContainer})
    }, Scribble.selectors.self);
})();

/*******************************************************************************
 * Copyright 2025 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/
(function() {

    "use strict";
    class Datetime extends FormView.FormFieldBase {

        static NS = FormView.Constants.NS;
        /**
         * Each FormField has a data attribute class that is prefixed along with the global namespace to
         * distinguish between them. If a component wants to put a data-attribute X, the attribute in HTML would be
         * data-{NS}-{IS}-x=""
         * @type {string}
         */
        static IS = "adaptiveFormDatetime";
        static bemBlock = 'cmp-adaptiveform-datetime'
        static selectors  = {
            self: "[data-" + this.NS + '-is="' + this.IS + '"]',
            widget: `.${Datetime.bemBlock}__widget`,
            label: `.${Datetime.bemBlock}__label`,
            description: `.${Datetime.bemBlock}__longdescription`,
            qm: `.${Datetime.bemBlock}__questionmark`,
            errorDiv: `.${Datetime.bemBlock}__errormessage`,
            tooltipDiv: `.${Datetime.bemBlock}__shortdescription`,
            eyeIcon: `.${Datetime.bemBlock}__eyeicon`
        };

        constructor(params) {
            super(params);
        }

        getWidget() {
            return this.element.querySelector(Datetime.selectors.widget);
        }

        getDescription() {
            return this.element.querySelector(Datetime.selectors.description);
        }

        getLabel() {
            return this.element.querySelector(Datetime.selectors.label);
        }

        getErrorDiv() {
            return this.element.querySelector(Datetime.selectors.errorDiv);
        }

        getTooltipDiv() {
            return this.element.querySelector(Datetime.selectors.tooltipDiv);
        }

        getQuestionMarkDiv() {
            return this.element.querySelector(Datetime.selectors.qm);
        }

        setModel(model) {
            super.setModel(model);
            if (this.widget.value !== '') {
                this._model.value = this.widget.value;
            }
            this.widget.addEventListener('blur', (e) => {
                this._model.value = e.target.value;
                this.setInactive();
            });
            this.widget.addEventListener('focus', (e) => {
                this.setActive();
            });
        }

    }

    FormView.Utils.setupField(({element, formContainer}) => {
        return new Datetime({element, formContainer})
    }, Datetime.selectors.self);

})();
